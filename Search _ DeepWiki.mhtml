From: <Saved by Blink>
Snapshot-Content-Location: https://deepwiki.com/search/vllm-v1v0vllmworkercacheengine_2ef15c52-50e2-4db7-9076-4809f42995c8?mode=fast
Subject: Search | DeepWiki
Date: Mon, 27 Oct 2025 22:00:12 +0800
MIME-Version: 1.0
Content-Type: multipart/related;
	type="text/html";
	boundary="----MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----"


------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/html
Content-ID: <frame-BA6746DE93FD349C2375D1899C3C3834@mhtml.blink>
Content-Transfer-Encoding: quoted-printable
Content-Location: https://deepwiki.com/search/vllm-v1v0vllmworkercacheengine_2ef15c52-50e2-4db7-9076-4809f42995c8?mode=fast

<!DOCTYPE html><html lang=3D"en" class=3D"light" style=3D"color-scheme: lig=
ht;"><head><meta http-equiv=3D"Content-Type" content=3D"text/html; charset=
=3DUTF-8"><link rel=3D"stylesheet" type=3D"text/css" href=3D"cid:css-63b151=
db-15ef-4a4f-a85c-f690b81c1375@mhtml.blink" /><link rel=3D"stylesheet" type=
=3D"text/css" href=3D"cid:css-8f13f30f-e936-48e8-9f7d-c91f6ef3a077@mhtml.bl=
ink" /><link rel=3D"stylesheet" type=3D"text/css" href=3D"cid:css-fc5d1e29-=
5ad3-423d-96b7-7036dc7852eb@mhtml.blink" /><link rel=3D"stylesheet" type=3D=
"text/css" href=3D"cid:css-c34f4ee3-a26c-4e7d-b017-59ca33898d51@mhtml.blink=
" /><meta name=3D"viewport" content=3D"width=3Ddevice-width, initial-scale=
=3D1"><link rel=3D"stylesheet" href=3D"https://deepwiki.com/_next/static/cs=
s/de70bee13400563f.css?dpl=3Ddpl_FtMvNrLWw316N3P8owbGd4HX4iEE" data-precede=
nce=3D"next"><link rel=3D"stylesheet" href=3D"https://deepwiki.com/_next/st=
atic/css/2e0edb6b57d4c702.css?dpl=3Ddpl_FtMvNrLWw316N3P8owbGd4HX4iEE" data-=
precedence=3D"next"><link rel=3D"stylesheet" href=3D"https://deepwiki.com/_=
next/static/css/87600ca0112f3c8f.css?dpl=3Ddpl_FtMvNrLWw316N3P8owbGd4HX4iEE=
" data-precedence=3D"next"><link rel=3D"preload" as=3D"script" fetchpriorit=
y=3D"low" href=3D"https://deepwiki.com/_next/static/chunks/webpack-acbbbb54=
8492d4a6.js?dpl=3Ddpl_FtMvNrLWw316N3P8owbGd4HX4iEE"><meta name=3D"next-size=
-adjust" content=3D""><title>Search | DeepWiki</title><meta name=3D"descrip=
tion" content=3D"DeepWiki provides up-to-date documentation you can talk to=
, for every repo in the world. Think Deep Research for GitHub - powered by =
Devin."><meta property=3D"og:title" content=3D"Search | DeepWiki"><meta pro=
perty=3D"og:description" content=3D"DeepWiki provides up-to-date documentat=
ion you can talk to, for every repo in the world. Think Deep Research for G=
itHub - powered by Devin."><meta property=3D"og:url" content=3D"https://dee=
pwiki.com/search/vllm-v1v0vllmworkercacheengine_2ef15c52-50e2-4db7-9076-480=
9f42995c8"><meta property=3D"og:site_name" content=3D"DeepWiki"><meta prope=
rty=3D"og:type" content=3D"website"><meta name=3D"twitter:card" content=3D"=
summary"><meta name=3D"twitter:title" content=3D"Search | DeepWiki"><meta n=
ame=3D"twitter:description" content=3D"DeepWiki provides up-to-date documen=
tation you can talk to, for every repo in the world. Think Deep Research fo=
r GitHub - powered by Devin."><link rel=3D"icon" href=3D"https://deepwiki.c=
om/favicon.ico" type=3D"image/x-icon" sizes=3D"48x48"><link rel=3D"icon" hr=
ef=3D"https://deepwiki.com/icon.png?66aaf51e0e68c818" type=3D"image/png" si=
zes=3D"16x16"><link rel=3D"apple-touch-icon" href=3D"https://deepwiki.com/a=
pple-icon.png?a4f658907db0ab87" type=3D"image/png" sizes=3D"180x180"><link =
rel=3D"preload" href=3D"https://deepwiki.com/_next/static/media/4cf2300e9c8=
272f7-s.p.woff2" as=3D"font" crossorigin=3D"" type=3D"font/woff2"><link rel=
=3D"preload" href=3D"https://deepwiki.com/_next/static/media/93f479601ee12b=
01-s.p.woff2" as=3D"font" crossorigin=3D"" type=3D"font/woff2"><link rel=3D=
"preload" href=3D"https://deepwiki.com/_next/static/media/d3ebbfd689654d3a-=
s.p.woff2" as=3D"font" crossorigin=3D"" type=3D"font/woff2"></head><body cl=
ass=3D"__variable_188709 font-geist-sans relative min-h-screen __variable_9=
a8899 bg-background antialiased"><section aria-label=3D"Notifications alt+T=
" tabindex=3D"-1" aria-live=3D"polite" aria-relevant=3D"additions text" ari=
a-atomic=3D"false"></section><div class=3D"flex min-h-full w-full flex-col =
scroll-smooth" style=3D"scrollbar-gutter:stable"><div class=3D"bg-backgroun=
d border-b-border sticky top-0 z-30 border-b border-dashed"><div class=3D"f=
ont-geist-mono relative flex h-8 items-center justify-center text-xs font-m=
edium sm:hidden"><div class=3D"powered-by-devin-gradient absolute inset-0 z=
-[-1] h-8 w-full"></div><a class=3D"flex items-center gap-2" href=3D"https:=
//deepwiki.com/private-repo"><svg class=3D"size-3 [&amp;_path]:stroke-0 [&a=
mp;_path]:animate-[custom-pulse_1.8s_infinite_var(--delay,0s)]" xmlns=3D"ht=
tp://www.w3.org/2000/svg" viewBox=3D"110 110 460 500"><path style=3D"fill:#=
21c19a" class=3D"[--delay:0.6s]" d=3D"M418.73,332.37c9.84-5.68,22.07-5.68,3=
1.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,=
2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.0=
3.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.6=
5-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3=
.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.=
02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22=
.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v2=
9.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.=
71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65=
-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1=
.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10=
.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.6=
4.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,=
.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2=
.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.=
95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2=
.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.=
18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08=
-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8=
.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04=
-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89=
,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.7=
2c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95=
,15.95-27.63Z"></path><path style=3D"fill:#3969ca" d=3D"M141.09,317.65l50.9=
7,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.=
13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,=
1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.=
22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.=
91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.=
64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.=
28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65=
-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.=
65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.0=
2-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.=
34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29=
.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.7=
1c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-=
.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.=
71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.=
22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style=3D"fill:#0294de" c=
lass=3D"[--delay:1.2s]" d=3D"M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.=
24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.4=
7-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.2=
6-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.=
96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56=
-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1=
.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.1=
6l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.0=
1-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.=
8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.=
04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-=
.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.2=
7,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1=
.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.=
37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58=
s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2=
.25-8.11-5.9-10.22Z"></path></svg>Index your code with Devin</a></div><div =
class=3D"container-wrapper"><div class=3D"container mx-auto flex w-full fle=
x-row items-center gap-2 py-4 md:py-6"><a class=3D"flex items-center gap-3"=
 href=3D"https://deepwiki.com/"><span class=3D"text-base font-medium leadin=
g-none md:text-lg">DeepWiki</span></a><div class=3D"flex-1"></div><div clas=
s=3D"flex items-center gap-4"><a class=3D"group hidden items-center gap-1.5=
 md:flex" href=3D"https://deepwiki.com/private-repo"><div class=3D"relative=
"><span class=3D"text-foreground/70 group-hover:text-foreground text-xs fon=
t-light transition-colors">Index your code with</span><div class=3D"bg-fore=
ground/30 absolute bottom-0 left-0 h-[1px] w-0 transition-all duration-300 =
group-hover:w-full"></div></div><div class=3D"flex items-center gap-1 trans=
ition-transform duration-300 group-hover:translate-x-0.5"><svg class=3D"siz=
e-4 transform transition-transform duration-700 group-hover:rotate-180 [&am=
p;_path]:stroke-0" xmlns=3D"http://www.w3.org/2000/svg" viewBox=3D"110 110 =
460 500"><path style=3D"fill:#21c19a" class=3D"" d=3D"M418.73,332.37c9.84-5=
.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.1=
6.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.1=
3,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1=
l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22=
l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.1=
6-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.=
07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37=
,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31=
.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.=
21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.0=
5-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11=
-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.=
06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.1=
9.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.8=
8-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68=
,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.8=
6.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.=
31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.=
58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.=
86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1=
.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25=
-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,=
1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-=
27.63s6.11-21.95,15.95-27.63Z"></path><path style=3D"fill:#3969ca" d=3D"M14=
1.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.9=
7-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.=
57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.=
19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.6=
3s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.=
87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,=
2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l=
50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l=
-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16=
-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.0=
7.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,=
1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.=
91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.2=
1-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05=
-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-=
5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style=3D=
"fill:#0294de" class=3D"" d=3D"M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06=
-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2=
.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88=
.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-1=
5.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.=
56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51=
-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-=
.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6=
.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.=
1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.0=
4.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.7=
5-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16=
.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69=
,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,=
1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.=
58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22=
-2.25-8.11-5.9-10.22Z"></path></svg><span class=3D"text-sm font-medium">Dev=
in</span></div></a><button class=3D"flex items-center rounded-md !text-whit=
e cursor-pointer transition-all border bg-blue-500 hover:bg-blue-600 border=
-blue-500 hover:border-blue-600 dark:bg-blue-900 dark:hover:bg-blue-800 dar=
k:border-blue-900 dark:hover:border-blue-800 disabled:cursor-default disabl=
ed:opacity-50 disabled:hover:bg-blue-500 disabled:hover:border-blue-500 dar=
k:disabled:hover:bg-blue-900 dark:disabled:hover:border-blue-900 gap-1.5 px=
-3 py-1.5 text-sm" aria-label=3D"Share" data-state=3D"closed" data-slot=3D"=
tooltip-trigger"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"24" hei=
ght=3D"24" viewBox=3D"0 0 24 24" fill=3D"none" stroke=3D"currentColor" stro=
ke-width=3D"2" stroke-linecap=3D"round" stroke-linejoin=3D"round" class=3D"=
h-4 w-4"><circle cx=3D"18" cy=3D"5" r=3D"3"></circle><circle cx=3D"6" cy=3D=
"12" r=3D"3"></circle><circle cx=3D"18" cy=3D"19" r=3D"3"></circle><line x1=
=3D"8.59" y1=3D"13.51" x2=3D"15.42" y2=3D"17.49"></line><line x1=3D"15.41" =
y1=3D"6.51" x2=3D"8.59" y2=3D"10.49"></line></svg><span>Share</span></butto=
n><button class=3D"hover:bg-surface-hover flex h-8 w-8 cursor-pointer items=
-center justify-center rounded-md transition-colors" aria-label=3D"Switch t=
o dark mode"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=
=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-5 w-5 tex=
t-gray-700"><path d=3D"M235.54,150.21a104.84,104.84,0,0,1-37,52.91A104,104,=
0,0,1,32,120,103.09,103.09,0,0,1,52.88,57.48a104.84,104.84,0,0,1,52.91-37,8=
,8,0,0,1,10,10,88.08,88.08,0,0,0,109.8,109.8,8,8,0,0,1,10,10Z"></path></svg=
></button></div></div></div></div><div class=3D"absolute right-2 top-[50%] =
z-20 -translate-y-1/2 lg:block xl:right-8 2xl:right-12"><div class=3D"relat=
ive"><div class=3D"flex flex-col gap-3 px-1 py-4"><div class=3D"h-0.5 w-4 c=
ursor-pointer rounded-full shadow-sm transition-colors bg-white shadow-whit=
e/70"></div><div class=3D"h-0.5 w-4 cursor-pointer rounded-full shadow-sm t=
ransition-colors bg-neutral-400 shadow-neutral-400/70"></div><div class=3D"=
h-0.5 w-4 cursor-pointer rounded-full shadow-sm transition-colors bg-neutra=
l-400 shadow-neutral-400/70"></div></div></div></div><div class=3D"containe=
r-wrapper flex-1"><div class=3D"container relative mx-auto"><div class=3D"p=
b-36"><div id=3D"1" class=3D"flex flex-col gap-3 pt-6 lg:flex-row" data-que=
ry-display=3D"true" data-query-index=3D"0"><div class=3D"flex max-h-fit min=
-w-0 flex-1 flex-shrink-0 flex-col xl:[flex-grow:2]"><div><div class=3D"fle=
x flex-col"><a class=3D"flex items-center gap-1 text-base text-neutral-400 =
transition-colors hover:text-black dark:hover:text-white" href=3D"https://d=
eepwiki.com/vllm-project/vllm"><svg xmlns=3D"http://www.w3.org/2000/svg" wi=
dth=3D"16" height=3D"16" fill=3D"currentColor" viewBox=3D"0 0 256 256"><pat=
h d=3D"M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-7=
2a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224=
,128Z"></path></svg>vllm-project/vllm</a><div class=3D"min-w-0 flex-1 pt-1"=
><div class=3D"flex flex-col items-start gap-2 text-white"><span class=3D"t=
ext-xl xl:text-2xl w-full [overflow-wrap:break-word]">=E5=9C=A8Vllm V1=E4=
=B8=AD=EF=BC=8C=E5=8E=9F=E5=A7=8BV0=E7=9A=84vllm.worker.cache_engine.py=E4=
=B8=ADCacheEngine=E7=B1=BB=E7=9A=84allocate_kv_cache=E7=9B=B8=E5=85=B3=E9=
=80=BB=E8=BE=91=E8=A2=AB=E6=94=BE=E5=88=B0=E5=93=AA=E4=BA=86=EF=BC=9F <butt=
on class=3D"relative ml-2 cursor-pointer align-baseline text-gray-400 opaci=
ty-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:o=
pacity-100" aria-label=3D"Copy link to query"><svg xmlns=3D"http://www.w3.o=
rg/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"=
0 0 256 256" class=3D"h-4 w-4"><path d=3D"M117.18,188.74a12,12,0,0,1,0,17l-=
5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89=
,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0=
,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0=
,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,=
0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,4=
9L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72=
,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,=
41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button><=
/span></div></div></div><div class=3D"py-2"><div class=3D"text-primary/70 f=
lex flex-col gap-2 text-sm"><div class=3D"flex items-center justify-between=
 gap-2"><div class=3D"inline-flex items-center rounded-full px-2.5 py-1 tex=
t-xs font-medium bg-neutral-400/10 text-neutral-500 dark:bg-neutral-600/10 =
dark:text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1=
2" height=3D"12" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"mr-=
1"><path d=3D"M213.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,1=
43.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,=
0,0,1,3,12.95Z"></path></svg>Fast</div></div></div></div><div class=3D"h-fi=
t rounded-lg" style=3D"scrollbar-width: thin; scrollbar-color: rgb(58, 58, =
58) transparent;"><div class=3D"dark:[&amp;_pre:has(code)]:bg-shade dark:[&=
amp;_code[data-lang]]:bg-shade relative flex flex-col gap-1 rounded-md bord=
er-[0.5px] border-[#d0d0d0] bg-[#f8f8f8] p-4 text-white [overflow-wrap:anyw=
here] dark:border-[#2F2F2F] dark:bg-[#141414] [&amp;_pre]:my-3"><div class=
=3D"prose-custom prose-custom-md prose-custom-gray !max-w-none text-neutral=
-300 [overflow-wrap:anywhere]"><p>=E6=82=A8=E8=AF=A2=E9=97=AE=E7=9A=84=E6=
=98=AF=E5=9C=A8 vLLM V1 =E4=B8=AD,=E5=8E=9F=E6=9C=AC V0 =E7=89=88=E6=9C=AC=
=E7=9A=84 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] =
text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484=
848]/30">vllm.worker.cache_engine.py</code> =E4=B8=AD <code class=3D"rounde=
d-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15=
px] before:hidden after:hidden dark:bg-[#484848]/30">CacheEngine</code> =E7=
=B1=BB=E7=9A=84 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.2=
0rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg=
-[#484848]/30">allocate_kv_cache</code> =E7=9B=B8=E5=85=B3=E9=80=BB=E8=BE=
=91=E8=A2=AB=E7=A7=BB=E5=88=B0=E4=BA=86=E5=93=AA=E9=87=8C=E3=80=82</p>
<h2 class=3D"group">=E5=9B=9E=E7=AD=94  </h2>
<p>=E5=9C=A8 vLLM V1 =E4=B8=AD,KV cache =E7=9A=84=E5=88=86=E9=85=8D=E9=80=
=BB=E8=BE=91=E7=BB=8F=E8=BF=87=E4=BA=86=E9=87=8D=E5=A4=A7=E9=87=8D=E6=9E=84=
,=E4=B8=BB=E8=A6=81=E5=88=86=E6=95=A3=E5=88=B0=E4=BB=A5=E4=B8=8B=E5=87=A0=
=E4=B8=AA=E7=BB=84=E4=BB=B6=E4=B8=AD:</p>
<h3 class=3D"group">1. KV Cache =E5=88=9D=E5=A7=8B=E5=8C=96 - <code class=
=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal l=
eading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">EngineCore._=
initialize_kv_caches()</code>  </h3>
<p>V1 =E7=9A=84 KV cache =E5=88=9D=E5=A7=8B=E5=8C=96=E9=80=BB=E8=BE=91=E7=
=8E=B0=E5=9C=A8=E4=BD=8D=E4=BA=8E <code class=3D"rounded-sm bg-[#e5e5e5] px=
-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden af=
ter:hidden dark:bg-[#484848]/30">EngineCore._initialize_kv_caches()</code> =
=E6=96=B9=E6=B3=95=E4=B8=AD <span role=3D"link" tabindex=3D"0" class=3D"bg-=
pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-poi=
nter rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px=
] transition-colors duration-100 before:hidden after:hidden" style=3D"font-=
family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font=
-weight: 400; font-style: normal;">core.py:202-247</span> =E3=80=82=E8=AF=
=A5=E6=96=B9=E6=B3=95=E8=B4=9F=E8=B4=A3:</p>
<ul>
<li>=E4=BB=8E model executor =E8=8E=B7=E5=8F=96 KV cache =E8=A7=84=E6=A0=BC=
 <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific act=
ive:bg-pacific/20 hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem=
] py-[0.12rem] text-xs font-normal leading-[15px] transition-colors duratio=
n-100 before:hidden after:hidden" style=3D"font-family: &quot;IBM Plex Mono=
&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: 400; font-style: n=
ormal;">core.py:208</span></li>
<li>=E7=A1=AE=E5=AE=9A=E5=8F=AF=E7=94=A8=E7=9A=84 GPU =E5=86=85=E5=AD=98 <s=
pan role=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active=
:bg-pacific/20 hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] p=
y-[0.12rem] text-xs font-normal leading-[15px] transition-colors duration-1=
00 before:hidden after:hidden" style=3D"font-family: &quot;IBM Plex Mono&qu=
ot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: 400; font-style: norm=
al;">core.py:224</span></li>
<li>=E7=94=9F=E6=88=90 KV cache =E9=85=8D=E7=BD=AE <span role=3D"link" tabi=
ndex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:b=
g-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs fo=
nt-normal leading-[15px] transition-colors duration-100 before:hidden after=
:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mo=
no Fallback&quot;; font-weight: 400; font-style: normal;">core.py:232-235</=
span></li>
<li>=E5=88=9D=E5=A7=8B=E5=8C=96 model executor =E7=9A=84 KV cache <span rol=
e=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pac=
ific/20 hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12=
rem] text-xs font-normal leading-[15px] transition-colors duration-100 befo=
re:hidden after:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &q=
uot;IBM Plex Mono Fallback&quot;; font-weight: 400; font-style: normal;">co=
re.py:240</span></li>
</ul>
<h3 class=3D"group">2. Worker =E5=B1=82=E9=9D=A2=E7=9A=84 KV Cache =E5=88=
=86=E9=85=8D  </h3>
<p>=E5=9C=A8 worker =E5=B1=82=E9=9D=A2,KV cache =E7=9A=84=E5=AE=9E=E9=99=85=
=E5=86=85=E5=AD=98=E5=88=86=E9=85=8D=E5=8F=91=E7=94=9F=E5=9C=A8:</p>
<p><strong>GPU Worker:</strong></p>
<ul>
<li><code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-x=
s font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/3=
0">GPUModelRunner._allocate_kv_cache_tensors()</code> =E8=B4=9F=E8=B4=A3=E5=
=88=86=E9=85=8D KV cache =E5=BC=A0=E9=87=8F <span role=3D"link" tabindex=3D=
"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacif=
ic/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-norm=
al leading-[15px] transition-colors duration-100 before:hidden after:hidden=
" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fall=
back&quot;; font-weight: 400; font-style: normal;">gpu_model_runner.py:4263=
-4293</span></li>
<li>=E8=AF=A5=E6=96=B9=E6=B3=95=E6=A0=B9=E6=8D=AE <code class=3D"rounded-sm=
 bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] =
before:hidden after:hidden dark:bg-[#484848]/30">KVCacheConfig</code> =E5=
=88=9B=E5=BB=BA=E5=AE=9E=E9=99=85=E7=9A=84 GPU =E5=86=85=E5=AD=98=E7=BC=93=
=E5=86=B2=E5=8C=BA <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/1=
0 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer roun=
ded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] transit=
ion-colors duration-100 before:hidden after:hidden" style=3D"font-family: &=
quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: =
400; font-style: normal;">core.py:113-119</span></li>
</ul>
<p><strong>TPU Worker:</strong></p>
<ul>
<li><code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-x=
s font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/3=
0">TPUModelRunner.initialize_kv_cache()</code> =E6=89=A7=E8=A1=8C=E7=B1=BB=
=E4=BC=BC=E7=9A=84=E5=8A=9F=E8=83=BD <span role=3D"link" tabindex=3D"0" cla=
ss=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 c=
ursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal lead=
ing-[15px] transition-colors duration-100 before:hidden after:hidden" style=
=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&qu=
ot;; font-weight: 400; font-style: normal;">tpu_model_runner.py:1770-1862</=
span></li>
</ul>
<h3 class=3D"group">3. =E8=BF=90=E8=A1=8C=E6=97=B6=E7=9A=84 KV Cache =E5=9D=
=97=E5=88=86=E9=85=8D - <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem]=
 py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden=
 dark:bg-[#484848]/30">KVCacheManager</code>  </h3>
<p>=E8=BF=90=E8=A1=8C=E6=97=B6=E7=9A=84 KV cache =E5=9D=97=E5=88=86=E9=85=
=8D=E9=80=BB=E8=BE=91=E7=8E=B0=E5=9C=A8=E7=94=B1 <code class=3D"rounded-sm =
bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] b=
efore:hidden after:hidden dark:bg-[#484848]/30">KVCacheManager.allocate_slo=
ts()</code> =E5=A4=84=E7=90=86 <span role=3D"link" tabindex=3D"0" class=3D"=
bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-=
pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[1=
5px] transition-colors duration-100 before:hidden after:hidden" style=3D"fo=
nt-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; f=
ont-weight: 400; font-style: normal;">kv_cache_manager.py:224-268</span> =
=E3=80=82=E8=AF=A5=E6=96=B9=E6=B3=95:</p>
<ul>
<li>=E8=AE=A1=E7=AE=97=E9=9C=80=E8=A6=81=E5=88=86=E9=85=8D=E7=9A=84=E5=9D=
=97=E6=95=B0 <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text=
-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer rounded-md=
 px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] transition-co=
lors duration-100 before:hidden after:hidden" style=3D"font-family: &quot;I=
BM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: 400; f=
ont-style: normal;">kv_cache_manager.py:295-300</span></li>
<li>=E6=A3=80=E6=9F=A5=E6=98=AF=E5=90=A6=E6=9C=89=E8=B6=B3=E5=A4=9F=E7=9A=
=84=E7=A9=BA=E9=97=B2=E5=9D=97 <span role=3D"link" tabindex=3D"0" class=3D"=
bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-=
pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[1=
5px] transition-colors duration-100 before:hidden after:hidden" style=3D"fo=
nt-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; f=
ont-weight: 400; font-style: normal;">kv_cache_manager.py:302-304</span></l=
i>
<li>=E9=80=9A=E8=BF=87 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] =
py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden =
dark:bg-[#484848]/30">KVCacheCoordinator</code> =E5=88=86=E9=85=8D=E6=96=B0=
=E5=9D=97 <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pa=
cific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer rounded-md px=
-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] transition-color=
s duration-100 before:hidden after:hidden" style=3D"font-family: &quot;IBM =
Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: 400; font=
-style: normal;">kv_cache_manager.py:320-322</span></li>
</ul>
<p>=E5=BA=95=E5=B1=82=E7=9A=84=E5=9D=97=E5=88=86=E9=85=8D=E7=94=B1 <code cl=
ass=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-norma=
l leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">KVCacheCo=
ordinator.allocate_new_blocks()</code> =E6=89=A7=E8=A1=8C <span role=3D"lin=
k" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 =
hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] tex=
t-xs font-normal leading-[15px] transition-colors duration-100 before:hidde=
n after:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM =
Plex Mono Fallback&quot;; font-weight: 400; font-style: normal;">kv_cache_c=
oordinator.py:101-126</span> =E3=80=82</p>
<h2 class=3D"group">Notes  </h2>
<p>V1 =E6=9E=B6=E6=9E=84=E5=B0=86 V0 =E7=9A=84=E5=8D=95=E4=B8=80 <code clas=
s=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal =
leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">CacheEngine=
</code> =E7=B1=BB=E6=8B=86=E5=88=86=E6=88=90=E4=BA=86=E5=A4=9A=E4=B8=AA=E4=
=B8=93=E9=97=A8=E7=9A=84=E7=BB=84=E4=BB=B6:</p>
<ul>
<li><strong>=E5=88=9D=E5=A7=8B=E5=8C=96=E9=98=B6=E6=AE=B5</strong>: <code c=
lass=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-norm=
al leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">EngineCo=
re._initialize_kv_caches()</code> =E8=B4=9F=E8=B4=A3=E9=85=8D=E7=BD=AE=E5=
=92=8C=E5=88=9D=E5=A7=8B=E5=8C=96</li>
<li><strong>=E5=86=85=E5=AD=98=E5=88=86=E9=85=8D</strong>: Worker =E7=9A=84=
 model runner =E8=B4=9F=E8=B4=A3=E5=AE=9E=E9=99=85=E7=9A=84=E5=BC=A0=E9=87=
=8F=E5=88=86=E9=85=8D</li>
<li><strong>=E8=BF=90=E8=A1=8C=E6=97=B6=E7=AE=A1=E7=90=86</strong>: <code c=
lass=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-norm=
al leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">KVCacheM=
anager</code> =E5=92=8C <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem]=
 py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden=
 dark:bg-[#484848]/30">KVCacheCoordinator</code> =E8=B4=9F=E8=B4=A3=E5=9D=
=97=E7=BA=A7=E5=88=AB=E7=9A=84=E5=88=86=E9=85=8D=E5=92=8C=E7=AE=A1=E7=90=86=
</li>
</ul>
<p>=E8=BF=99=E7=A7=8D=E8=AE=BE=E8=AE=A1=E4=BD=BF=E5=BE=97 KV cache =E7=AE=
=A1=E7=90=86=E6=9B=B4=E5=8A=A0=E6=A8=A1=E5=9D=97=E5=8C=96,=E6=94=AF=E6=8C=
=81=E6=9B=B4=E5=A4=8D=E6=9D=82=E7=9A=84=E5=9C=BA=E6=99=AF=E5=A6=82 prefix c=
aching=E3=80=81chunked prefill =E7=AD=89 <span role=3D"link" tabindex=3D"0"=
 class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/=
20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal =
leading-[15px] transition-colors duration-100 before:hidden after:hidden" s=
tyle=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallbac=
k&quot;; font-weight: 400; font-style: normal;">v1_guide.md:49-53</span> =
=E3=80=82</p>
<p>Wiki pages you might want to explore:</p>
<ul>
<li><a href=3D"https://deepwiki.com/vllm-project/vllm/2.4-request-processin=
g-and-scheduling">Request Processing and Scheduling (vllm-project/vllm)</a>=
</li>
</ul></div><div class=3D"mt-4 flex justify-end gap-2"><button data-state=3D=
"closed" data-slot=3D"tooltip-trigger"><button class=3D"border-border bg-su=
rface hover:border-border-hover hover:bg-component flex cursor-pointer item=
s-center gap-1.5 rounded-md border px-3 py-2 text-sm transition-colors" ari=
a-label=3D"Copy" type=3D"button" id=3D"radix-=C2=ABr0=C2=BB" aria-haspopup=
=3D"menu" aria-expanded=3D"false" data-state=3D"closed"><svg xmlns=3D"http:=
//www.w3.org/2000/svg" width=3D"24" height=3D"24" viewBox=3D"0 0 24 24" fil=
l=3D"none" stroke=3D"currentColor" stroke-width=3D"2" stroke-linecap=3D"rou=
nd" stroke-linejoin=3D"round" class=3D"lucide lucide-copy h-4 w-4" aria-hid=
den=3D"true"><rect width=3D"14" height=3D"14" x=3D"8" y=3D"8" rx=3D"2" ry=
=3D"2"></rect><path d=3D"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .=
9 2 2"></path></svg></button></button><button class=3D"flex items-center ro=
unded-md cursor-pointer transition-all border border-border bg-surface hove=
r:border-border-hover hover:bg-component disabled:cursor-default disabled:o=
pacity-50 disabled:hover:border-border disabled:hover:bg-surface gap-1.5 px=
-3 py-1.5 text-sm" aria-label=3D"Share" data-state=3D"closed" data-slot=3D"=
tooltip-trigger"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"24" hei=
ght=3D"24" viewBox=3D"0 0 24 24" fill=3D"none" stroke=3D"currentColor" stro=
ke-width=3D"2" stroke-linecap=3D"round" stroke-linejoin=3D"round" class=3D"=
h-4 w-4"><circle cx=3D"18" cy=3D"5" r=3D"3"></circle><circle cx=3D"6" cy=3D=
"12" r=3D"3"></circle><circle cx=3D"18" cy=3D"19" r=3D"3"></circle><line x1=
=3D"8.59" y1=3D"13.51" x2=3D"15.42" y2=3D"17.49"></line><line x1=3D"15.41" =
y1=3D"6.51" x2=3D"8.59" y2=3D"10.49"></line></svg></button></div></div></di=
v></div></div><div class=3D"min-w-0 flex-1 scroll-smooth xl:[flex-grow:3]" =
style=3D"scrollbar-width: thin; scrollbar-color: rgb(90, 90, 90) transparen=
t; min-height: unset;"><div class=3D"sticky left-0 top-20 overflow-y-auto r=
ounded-md" style=3D"max-height: calc(-135px + 100vh);"><div class=3D"flex f=
lex-col gap-3 p-0 pb-[90px]"><div id=3D"file-Repo vllm-project/vllm: vllm/v=
1/engine/core.py" class=3D"flex flex-col gap-2 scroll-smooth rounded-md" st=
yle=3D"content-visibility: auto;"><div class=3D"scrollbar-hide relative w-f=
ull p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-secondary dark=
:bg-surface sticky top-0 z-10 flex w-full items-center justify-between px-3=
 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"flex min-w-0 g=
row items-center gap-2"><button><svg xmlns=3D"http://www.w3.org/2000/svg" w=
idth=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" c=
lass=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A=
8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path=
></svg></button><div class=3D"[&amp;_svg_path]:fill-current size-4 flex-shr=
ink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width: 20px;"><svg v=
iewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8c0 .2=
-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-3.3.3=
-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.1-.4-=
.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 1.4.6=
.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3.8.8.=
8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.3-2.3=
v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.3 3.3=
-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.4v1.3=
c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-.6-.4=
-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4-.3-.=
8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div><a hre=
f=3D"https://github.com/vllm-project/vllm" target=3D"_blank" rel=3D"norefer=
rer" class=3D"cursor-pointer truncate text-neutral-500 hover:underline">vll=
m-project/vllm</a><a href=3D"https://github.com/vllm-project/vllm/blob/352c=
0c8a/vllm/v1/engine/core.py" target=3D"_blank" rel=3D"noreferrer" class=3D"=
cursor-pointer truncate text-black dark:text-neutral-300 hover:underline">v=
llm/v1/engine/core.py</a><button><svg xmlns=3D"http://www.w3.org/2000/svg" =
width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" =
class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,0,0-8,8V80H4=
0a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40=
A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z=
"></path></svg></button></div></div><div class=3D"scrollbar-hide grid overf=
low-auto scroll-smooth"><button class=3D"h-5 w-full cursor-pointer bg-[#f0f=
0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><=
div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-ligh=
t text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em"=
 height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 =
w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,=
1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM21=
6,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><di=
v class=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-h=
idden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family:=
 Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, C=
ourier, monospace; direction: ltr; text-align: left; white-space: pre; word=
-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em;=
 tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; bor=
der: 1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><=
code style=3D"white-space: pre; font-size: 12px;"><span style=3D"background=
-color: rgb(248, 248, 248); display: block; white-space: pre; padding: 0px =
20px;"><span class=3D"linenumber react-syntax-highlighter-line-number" styl=
e=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; text-ali=
gn: right; user-select: none; font-size: 11px; font-weight: normal; font-fa=
mily: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: ital=
ic;">110</span><span>        self</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>available_gpu_memory_for_kv_cache </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span> <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span=
 class=3D"token" style=3D"color: rgb(54, 172, 170);">1</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">111</span>
</span><span style=3D"background-color: rgb(248, 248, 248); display: block;=
 white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-synt=
ax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25=
em; padding-right: 1em; text-align: right; user-select: none; font-size: 11=
px; font-weight: normal; font-family: monospace; padding-left: 8px; color: =
rgb(0, 128, 0); font-style: italic;">112</span><span>        </span><span c=
lass=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># Setup=
 KV Caches and update CacheConfig after profiling.</span></span></code></pr=
e></div><div class=3D"citation-0-6"><div class=3D"relative w-full min-w-max=
 overflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snip=
pet cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Cons=
olas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courie=
r, monospace; direction: ltr; text-align: left; white-space: pre; word-spac=
ing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-=
size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: =
1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><code =
style=3D"white-space: pre; font-size: 12px;"><span style=3D"background-colo=
r: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px=
;"><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D=
"display: inline-block; min-width: 2.25em; padding-right: 1em; text-align: =
right; user-select: none; font-size: 11px; font-weight: normal; font-family=
: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;"=
>113</span><span>        num_gpu_blocks</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> num_cpu_blocks</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> kv_cache_confi=
g </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span>=
<span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.=
</span><span>_initialize_kv_caches</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">114</span>            vllm_con=
fig
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">115</span><span>        </span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">116</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">117</span><span>        vllm_config</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
cache_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
.</span><span>num_gpu_blocks </span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">=3D</span><span> num_gpu_blocks
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">118</span><span>        vllm_c=
onfig</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>cache_config</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">.</span><span>num_cpu_blocks </span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">=3D</span><span> num_cpu_blocks
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">119</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
collective_rpc</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">(</span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"initial=
ize_cache"</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,<=
/span><span> args</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">=3D</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</s=
pan><span>num_gpu_blocks</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">,</span><span> num_cpu_blocks</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">)</span></span></code></pre></div></div><div class=3D"rel=
ative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-neutr=
al-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, &qu=
ot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monosp=
ace; direction: ltr; text-align: left; white-space: pre; word-spacing: norm=
al; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; =
hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px solid=
 rgb(221, 221, 221); background-color: white; width: 100%;"><code style=3D"=
white-space: pre; font-size: 12px;"><span style=3D"background-color: rgb(24=
8, 248, 248); display: block; white-space: pre; padding: 0px 20px;"><span c=
lass=3D"linenumber react-syntax-highlighter-line-number" style=3D"display: =
inline-block; min-width: 2.25em; padding-right: 1em; text-align: right; use=
r-select: none; font-size: 11px; font-weight: normal; font-family: monospac=
e; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">120</span=
><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">121</span><span>        self</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>s=
tructured_output_manager </span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">=3D</span><span> StructuredOutputManager</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">(</span><span>vllm_config</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">122</span></span></code></pre><=
/div><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e=
0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h=
-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"=
><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fil=
l=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M50=
.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-=
58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,=
0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><button class=3D"h-5 =
w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 d=
ark:hover:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5=
 pl-[1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.=
w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=
=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.3=
2,11.32L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.=
32l72-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"><=
/path></svg></div></button><div class=3D"relative w-full min-w-max overflow=
-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color:=
 rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quo=
t;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align=
: left; white-space: pre; word-spacing: normal; word-break: normal; font-si=
ze: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; ma=
rgin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background=
-color: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12=
px;"><span style=3D"background-color: rgb(248, 248, 248); display: block; w=
hite-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax=
-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25em=
; padding-right: 1em; text-align: right; user-select: none; font-size: 11px=
; font-weight: normal; font-family: monospace; padding-left: 8px; color: rg=
b(0, 128, 0); font-style: italic;">199</span><span>            self</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>step <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span=
> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</spa=
n><span>batch_queue </span><span class=3D"token" style=3D"color: rgb(0, 0, =
255);">is</span><span> </span><span class=3D"token" style=3D"color: rgb(54,=
 172, 170);">None</span><span> </span><span class=3D"token" style=3D"color:=
 rgb(0, 0, 255);">else</span><span> self</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">.</span><span>step_with_batch_queue
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">200</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">201</span></span></code></pre><=
/div><div class=3D"citation-0-0 citation-0-1 citation-0-2 citation-0-3 cita=
tion-0-4"><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_pr=
e]:overflow-hidden bg-[#6096FF]/10 clickable-snippet cursor-pointer"><pre s=
tyle=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera=
 Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: l=
tr; text-align: left; white-space: pre; word-spacing: normal; word-break: n=
ormal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; pa=
dding: 0px; margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 22=
1); background-color: white; width: 100%;"><code style=3D"white-space: pre;=
 font-size: 12px;"><span style=3D"background-color: var(--bg-secondary); di=
splay: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumb=
er react-syntax-highlighter-line-number" style=3D"display: inline-block; mi=
n-width: 2.25em; padding-right: 1em; text-align: right; user-select: none; =
font-size: 11px; font-weight: normal; font-family: monospace; padding-left:=
 8px; color: rgb(0, 128, 0); font-style: italic;">202</span><span>    </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">_initialize_k=
v_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</s=
pan><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">203</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 vllm_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
:</span><span> VllmConfig
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">204</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">tuple</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">[</span><span class=3D"token builtin">int</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><span =
class=3D"token builtin">int</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">,</span><span> KVCacheConfig</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">205</span><span>        start =
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><s=
pan> time</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</=
span><span>time</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span>=
<span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">206</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">207</span><span>        </span><span =
class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># Get =
all kv cache needed by the model</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">208</span><span>        kv_cac=
he_specs </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
</span><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">.</span><span>model_executor</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">.</span><span>get_kv_cache_specs</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">209</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">210</span><span>        has_kv_cache =
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><s=
pan> </span><span class=3D"token builtin">any</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_spec </span><span c=
lass=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> kv_cache_s=
pec </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</span>=
<span> kv_cache_specs</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">211</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> has=
_kv_cache</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</=
span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">212</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span>=
 os</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>environ</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
.</span><span>get</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">(</span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"VLLM=
_ELASTIC_EP_SCALE_UP_LAUNCH"</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">)</span><span> </span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">=3D=3D</span><span> </span><span class=3D"token" style=
=3D"color: rgb(163, 21, 21);">"1"</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">213</span><span>              =
  dp_group </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
=3D</span><span> </span><span class=3D"token builtin">getattr</span><span c=
lass=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>self</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </spa=
n><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"dp_group"</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </s=
pan><span class=3D"token" style=3D"color: rgb(54, 172, 170);">None</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">214</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</spa=
n><span> dp_group </span><span class=3D"token" style=3D"color: rgb(0, 0, 25=
5);">is</span><span> </span><span class=3D"token" style=3D"color: rgb(0, 0,=
 255);">not</span><span> </span><span class=3D"token" style=3D"color: rgb(5=
4, 172, 170);">None</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">215</span><span>              =
  self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</spa=
n><span>available_gpu_memory_for_kv_cache </span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">216</span><span>              =
      ParallelConfig</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">.</span><span>sync_kv_cache_memory_size</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">(</span><span>dp_group</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=3D"toke=
n" style=3D"color: rgb(54, 172, 170);">1</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">217</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><s=
pan>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">218</span><span>              =
  available_gpu_memory </span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">[</span><span>self</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">.</span><span>available_gpu_memory_for_kv_cache</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span> </s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">*</span><span> =
</span><span class=3D"token builtin">len</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">219</span>                    =
kv_cache_specs
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">220</span><span>                </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">221</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">222</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: =
italic;"># Profiles the peak memory usage of the model to determine how</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">223</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: =
italic;"># much memory can be allocated for kv cache.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">224</span><span>              =
  available_gpu_memory </span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">=3D</span><span> self</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>model_executor</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">.</span><span>determine_available_memor=
y</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">225</span><span>              =
  self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</spa=
n><span>available_gpu_memory_for_kv_cache </span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">=3D</span><span> available_gpu_memory</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span class=
=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">226</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">227</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: ital=
ic;"># Attention free models don't need memory for kv cache</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">228</span><span>            av=
ailable_gpu_memory </span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">[</span><span class=3D"token" style=3D"color: rgb(54, 172, 170)=
;">0</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span>=
<span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">*</sp=
an><span> </span><span class=3D"token builtin">len</span><span class=3D"tok=
en" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_specs</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">229</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">230</span><span>        </span><span =
class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span> </span=
><span class=3D"token builtin">len</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">(</span><span>kv_cache_specs</span><span class=3D"tok=
en" style=3D"color: rgb(57, 58, 52);">)</span><span> </span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><span c=
lass=3D"token builtin">len</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">(</span><span>available_gpu_memory</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">231</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">232</span><span>        kv_cache_conf=
igs </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</spa=
n><span> get_kv_cache_configs</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">233</span><span>            vl=
lm_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</=
span><span> kv_cache_specs</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">,</span><span> available_gpu_memory
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">234</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">235</span><span>        schedu=
ler_kv_cache_config </span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">=3D</span><span> generate_scheduler_kv_cache_config</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_confi=
gs</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><s=
pan>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">236</span><span>        num_gp=
u_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
</span><span> scheduler_kv_cache_config</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">.</span><span>num_blocks
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">237</span><span>        num_cp=
u_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170=
);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">238</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">239</span><span>        </span><span =
class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># Init=
ialize kv cache and warmup the execution</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">240</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
model_executor</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>initialize_from_config</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">(</span><span>kv_cache_configs</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">241</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">242</span><span>        elapsed </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span> =
time</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span>=
<span>time</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><s=
pan> start
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">243</span><span>        logger=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><spa=
n>info</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</spa=
n><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">244</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span =
class=3D"token" style=3D"color: rgb(163, 21, 21);">"init engine (profile, c=
reate kv cache, warmup model) took %.2f seconds"</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">245</span><span>            el=
apsed</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span=
><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">246</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">247</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 num_gpu_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">,</span><span> num_cpu_blocks</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">,</span><span> scheduler_kv_cache_config</span></span><=
/code></pre></div></div><div class=3D"relative w-full min-w-max overflow-hi=
dden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rg=
b(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;,=
 &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: l=
eft; white-space: pre; word-spacing: normal; word-break: normal; font-size:=
 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margi=
n: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-co=
lor: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;=
"><span style=3D"background-color: rgb(248, 248, 248); display: block; whit=
e-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">248</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">249</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">get_supported_tasks=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><spa=
n>self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><sp=
an> </span><span class=3D"token builtin">tuple</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">[</span><span>SupportedTask</span><span c=
lass=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">250</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span> =
self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span>=
<span>model_executor</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">.</span><span>supported_tasks</span></span></code></pre></div><butt=
on class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:=
bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h-full item=
s-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><svg xmln=
s=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"curre=
ntColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M50.34,117.66=
a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-58.35a8,8,=
0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H216a8=
,8,0,0,0,0-16Z"></path></svg></div></button></div></div></div><div id=3D"fi=
le-Repo vllm-project/vllm: vllm/v1/worker/gpu_model_runner.py" class=3D"fle=
x flex-col gap-2 scroll-smooth rounded-md" style=3D"content-visibility: aut=
o;"><div class=3D"scrollbar-hide relative w-full p-0 ring-1 ring-neutral-80=
0 rounded-sm"><div class=3D"bg-secondary dark:bg-surface sticky top-0 z-10 =
flex w-full items-center justify-between px-3 py-1.5 text-sm text-neutral-3=
00 rounded-t-sm"><div class=3D"flex min-w-0 grow items-center gap-2"><butto=
n><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fi=
ll=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M2=
13.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.=
69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg></button><div class=3D"=
[&amp;_svg_path]:fill-current size-4 flex-shrink-0" style=3D"fill: rgb(81, =
154, 186); height: 20px; width: 20px;"><svg viewBox=3D"0 0 32 32"><path d=
=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.4-=
2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .=
3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2=
 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 =
2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.=
8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0=
 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.=
1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .=
4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.=
8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.=
8.8c.5 0 .8-.4.8-.8z"></path></svg></div><a href=3D"https://github.com/vllm=
-project/vllm" target=3D"_blank" rel=3D"noreferrer" class=3D"cursor-pointer=
 truncate text-neutral-500 hover:underline">vllm-project/vllm</a><a href=3D=
"https://github.com/vllm-project/vllm/blob/352c0c8a/vllm/v1/worker/gpu_mode=
l_runner.py" target=3D"_blank" rel=3D"noreferrer" class=3D"cursor-pointer t=
runcate text-black dark:text-neutral-300 hover:underline">vllm/v1/worker/gp=
u_model_runner.py</a><button><svg xmlns=3D"http://www.w3.org/2000/svg" widt=
h=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" clas=
s=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,0,0-8,8V80H40a8,=
8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8=
,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></=
path></svg></button></div></div><div class=3D"scrollbar-hide grid overflow-=
auto scroll-smooth"><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0]=
 hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div =
class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light te=
xt-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" hei=
ght=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"=
><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,1-16=
,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216,32=
H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><div cl=
ass=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidde=
n bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Con=
solas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Couri=
er, monospace; direction: ltr; text-align: left; white-space: pre; word-spa=
cing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab=
-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border:=
 1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><code=
 style=3D"white-space: pre; font-size: 12px;"><span style=3D"background-col=
or: rgb(248, 248, 248); display: block; white-space: pre; padding: 0px 20px=
;"><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D=
"display: inline-block; min-width: 2.25em; padding-right: 1em; text-align: =
right; user-select: none; font-size: 11px; font-weight: normal; font-family=
: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;"=
>4260</span><span>                </span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">,</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4261</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4262</span></span></code></pre>=
</div><div class=3D"citation-0-5"><div class=3D"relative w-full min-w-max o=
verflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippe=
t cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consol=
as, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier,=
 monospace; direction: ltr; text-align: left; white-space: pre; word-spacin=
g: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-si=
ze: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1p=
x solid rgb(221, 221, 221); background-color: white; width: 100%;"><code st=
yle=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color:=
 var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"=
><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"d=
isplay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: ri=
ght; user-select: none; font-size: 11px; font-weight: normal; font-family: =
monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">4=
263</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, =
255);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">_allocate_kv_cache_tensors</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4264</span><span>        self<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span=
> kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">:</span><span> KVCacheConfig
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4265</span><span>    </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><spa=
n class=3D"token builtin">dict</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">[</span><span class=3D"token builtin">str</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> torch</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>Tensor=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4266</span><span>        </spa=
n><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 2=
1);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">4267</span>        Initializes the KV cache=
 buffer with the correct size. The buffer needs
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4268</span>        to be reshaped to the desired s=
hape before being used by the models.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4269</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4270</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4271</span>            kv_cache_config: The KV cac=
he config
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4272</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4273</span>            dict[str, torch.Tensor]: A =
map between layer names to their
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4274</span>            corresponding memory buffer=
 for KV cache.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4275</span><span class=3D"token tripl=
e-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4276</span><span>        kv_ca=
che_raw_tensors</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">:</span><span> </span><span class=3D"token builtin">dict</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token=
 builtin">str</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>,</span><span> torch</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>Tensor</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">]</span><span> </span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">{</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">}</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4277</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> k=
v_cache_tensor </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);=
">in</span><span> kv_cache_config</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>kv_cache_tensors</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4278</span><span>            t=
ensor </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</s=
pan><span> torch</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">.</span><span>zeros</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4279</span><span>             =
   kv_cache_tensor</span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">.</span><span>size</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">,</span><span> dtype</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">=3D</span><span>torch</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">.</span><span>int8</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">,</span><span> device</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span>self</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>device
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4280</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4281</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> kv_cache_tensor</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>shared_by</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4282</span><span>             =
   kv_cache_raw_tensors</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">[</span><span>layer_name</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">]</span><span> </span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">=3D</span><span> tensor
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4283</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4284</span><span>        layer_names =
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><s=
pan> </span><span class=3D"token builtin">set</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4285</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> g=
roup </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</span=
><span> kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>kv_cache_groups</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4286</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> group</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>layer_names</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4287</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><=
span> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255=
);">in</span><span> self</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>runner_only_attn_layers</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4288</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">contin=
ue</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4289</span><span>             =
   layer_names</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>add</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">(</span><span>layer_name</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4290</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span=
> layer_names </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D=3D</span><span> </span><span class=3D"token builtin">set</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_ra=
w_tensors</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</=
span><span>keys</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4291</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"Some layers=
 are not correctly initialized"</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4292</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4293</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span=
> kv_cache_raw_tensors</span></span></code></pre></div></div><div class=3D"=
relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-ne=
utral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, =
&quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, mon=
ospace; direction: ltr; text-align: left; white-space: pre; word-spacing: n=
ormal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: =
4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px so=
lid rgb(221, 221, 221); background-color: white; width: 100%;"><code style=
=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: rg=
b(248, 248, 248); display: block; white-space: pre; padding: 0px 20px;"><sp=
an class=3D"linenumber react-syntax-highlighter-line-number" style=3D"displ=
ay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: right;=
 user-select: none; font-size: 11px; font-weight: normal; font-family: mono=
space; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">4294<=
/span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4295</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">_attn_group_iterat=
or</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><s=
pan>self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</s=
pan><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><=
span> Iterator</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">[</span><span>AttentionGroup</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4296</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 itertools</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.<=
/span><span>chain</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">.</span><span>from_iterable</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">(</span><span>self</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span>attn_groups</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">)</span></span></code></pre></div><b=
utton class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] da=
rk:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h-full i=
tems-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><svg x=
mlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"cu=
rrentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M50.34,117=
.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-58.35a8=
,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H21=
6a8,8,0,0,0,0-16Z"></path></svg></div></button></div></div></div><div id=3D=
"file-Repo vllm-project/vllm: vllm/v1/worker/tpu_model_runner.py" class=3D"=
flex flex-col gap-2 scroll-smooth rounded-md" style=3D"content-visibility: =
auto;"><div class=3D"scrollbar-hide relative w-full p-0 ring-1 ring-neutral=
-800 rounded-sm"><div class=3D"bg-secondary dark:bg-surface sticky top-0 z-=
10 flex w-full items-center justify-between px-3 py-1.5 text-sm text-neutra=
l-300 rounded-t-sm"><div class=3D"flex min-w-0 grow items-center gap-2"><bu=
tton><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em"=
 fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D=
"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,1=
64.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg></button><div class=
=3D"[&amp;_svg_path]:fill-current size-4 flex-shrink-0" style=3D"fill: rgb(=
81, 154, 186); height: 20px; width: 20px;"><svg viewBox=3D"0 0 32 32"><path=
 d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.=
4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0=
 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-=
.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.=
8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8=
-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9=
 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c=
-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1=
 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.=
4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.=
7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div><a href=3D"https://github.com/vl=
lm-project/vllm" target=3D"_blank" rel=3D"noreferrer" class=3D"cursor-point=
er truncate text-neutral-500 hover:underline">vllm-project/vllm</a><a href=
=3D"https://github.com/vllm-project/vllm/blob/352c0c8a/vllm/v1/worker/tpu_m=
odel_runner.py" target=3D"_blank" rel=3D"noreferrer" class=3D"cursor-pointe=
r truncate text-black dark:text-neutral-300 hover:underline">vllm/v1/worker=
/tpu_model_runner.py</a><button><svg xmlns=3D"http://www.w3.org/2000/svg" w=
idth=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" c=
lass=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,0,0-8,8V80H40=
a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A=
8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"=
></path></svg></button></div></div><div class=3D"scrollbar-hide grid overfl=
ow-auto scroll-smooth"><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0=
f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><d=
iv class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light=
 text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" =
height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w=
-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,1=
-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216=
,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><div=
 class=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hi=
dden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: =
Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Co=
urier, monospace; direction: ltr; text-align: left; white-space: pre; word-=
spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; =
tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; bord=
er: 1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><c=
ode style=3D"white-space: pre; font-size: 12px;"><span style=3D"background-=
color: rgb(248, 248, 248); display: block; white-space: pre; padding: 0px 2=
0px;"><span class=3D"linenumber react-syntax-highlighter-line-number" style=
=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; text-alig=
n: right; user-select: none; font-size: 11px; font-weight: normal; font-fam=
ily: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: itali=
c;">1767</span><span>            logger</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">.</span><span>debug</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"=
color: rgb(163, 21, 21);">"%s reuses KV cache of %s"</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">,</span><span> layer_name</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> target_=
layer_name</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)<=
/span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1768</span><span>            kv=
_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</sp=
an><span>layer_name</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">]</span><span> </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">=3D</span><span> kv_caches</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">[</span><span>target_layer_name</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1769</span></span></code></pre>=
</div><div class=3D"citation-0-7"><div class=3D"relative w-full min-w-max o=
verflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippe=
t cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consol=
as, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier,=
 monospace; direction: ltr; text-align: left; white-space: pre; word-spacin=
g: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-si=
ze: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1p=
x solid rgb(221, 221, 221); background-color: white; width: 100%;"><code st=
yle=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color:=
 var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"=
><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"d=
isplay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: ri=
ght; user-select: none; font-size: 11px; font-weight: normal; font-family: =
monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">1=
770</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, =
255);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">initialize_kv_cache</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">(</span><span>self</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">,</span><span> kv_cache_config</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> KVCacheConfig</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>=
 </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </sp=
an><span class=3D"token" style=3D"color: rgb(54, 172, 170);">None</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1771</span><span>        </spa=
n><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 2=
1);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">1772</span>        Initialize KV cache base=
d on `kv_cache_config`.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">1773</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">1774</span>            kv_cache_config: Configurat=
ion for the KV cache, including the KV
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">1775</span>            cache size of each layer
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1776</span><span class=3D"token tripl=
e-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1777</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> </=
span><span class=3D"token builtin">len</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">(</span><span>kv_cache_config</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>kv_cache_groups<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span=
><span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">1<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1778</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">raise</span><s=
pan> NotImplementedError</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1779</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"Hybrid =
models with more than one KV cache type are not supported yet."</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1780</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1781</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1782</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1783</span><span>            k=
v_cache_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>kv_cache_groups</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: rgb(54, 17=
2, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><spa=
n>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1784</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">!=3D</span><s=
pan> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</=
span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1785</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1786</span><span>            s=
elf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>input_batch </span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">=3D</span><span> InputBatch</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1787</span><span>             =
   max_num_reqs</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>max_num_reqs</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1788</span><span>             =
   max_model_len</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>max_model_len</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1789</span><span>             =
   max_num_batched_tokens</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">=3D</span><span>self</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>max_num_tokens</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1790</span><span>             =
   device</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
</span><span>self</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">.</span><span>device</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1791</span><span>             =
   pin_memory</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>pin_memory</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1792</span><span>             =
   vocab_size</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>model_config</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">.</span><span>get_vocab_size</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1793</span><span>             =
   block_sizes</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span=
><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1794</span><span>             =
       kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>kv_cache_groups</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.<=
/span><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1795</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1796</span><span>             =
   kernel_block_sizes</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">=3D</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
[</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1797</span><span>             =
       kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>kv_cache_groups</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.<=
/span><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1798</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1799</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1800</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;=
"># Verify dtype compatibility between block_table_cpu and input_batch</spa=
n><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1801</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span=
> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><s=
pan>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1802</span><span>            s=
elf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>block_table_cpu</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">.</span><span>dtype
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1803</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span>=
<span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.=
</span><span>input_batch</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>block_table</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: rgb(=
54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</spa=
n><span>get_cpu_tensor</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><spa=
n>dtype
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1804</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1805</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1806</span><span>        kv_cache_siz=
es </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span=
><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">{</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">}</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1807</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> k=
v_cache_tensor </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);=
">in</span><span> kv_cache_config</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>kv_cache_tensors</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1808</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><=
span> </span><span class=3D"token builtin">len</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_tensor</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>shared_by<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</sp=
an><span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">=
1</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><sp=
an> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span>=
<span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1809</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"KV cach=
e tensor shared by multiple layers is not supported in TPU."</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1810</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1811</span><span>            k=
v_cache_sizes</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>[</span><span>kv_cache_tensor</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">.</span><span>shared_by</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]<=
/span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> kv_cache_tensor</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1812</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1813</span><span>        kv_caches</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> =
</span><span class=3D"token builtin">dict</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token builtin">str</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> to=
rch</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>Tensor</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]=
</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">{</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">}</s=
pan><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1814</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> k=
v_cache_group </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> kv_cache_config</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>kv_cache_groups</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1815</span><span>            k=
v_cache_spec </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> kv_cache_group</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>kv_cache_spec
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1816</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> kv_cache_group</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">.</span><span>layer_names</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1817</span><span>             =
   tensor_size </span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">=3D</span><span> kv_cache_sizes</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">[</span><span>layer_name</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1818</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</sp=
an><span> tensor_size </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">%</span><span> kv_cache_spec</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span>page_size_bytes </span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><sp=
an class=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1819</span><span>             =
   num_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span> tensor_size </span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">//</span><span> kv_cache_spec</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">.</span><span>page_size_bytes  </span><=
span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">#=
 noqa</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1820</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><=
span> </span><span class=3D"token builtin">isinstance</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_spec</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> Atte=
ntionSpec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1821</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</sp=
an><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>use_spmd</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1822</span><span>             =
           num_kv_heads </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">=3D</span><span> kv_cache_spec</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">.</span><span>num_kv_heads
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1823</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">as=
sert</span><span> self</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>original_parallel_config </span><span class=3D"toke=
n" style=3D"color: rgb(0, 0, 255);">is</span><span> </span><span class=3D"t=
oken" style=3D"color: rgb(0, 0, 255);">not</span><span> </span><span class=
=3D"token" style=3D"color: rgb(54, 172, 170);">None</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1824</span><span>             =
           tp_size </span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">=3D</span><span> self</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">.</span><span>original_parallel_config</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">.</span><span>tensor_parallel_siz=
e
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1825</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); fon=
t-style: italic;"># TODO: Handle kv cache duplication under SPMD mode.</spa=
n><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1826</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">as=
sert</span><span> num_kv_heads </span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">%</span><span> tp_size </span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><span class=3D"tok=
en" style=3D"color: rgb(54, 172, 170);">0</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> </span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1827</span><span>             =
               </span><span class=3D"token string-interpolation" style=3D"c=
olor: rgb(163, 21, 21);">f"num_kv_heads </span><span class=3D"token string-=
interpolation interpolation" style=3D"color: rgb(57, 58, 52);">{</span><spa=
n class=3D"token string-interpolation interpolation">num_kv_heads</span><sp=
an class=3D"token string-interpolation interpolation" style=3D"color: rgb(5=
7, 58, 52);">}</span><span class=3D"token string-interpolation" style=3D"co=
lor: rgb(163, 21, 21);"> must be divisible by "</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1828</span><span>             =
               </span><span class=3D"token string-interpolation" style=3D"c=
olor: rgb(163, 21, 21);">f"tp_size </span><span class=3D"token string-inter=
polation interpolation" style=3D"color: rgb(57, 58, 52);">{</span><span cla=
ss=3D"token string-interpolation interpolation">tp_size</span><span class=
=3D"token string-interpolation interpolation" style=3D"color: rgb(57, 58, 5=
2);">}</span><span class=3D"token string-interpolation" style=3D"color: rgb=
(163, 21, 21);"> under SPMD mode"</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1829</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1830</span><span>             =
       kv_cache_shape </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">=3D</span><span> PallasAttentionBackend</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">.</span><span>get_kv_cache_shape</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1831</span><span>             =
           num_blocks</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1832</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>block_size</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1833</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>num_kv_heads</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1834</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>head_size</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1835</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1836</span><span>             =
       dtype </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> kv_cache_spec</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">.</span><span>dtype
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1837</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1838</span><span>                    =
tpu_kv_cache </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> torch</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>zeros</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">(</span><span>kv_cache_shape</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span> dtype</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span>dtype</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">.</span><span>to</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1839</span><span>             =
           self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">.</span><span>device
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1840</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1841</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1842</span><span>                    =
kv_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</=
span><span>layer_name</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span> </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">=3D</span><span> tpu_kv_cache
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1843</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1844</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">raise<=
/span><span> NotImplementedError
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1845</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1846</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># Set=
 up cross-layer KV cache sharing if needed</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1847</span><span>        self<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span=
>maybe_setup_cross_layer_kv_sharing</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">(</span><span>kv_caches</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span> kv_cache_config</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1848</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1849</span><span>        bind_kv_cach=
e</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><sp=
an>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1850</span><span>            k=
v_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</s=
pan><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1851</span><span>            s=
elf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>vllm_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">.</span><span>compilation_config</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">.</span><span>static_forward_context</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1852</span><span>            s=
elf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>kv_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1853</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1854</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1855</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> self</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>use=
_spmd</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span=
><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1856</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: ita=
lic;"># Shard KV Cache</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1857</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> cache </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</=
span><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">.</span><span>kv_caches</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1858</span><span>             =
   xs</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>mark_sharding</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">(</span><span>cache</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">,</span><span> self</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">.</span><span>mesh</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> </span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"colo=
r: rgb(54, 172, 170);">None</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">,</span><span> </span><span class=3D"token" style=3D"color: =
rgb(163, 21, 21);">"x"</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">,</span><span> </span><span class=3D"token" style=3D"color: rgb(5=
4, 172, 170);">None</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">,</span><span> </span><span class=3D"token" style=3D"color: rgb(54, =
172, 170);">None</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">)</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span=
><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1859</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1860</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> has_kv_tr=
ansfer_group</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1861</span><span>            g=
et_kv_transfer_group</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
register_kv_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">(</span><span>kv_caches</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1862</span><span>            g=
et_kv_transfer_group</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
set_host_xfer_buffer_ops</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">(</span><span>copy_kv_blocks</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span></span></code></pre></div></div><div c=
lass=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidd=
en bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Co=
nsolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Cour=
ier, monospace; direction: ltr; text-align: left; white-space: pre; word-sp=
acing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; ta=
b-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border=
: 1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><cod=
e style=3D"white-space: pre; font-size: 12px;"><span style=3D"background-co=
lor: rgb(248, 248, 248); display: block; white-space: pre; padding: 0px 20p=
x;"><span class=3D"linenumber react-syntax-highlighter-line-number" style=
=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; text-alig=
n: right; user-select: none; font-size: 11px; font-weight: normal; font-fam=
ily: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: itali=
c;">1863</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1864</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">reset_dynamo_cache=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><spa=
n>self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1865</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"=
># NOTE: We check `is_multimodal_model` instead of `supports_mm_inputs`</sp=
an></span></code></pre></div><button class=3D"h-5 w-full cursor-pointer bg-=
[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/=
80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font=
-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D=
"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D=
"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,=
0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,=
0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></butt=
on></div></div></div><div id=3D"file-Repo vllm-project/vllm: vllm/v1/core/k=
v_cache_manager.py" class=3D"flex flex-col gap-2 scroll-smooth rounded-md" =
style=3D"content-visibility: auto;"><div class=3D"scrollbar-hide relative w=
-full p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-secondary da=
rk:bg-surface sticky top-0 z-10 flex w-full items-center justify-between px=
-3 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"flex min-w-0=
 grow items-center gap-2"><button><svg xmlns=3D"http://www.w3.org/2000/svg"=
 width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256"=
 class=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-8=
0A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></pa=
th></svg></button><div class=3D"[&amp;_svg_path]:fill-current size-4 flex-s=
hrink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width: 20px;"><svg=
 viewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8c0 =
.2-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-3.3=
.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.1-.=
4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 1.4=
.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3.8.=
8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.3-2=
.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.3 3=
.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.4v1=
.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-.6-=
.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4-.3=
-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div><a h=
ref=3D"https://github.com/vllm-project/vllm" target=3D"_blank" rel=3D"noref=
errer" class=3D"cursor-pointer truncate text-neutral-500 hover:underline">v=
llm-project/vllm</a><a href=3D"https://github.com/vllm-project/vllm/blob/35=
2c0c8a/vllm/v1/core/kv_cache_manager.py" target=3D"_blank" rel=3D"noreferre=
r" class=3D"cursor-pointer truncate text-black dark:text-neutral-300 hover:=
underline">vllm/v1/core/kv_cache_manager.py</a><button><svg xmlns=3D"http:/=
/www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" vi=
ewBox=3D"0 0 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32=
H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V1=
76h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,=
8,0,0,0-8-8H96V48H208Z"></path></svg></button></div></div><div class=3D"scr=
ollbar-hide grid overflow-auto scroll-smooth"><button class=3D"h-5 w-full c=
ursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hove=
r:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3=
rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2=
000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 =
256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L=
136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72=
a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></=
svg></div></button><div class=3D"relative w-full min-w-max overflow-hidden =
[&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57,=
 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quo=
t;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; =
white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9e=
m; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0p=
x; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: =
white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><sp=
an style=3D"background-color: rgb(248, 248, 248); display: block; white-spa=
ce: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlig=
hter-line-number" style=3D"display: inline-block; min-width: 2.25em; paddin=
g-right: 1em; text-align: right; user-select: none; font-size: 11px; font-w=
eight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128=
, 0); font-style: italic;">221</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">222</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span> =
self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span>=
<span>create_kv_cache_blocks</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">(</span><span>computed_blocks</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">,</span><span> num_new_computed_tokens
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">223</span></span></code></pre><=
/div><div class=3D"citation-0-8"><div class=3D"relative w-full min-w-max ov=
erflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet=
 cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consola=
s, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, =
monospace; direction: ltr; text-align: left; white-space: pre; word-spacing=
: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-siz=
e: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px=
 solid rgb(221, 221, 221); background-color: white; width: 100%;"><code sty=
le=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: =
var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;">=
<span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"di=
splay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: rig=
ht; user-select: none; font-size: 11px; font-weight: normal; font-family: m=
onospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">22=
4</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, 25=
5);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">allocate_slots</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">225</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">226</span><span>        reques=
t</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><sp=
an> Request</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,=
</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">227</span><span>        num_ne=
w_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</s=
pan><span> </span><span class=3D"token builtin">int</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">228</span><span>        num_ne=
w_computed_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">:</span><span> </span><span class=3D"token builtin">int</span><span> <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><sp=
an> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">0</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">229</span><span>        new_co=
mputed_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>:</span><span> KVCacheBlocks </span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">|</span><span> </span><span class=3D"token" style=3D"colo=
r: rgb(54, 172, 170);">None</span><span> </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" =
style=3D"color: rgb(54, 172, 170);">None</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">230</span><span>        num_lo=
okahead_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">:</span><span> </span><span class=3D"token builtin">int</span><span> </sp=
an><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span>=
 </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">231</span><span>        delay_=
cache_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
:</span><span> </span><span class=3D"token builtin">bool</span><span> </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span> =
</span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">False</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">232</span><span>        num_en=
coder_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
:</span><span> </span><span class=3D"token builtin">int</span><span> </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span> <=
/span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">233</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> KVCacheBlock=
s </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">|</span><s=
pan> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">None<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">234</span><span>        </span=
><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21=
);">"""Add slots for a request with new tokens to append.
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">235</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">236</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">237</span>            request: The request to allo=
cate slots.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">238</span>            num_new_tokens: The number o=
f tokens to allocate, including external
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">239</span>                tokens. Note that this d=
oes not include tokens that have
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">240</span>                already been computed lo=
cally (i.e. new_computed_blocks).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">241</span>            num_new_computed_tokens: The=
 number of new computed tokens just
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">242</span>                hitting the prefix cachi=
ng, excluding external tokens.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">243</span>            new_computed_blocks: The cac=
hed blocks for the above new computed
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">244</span>                tokens.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">245</span>            num_lookahead_tokens: The nu=
mber of speculative tokens to allocate.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">246</span>                This is used by spec dec=
ode proposers with kv-cache such
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">247</span>                as eagle.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">248</span>            delay_cache_blocks: Whether =
to skip caching the blocks. This is
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">249</span>                used by P/D when allocat=
ing blocks used in a KV transfer
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">250</span>                which will complete in a=
 future step.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">251</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">252</span>        Blocks layout:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">253</span>        ```
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">254</span>        --------------------------------=
---------------------------------------
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">255</span>        | &lt; computed &gt; | &lt; new =
computed &gt; |    &lt; new &gt;    | &lt; pre-allocated &gt; |
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">256</span>        --------------------------------=
---------------------------------------
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">257</span>        |                  &lt; required=
 &gt;                   |
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">258</span>        --------------------------------=
------------------
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">259</span>        |                    &lt; full &=
gt;                  |
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">260</span>        --------------------------------=
----------------
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">261</span>                                        =
  | &lt;new full&gt; |
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">262</span>                                        =
  --------------
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">263</span>        ```
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">264</span>        The following *_blocks are illus=
trated in this layout.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">265</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">266</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">267</span>            A list of new allocated bloc=
ks.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">268</span>        """</span></code></pre></div></d=
iv><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:over=
flow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-f=
amily: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&qu=
ot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre=
; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: =
1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: aut=
o; border: 1px solid rgb(221, 221, 221); background-color: white; width: 10=
0%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D"back=
ground-color: rgb(248, 248, 248); display: block; white-space: pre; padding=
: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-number=
" style=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; te=
xt-align: right; user-select: none; font-size: 11px; font-weight: normal; f=
ont-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style=
: italic;">269</span><span>        </span><span class=3D"token" style=3D"co=
lor: rgb(0, 0, 255);">if</span><span> num_new_tokens </span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><span c=
lass=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">270</span><span>            </s=
pan><span class=3D"token" style=3D"color: rgb(0, 0, 255);">raise</span><spa=
n> ValueError</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>(</span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"num_new_=
tokens must be greater than 0"</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">271</span></span></code></pre><=
/div><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e=
0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h=
-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"=
><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fil=
l=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M50=
.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-=
58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,=
0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><button class=3D"h-5 =
w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 d=
ark:hover:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5=
 pl-[1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.=
w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=
=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.3=
2,11.32L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.=
32l72-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"><=
/path></svg></div></button><div class=3D"relative w-full min-w-max overflow=
-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color:=
 rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quo=
t;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align=
: left; white-space: pre; word-spacing: normal; word-break: normal; font-si=
ze: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; ma=
rgin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background=
-color: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12=
px;"><span style=3D"background-color: rgb(248, 248, 248); display: block; w=
hite-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax=
-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25em=
; padding-right: 1em; text-align: right; user-select: none; font-size: 11px=
; font-weight: normal; font-family: monospace; padding-left: 8px; color: rg=
b(0, 128, 0); font-style: italic;">292</span><span>            self</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>max_mo=
del_len</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</sp=
an><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">293</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">294</span></span></code></pre><=
/div><div class=3D"citation-0-9"><div class=3D"relative w-full min-w-max ov=
erflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet=
 cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consola=
s, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, =
monospace; direction: ltr; text-align: left; white-space: pre; word-spacing=
: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-siz=
e: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px=
 solid rgb(221, 221, 221); background-color: white; width: 100%;"><code sty=
le=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: =
var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;">=
<span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"di=
splay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: rig=
ht; user-select: none; font-size: 11px; font-weight: normal; font-family: m=
onospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">29=
5</span><span>        num_blocks_to_allocate </span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">=3D</span><span> self</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">.</span><span>coordinator</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>get_nu=
m_blocks_to_allocate</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">296</span><span>            re=
quest_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D<=
/span><span>request</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">.</span><span>request_id</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">297</span><span>            nu=
m_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D<=
/span><span>num_tokens_need_slot</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">298</span><span>            ne=
w_computed_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">=3D</span><span>new_computed_block_list</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">299</span><span>            nu=
m_encoder_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span>num_encoder_tokens</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">300</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></c=
ode></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">301</span><span> </span></span></code></pre><=
/div><div class=3D"citation-0-10"><div class=3D"relative w-full min-w-max o=
verflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippe=
t cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consol=
as, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier,=
 monospace; direction: ltr; text-align: left; white-space: pre; word-spacin=
g: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-si=
ze: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1p=
x solid rgb(221, 221, 221); background-color: white; width: 100%;"><code st=
yle=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color:=
 var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"=
><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"d=
isplay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: ri=
ght; user-select: none; font-size: 11px; font-weight: normal; font-family: =
monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">3=
02</span><span>        </span><span class=3D"token" style=3D"color: rgb(0, =
0, 255);">if</span><span> num_blocks_to_allocate </span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> self</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>block_pool</sp=
an><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>ge=
t_num_free_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">303</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: ital=
ic;"># Cannot allocate new blocks</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">304</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><s=
pan> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">None<=
/span></span></code></pre></div></div><div class=3D"relative w-full min-w-m=
ax overflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre styl=
e=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sa=
ns Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr;=
 text-align: left; white-space: pre; word-spacing: normal; word-break: norm=
al; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; paddi=
ng: 0px; margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221);=
 background-color: white; width: 100%;"><code style=3D"white-space: pre; fo=
nt-size: 12px;"><span style=3D"background-color: rgb(248, 248, 248); displa=
y: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber r=
eact-syntax-highlighter-line-number" style=3D"display: inline-block; min-wi=
dth: 2.25em; padding-right: 1em; text-align: right; user-select: none; font=
-size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px=
; color: rgb(0, 128, 0); font-style: italic;">305</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">306</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# Touch the computed blocks to make sure they won't be evicted.</span><span=
>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">307</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> self=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><spa=
n>enable_caching</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">:</span></span></code></pre></div><button class=3D"h-5 w-full cursor-po=
inter bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neu=
tral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] tex=
t-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg"=
 width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256"=
 class=3D"h-3 w-3"><path d=3D"M224,128a8,8,0,0,1-8,8H40a8,8,0,0,1,0-16H216A=
8,8,0,0,1,224,128ZM101.66,53.66,120,35.31V96a8,8,0,0,0,16,0V35.31l18.34,18.=
35a8,8,0,0,0,11.32-11.32l-32-32a8,8,0,0,0-11.32,0l-32,32a8,8,0,0,0,11.32,11=
.32Zm52.68,148.68L136,220.69V160a8,8,0,0,0-16,0v60.69l-18.34-18.35a8,8,0,0,=
0-11.32,11.32l32,32a8,8,0,0,0,11.32,0l32-32a8,8,0,0,0-11.32-11.32Z"></path>=
</svg></div></button><div class=3D"relative w-full min-w-max overflow-hidde=
n [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(5=
7, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &q=
uot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left=
; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.=
9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: =
0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color=
: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><=
span style=3D"background-color: rgb(248, 248, 248); display: block; white-s=
pace: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highl=
ighter-line-number" style=3D"display: inline-block; min-width: 2.25em; padd=
ing-right: 1em; text-align: right; user-select: none; font-size: 11px; font=
-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 1=
28, 0); font-style: italic;">317</span><span>            request</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>request_i=
d</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><sp=
an> new_computed_block_list
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">318</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">319</span></span></code></pre><=
/div><div class=3D"citation-0-11"><div class=3D"relative w-full min-w-max o=
verflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippe=
t cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consol=
as, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier,=
 monospace; direction: ltr; text-align: left; white-space: pre; word-spacin=
g: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-si=
ze: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1p=
x solid rgb(221, 221, 221); background-color: white; width: 100%;"><code st=
yle=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color:=
 var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"=
><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"d=
isplay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: ri=
ght; user-select: none; font-size: 11px; font-weight: normal; font-family: =
monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">3=
20</span><span>        new_blocks </span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">=3D</span><span> self</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">.</span><span>coordinator</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>allocate_new_blo=
cks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><=
span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">321</span><span>            re=
quest</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">,</span><span> num_tokens_need_slot</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> num_encoder_tokens
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">322</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></c=
ode></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">323</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">324</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# P/D: delay caching blocks if we have to recv from</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">325</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# remote. Update state for locally cached blocks.</span></span></code></pre=
></div><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e=
0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex=
 h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-40=
0"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" f=
ill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M=
50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.3=
4-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,=
0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button></div></div></div><=
div id=3D"file-Repo vllm-project/vllm: vllm/v1/core/kv_cache_coordinator.py=
" class=3D"flex flex-col gap-2 scroll-smooth rounded-md" style=3D"content-v=
isibility: auto;"><div class=3D"scrollbar-hide relative w-full p-0 ring-1 r=
ing-neutral-800 rounded-sm"><div class=3D"bg-secondary dark:bg-surface stic=
ky top-0 z-10 flex w-full items-center justify-between px-3 py-1.5 text-sm =
text-neutral-300 rounded-t-sm"><div class=3D"flex min-w-0 grow items-center=
 gap-2"><button><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" hei=
ght=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"=
><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,=
90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg></button>=
<div class=3D"[&amp;_svg_path]:fill-current size-4 flex-shrink-0" style=3D"=
fill: rgb(81, 154, 186); height: 20px; width: 20px;"><svg viewBox=3D"0 0 32=
 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8c0 .2-.1.3-.3.3h-.9c-=
.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-3.3.3-.9.9-1.6 1.9-1.=
8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.1-.4-.4V9.4c0-.7.3-1.=
2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 1.4.6.4.4.7.8.6 1.4v3=
.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3.8.8.8.4 0 .8-.4.8-.8=
s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.3-2.3v-1.8c0-.2.1-.3.=
3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.3 3.3-.3.9-.9 1.6-1.9=
 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.4v1.3c0 .7-.3 1.2-.9 =
1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-.6-.4-.4-.7-.8-.6-1.4=
v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4-.3-.8-.8-.8-.4 0-.8.=
4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div><a href=3D"https://git=
hub.com/vllm-project/vllm" target=3D"_blank" rel=3D"noreferrer" class=3D"cu=
rsor-pointer truncate text-neutral-500 hover:underline">vllm-project/vllm</=
a><a href=3D"https://github.com/vllm-project/vllm/blob/352c0c8a/vllm/v1/cor=
e/kv_cache_coordinator.py" target=3D"_blank" rel=3D"noreferrer" class=3D"cu=
rsor-pointer truncate text-black dark:text-neutral-300 hover:underline">vll=
m/v1/core/kv_cache_coordinator.py</a><button><svg xmlns=3D"http://www.w3.or=
g/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0=
 0 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,=
0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,=
0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-=
8H96V48H208Z"></path></svg></button></div></div><div class=3D"scrollbar-hid=
e grid overflow-auto scroll-smooth"><button class=3D"h-5 w-full cursor-poin=
ter bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutr=
al-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-=
xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" w=
idth=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" c=
lass=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V=
224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1=
,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div>=
</button><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_pre=
]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); =
font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier =
New&quot;, Courier, monospace; direction: ltr; text-align: left; white-spac=
e: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-he=
ight: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflo=
w: auto; border: 1px solid rgb(221, 221, 221); background-color: white; wid=
th: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=
=3D"background-color: rgb(248, 248, 248); display: block; white-space: pre;=
 padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-lin=
e-number" style=3D"display: inline-block; min-width: 2.25em; padding-right:=
 1em; text-align: right; user-select: none; font-size: 11px; font-weight: n=
ormal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); fo=
nt-style: italic;">98</span><span>        </span><span class=3D"token" styl=
e=3D"color: rgb(0, 0, 255);">for</span><span> i</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">,</span><span> manager </span><span clas=
s=3D"token" style=3D"color: rgb(0, 0, 255);">in</span><span> </span><span c=
lass=3D"token builtin">enumerate</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">(</span><span>self</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span>single_type_managers</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">99</span><span>            mana=
ger</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>save_new_computed_blocks</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">(</span><span>request_id</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> new_computed_blocks</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>i</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">100</span></span></code></pre><=
/div><div class=3D"citation-0-12"><div class=3D"relative w-full min-w-max o=
verflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippe=
t cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consol=
as, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier,=
 monospace; direction: ltr; text-align: left; white-space: pre; word-spacin=
g: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-si=
ze: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1p=
x solid rgb(221, 221, 221); background-color: white; width: 100%;"><code st=
yle=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color:=
 var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"=
><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"d=
isplay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: ri=
ght; user-select: none; font-size: 11px; font-weight: normal; font-family: =
monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">1=
01</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, 2=
55);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">allocate_new_blocks</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">102</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:=
</span><span> </span><span class=3D"token builtin">str</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> num_tokens</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </spa=
n><span class=3D"token builtin">int</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span> num_encoder_tokens</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </span><span cl=
ass=3D"token builtin">int</span><span> </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" =
style=3D"color: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">103</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">tuple</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">[</span><span class=3D"token builtin">list</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>KVCacheBlock<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">104</span><span>        </span=
><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21=
);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">105</span>        Allocate new blocks for t=
he request to give it at least `num_tokens`
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">106</span>        token slots.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">107</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">108</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">109</span>            request_id: The request ID.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">110</span>            num_tokens: The total number=
 of tokens that need a slot (including
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">111</span>                tokens that are already =
allocated).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">112</span>            num_encoder_tokens: The numb=
er of encoder tokens for allocating
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">113</span>                blocks for cross-attenti=
on.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">114</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">115</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">116</span>            The new allocated blocks.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">117</span><span class=3D"token triple=
-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">118</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 </span><span class=3D"token builtin">tuple</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">119</span><span>            ma=
nager</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>allocate_new_blocks</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">120</span><span>              =
  request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">121</span>                num_=
encoder_tokens
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">122</span><span>                </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> </=
span><span class=3D"token builtin">isinstance</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">(</span><span>manager</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> CrossAttentionMana=
ger</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><=
span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">123</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span>=
<span> num_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">124</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">125</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span=
> manager </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in<=
/span><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">.</span><span>single_type_managers
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">126</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></c=
ode></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">127</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">128</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">cache_blocks</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>self<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span=
> request</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</=
span><span> Request</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">,</span><span> num_computed_tokens</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">:</span><span> </span><span class=3D"token bui=
ltin">int</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
-</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span>=
<span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">Non=
e</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><sp=
an>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">129</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(163, 21, 21);">""</span><span>"</=
span></span></code></pre></div><button class=3D"h-5 w-full cursor-pointer b=
g-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-70=
0/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs fo=
nt-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=
=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=
=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8=
,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.=
32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></b=
utton></div></div></div><div id=3D"file-Repo vllm-project/vllm: docs/usage/=
v1_guide.md" class=3D"flex flex-col gap-2 scroll-smooth rounded-md" style=
=3D"content-visibility: auto;"><div class=3D"scrollbar-hide relative w-full=
 p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-secondary dark:bg=
-surface sticky top-0 z-10 flex w-full items-center justify-between px-3 py=
-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"flex min-w-0 grow=
 items-center gap-2"><button><svg xmlns=3D"http://www.w3.org/2000/svg" widt=
h=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" clas=
s=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8=
,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></=
svg></button><div class=3D"[&amp;_svg_path]:fill-current size-4 flex-shrink=
-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width: 20px;"><svg view=
Box=3D"0 0 32 32"><path d=3D"M20.7 6.7v9.9h3.8c-2.9 3-5.8 5.9-8.7 8.8-2.7-2=
.8-5.6-5.8-8.4-8.7h3.5V6.6c1.3.9 4.4 3.1 5 3.1.6 0 3.6-2.2 4.8-3z"></path><=
/svg></div><a href=3D"https://github.com/vllm-project/vllm" target=3D"_blan=
k" rel=3D"noreferrer" class=3D"cursor-pointer truncate text-neutral-500 hov=
er:underline">vllm-project/vllm</a><a href=3D"https://github.com/vllm-proje=
ct/vllm/blob/352c0c8a/docs/usage/v1_guide.md" target=3D"_blank" rel=3D"nore=
ferrer" class=3D"cursor-pointer truncate text-black dark:text-neutral-300 h=
over:underline">docs/usage/v1_guide.md</a><button><svg xmlns=3D"http://www.=
w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=
=3D"0 0 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8=
,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40=
a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0=
,0-8-8H96V48H208Z"></path></svg></button></div></div><div class=3D"scrollba=
r-hide grid overflow-auto scroll-smooth"><button class=3D"h-5 w-full cursor=
-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-=
neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] =
text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/s=
vg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 2=
56" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,9=
1.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,=
0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg><=
/div></button><div class=3D"relative w-full min-w-max overflow-hidden [&amp=
;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, =
52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Cou=
rier New&quot;, Courier, monospace; direction: ltr; text-align: left; white=
-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; li=
ne-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; ov=
erflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white=
; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span st=
yle=3D"background-color: rgb(248, 248, 248); display: block; white-space: p=
re; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-=
line-number" style=3D"display: inline-block; min-width: 2.25em; padding-rig=
ht: 1em; text-align: right; user-select: none; font-size: 11px; font-weight=
: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0);=
 font-style: italic;">46</span><span class=3D"token list" style=3D"color: r=
gb(57, 58, 52);">-</span><span> </span><span class=3D"token" style=3D"font-=
weight: bold; color: rgb(57, 58, 52);">**</span><span class=3D"token conten=
t" style=3D"font-weight: bold;">=F0=9F=94=B4 Deprecated</span><span class=
=3D"token" style=3D"font-weight: bold; color: rgb(57, 58, 52);">**</span><s=
pan>: Not planned for V1 unless there is strong demand.
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">47</span>
</span><span style=3D"background-color: rgb(248, 248, 248); display: block;=
 white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-synt=
ax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25=
em; padding-right: 1em; text-align: right; user-select: none; font-size: 11=
px; font-weight: normal; font-family: monospace; padding-left: 8px; color: =
rgb(0, 128, 0); font-style: italic;">48</span>!!! note</span></code></pre><=
/div><div class=3D"citation-0-13"><div class=3D"relative w-full min-w-max o=
verflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippe=
t cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consol=
as, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier,=
 monospace; direction: ltr; text-align: left; white-space: pre; word-spacin=
g: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-si=
ze: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1p=
x solid rgb(221, 221, 221); background-color: white; width: 100%;"><code st=
yle=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color:=
 var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"=
><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"d=
isplay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: ri=
ght; user-select: none; font-size: 11px; font-weight: normal; font-family: =
monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">4=
9</span><span>    vLLM V1=E2=80=99s unified scheduler treats both prompt an=
d output tokens the same
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">50</span><span>    way by usin=
g a simple dictionary (e.g., </span><span class=3D"token code-snippet code"=
 style=3D"color: rgb(0, 0, 255);">`{request_id: num_tokens}`</span><span>) =
to dynamically
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">51</span>    allocate a fixed =
token budget per request, enabling features like chunked prefills,
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">52</span>    prefix caching, and spec=
ulative decoding without a strict separation between prefill
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">53</span>    and decode phases.</span=
></code></pre></div></div><div class=3D"relative w-full min-w-max overflow-=
hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: =
rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot=
;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align:=
 left; white-space: pre; word-spacing: normal; word-break: normal; font-siz=
e: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; mar=
gin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-=
color: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12p=
x;"><span style=3D"background-color: rgb(248, 248, 248); display: block; wh=
ite-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-=
highlighter-line-number" style=3D"display: inline-block; min-width: 2.25em;=
 padding-right: 1em; text-align: right; user-select: none; font-size: 11px;=
 font-weight: normal; font-family: monospace; padding-left: 8px; color: rgb=
(0, 128, 0); font-style: italic;">54</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">55</span>The V1 scheduler suppo=
rts multiple scheduling policies, including First-Come,
</span><span style=3D"background-color: rgb(248, 248, 248); display: block;=
 white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-synt=
ax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25=
em; padding-right: 1em; text-align: right; user-select: none; font-size: 11=
px; font-weight: normal; font-family: monospace; padding-left: 8px; color: =
rgb(0, 128, 0); font-style: italic;">56</span>First-Served (FCFS) and prior=
ity-based scheduling (where requests are processed</span></code></pre></div=
><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0]=
 dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h-ful=
l items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><sv=
g xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D=
"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M50.34,=
117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-58.3=
5a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16=
H216a8,8,0,0,0,0-16Z"></path></svg></div></button></div></div></div></div><=
/div></div></div><div class=3D"mb-8 mt-16 h-px w-full bg-neutral-300 dark:b=
g-neutral-700"></div><div id=3D"2" class=3D"flex flex-col gap-3 pt-6 lg:fle=
x-row" data-query-display=3D"true" data-query-index=3D"1"><div class=3D"fle=
x max-h-fit min-w-0 flex-1 flex-shrink-0 flex-col xl:[flex-grow:2]"><div><d=
iv class=3D"flex flex-col"><a class=3D"flex items-center gap-1 text-base te=
xt-neutral-400 transition-colors hover:text-black dark:hover:text-white" hr=
ef=3D"https://deepwiki.com/vllm-project/vllm"><svg xmlns=3D"http://www.w3.o=
rg/2000/svg" width=3D"16" height=3D"16" fill=3D"currentColor" viewBox=3D"0 =
0 256 256"><path d=3D"M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11=
.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H21=
6A8,8,0,0,1,224,128Z"></path></svg>vllm-project/vllm</a><div class=3D"min-w=
-0 flex-1 pt-1"><div class=3D"flex flex-col items-start gap-2 text-white"><=
span class=3D"text-xl xl:text-2xl w-full [overflow-wrap:break-word]">=E6=88=
=91=E5=8E=9F=E5=85=88=E5=9C=A8vllm V0=E4=B8=AD=EF=BC=8C=E5=AF=B9CacheEngine=
=E7=9A=84allocate_kv_cache=E5=81=9A=E4=BA=86=E5=88=86=E5=B1=82=E7=9A=84=E7=
=BC=93=E5=AD=98=E7=A8=80=E7=96=8F=E5=8C=96=EF=BC=8C=E6=A0=B9=E6=8D=AE=E7=A8=
=80=E7=96=8Fkv=E7=BC=93=E5=AD=98=E7=9A=84=E5=AE=9E=E9=99=85=E5=BD=A2=E7=8A=
=B6=E5=88=86=E9=85=8Dkv=E7=BC=93=E5=AD=98=E3=80=82=E6=89=80=E4=BB=A5=E6=88=
=91=E8=AF=A5=E5=9C=A8V1=E5=93=AA=E9=87=8C=E5=8A=A0=E4=B8=8A=E8=BF=99=E5=9D=
=97=E9=80=BB=E8=BE=91=EF=BC=9F<button class=3D"relative ml-2 cursor-pointer=
 align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-=
400 focus:opacity-100 group-hover:opacity-100" aria-label=3D"Copy link to q=
uery"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em=
" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-4 w-4"><path d=
=3D"M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0=
A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,1=
2,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.6=
2,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117=
.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,1=
7,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.6=
1,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,=
0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,=
0,0,0-82.91Z"></path></svg></button></span></div></div></div><div class=3D"=
py-2"><div class=3D"text-primary/70 flex flex-col gap-2 text-sm"><div class=
=3D"flex items-center justify-between gap-2"><div class=3D"inline-flex item=
s-center rounded-full px-2.5 py-1 text-xs font-medium bg-neutral-400/10 tex=
t-neutral-500 dark:bg-neutral-600/10 dark:text-neutral-400"><svg xmlns=3D"h=
ttp://www.w3.org/2000/svg" width=3D"12" height=3D"12" fill=3D"currentColor"=
 viewBox=3D"0 0 256 256" class=3D"mr-1"><path d=3D"M213.85,125.46l-112,120a=
8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1=
,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z"></path></svg>Fast</div=
></div></div></div><div class=3D"h-fit rounded-lg" style=3D"scrollbar-width=
: thin; scrollbar-color: rgb(58, 58, 58) transparent;"><div class=3D"dark:[=
&amp;_pre:has(code)]:bg-shade dark:[&amp;_code[data-lang]]:bg-shade relativ=
e flex flex-col gap-1 rounded-md border-[0.5px] border-[#d0d0d0] bg-[#f8f8f=
8] p-4 text-white [overflow-wrap:anywhere] dark:border-[#2F2F2F] dark:bg-[#=
141414] [&amp;_pre]:my-3"><div class=3D"prose-custom prose-custom-md prose-=
custom-gray !max-w-none text-neutral-300 [overflow-wrap:anywhere]"><p>=E6=
=82=A8=E6=83=B3=E5=9C=A8 vLLM V1 =E4=B8=AD=E5=AE=9E=E7=8E=B0=E5=88=86=E5=B1=
=82=E7=9A=84=E7=BC=93=E5=AD=98=E7=A8=80=E7=96=8F=E5=8C=96,=E6=A0=B9=E6=8D=
=AE=E7=A8=80=E7=96=8F KV =E7=BC=93=E5=AD=98=E7=9A=84=E5=AE=9E=E9=99=85=E5=
=BD=A2=E7=8A=B6=E5=88=86=E9=85=8D KV =E7=BC=93=E5=AD=98=E3=80=82</p>
<h2 class=3D"group">=E5=BB=BA=E8=AE=AE=E7=9A=84=E4=BF=AE=E6=94=B9=E4=BD=8D=
=E7=BD=AE  </h2>
<p>=E5=9F=BA=E4=BA=8E=E6=82=A8=E5=9C=A8 V0 =E4=B8=AD=E4=BF=AE=E6=94=B9 <cod=
e class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-n=
ormal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">Cache=
Engine.allocate_kv_cache</code> =E7=9A=84=E7=BB=8F=E9=AA=8C,=E5=9C=A8 V1 =
=E4=B8=AD=E6=82=A8=E9=9C=80=E8=A6=81=E5=9C=A8=E4=BB=A5=E4=B8=8B=E5=87=A0=E4=
=B8=AA=E5=85=B3=E9=94=AE=E4=BD=8D=E7=BD=AE=E6=B7=BB=E5=8A=A0=E7=A8=80=E7=96=
=8F=E5=8C=96=E9=80=BB=E8=BE=91:</p>
<h3 class=3D"group">1. =E4=BF=AE=E6=94=B9 KV Cache =E5=BC=A0=E9=87=8F=E5=88=
=86=E9=85=8D - <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20=
rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-=
[#484848]/30">GPUModelRunner._allocate_kv_cache_tensors()</code>  </h3>
<p>=E8=BF=99=E6=98=AF=E6=9C=80=E6=A0=B8=E5=BF=83=E7=9A=84=E4=BF=AE=E6=94=B9=
=E7=82=B9=E3=80=82 <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/1=
0 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer roun=
ded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] transit=
ion-colors duration-100 before:hidden after:hidden" style=3D"font-family: &=
quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: =
400; font-style: normal;">gpu_model_runner.py:4263-4293</span> =E8=AF=A5=E6=
=96=B9=E6=B3=95=E8=B4=9F=E8=B4=A3=E6=A0=B9=E6=8D=AE <code class=3D"rounded-=
sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px=
] before:hidden after:hidden dark:bg-[#484848]/30">KVCacheConfig</code> =E5=
=88=86=E9=85=8D=E5=AE=9E=E9=99=85=E7=9A=84 GPU =E5=86=85=E5=AD=98=E7=BC=93=
=E5=86=B2=E5=8C=BA=E3=80=82</p>
<p><strong>=E4=BF=AE=E6=94=B9=E5=BB=BA=E8=AE=AE:</strong></p>
<ul>
<li>=E5=9C=A8=E7=AC=AC 4278-4282 =E8=A1=8C,=E5=BD=93=E5=89=8D=E4=BB=A3=E7=
=A0=81=E4=B8=BA=E6=AF=8F=E4=B8=AA KV cache tensor =E5=88=86=E9=85=8D=E5=9B=
=BA=E5=AE=9A=E5=A4=A7=E5=B0=8F=E7=9A=84 <code class=3D"rounded-sm bg-[#e5e5=
e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hid=
den after:hidden dark:bg-[#484848]/30">torch.zeros</code> <span role=3D"lin=
k" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 =
hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] tex=
t-xs font-normal leading-[15px] transition-colors duration-100 before:hidde=
n after:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM =
Plex Mono Fallback&quot;; font-weight: 400; font-style: normal;">gpu_model_=
runner.py:4278-4282</span></li>
<li>=E6=82=A8=E5=8F=AF=E4=BB=A5=E5=9C=A8=E8=BF=99=E9=87=8C=E6=A0=B9=E6=8D=
=AE=E7=A8=80=E7=96=8F KV =E7=BC=93=E5=AD=98=E7=9A=84=E5=AE=9E=E9=99=85=E5=
=BD=A2=E7=8A=B6=E8=AE=A1=E7=AE=97=E6=89=80=E9=9C=80=E7=9A=84=E5=86=85=E5=AD=
=98=E5=A4=A7=E5=B0=8F,=E8=80=8C=E4=B8=8D=E6=98=AF=E4=BD=BF=E7=94=A8 <code c=
lass=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-norm=
al leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">kv_cache=
_tensor.size</code></li>
<li>=E9=9C=80=E8=A6=81=E4=BF=AE=E6=94=B9 <code class=3D"rounded-sm bg-[#e5e=
5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hi=
dden after:hidden dark:bg-[#484848]/30">KVCacheTensor.size</code> =E7=9A=84=
=E8=AE=A1=E7=AE=97=E9=80=BB=E8=BE=91,=E4=BD=BF=E5=85=B6=E5=8F=8D=E6=98=A0=
=E7=A8=80=E7=96=8F=E5=8C=96=E5=90=8E=E7=9A=84=E5=AE=9E=E9=99=85=E5=A4=A7=E5=
=B0=8F</li>
</ul>
<h3 class=3D"group">2. =E4=BF=AE=E6=94=B9 KV Cache =E5=BD=A2=E7=8A=B6=E9=87=
=8D=E5=A1=91 - <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20=
rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-=
[#484848]/30">GPUModelRunner._reshape_kv_cache_tensors()</code>  </h3>
<p>=E5=88=86=E9=85=8D=E5=AE=8C=E5=8E=9F=E5=A7=8B=E5=BC=A0=E9=87=8F=E5=90=8E=
,=E9=9C=80=E8=A6=81=E5=B0=86=E5=85=B6=E9=87=8D=E5=A1=91=E4=B8=BA=E6=A8=A1=
=E5=9E=8B=E6=89=80=E9=9C=80=E7=9A=84=E5=BD=A2=E7=8A=B6=E3=80=82 <span role=
=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-paci=
fic/20 hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12r=
em] text-xs font-normal leading-[15px] transition-colors duration-100 befor=
e:hidden after:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &qu=
ot;IBM Plex Mono Fallback&quot;; font-weight: 400; font-style: normal;">gpu=
_model_runner.py:4354-4448</span> =E8=AF=A5=E6=96=B9=E6=B3=95=E5=A4=84=E7=
=90=86=E4=B8=8D=E5=90=8C=E7=B1=BB=E5=9E=8B=E7=9A=84 KV cache(Attention=E3=
=80=81Mamba =E7=AD=89)=E7=9A=84=E5=BD=A2=E7=8A=B6=E8=BD=AC=E6=8D=A2=E3=80=
=82</p>
<p><strong>=E4=BF=AE=E6=94=B9=E5=BB=BA=E8=AE=AE:</strong></p>
<ul>
<li>=E5=9C=A8=E7=AC=AC 4374-4417 =E8=A1=8C=E7=9A=84 <code class=3D"rounded-=
sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px=
] before:hidden after:hidden dark:bg-[#484848]/30">AttentionSpec</code> =E5=
=88=86=E6=94=AF=E4=B8=AD,=E4=BF=AE=E6=94=B9 <code class=3D"rounded-sm bg-[#=
e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before=
:hidden after:hidden dark:bg-[#484848]/30">kv_cache_shape</code> =E7=9A=84=
=E8=AE=A1=E7=AE=97=E9=80=BB=E8=BE=91 <span role=3D"link" tabindex=3D"0" cla=
ss=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 c=
ursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal lead=
ing-[15px] transition-colors duration-100 before:hidden after:hidden" style=
=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&qu=
ot;; font-weight: 400; font-style: normal;">gpu_model_runner.py:4386-4392</=
span></li>
<li>=E6=A0=B9=E6=8D=AE=E6=82=A8=E7=9A=84=E7=A8=80=E7=96=8F=E5=8C=96=E7=AD=
=96=E7=95=A5=E8=B0=83=E6=95=B4 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0=
.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after=
:hidden dark:bg-[#484848]/30">num_blocks</code>=E3=80=81<code class=3D"roun=
ded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[=
15px] before:hidden after:hidden dark:bg-[#484848]/30">kernel_size</code>=
=E3=80=81<code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] t=
ext-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#4848=
48]/30">num_kv_heads</code> =E7=AD=89=E5=8F=82=E6=95=B0</li>
<li>=E7=A1=AE=E4=BF=9D=E7=A8=80=E7=96=8F=E5=8C=96=E5=90=8E=E7=9A=84=E5=BD=
=A2=E7=8A=B6=E4=B8=8E attention backend =E7=9A=84=E6=9C=9F=E6=9C=9B=E4=B8=
=80=E8=87=B4</li>
</ul>
<h3 class=3D"group">3. =E4=BF=AE=E6=94=B9 KV Cache =E9=85=8D=E7=BD=AE=E7=94=
=9F=E6=88=90 - <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20=
rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-=
[#484848]/30">get_kv_cache_configs()</code>  </h3>
<p>=E5=9C=A8=E5=88=9D=E5=A7=8B=E5=8C=96=E9=98=B6=E6=AE=B5,<code class=3D"ro=
unded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading=
-[15px] before:hidden after:hidden dark:bg-[#484848]/30">EngineCore._initia=
lize_kv_caches()</code> =E8=B0=83=E7=94=A8 <code class=3D"rounded-sm bg-[#e=
5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:=
hidden after:hidden dark:bg-[#484848]/30">get_kv_cache_configs()</code> =E7=
=94=9F=E6=88=90 KV cache =E9=85=8D=E7=BD=AE=E3=80=82 <span role=3D"link" ta=
bindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover=
:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs =
font-normal leading-[15px] transition-colors duration-100 before:hidden aft=
er:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex =
Mono Fallback&quot;; font-weight: 400; font-style: normal;">core.py:232-234=
</span> =E6=82=A8=E9=9C=80=E8=A6=81=E5=9C=A8=E9=85=8D=E7=BD=AE=E7=94=9F=E6=
=88=90=E6=97=B6=E5=B0=B1=E8=80=83=E8=99=91=E7=A8=80=E7=96=8F=E5=8C=96=E3=80=
=82</p>
<p><strong>=E4=BF=AE=E6=94=B9=E5=BB=BA=E8=AE=AE:</strong></p>
<ul>
<li>=E4=BF=AE=E6=94=B9 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] =
py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden =
dark:bg-[#484848]/30">vllm/v1/core/kv_cache_utils.py</code> =E4=B8=AD=E7=9A=
=84 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-x=
s font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/3=
0">get_kv_cache_configs()</code> =E5=87=BD=E6=95=B0</li>
<li>=E5=9C=A8=E8=AE=A1=E7=AE=97 <code class=3D"rounded-sm bg-[#e5e5e5] px-[=
0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden afte=
r:hidden dark:bg-[#484848]/30">KVCacheTensor.size</code> =E6=97=B6=E5=BA=94=
=E7=94=A8=E7=A8=80=E7=96=8F=E5=8C=96=E7=AD=96=E7=95=A5</li>
<li>=E7=A1=AE=E4=BF=9D <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] =
py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden =
dark:bg-[#484848]/30">num_blocks</code> =E7=9A=84=E8=AE=A1=E7=AE=97=E5=8F=
=8D=E6=98=A0=E7=A8=80=E7=96=8F=E5=8C=96=E5=90=8E=E7=9A=84=E5=AE=9E=E9=99=85=
=E5=9D=97=E6=95=B0</li>
</ul>
<h3 class=3D"group">4. =E5=8F=AF=E9=80=89:=E4=BF=AE=E6=94=B9=E5=9D=97=E5=88=
=86=E9=85=8D=E9=80=BB=E8=BE=91 - <code class=3D"rounded-sm bg-[#e5e5e5] px-=
[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden aft=
er:hidden dark:bg-[#484848]/30">KVCacheCoordinator.allocate_new_blocks()</c=
ode>  </h3>
<p>=E5=A6=82=E6=9E=9C=E6=82=A8=E7=9A=84=E7=A8=80=E7=96=8F=E5=8C=96=E6=98=AF=
=E5=8A=A8=E6=80=81=E7=9A=84(=E5=8D=B3=E4=B8=8D=E5=90=8C=E8=AF=B7=E6=B1=82=
=E6=9C=89=E4=B8=8D=E5=90=8C=E7=9A=84=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F),=
=E5=8F=AF=E8=83=BD=E9=9C=80=E8=A6=81=E4=BF=AE=E6=94=B9=E8=BF=90=E8=A1=8C=E6=
=97=B6=E7=9A=84=E5=9D=97=E5=88=86=E9=85=8D=E9=80=BB=E8=BE=91=E3=80=82 <span=
 role=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg=
-pacific/20 hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[=
0.12rem] text-xs font-normal leading-[15px] transition-colors duration-100 =
before:hidden after:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;=
, &quot;IBM Plex Mono Fallback&quot;; font-weight: 400; font-style: normal;=
">kv_cache_coordinator.py:101-126</span> =E8=AF=A5=E6=96=B9=E6=B3=95=E8=B4=
=9F=E8=B4=A3=E4=B8=BA=E8=AF=B7=E6=B1=82=E5=88=86=E9=85=8D=E6=96=B0=E7=9A=84=
 KV cache =E5=9D=97=E3=80=82</p>
<p><strong>=E4=BF=AE=E6=94=B9=E5=BB=BA=E8=AE=AE:</strong></p>
<ul>
<li>=E5=9C=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20r=
em] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[=
#484848]/30">get_num_blocks_to_allocate()</code> =E4=B8=AD=E6=A0=B9=E6=8D=
=AE=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F=E8=B0=83=E6=95=B4=E6=89=80=E9=9C=80=
=E5=9D=97=E6=95=B0 <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/1=
0 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer roun=
ded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] transit=
ion-colors duration-100 before:hidden after:hidden" style=3D"font-family: &=
quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: =
400; font-style: normal;">kv_cache_coordinator.py:51-85</span></li>
<li>=E5=9C=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20r=
em] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[=
#484848]/30">allocate_new_blocks()</code> =E4=B8=AD=E5=88=86=E9=85=8D=E7=A8=
=80=E7=96=8F=E5=8C=96=E7=9A=84=E5=9D=97</li>
</ul>
<h2 class=3D"group">TPU =E6=94=AF=E6=8C=81  </h2>
<p>=E5=A6=82=E6=9E=9C=E6=82=A8=E4=B9=9F=E9=9C=80=E8=A6=81=E6=94=AF=E6=8C=81=
 TPU,=E9=9C=80=E8=A6=81=E5=9C=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-=
[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden aft=
er:hidden dark:bg-[#484848]/30">TPUModelRunner.initialize_kv_cache()</code>=
 =E4=B8=AD=E5=81=9A=E7=B1=BB=E4=BC=BC=E4=BF=AE=E6=94=B9=E3=80=82 <span role=
=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-paci=
fic/20 hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12r=
em] text-xs font-normal leading-[15px] transition-colors duration-100 befor=
e:hidden after:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &qu=
ot;IBM Plex Mono Fallback&quot;; font-weight: 400; font-style: normal;">tpu=
_model_runner.py:1770-1844</span> =E8=AF=A5=E6=96=B9=E6=B3=95=E7=9A=84=E9=
=80=BB=E8=BE=91=E4=B8=8E GPU =E7=89=88=E6=9C=AC=E7=B1=BB=E4=BC=BC,=E4=BD=86=
=E4=BD=BF=E7=94=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[=
0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark=
:bg-[#484848]/30">PallasAttentionBackend</code>=E3=80=82</p>
<h2 class=3D"group">=E5=AE=9E=E7=8E=B0=E6=B5=81=E7=A8=8B  </h2>
<ol>
<li><strong>=E9=A6=96=E5=85=88</strong>=E4=BF=AE=E6=94=B9 <code class=3D"ro=
unded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading=
-[15px] before:hidden after:hidden dark:bg-[#484848]/30">_allocate_kv_cache=
_tensors()</code> =E5=92=8C <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25=
rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hi=
dden dark:bg-[#484848]/30">_reshape_kv_cache_tensors()</code>,=E7=A1=AE=E4=
=BF=9D=E8=83=BD=E6=AD=A3=E7=A1=AE=E5=88=86=E9=85=8D=E5=92=8C=E9=87=8D=E5=A1=
=91=E7=A8=80=E7=96=8F=E5=8C=96=E7=9A=84=E5=BC=A0=E9=87=8F</li>
<li><strong>=E7=84=B6=E5=90=8E</strong>=E4=BF=AE=E6=94=B9 <code class=3D"ro=
unded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading=
-[15px] before:hidden after:hidden dark:bg-[#484848]/30">get_kv_cache_confi=
gs()</code>,=E5=9C=A8=E9=85=8D=E7=BD=AE=E7=94=9F=E6=88=90=E9=98=B6=E6=AE=B5=
=E5=B0=B1=E5=BA=94=E7=94=A8=E7=A8=80=E7=96=8F=E5=8C=96</li>
<li><strong>=E6=9C=80=E5=90=8E</strong>=E5=A6=82=E6=9E=9C=E9=9C=80=E8=A6=81=
=E5=8A=A8=E6=80=81=E7=A8=80=E7=96=8F=E5=8C=96,=E4=BF=AE=E6=94=B9 <code clas=
s=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal =
leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">KVCacheCoor=
dinator</code> =E7=9A=84=E5=9D=97=E5=88=86=E9=85=8D=E9=80=BB=E8=BE=91</li>
</ol>
<h2 class=3D"group">Notes  </h2>
<p>V1 =E7=9A=84 KV cache =E7=AE=A1=E7=90=86=E6=AF=94 V0 =E6=9B=B4=E5=8A=A0=
=E6=A8=A1=E5=9D=97=E5=8C=96,=E6=94=AF=E6=8C=81=E6=B7=B7=E5=90=88=E6=A8=A1=
=E5=9E=8B(=E5=A4=9A=E7=A7=8D attention =E7=B1=BB=E5=9E=8B)=E3=80=82=E6=82=
=A8=E7=9A=84=E7=A8=80=E7=96=8F=E5=8C=96=E9=80=BB=E8=BE=91=E9=9C=80=E8=A6=81=
=E8=80=83=E8=99=91 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[=
0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark=
:bg-[#484848]/30">KVCacheGroupSpec</code> =E7=9A=84=E6=A6=82=E5=BF=B5,=E5=
=8D=B3=E4=B8=8D=E5=90=8C=E5=B1=82=E5=8F=AF=E8=83=BD=E5=B1=9E=E4=BA=8E=E4=B8=
=8D=E5=90=8C=E7=9A=84 KV cache =E7=BB=84=E3=80=82 <span role=3D"link" tabin=
dex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg=
-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs fon=
t-normal leading-[15px] transition-colors duration-100 before:hidden after:=
hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mon=
o Fallback&quot;; font-weight: 400; font-style: normal;">kv_cache_interface=
.py:368-378</span> =E6=AF=8F=E4=B8=AA=E7=BB=84=E5=8F=AF=E4=BB=A5=E6=9C=89=
=E4=B8=8D=E5=90=8C=E7=9A=84=E7=A8=80=E7=96=8F=E5=8C=96=E7=AD=96=E7=95=A5=E3=
=80=82</p>
<p>=E5=8F=A6=E5=A4=96,V1 =E6=94=AF=E6=8C=81 prefix caching,=E6=82=A8=E7=9A=
=84=E7=A8=80=E7=96=8F=E5=8C=96=E9=80=BB=E8=BE=91=E9=9C=80=E8=A6=81=E4=B8=8E=
=E7=BC=93=E5=AD=98=E6=9C=BA=E5=88=B6=E5=85=BC=E5=AE=B9,=E7=A1=AE=E4=BF=9D=
=E7=A8=80=E7=96=8F=E5=8C=96=E7=9A=84=E5=9D=97=E5=8F=AF=E4=BB=A5=E8=A2=AB=E6=
=AD=A3=E7=A1=AE=E7=BC=93=E5=AD=98=E5=92=8C=E9=87=8D=E7=94=A8=E3=80=82</p>
<p>Wiki pages you might want to explore:</p>
<ul>
<li><a href=3D"https://deepwiki.com/vllm-project/vllm/2.4-request-processin=
g-and-scheduling">Request Processing and Scheduling (vllm-project/vllm)</a>=
</li>
</ul></div><div class=3D"mt-4 flex justify-end gap-2"><button data-state=3D=
"closed" data-slot=3D"tooltip-trigger"><button class=3D"border-border bg-su=
rface hover:border-border-hover hover:bg-component flex cursor-pointer item=
s-center gap-1.5 rounded-md border px-3 py-2 text-sm transition-colors" ari=
a-label=3D"Copy" type=3D"button" id=3D"radix-=C2=ABr4=C2=BB" aria-haspopup=
=3D"menu" aria-expanded=3D"false" data-state=3D"closed"><svg xmlns=3D"http:=
//www.w3.org/2000/svg" width=3D"24" height=3D"24" viewBox=3D"0 0 24 24" fil=
l=3D"none" stroke=3D"currentColor" stroke-width=3D"2" stroke-linecap=3D"rou=
nd" stroke-linejoin=3D"round" class=3D"lucide lucide-copy h-4 w-4" aria-hid=
den=3D"true"><rect width=3D"14" height=3D"14" x=3D"8" y=3D"8" rx=3D"2" ry=
=3D"2"></rect><path d=3D"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .=
9 2 2"></path></svg></button></button><button class=3D"flex items-center ro=
unded-md cursor-pointer transition-all border border-border bg-surface hove=
r:border-border-hover hover:bg-component disabled:cursor-default disabled:o=
pacity-50 disabled:hover:border-border disabled:hover:bg-surface gap-1.5 px=
-3 py-1.5 text-sm" aria-label=3D"Share" data-state=3D"closed" data-slot=3D"=
tooltip-trigger"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"24" hei=
ght=3D"24" viewBox=3D"0 0 24 24" fill=3D"none" stroke=3D"currentColor" stro=
ke-width=3D"2" stroke-linecap=3D"round" stroke-linejoin=3D"round" class=3D"=
h-4 w-4"><circle cx=3D"18" cy=3D"5" r=3D"3"></circle><circle cx=3D"6" cy=3D=
"12" r=3D"3"></circle><circle cx=3D"18" cy=3D"19" r=3D"3"></circle><line x1=
=3D"8.59" y1=3D"13.51" x2=3D"15.42" y2=3D"17.49"></line><line x1=3D"15.41" =
y1=3D"6.51" x2=3D"8.59" y2=3D"10.49"></line></svg></button></div></div></di=
v></div></div><div class=3D"min-w-0 flex-1 scroll-smooth xl:[flex-grow:3]" =
style=3D"scrollbar-width: thin; scrollbar-color: rgb(90, 90, 90) transparen=
t; min-height: unset;"><div class=3D"sticky left-0 top-20 overflow-y-auto r=
ounded-md" style=3D"max-height: calc(-135px + 100vh);"><div class=3D"flex f=
lex-col gap-3 p-0 pb-[90px]"><div id=3D"file-Repo vllm-project/vllm: vllm/v=
1/worker/gpu_model_runner.py" class=3D"flex flex-col gap-2 scroll-smooth ro=
unded-md" style=3D"content-visibility: auto;"><div class=3D"scrollbar-hide =
relative w-full p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-se=
condary dark:bg-surface sticky top-0 z-10 flex w-full items-center justify-=
between px-3 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"fl=
ex min-w-0 grow items-center gap-2"><button><svg xmlns=3D"http://www.w3.org=
/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 =
0 256 256" class=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.=
32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11=
.32Z"></path></svg></button><div class=3D"[&amp;_svg_path]:fill-current siz=
e-4 flex-shrink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width: 2=
0px;"><svg viewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 =
2.3v1.8c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1=
-2.2.3-3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3=
 0-.4-.1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.=
1 1 .3 1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6=
c0 .4.3.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.=
3-.9 2.3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.=
1 2.2-.3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 =
.4.1.4.4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-=
.3-1.4-.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8=
 6c0-.4-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg>=
</div><a href=3D"https://github.com/vllm-project/vllm" target=3D"_blank" re=
l=3D"noreferrer" class=3D"cursor-pointer truncate text-neutral-500 hover:un=
derline">vllm-project/vllm</a><a href=3D"https://github.com/vllm-project/vl=
lm/blob/352c0c8a/vllm/v1/worker/gpu_model_runner.py" target=3D"_blank" rel=
=3D"noreferrer" class=3D"cursor-pointer truncate text-black dark:text-neutr=
al-300 hover:underline">vllm/v1/worker/gpu_model_runner.py</a><button><svg =
xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"c=
urrentColor" viewBox=3D"0 0 256 256" class=3D"h-4 w-4 text-neutral-500"><pa=
th d=3D"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a=
8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm=
48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></svg></button></div></div><d=
iv class=3D"scrollbar-hide grid overflow-auto scroll-smooth"><button class=
=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutr=
al-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h-full items-center=
 gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"htt=
p://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor"=
 viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,=
0,1-11.32,11.32L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-1=
1.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,=
0-16Z"></path></svg></div></button><div class=3D"relative w-full min-w-max =
overflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=
=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera San=
s Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; =
text-align: left; white-space: pre; word-spacing: normal; word-break: norma=
l; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; paddin=
g: 0px; margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); =
background-color: white; width: 100%;"><code style=3D"white-space: pre; fon=
t-size: 12px;"><span style=3D"background-color: rgb(248, 248, 248); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4260</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4261</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4262</span></span></code></pre>=
</div><div class=3D"citation-1-0 citation-1-1"><div class=3D"relative w-ful=
l min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 cli=
ckable-snippet cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-f=
amily: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&qu=
ot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre=
; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: =
1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: aut=
o; border: 1px solid rgb(221, 221, 221); background-color: white; width: 10=
0%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D"back=
ground-color: var(--bg-secondary); display: block; white-space: pre; paddin=
g: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-numbe=
r" style=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; t=
ext-align: right; user-select: none; font-size: 11px; font-weight: normal; =
font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-styl=
e: italic;">4263</span><span>    </span><span class=3D"token" style=3D"colo=
r: rgb(0, 0, 255);">def</span><span> </span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">_allocate_kv_cache_tensors</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4264</span><span>        self<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span=
> kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">:</span><span> KVCacheConfig
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4265</span><span>    </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><spa=
n class=3D"token builtin">dict</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">[</span><span class=3D"token builtin">str</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> torch</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>Tensor=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4266</span><span>        </spa=
n><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 2=
1);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">4267</span>        Initializes the KV cache=
 buffer with the correct size. The buffer needs
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4268</span>        to be reshaped to the desired s=
hape before being used by the models.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4269</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4270</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4271</span>            kv_cache_config: The KV cac=
he config
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4272</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4273</span>            dict[str, torch.Tensor]: A =
map between layer names to their
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4274</span>            corresponding memory buffer=
 for KV cache.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4275</span><span class=3D"token tripl=
e-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4276</span><span>        kv_ca=
che_raw_tensors</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">:</span><span> </span><span class=3D"token builtin">dict</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token=
 builtin">str</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>,</span><span> torch</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>Tensor</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">]</span><span> </span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">{</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">}</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4277</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> k=
v_cache_tensor </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);=
">in</span><span> kv_cache_config</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>kv_cache_tensors</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4278</span><span>            t=
ensor </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</s=
pan><span> torch</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">.</span><span>zeros</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4279</span><span>             =
   kv_cache_tensor</span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">.</span><span>size</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">,</span><span> dtype</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">=3D</span><span>torch</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">.</span><span>int8</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">,</span><span> device</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span>self</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>device
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4280</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4281</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> kv_cache_tensor</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>shared_by</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4282</span><span>             =
   kv_cache_raw_tensors</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">[</span><span>layer_name</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">]</span><span> </span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">=3D</span><span> tensor
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4283</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4284</span><span>        layer_names =
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><s=
pan> </span><span class=3D"token builtin">set</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4285</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> g=
roup </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</span=
><span> kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>kv_cache_groups</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4286</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> group</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>layer_names</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4287</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><=
span> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255=
);">in</span><span> self</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>runner_only_attn_layers</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4288</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">contin=
ue</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4289</span><span>             =
   layer_names</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>add</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">(</span><span>layer_name</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4290</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span=
> layer_names </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D=3D</span><span> </span><span class=3D"token builtin">set</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_ra=
w_tensors</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</=
span><span>keys</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4291</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"Some layers=
 are not correctly initialized"</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4292</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4293</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span=
> kv_cache_raw_tensors</span></span></code></pre></div></div><div class=3D"=
relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-ne=
utral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, =
&quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, mon=
ospace; direction: ltr; text-align: left; white-space: pre; word-spacing: n=
ormal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: =
4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px so=
lid rgb(221, 221, 221); background-color: white; width: 100%;"><code style=
=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: rg=
b(248, 248, 248); display: block; white-space: pre; padding: 0px 20px;"><sp=
an class=3D"linenumber react-syntax-highlighter-line-number" style=3D"displ=
ay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: right;=
 user-select: none; font-size: 11px; font-weight: normal; font-family: mono=
space; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">4294<=
/span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4295</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">_attn_group_iterat=
or</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><s=
pan>self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</s=
pan><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><=
span> Iterator</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">[</span><span>AttentionGroup</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4296</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 itertools</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.<=
/span><span>chain</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">.</span><span>from_iterable</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">(</span><span>self</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span>attn_groups</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">)</span></span></code></pre></div><b=
utton class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] da=
rk:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h-full i=
tems-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><svg x=
mlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"cu=
rrentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M50.34,117=
.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-58.35a8=
,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H21=
6a8,8,0,0,0,0-16Z"></path></svg></div></button><button class=3D"h-5 w-full =
cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hov=
er:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.=
3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/=
2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0=
 256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32=
L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-7=
2a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path><=
/svg></div></button><div class=3D"relative w-full min-w-max overflow-hidden=
 [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57=
, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &qu=
ot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left;=
 white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9=
em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0=
px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color:=
 white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><s=
pan style=3D"background-color: rgb(248, 248, 248); display: block; white-sp=
ace: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highli=
ghter-line-number" style=3D"display: inline-block; min-width: 2.25em; paddi=
ng-right: 1em; text-align: right; user-select: none; font-size: 11px; font-=
weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 12=
8, 0); font-style: italic;">4351</span><span>        kv_cache_config</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> KVCa=
cheConfig</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</=
span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4352</span><span>        kv_cac=
he_raw_tensors</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">:</span><span> </span><span class=3D"token builtin">dict</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token =
builtin">str</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
,</span><span> torch</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">.</span><span>Tensor</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">,</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4353</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">dict</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">[</span><span class=3D"token builtin">str</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> torch</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>Tensor<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span></span></code></=
pre></div><div class=3D"citation-1-2 citation-1-3"><div class=3D"relative w=
-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10=
 clickable-snippet cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); fo=
nt-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier Ne=
w&quot;, Courier, monospace; direction: ltr; text-align: left; white-space:=
 pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-heig=
ht: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow:=
 auto; border: 1px solid rgb(221, 221, 221); background-color: white; width=
: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D"=
background-color: var(--bg-secondary); display: block; white-space: pre; pa=
dding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-n=
umber" style=3D"display: inline-block; min-width: 2.25em; padding-right: 1e=
m; text-align: right; user-select: none; font-size: 11px; font-weight: norm=
al; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-=
style: italic;">4354</span><span>        </span><span class=3D"token triple=
-quoted-string" style=3D"color: rgb(163, 21, 21);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">4355</span>        Reshape the KV cache ten=
sors to the desired shape and dtype.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4356</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4357</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4358</span>            kv_cache_config: The KV cac=
he config
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4359</span>            kv_cache_raw_tensors: The K=
V cache buffer of each layer, with
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4360</span>                correct size but uninit=
ialized shape.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4361</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4362</span>            Dict[str, torch.Tensor]: A =
map between layer names to their
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">4363</span>            corresponding memory buffer=
 for KV cache.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4364</span><span class=3D"token tripl=
e-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4365</span><span>        kv_ca=
ches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span>=
<span> </span><span class=3D"token builtin">dict</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token builtin">s=
tr</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><s=
pan> torch</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.<=
/span><span>Tensor</span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">]</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">{</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">}</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4366</span><span>        has_a=
ttn</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><=
span> has_mamba </span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 1=
72, 170);">False</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">,</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 172=
, 170);">False</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4367</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> g=
roup </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</span=
><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
.</span><span>_kv_cache_spec_attn_group_iterator</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4368</span><span>            k=
v_cache_spec </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> group</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>kv_cache_spec
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4369</span><span>            a=
ttn_backend </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
=3D</span><span> group</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>backend
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4370</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> group</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>layer_names</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4371</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><=
span> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255=
);">in</span><span> self</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>runner_only_attn_layers</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4372</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">contin=
ue</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4373</span><span>             =
   raw_tensor </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span> kv_cache_raw_tensors</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span>layer_name</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4374</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</sp=
an><span> raw_tensor</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">.</span><span>numel</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">)</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">%</span><span> kv_cache_spec</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">.</span><span>page_size_bytes </span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><span c=
lass=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4375</span><span>             =
   num_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span> raw_tensor</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">.</span><span>numel</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">)</span><span> </span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">//</span><span> kv_cache_spec</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">.</span><span>page_size_bytes
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4376</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><=
span> </span><span class=3D"token builtin">isinstance</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_spec</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> Atte=
ntionSpec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4377</span><span>             =
       has_attn </span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 1=
72, 170);">True</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4378</span><span>             =
       kv_manager_block_size </span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">=3D</span><span> kv_cache_spec</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4379</span><span>             =
       kernel_size_list </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">=3D</span><span> self</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>_find_compatible_block_sizes</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4380</span><span>             =
           kv_manager_block_size</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">,</span><span> attn_backend</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">,</span><span> return_all</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span class=3D"to=
ken" style=3D"color: rgb(54, 172, 170);">False</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4381</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4382</span><span>             =
       kernel_size </span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">=3D</span><span> kernel_size_list</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4383</span><span>             =
       num_blocks_per_kv_block </span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">=3D</span><span> kv_manager_block_size </span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">//</span><span> kernel_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4384</span><span>             =
       kernel_num_blocks </span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">=3D</span><span> num_blocks </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">*</span><span> num_blocks_per_kv_block
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4385</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4386</span><span>                    =
kv_cache_shape </span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">=3D</span><span> attn_backend</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>get_kv_cache_shape</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4387</span><span>             =
           kernel_num_blocks</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4388</span><span>             =
           kernel_size</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4389</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>num_kv_heads</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4390</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>head_size</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4391</span><span>             =
           cache_dtype_str</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">=3D</span><span>self</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">.</span><span>cache_config</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">.</span><span>cache_dtype</span><span c=
lass=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4392</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4393</span><span>             =
       dtype </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> kv_cache_spec</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">.</span><span>dtype
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4394</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">try</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4395</span><span>             =
           kv_cache_stride_order </span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">=3D</span><span> attn_backend</span><span class=3D"tok=
en" style=3D"color: rgb(57, 58, 52);">.</span><span>get_kv_cache_stride_ord=
er</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>  </spa=
n><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;=
"># noqa: E501</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4396</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">as=
sert</span><span> </span><span class=3D"token builtin">len</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_stride=
_order</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
=3D</span><span> </span><span class=3D"token builtin">len</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_shape</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4397</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">except=
</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">(</span><span>AttributeError</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">,</span><span> NotImplementedError</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4398</span><span>             =
           kv_cache_stride_order </span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token builtin">=
tuple</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span=
><span class=3D"token builtin">range</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">(</span><span class=3D"token builtin">len</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache=
_shape</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4399</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-st=
yle: italic;"># The allocation respects the backend-defined stride order</s=
pan><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4400</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-st=
yle: italic;"># to ensure the semantic remains consistent for each</span><s=
pan>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4401</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-st=
yle: italic;"># backend. We first obtain the generic kv cache shape and</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4402</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-st=
yle: italic;"># then permute it according to the stride order which could</=
span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4403</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-st=
yle: italic;"># result in a non-contiguous tensor.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4404</span><span>             =
       kv_cache_shape </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">=3D</span><span> </span><span class=3D"token builtin">tuple</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4405</span><span>             =
           kv_cache_shape</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">[</span><span>i</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">]</span><span> </span><span class=3D"token" style=3D"color:=
 rgb(0, 0, 255);">for</span><span> i </span><span class=3D"token" style=3D"=
color: rgb(0, 0, 255);">in</span><span> kv_cache_stride_order
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4406</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4407</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-st=
yle: italic;"># Maintain original KV shape view.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4408</span><span>             =
       inv_order </span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">[</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4409</span><span>             =
           kv_cache_stride_order</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>index</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>i</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4410</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">fo=
r</span><span> i </span><span class=3D"token" style=3D"color: rgb(0, 0, 255=
);">in</span><span> </span><span class=3D"token builtin">range</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"to=
ken builtin">len</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">(</span><span>kv_cache_stride_order</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4411</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4412</span><span>             =
       kv_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">[</span><span>layer_name</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">]</span><span> </span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4413</span><span>             =
           kv_cache_raw_tensors</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">[</span><span>layer_name</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4414</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.=
</span><span>view</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">(</span><span>dtype</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4415</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.=
</span><span>view</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">(</span><span>kv_cache_shape</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4416</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.=
</span><span>permute</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">*</=
span><span>inv_order</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4417</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4418</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">elif</span=
><span> </span><span class=3D"token builtin">isinstance</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_spec</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> =
MambaSpec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4419</span><span>             =
       has_mamba </span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(54, =
172, 170);">True</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4420</span><span>             =
       raw_tensor </span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">=3D</span><span> kv_cache_raw_tensors</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">[</span><span>layer_name</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4421</span><span>             =
       state_tensors </span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">[</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4422</span><span>             =
       storage_offset_bytes </span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"colo=
r: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4423</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</s=
pan><span> shape</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">,</span><span> dtype </span><span class=3D"token" style=3D"color: rgb(0=
, 0, 255);">in</span><span> </span><span class=3D"token builtin">zip</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_ca=
che_spec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</s=
pan><span>shapes</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">,</span><span> kv_cache_spec</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>dtypes</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4424</span><span>             =
           dtype_size </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">=3D</span><span> get_dtype_size</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>dtype</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4425</span><span>             =
           num_element_per_page </span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4426</span><span>             =
               kv_cache_spec</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">.</span><span>page_size_bytes </span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">//</span><span> dtype_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4427</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4428</span><span>             =
           target_shape </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">(</span><span>num_blocks</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> </span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">*</span><span>shape</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4429</span><span>             =
           stride </span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">=3D</span><span> torch</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">.</span><span>empty</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">(</span><span>target_shape</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span>stride</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4430</span><span>             =
           target_stride </span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">=3D</span><span> </span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">(</span><span>num_element_per_page</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">*</span><span>stride</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span class=3D=
"token" style=3D"color: rgb(54, 172, 170);">1</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">:</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4431</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">as=
sert</span><span> storage_offset_bytes </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">%</span><span> dtype_size </span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><sp=
an class=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4432</span><span>             =
           tensor </span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">=3D</span><span> torch</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">.</span><span>as_strided</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4433</span><span>             =
               raw_tensor</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">.</span><span>view</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">(</span><span>dtype</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4434</span><span>             =
               size</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">=3D</span><span>target_shape</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4435</span><span>             =
               stride</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">=3D</span><span>target_stride</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4436</span><span>             =
               storage_offset</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">=3D</span><span>storage_offset_bytes </span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">//</span><span> dtype_size</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4437</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4438</span><span>             =
           state_tensors</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>append</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">(</span><span>tensor</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4439</span><span>             =
           storage_offset_bytes </span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">+=3D</span><span> stride</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"colo=
r: rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">]</span><span> </span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">*</span><span> dtype_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4440</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4441</span><span>                    =
kv_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</=
span><span>layer_name</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span> </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">=3D</span><span> state_tensors
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4442</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4443</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">raise<=
/span><span> NotImplementedError
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4444</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4445</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> has_attn =
</span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">and</span><sp=
an> has_mamba</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4446</span><span>            s=
elf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>_update_hybrid_attention_mamba_layout</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">(</span><span>kv_caches</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">4447</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">4448</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span> kv_ca=
ches</span></span></code></pre></div></div><div class=3D"relative w-full mi=
n-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre=
 style=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Ve=
ra Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction:=
 ltr; text-align: left; white-space: pre; word-spacing: normal; word-break:=
 normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; =
padding: 0px; margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, =
221); background-color: white; width: 100%;"><code style=3D"white-space: pr=
e; font-size: 12px;"><span style=3D"background-color: rgb(248, 248, 248); d=
isplay: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenum=
ber react-syntax-highlighter-line-number" style=3D"display: inline-block; m=
in-width: 2.25em; padding-right: 1em; text-align: right; user-select: none;=
 font-size: 11px; font-weight: normal; font-family: monospace; padding-left=
: 8px; color: rgb(0, 128, 0); font-style: italic;">4449</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4450</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">_update_hybrid_att=
ention_mamba_layout</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">(</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">4451</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 kv_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:<=
/span><span> </span><span class=3D"token builtin">dict</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token buil=
tin">str</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</s=
pan><span> torch</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">.</span><span>Tensor</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">]</span></span></code></pre></div><button class=3D"h-5 w-full c=
ursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hove=
r:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3=
rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2=
000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 =
256 256" class=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L1=
20,164.69V32a8,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72=
a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path><=
/svg></div></button></div></div></div><div id=3D"file-Repo vllm-project/vll=
m: vllm/v1/engine/core.py" class=3D"flex flex-col gap-2 scroll-smooth round=
ed-md" style=3D"content-visibility: auto;"><div class=3D"scrollbar-hide rel=
ative w-full p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-secon=
dary dark:bg-surface sticky top-0 z-10 flex w-full items-center justify-bet=
ween px-3 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"flex =
min-w-0 grow items-center gap-2"><button><svg xmlns=3D"http://www.w3.org/20=
00/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 2=
56 256" class=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,=
0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32=
Z"></path></svg></button><div class=3D"[&amp;_svg_path]:fill-current size-4=
 flex-shrink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width: 20px=
;"><svg viewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3=
v1.8c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.=
2.3-3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-=
.4-.1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1=
 .3 1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 =
.4.3.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.=
9 2.3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2=
.2-.3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.=
1.4.4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-=
1.4-.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c=
0-.4-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></d=
iv><a href=3D"https://github.com/vllm-project/vllm" target=3D"_blank" rel=
=3D"noreferrer" class=3D"cursor-pointer truncate text-neutral-500 hover:und=
erline">vllm-project/vllm</a><a href=3D"https://github.com/vllm-project/vll=
m/blob/352c0c8a/vllm/v1/engine/core.py" target=3D"_blank" rel=3D"noreferrer=
" class=3D"cursor-pointer truncate text-black dark:text-neutral-300 hover:u=
nderline">vllm/v1/engine/core.py</a><button><svg xmlns=3D"http://www.w3.org=
/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 =
0 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,0=
,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0=
,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8=
H96V48H208Z"></path></svg></button></div></div><div class=3D"scrollbar-hide=
 grid overflow-auto scroll-smooth"><button class=3D"h-5 w-full cursor-point=
er bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutra=
l-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-x=
s font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" wi=
dth=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" cl=
ass=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V2=
24a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,=
11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div><=
/button><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]=
:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); f=
ont-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier N=
ew&quot;, Courier, monospace; direction: ltr; text-align: left; white-space=
: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-hei=
ght: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow=
: auto; border: 1px solid rgb(221, 221, 221); background-color: white; widt=
h: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D=
"background-color: rgb(248, 248, 248); display: block; white-space: pre; pa=
dding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-n=
umber" style=3D"display: inline-block; min-width: 2.25em; padding-right: 1e=
m; text-align: right; user-select: none; font-size: 11px; font-weight: norm=
al; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-=
style: italic;">229</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">230</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span> =
</span><span class=3D"token builtin">len</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_specs</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span>=
<span class=3D"token builtin">len</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">(</span><span>available_gpu_memory</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">231</span></span></code></pre><=
/div><div class=3D"citation-1-4"><div class=3D"relative w-full min-w-max ov=
erflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet=
 cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consola=
s, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, =
monospace; direction: ltr; text-align: left; white-space: pre; word-spacing=
: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-siz=
e: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px=
 solid rgb(221, 221, 221); background-color: white; width: 100%;"><code sty=
le=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: =
var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;">=
<span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"di=
splay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: rig=
ht; user-select: none; font-size: 11px; font-weight: normal; font-family: m=
onospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">23=
2</span><span>        kv_cache_configs </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">=3D</span><span> get_kv_cache_configs</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">233</span><span>            vl=
lm_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</=
span><span> kv_cache_specs</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">,</span><span> available_gpu_memory
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">234</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></c=
ode></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">235</span><span>        scheduler_kv_cache_co=
nfig </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</sp=
an><span> generate_scheduler_kv_cache_config</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_configs</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">236</span><span>        num_gpu=
_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D<=
/span><span> scheduler_kv_cache_config</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span>num_blocks
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">237</span><span>        num_cpu=
_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D<=
/span><span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170)=
;">0</span></span></code></pre></div><button class=3D"h-5 w-full cursor-poi=
nter bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neut=
ral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text=
-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" =
width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" =
class=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69=
V32a8,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,=
1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></di=
v></button></div></div></div><div id=3D"file-Repo vllm-project/vllm: vllm/v=
1/core/kv_cache_coordinator.py" class=3D"flex flex-col gap-2 scroll-smooth =
rounded-md" style=3D"content-visibility: auto;"><div class=3D"scrollbar-hid=
e relative w-full p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-=
secondary dark:bg-surface sticky top-0 z-10 flex w-full items-center justif=
y-between px-3 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"=
flex min-w-0 grow items-center gap-2"><button><svg xmlns=3D"http://www.w3.o=
rg/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"=
0 0 256 256" class=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-1=
1.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,=
11.32Z"></path></svg></button><div class=3D"[&amp;_svg_path]:fill-current s=
ize-4 flex-shrink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width:=
 20px;"><svg viewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.=
3 2.3v1.8c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-=
.1-2.2.3-3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-=
.3 0-.4-.1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.=
5.1 1 .3 1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8=
-6c0 .4.3.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 =
2.3-.9 2.3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.=
1.1 2.2-.3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 =
0 .4.1.4.4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-=
1-.3-1.4-.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2=
.8 6c0-.4-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></sv=
g></div><a href=3D"https://github.com/vllm-project/vllm" target=3D"_blank" =
rel=3D"noreferrer" class=3D"cursor-pointer truncate text-neutral-500 hover:=
underline">vllm-project/vllm</a><a href=3D"https://github.com/vllm-project/=
vllm/blob/352c0c8a/vllm/v1/core/kv_cache_coordinator.py" target=3D"_blank" =
rel=3D"noreferrer" class=3D"cursor-pointer truncate text-black dark:text-ne=
utral-300 hover:underline">vllm/v1/core/kv_cache_coordinator.py</a><button>=
<svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=
=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-4 w-4 text-neutral-500=
"><path d=3D"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8=
H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H=
160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></svg></button></div></d=
iv><div class=3D"scrollbar-hide grid overflow-auto scroll-smooth"><button c=
lass=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-n=
eutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex h-full items-ce=
nter gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D=
"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentCo=
lor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,=
8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0=
,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,=
0,0,0-16Z"></path></svg></div></button><div class=3D"relative w-full min-w-=
max overflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre sty=
le=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera S=
ans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr=
; text-align: left; white-space: pre; word-spacing: normal; word-break: nor=
mal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padd=
ing: 0px; margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221)=
; background-color: white; width: 100%;"><code style=3D"white-space: pre; f=
ont-size: 12px;"><span style=3D"background-color: rgb(248, 248, 248); displ=
ay: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber =
react-syntax-highlighter-line-number" style=3D"display: inline-block; min-w=
idth: 2.25em; padding-right: 1em; text-align: right; user-select: none; fon=
t-size: 11px; font-weight: normal; font-family: monospace; padding-left: 8p=
x; color: rgb(0, 128, 0); font-style: italic;">48</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> i</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span>=
<span> kv_cache_group </span><span class=3D"token" style=3D"color: rgb(0, 0=
, 255);">in</span><span> </span><span class=3D"token builtin">enumerate</sp=
an><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>se=
lf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><s=
pan>kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">.</span><span>kv_cache_groups</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">49</span><span>        </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">50</span></span></code></pre></=
div><div class=3D"citation-1-6"><div class=3D"relative w-full min-w-max ove=
rflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet =
cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas=
, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, m=
onospace; direction: ltr; text-align: left; white-space: pre; word-spacing:=
 normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size=
: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px =
solid rgb(221, 221, 221); background-color: white; width: 100%;"><code styl=
e=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: v=
ar(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"><=
span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"dis=
play: inline-block; min-width: 2.25em; padding-right: 1em; text-align: righ=
t; user-select: none; font-size: 11px; font-weight: normal; font-family: mo=
nospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">51<=
/span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, 255)=
;">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">get_num_blocks_to_allocate</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">52</span><span>        self</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">53</span><span>        request=
_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><=
span> </span><span class=3D"token builtin">str</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">54</span><span>        num_tok=
ens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><=
span> </span><span class=3D"token builtin">int</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">55</span><span>        new_com=
puted_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
:</span><span> </span><span class=3D"token builtin">tuple</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>Sequence</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>KVCach=
eBlock</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">56</span><span>        num_enc=
oder_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:=
</span><span> </span><span class=3D"token builtin">int</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">57</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">int</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">58</span><span>        </span>=
<span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21)=
;">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">59</span>        Get the number of blocks n=
eeded to be allocated for the request.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">60</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">61</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">62</span>            request_id: The request ID.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">63</span>            num_tokens: The total number =
of tokens that need a slot (including
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">64</span>                tokens that are already a=
llocated).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">65</span>            new_computed_blocks: The new =
computed blocks just hitting the
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">66</span>                prefix caching.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">67</span>            num_encoder_tokens: The numbe=
r of encoder tokens for allocating
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">68</span>                blocks for cross-attentio=
n.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">69</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">70</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">71</span>            The number of blocks.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">72</span><span class=3D"token triple-=
quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">73</span><span>        num_blo=
cks_to_allocate </span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 1=
72, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">74</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> i</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 manager </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</=
span><span> </span><span class=3D"token builtin">enumerate</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>self</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>single_ty=
pe_managers</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><spa=
n>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">75</span><span>            </s=
pan><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> =
</span><span class=3D"token builtin">isinstance</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">(</span><span>manager</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> CrossAttentionM=
anager</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">76</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: i=
talic;"># For cross-attention, we issue a single static allocation</span><s=
pan>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">77</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: i=
talic;"># of blocks based on the number of encoder input tokens.</span><spa=
n>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">78</span><span>               =
 num_blocks_to_allocate </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">+=3D</span><span> manager</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">.</span><span>get_num_blocks_to_allocate</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">79</span><span>               =
     request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">,</span><span> num_encoder_tokens</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">,</span><span> </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">80</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><sp=
an>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">81</span><span>            </s=
pan><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">82</span><span>               =
 num_blocks_to_allocate </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">+=3D</span><span> manager</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">.</span><span>get_num_blocks_to_allocate</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">83</span><span>               =
     request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">,</span><span> num_tokens</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">,</span><span> new_computed_blocks</span><span class=3D"tok=
en" style=3D"color: rgb(57, 58, 52);">[</span><span>i</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">84</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><sp=
an>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">85</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span> =
num_blocks_to_allocate</span></span></code></pre></div></div><div class=3D"=
relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-ne=
utral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, =
&quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, mon=
ospace; direction: ltr; text-align: left; white-space: pre; word-spacing: n=
ormal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: =
4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px so=
lid rgb(221, 221, 221); background-color: white; width: 100%;"><code style=
=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: rg=
b(248, 248, 248); display: block; white-space: pre; padding: 0px 20px;"><sp=
an class=3D"linenumber react-syntax-highlighter-line-number" style=3D"displ=
ay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: right;=
 user-select: none; font-size: 11px; font-weight: normal; font-family: mono=
space; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">86</s=
pan><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">87</span><span>    </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">save_new_computed_bl=
ocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span>=
<span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">88</span><span>        self</sp=
an><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> r=
equest_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</=
span><span> </span><span class=3D"token builtin">str</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">,</span><span> new_computed_blocks<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span=
> </span><span class=3D"token builtin">tuple</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">[</span><span>Sequence</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">[</span><span>KVCacheBlock</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">]</span></span></code></pre></div><button class=3D"h-5 w-ful=
l cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:h=
over:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[=
1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.or=
g/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0=
 0 256 256" class=3D"h-3 w-3"><path d=3D"M224,128a8,8,0,0,1-8,8H40a8,8,0,0,=
1,0-16H216A8,8,0,0,1,224,128ZM101.66,53.66,120,35.31V96a8,8,0,0,0,16,0V35.3=
1l18.34,18.35a8,8,0,0,0,11.32-11.32l-32-32a8,8,0,0,0-11.32,0l-32,32a8,8,0,0=
,0,11.32,11.32Zm52.68,148.68L136,220.69V160a8,8,0,0,0-16,0v60.69l-18.34-18.=
35a8,8,0,0,0-11.32,11.32l32,32a8,8,0,0,0,11.32,0l32-32a8,8,0,0,0-11.32-11.3=
2Z"></path></svg></div></button><div class=3D"relative w-full min-w-max ove=
rflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"c=
olor: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mon=
o&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-=
align: left; white-space: pre; word-spacing: normal; word-break: normal; fo=
nt-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0p=
x; margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); backg=
round-color: white; width: 100%;"><code style=3D"white-space: pre; font-siz=
e: 12px;"><span style=3D"background-color: rgb(248, 248, 248); display: blo=
ck; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-s=
yntax-highlighter-line-number" style=3D"display: inline-block; min-width: 2=
.25em; padding-right: 1em; text-align: right; user-select: none; font-size:=
 11px; font-weight: normal; font-family: monospace; padding-left: 8px; colo=
r: rgb(0, 128, 0); font-style: italic;">98</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> i</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> mana=
ger </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</span>=
<span> </span><span class=3D"token builtin">enumerate</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">(</span><span>self</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>single_type_ma=
nagers</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">99</span><span>            mana=
ger</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>save_new_computed_blocks</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">(</span><span>request_id</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> new_computed_blocks</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>i</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">100</span></span></code></pre><=
/div><div class=3D"citation-1-5"><div class=3D"relative w-full min-w-max ov=
erflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet=
 cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consola=
s, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, =
monospace; direction: ltr; text-align: left; white-space: pre; word-spacing=
: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-siz=
e: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px=
 solid rgb(221, 221, 221); background-color: white; width: 100%;"><code sty=
le=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: =
var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;">=
<span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"di=
splay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: rig=
ht; user-select: none; font-size: 11px; font-weight: normal; font-family: m=
onospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">10=
1</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, 25=
5);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">allocate_new_blocks</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">102</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:=
</span><span> </span><span class=3D"token builtin">str</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> num_tokens</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </spa=
n><span class=3D"token builtin">int</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span> num_encoder_tokens</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </span><span cl=
ass=3D"token builtin">int</span><span> </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" =
style=3D"color: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">103</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">tuple</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">[</span><span class=3D"token builtin">list</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>KVCacheBlock<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">104</span><span>        </span=
><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21=
);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">105</span>        Allocate new blocks for t=
he request to give it at least `num_tokens`
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">106</span>        token slots.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">107</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">108</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">109</span>            request_id: The request ID.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">110</span>            num_tokens: The total number=
 of tokens that need a slot (including
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">111</span>                tokens that are already =
allocated).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">112</span>            num_encoder_tokens: The numb=
er of encoder tokens for allocating
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">113</span>                blocks for cross-attenti=
on.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">114</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">115</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">116</span>            The new allocated blocks.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">117</span><span class=3D"token triple=
-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">118</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 </span><span class=3D"token builtin">tuple</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">119</span><span>            ma=
nager</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>allocate_new_blocks</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">120</span><span>              =
  request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">121</span>                num_=
encoder_tokens
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">122</span><span>                </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> </=
span><span class=3D"token builtin">isinstance</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">(</span><span>manager</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> CrossAttentionMana=
ger</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><=
span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">123</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span>=
<span> num_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">124</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">125</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span=
> manager </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in<=
/span><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">.</span><span>single_type_managers
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">126</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></c=
ode></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">127</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">128</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">cache_blocks</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>self<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span=
> request</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</=
span><span> Request</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">,</span><span> num_computed_tokens</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">:</span><span> </span><span class=3D"token bui=
ltin">int</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
-</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span>=
<span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">Non=
e</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><sp=
an>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">129</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(163, 21, 21);">""</span><span>"</=
span></span></code></pre></div><button class=3D"h-5 w-full cursor-pointer b=
g-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-70=
0/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs fo=
nt-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=
=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=
=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8=
,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.=
32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></b=
utton></div></div></div><div id=3D"file-Repo vllm-project/vllm: vllm/v1/wor=
ker/tpu_model_runner.py" class=3D"flex flex-col gap-2 scroll-smooth rounded=
-md" style=3D"content-visibility: auto;"><div class=3D"scrollbar-hide relat=
ive w-full p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-seconda=
ry dark:bg-surface sticky top-0 z-10 flex w-full items-center justify-betwe=
en px-3 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"flex mi=
n-w-0 grow items-center gap-2"><button><svg xmlns=3D"http://www.w3.org/2000=
/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256=
 256" class=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l=
-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"=
></path></svg></button><div class=3D"[&amp;_svg_path]:fill-current size-4 f=
lex-shrink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width: 20px;"=
><svg viewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1=
.8c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.=
3-3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4=
-.1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .=
3 1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4=
.3.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 =
2.3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2=
-.3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.=
4.4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.=
4-.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-=
.4-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div=
><a href=3D"https://github.com/vllm-project/vllm" target=3D"_blank" rel=3D"=
noreferrer" class=3D"cursor-pointer truncate text-neutral-500 hover:underli=
ne">vllm-project/vllm</a><a href=3D"https://github.com/vllm-project/vllm/bl=
ob/352c0c8a/vllm/v1/worker/tpu_model_runner.py" target=3D"_blank" rel=3D"no=
referrer" class=3D"cursor-pointer truncate text-black dark:text-neutral-300=
 hover:underline">vllm/v1/worker/tpu_model_runner.py</a><button><svg xmlns=
=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"curren=
tColor" viewBox=3D"0 0 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=
=3D"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,=
0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-4=
8H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></svg></button></div></div><div c=
lass=3D"scrollbar-hide grid overflow-auto scroll-smooth"><button class=3D"h=
-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-80=
0 dark:hover:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-=
1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://w=
ww.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" view=
Box=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-1=
1.32,11.32L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-=
11.32l72-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z=
"></path></svg></div></button><div class=3D"relative w-full min-w-max overf=
low-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"col=
or: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&=
quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-al=
ign: left; white-space: pre; word-spacing: normal; word-break: normal; font=
-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px;=
 margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); backgro=
und-color: white; width: 100%;"><code style=3D"white-space: pre; font-size:=
 12px;"><span style=3D"background-color: rgb(248, 248, 248); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1767</span><span>            logger</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
debug</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span=
><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"%s reuses KV cac=
he of %s"</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</=
span><span> layer_name</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">,</span><span> target_layer_name</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1768</span><span>            kv=
_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</sp=
an><span>layer_name</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">]</span><span> </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">=3D</span><span> kv_caches</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">[</span><span>target_layer_name</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1769</span></span></code></pre>=
</div><div class=3D"citation-1-7"><div class=3D"relative w-full min-w-max o=
verflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippe=
t cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consol=
as, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier,=
 monospace; direction: ltr; text-align: left; white-space: pre; word-spacin=
g: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-si=
ze: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1p=
x solid rgb(221, 221, 221); background-color: white; width: 100%;"><code st=
yle=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color:=
 var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;"=
><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"d=
isplay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: ri=
ght; user-select: none; font-size: 11px; font-weight: normal; font-family: =
monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">1=
770</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, =
255);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">initialize_kv_cache</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">(</span><span>self</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">,</span><span> kv_cache_config</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> KVCacheConfig</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>=
 </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </sp=
an><span class=3D"token" style=3D"color: rgb(54, 172, 170);">None</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1771</span><span>        </spa=
n><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 2=
1);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">1772</span>        Initialize KV cache base=
d on `kv_cache_config`.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">1773</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">1774</span>            kv_cache_config: Configurat=
ion for the KV cache, including the KV
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">1775</span>            cache size of each layer
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1776</span><span class=3D"token tripl=
e-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1777</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> </=
span><span class=3D"token builtin">len</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">(</span><span>kv_cache_config</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>kv_cache_groups<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span=
><span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">1<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1778</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">raise</span><s=
pan> NotImplementedError</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1779</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"Hybrid =
models with more than one KV cache type are not supported yet."</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1780</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1781</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1782</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1783</span><span>            k=
v_cache_config</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>kv_cache_groups</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: rgb(54, 17=
2, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><spa=
n>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1784</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">!=3D</span><s=
pan> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</=
span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1785</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1786</span><span>            s=
elf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>input_batch </span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">=3D</span><span> InputBatch</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1787</span><span>             =
   max_num_reqs</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>max_num_reqs</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1788</span><span>             =
   max_model_len</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>max_model_len</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1789</span><span>             =
   max_num_batched_tokens</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">=3D</span><span>self</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>max_num_tokens</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1790</span><span>             =
   device</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
</span><span>self</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">.</span><span>device</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1791</span><span>             =
   pin_memory</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>pin_memory</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1792</span><span>             =
   vocab_size</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span>self</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>model_config</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">.</span><span>get_vocab_size</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1793</span><span>             =
   block_sizes</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span=
><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1794</span><span>             =
       kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>kv_cache_groups</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.<=
/span><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1795</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1796</span><span>             =
   kernel_block_sizes</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">=3D</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
[</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1797</span><span>             =
       kv_cache_config</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>kv_cache_groups</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.<=
/span><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1798</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1799</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1800</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;=
"># Verify dtype compatibility between block_table_cpu and input_batch</spa=
n><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1801</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span=
> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><s=
pan>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1802</span><span>            s=
elf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>block_table_cpu</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">.</span><span>dtype
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1803</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span>=
<span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.=
</span><span>input_batch</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>block_table</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: rgb(=
54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</spa=
n><span>get_cpu_tensor</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">(</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><spa=
n>dtype
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1804</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1805</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1806</span><span>        kv_cache_siz=
es </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span=
><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">{</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">}</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1807</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> k=
v_cache_tensor </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);=
">in</span><span> kv_cache_config</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>kv_cache_tensors</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1808</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><=
span> </span><span class=3D"token builtin">len</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_tensor</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>shared_by<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</sp=
an><span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">=
1</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><sp=
an> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span>=
<span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1809</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"KV cach=
e tensor shared by multiple layers is not supported in TPU."</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1810</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1811</span><span>            k=
v_cache_sizes</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>[</span><span>kv_cache_tensor</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">.</span><span>shared_by</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(54, 172, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]<=
/span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> kv_cache_tensor</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">.</span><span>size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1812</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1813</span><span>        kv_caches</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> =
</span><span class=3D"token builtin">dict</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token builtin">str</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> to=
rch</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>Tensor</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]=
</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">{</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">}</s=
pan><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1814</span><span>        </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> k=
v_cache_group </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> kv_cache_config</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>kv_cache_groups</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1815</span><span>            k=
v_cache_spec </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> kv_cache_group</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">.</span><span>kv_cache_spec
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1816</span><span>            <=
/span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><spa=
n> layer_name </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);"=
>in</span><span> kv_cache_group</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">.</span><span>layer_names</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1817</span><span>             =
   tensor_size </span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">=3D</span><span> kv_cache_sizes</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">[</span><span>layer_name</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1818</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</sp=
an><span> tensor_size </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">%</span><span> kv_cache_spec</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span>page_size_bytes </span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><sp=
an class=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1819</span><span>             =
   num_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span> tensor_size </span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">//</span><span> kv_cache_spec</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">.</span><span>page_size_bytes  </span><=
span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">#=
 noqa</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1820</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><=
span> </span><span class=3D"token builtin">isinstance</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">(</span><span>kv_cache_spec</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> Atte=
ntionSpec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1821</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</sp=
an><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>use_spmd</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1822</span><span>             =
           num_kv_heads </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">=3D</span><span> kv_cache_spec</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">.</span><span>num_kv_heads
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1823</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">as=
sert</span><span> self</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>original_parallel_config </span><span class=3D"toke=
n" style=3D"color: rgb(0, 0, 255);">is</span><span> </span><span class=3D"t=
oken" style=3D"color: rgb(0, 0, 255);">not</span><span> </span><span class=
=3D"token" style=3D"color: rgb(54, 172, 170);">None</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1824</span><span>             =
           tp_size </span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">=3D</span><span> self</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">.</span><span>original_parallel_config</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">.</span><span>tensor_parallel_siz=
e
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1825</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); fon=
t-style: italic;"># TODO: Handle kv cache duplication under SPMD mode.</spa=
n><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1826</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">as=
sert</span><span> num_kv_heads </span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">%</span><span> tp_size </span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">=3D=3D</span><span> </span><span class=3D"tok=
en" style=3D"color: rgb(54, 172, 170);">0</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> </span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1827</span><span>             =
               </span><span class=3D"token string-interpolation" style=3D"c=
olor: rgb(163, 21, 21);">f"num_kv_heads </span><span class=3D"token string-=
interpolation interpolation" style=3D"color: rgb(57, 58, 52);">{</span><spa=
n class=3D"token string-interpolation interpolation">num_kv_heads</span><sp=
an class=3D"token string-interpolation interpolation" style=3D"color: rgb(5=
7, 58, 52);">}</span><span class=3D"token string-interpolation" style=3D"co=
lor: rgb(163, 21, 21);"> must be divisible by "</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1828</span><span>             =
               </span><span class=3D"token string-interpolation" style=3D"c=
olor: rgb(163, 21, 21);">f"tp_size </span><span class=3D"token string-inter=
polation interpolation" style=3D"color: rgb(57, 58, 52);">{</span><span cla=
ss=3D"token string-interpolation interpolation">tp_size</span><span class=
=3D"token string-interpolation interpolation" style=3D"color: rgb(57, 58, 5=
2);">}</span><span class=3D"token string-interpolation" style=3D"color: rgb=
(163, 21, 21);"> under SPMD mode"</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1829</span><span>             =
           </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1830</span><span>             =
       kv_cache_shape </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">=3D</span><span> PallasAttentionBackend</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">.</span><span>get_kv_cache_shape</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1831</span><span>             =
           num_blocks</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1832</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>block_size</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1833</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>num_kv_heads</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1834</span><span>             =
           kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>head_size</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1835</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1836</span><span>             =
       dtype </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> kv_cache_spec</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">.</span><span>dtype
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1837</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1838</span><span>                    =
tpu_kv_cache </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>=3D</span><span> torch</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>zeros</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">(</span><span>kv_cache_shape</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span> dtype</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">=3D</span><span>dtype</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">.</span><span>to</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1839</span><span>             =
           self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">.</span><span>device
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1840</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</sp=
an><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1841</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">1842</span><span>                    =
kv_caches</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</=
span><span>layer_name</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">]</span><span> </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">=3D</span><span> tpu_kv_cache
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1843</span><span>             =
   </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">1844</span><span>             =
       </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">raise<=
/span><span> NotImplementedError</span></span></code></pre></div></div><div=
 class=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hi=
dden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: =
Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Co=
urier, monospace; direction: ltr; text-align: left; white-space: pre; word-=
spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; =
tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; bord=
er: 1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><c=
ode style=3D"white-space: pre; font-size: 12px;"><span style=3D"background-=
color: rgb(248, 248, 248); display: block; white-space: pre; padding: 0px 2=
0px;"><span class=3D"linenumber react-syntax-highlighter-line-number" style=
=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; text-alig=
n: right; user-select: none; font-size: 11px; font-weight: normal; font-fam=
ily: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: itali=
c;">1845</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1846</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"=
># Set up cross-layer KV cache sharing if needed</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">1847</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
maybe_setup_cross_layer_kv_sharing</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">(</span><span>kv_caches</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">,</span><span> kv_cache_config</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></code></=
pre></div><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-=
[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"f=
lex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral=
-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em=
" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=
=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69=
l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8=
,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button></div></div></=
div><div id=3D"file-Repo vllm-project/vllm: vllm/v1/kv_cache_interface.py" =
class=3D"flex flex-col gap-2 scroll-smooth rounded-md" style=3D"content-vis=
ibility: auto;"><div class=3D"scrollbar-hide relative w-full p-0 ring-1 rin=
g-neutral-800 rounded-sm"><div class=3D"bg-secondary dark:bg-surface sticky=
 top-0 z-10 flex w-full items-center justify-between px-3 py-1.5 text-sm te=
xt-neutral-300 rounded-t-sm"><div class=3D"flex min-w-0 grow items-center g=
ap-2"><button><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" heigh=
t=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><=
path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90=
.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg></button><d=
iv class=3D"[&amp;_svg_path]:fill-current size-4 flex-shrink-0" style=3D"fi=
ll: rgb(81, 154, 186); height: 20px; width: 20px;"><svg viewBox=3D"0 0 32 3=
2"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8c0 .2-.1.3-.3.3h-.9c-.9=
 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-3.3.3-.9.9-1.6 1.9-1.8h=
5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.1-.4-.4V9.4c0-.7.3-1.2.=
9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 1.4.6.4.4.7.8.6 1.4v3.6=
c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3.8.8.8.4 0 .8-.4.8-.8s-=
.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.3-2.3v-1.8c0-.2.1-.3.3-=
.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.3 3.3-.3.9-.9 1.6-1.9 1=
.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.4v1.3c0 .7-.3 1.2-.9 1.=
4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-.6-.4-.4-.7-.8-.6-1.4v-=
3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4-.3-.8-.8-.8-.4 0-.8.4-=
.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div><a href=3D"https://githu=
b.com/vllm-project/vllm" target=3D"_blank" rel=3D"noreferrer" class=3D"curs=
or-pointer truncate text-neutral-500 hover:underline">vllm-project/vllm</a>=
<a href=3D"https://github.com/vllm-project/vllm/blob/352c0c8a/vllm/v1/kv_ca=
che_interface.py" target=3D"_blank" rel=3D"noreferrer" class=3D"cursor-poin=
ter truncate text-black dark:text-neutral-300 hover:underline">vllm/v1/kv_c=
ache_interface.py</a><button><svg xmlns=3D"http://www.w3.org/2000/svg" widt=
h=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" clas=
s=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,0,0-8,8V80H40a8,=
8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8=
,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></=
path></svg></button></div></div><div class=3D"scrollbar-hide grid overflow-=
auto scroll-smooth"><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0]=
 hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div =
class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light te=
xt-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" hei=
ght=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"=
><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,1-16=
,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216,32=
H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><div cl=
ass=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidde=
n bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Con=
solas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Couri=
er, monospace; direction: ltr; text-align: left; white-space: pre; word-spa=
cing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab=
-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border:=
 1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><code=
 style=3D"white-space: pre; font-size: 12px;"><span style=3D"background-col=
or: rgb(248, 248, 248); display: block; white-space: pre; padding: 0px 20px=
;"><span class=3D"linenumber react-syntax-highlighter-line-number" style=3D=
"display: inline-block; min-width: 2.25em; padding-right: 1em; text-align: =
right; user-select: none; font-size: 11px; font-weight: normal; font-family=
: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;"=
>365</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">366</span>
</span><span style=3D"background-color: rgb(248, 248, 248); display: block;=
 white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-synt=
ax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25=
em; padding-right: 1em; text-align: right; user-select: none; font-size: 11=
px; font-weight: normal; font-family: monospace; padding-left: 8px; color: =
rgb(0, 128, 0); font-style: italic;">367</span><span></span><span class=3D"=
token decorator annotation" style=3D"color: rgb(57, 58, 52);">@dataclass</s=
pan></span></code></pre></div><div class=3D"citation-1-8"><div class=3D"rel=
ative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-[#609=
6FF]/10 clickable-snippet cursor-pointer"><pre style=3D"color: rgb(57, 58, =
52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Cou=
rier New&quot;, Courier, monospace; direction: ltr; text-align: left; white=
-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; li=
ne-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; ov=
erflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white=
; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span st=
yle=3D"background-color: var(--bg-secondary); display: block; white-space: =
pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter=
-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-ri=
ght: 1em; text-align: right; user-select: none; font-size: 11px; font-weigh=
t: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0)=
; font-style: italic;">368</span><span class=3D"token" style=3D"color: rgb(=
0, 0, 255);">class</span><span> </span><span class=3D"token" style=3D"color=
: rgb(43, 145, 175);">KVCacheGroupSpec</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">369</span><span>    </span><sp=
an class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21);">=
"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">370</span>    Represents a group of model l=
ayers that share the same KV cache block table.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">371</span>    These layers are regarded as one lay=
er in the KV cache manager.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">372</span><span class=3D"token triple=
-quoted-string" style=3D"color: rgb(163, 21, 21);">    """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">373</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">374</span><span>    </span><span clas=
s=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># The name=
s of model layers in this group</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">375</span><span>    layer_name=
s</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><sp=
an> </span><span class=3D"token builtin">list</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token builtin">str<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span=
>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">376</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># T=
he KV cache spec of this manager layer</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">377</span><span>    kv_cache_s=
pec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><=
span> KVCacheSpec
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">378</span></span></code></pre>=
</div></div><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_=
pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52=
); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Couri=
er New&quot;, Courier, monospace; direction: ltr; text-align: left; white-s=
pace: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line=
-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; over=
flow: auto; border: 1px solid rgb(221, 221, 221); background-color: white; =
width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span styl=
e=3D"background-color: rgb(248, 248, 248); display: block; white-space: pre=
; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-li=
ne-number" style=3D"display: inline-block; min-width: 2.25em; padding-right=
: 1em; text-align: right; user-select: none; font-size: 11px; font-weight: =
normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); f=
ont-style: italic;">379</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">380</span><span></span><span cl=
ass=3D"token decorator annotation" style=3D"color: rgb(57, 58, 52);">@datac=
lass</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">381</span><span></span><span cl=
ass=3D"token" style=3D"color: rgb(0, 0, 255);">class</span><span> </span><s=
pan class=3D"token" style=3D"color: rgb(43, 145, 175);">KVCacheConfig</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span></span></c=
ode></pre></div><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hov=
er:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div clas=
s=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-n=
eutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=
=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><p=
ath d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V1=
64.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H4=
0a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button></div></d=
iv></div></div></div></div></div><div class=3D"mb-8 mt-16 h-px w-full bg-ne=
utral-300 dark:bg-neutral-700"></div><div id=3D"3" class=3D"flex flex-col g=
ap-3 pt-6 lg:flex-row" data-query-display=3D"true" data-query-index=3D"2"><=
div class=3D"flex max-h-fit min-w-0 flex-1 flex-shrink-0 flex-col xl:[flex-=
grow:2]"><div><div class=3D"flex flex-col"><a class=3D"flex items-center ga=
p-1 text-base text-neutral-400 transition-colors hover:text-black dark:hove=
r:text-white" href=3D"https://deepwiki.com/vllm-project/vllm"><svg xmlns=3D=
"http://www.w3.org/2000/svg" width=3D"16" height=3D"16" fill=3D"currentColo=
r" viewBox=3D"0 0 256 256"><path d=3D"M224,128a8,8,0,0,1-8,8H59.31l58.35,58=
.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11=
.32L59.31,120H216A8,8,0,0,1,224,128Z"></path></svg>vllm-project/vllm</a><di=
v class=3D"min-w-0 flex-1 pt-1"><div class=3D"flex flex-col items-start gap=
-2 text-white"><span class=3D"text-xl xl:text-2xl w-full [overflow-wrap:bre=
ak-word]">=E5=8A=A8=E6=80=81=E7=A8=80=E7=96=8F=E5=8C=96,=E4=BF=AE=E6=94=B9 =
KVCacheCoordinator =E7=9A=84=E5=9D=97=E5=88=86=E9=85=8D=E9=80=BB=E8=BE=91  =
=E5=85=B7=E4=BD=93=E6=80=8E=E4=B9=88=E6=94=B9=EF=BC=9F<button class=3D"rela=
tive ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-=
opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria=
-label=3D"Copy link to query"><svg xmlns=3D"http://www.w3.org/2000/svg" wid=
th=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" cla=
ss=3D"h-4 w-4"><path d=3D"M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,=
58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.=
64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L4=
6.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.1=
1-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5=
.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A3=
4.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.=
38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.7=
5-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></span></div></di=
v></div><div class=3D"py-2"><div class=3D"text-primary/70 flex flex-col gap=
-2 text-sm"><div class=3D"flex items-center justify-between gap-2"><div cla=
ss=3D"inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium=
 bg-neutral-400/10 text-neutral-500 dark:bg-neutral-600/10 dark:text-neutra=
l-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"12" height=3D"12"=
 fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"mr-1"><path d=3D"M2=
13.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-=
3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z">=
</path></svg>Fast</div></div></div></div><div class=3D"h-fit rounded-lg" st=
yle=3D"scrollbar-width: thin; scrollbar-color: rgb(58, 58, 58) transparent;=
"><div class=3D"dark:[&amp;_pre:has(code)]:bg-shade dark:[&amp;_code[data-l=
ang]]:bg-shade relative flex flex-col gap-1 rounded-md border-[0.5px] borde=
r-[#d0d0d0] bg-[#f8f8f8] p-4 text-white [overflow-wrap:anywhere] dark:borde=
r-[#2F2F2F] dark:bg-[#141414] [&amp;_pre]:my-3"><div class=3D"prose-custom =
prose-custom-md prose-custom-gray !max-w-none text-neutral-300 [overflow-wr=
ap:anywhere]"><p>=E6=82=A8=E6=83=B3=E4=BA=86=E8=A7=A3=E5=A6=82=E4=BD=95=E5=
=9C=A8 vLLM V1 =E4=B8=AD=E4=BF=AE=E6=94=B9 <code class=3D"rounded-sm bg-[#e=
5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:=
hidden after:hidden dark:bg-[#484848]/30">KVCacheCoordinator</code> =E7=9A=
=84=E5=9D=97=E5=88=86=E9=85=8D=E9=80=BB=E8=BE=91=E4=BB=A5=E6=94=AF=E6=8C=81=
=E5=8A=A8=E6=80=81=E7=A8=80=E7=96=8F=E5=8C=96=E3=80=82</p>
<h2 class=3D"group">=E6=A0=B8=E5=BF=83=E4=BF=AE=E6=94=B9=E7=82=B9  </h2>
<p>=E5=8A=A8=E6=80=81=E7=A8=80=E7=96=8F=E5=8C=96=E9=9C=80=E8=A6=81=E5=9C=A8=
=E8=BF=90=E8=A1=8C=E6=97=B6=E6=A0=B9=E6=8D=AE=E6=AF=8F=E4=B8=AA=E8=AF=B7=E6=
=B1=82=E7=9A=84=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F=E5=8A=A8=E6=80=81=E8=B0=
=83=E6=95=B4=E5=9D=97=E5=88=86=E9=85=8D=E6=95=B0=E9=87=8F=E3=80=82=E4=B8=BB=
=E8=A6=81=E9=9C=80=E8=A6=81=E4=BF=AE=E6=94=B9=E4=BB=A5=E4=B8=8B=E4=B8=A4=E4=
=B8=AA=E6=96=B9=E6=B3=95:</p>
<h3 class=3D"group">1. =E4=BF=AE=E6=94=B9 <code class=3D"rounded-sm bg-[#e5=
e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:h=
idden after:hidden dark:bg-[#484848]/30">get_num_blocks_to_allocate()</code=
> - =E8=AE=A1=E7=AE=97=E7=A8=80=E7=96=8F=E5=8C=96=E5=90=8E=E7=9A=84=E5=9D=
=97=E6=95=B0  </h3>
<p><code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs=
 font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30=
">KVCacheCoordinator.get_num_blocks_to_allocate()</code> =E6=96=B9=E6=B3=95=
=E8=B4=9F=E8=B4=A3=E8=AE=A1=E7=AE=97=E9=9C=80=E8=A6=81=E5=88=86=E9=85=8D=E7=
=9A=84=E5=9D=97=E6=95=B0 <span role=3D"link" tabindex=3D"0" class=3D"bg-pac=
ific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointe=
r rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] t=
ransition-colors duration-100 before:hidden after:hidden" style=3D"font-fam=
ily: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-we=
ight: 400; font-style: normal;">kv_cache_coordinator.py:51-85</span> =E3=80=
=82=E8=AF=A5=E6=96=B9=E6=B3=95=E9=81=8D=E5=8E=86=E6=89=80=E6=9C=89 <code cl=
ass=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-norma=
l leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">single_ty=
pe_managers</code> =E5=B9=B6=E7=B4=AF=E5=8A=A0=E6=AF=8F=E4=B8=AA manager =
=E9=9C=80=E8=A6=81=E7=9A=84=E5=9D=97=E6=95=B0 <span role=3D"link" tabindex=
=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pa=
cific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-n=
ormal leading-[15px] transition-colors duration-100 before:hidden after:hid=
den" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono F=
allback&quot;; font-weight: 400; font-style: normal;">kv_cache_coordinator.=
py:73-85</span> =E3=80=82</p>
<p><strong>=E4=BF=AE=E6=94=B9=E7=AD=96=E7=95=A5:</strong></p>
<p>=E6=82=A8=E9=9C=80=E8=A6=81=E5=9C=A8=E8=B0=83=E7=94=A8 <code class=3D"ro=
unded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading=
-[15px] before:hidden after:hidden dark:bg-[#484848]/30">manager.get_num_bl=
ocks_to_allocate()</code> =E4=B9=8B=E5=89=8D,=E6=A0=B9=E6=8D=AE=E8=AF=B7=E6=
=B1=82=E7=9A=84=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F=E8=AE=A1=E7=AE=97=E5=AE=
=9E=E9=99=85=E9=9C=80=E8=A6=81=E7=9A=84 token =E6=95=B0=E9=87=8F:</p>
<pre class=3D"px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] ha=
s-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[c=
ode]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_cod=
e]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><pre style=3D"=
display: block; overflow-x: auto; padding: 6px 8px; color: rgb(51, 51, 51);=
 background: transparent; margin: 0px; width: 100%;"><code style=3D"white-s=
pace: pre; font-size: 12px;"><span class=3D"hljs-function" style=3D"color: =
rgb(51, 51, 51); font-weight: bold;">def</span><span class=3D"hljs-function=
"> </span><span class=3D"hljs-function" style=3D"color: rgb(153, 0, 0); fon=
t-weight: bold;">get_num_blocks_to_allocate</span><span class=3D"hljs-funct=
ion">(</span><span class=3D"hljs-function hljs-params"> =20
</span><span class=3D"hljs-function hljs-params">    self, =20
</span><span class=3D"hljs-function hljs-params">    request_id: </span><sp=
an class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 134, 179);">s=
tr</span><span class=3D"hljs-function hljs-params">, =20
</span><span class=3D"hljs-function hljs-params">    num_tokens: </span><sp=
an class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 134, 179);">i=
nt</span><span class=3D"hljs-function hljs-params">, =20
</span><span class=3D"hljs-function hljs-params">    new_computed_blocks: <=
/span><span class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 134,=
 179);">tuple</span><span class=3D"hljs-function hljs-params">[</span><span=
 class=3D"hljs-function hljs-params" style=3D"color: rgb(68, 85, 136); font=
-weight: bold;">Sequence</span><span class=3D"hljs-function hljs-params">[K=
VCacheBlock], ...], =20
</span><span class=3D"hljs-function hljs-params">    num_encoder_tokens: </=
span><span class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 134, =
179);">int</span><span class=3D"hljs-function hljs-params">, =20
</span><span class=3D"hljs-function hljs-params">    sparsity_pattern: </sp=
an><span class=3D"hljs-function hljs-params" style=3D"color: rgb(68, 85, 13=
6); font-weight: bold;">Optional</span><span class=3D"hljs-function hljs-pa=
rams">[SparsityPattern] =3D </span><span class=3D"hljs-function hljs-params=
" style=3D"color: rgb(0, 128, 128);">None</span><span class=3D"hljs-functio=
n hljs-params">,  </span><span class=3D"hljs-function hljs-params" style=3D=
"color: rgb(153, 153, 136); font-style: italic;"># =E6=96=B0=E5=A2=9E=E5=8F=
=82=E6=95=B0  </span><span class=3D"hljs-function hljs-params">
</span><span class=3D"hljs-function hljs-params"></span><span class=3D"hljs=
-function">) -&gt; </span><span class=3D"hljs-function" style=3D"color: rgb=
(0, 134, 179);">int</span><span class=3D"hljs-function">:</span><span> =20
</span><span>    num_blocks_to_allocate =3D </span><span style=3D"color: rg=
b(0, 128, 128);">0</span><span> =20
</span><span>    </span><span style=3D"color: rgb(51, 51, 51); font-weight:=
 bold;">for</span><span> i, manager </span><span style=3D"color: rgb(51, 51=
, 51); font-weight: bold;">in</span><span> </span><span style=3D"color: rgb=
(0, 134, 179);">enumerate</span><span>(self.single_type_managers): =20
</span><span>        </span><span style=3D"color: rgb(51, 51, 51); font-wei=
ght: bold;">if</span><span> </span><span style=3D"color: rgb(0, 134, 179);"=
>isinstance</span><span>(manager, CrossAttentionManager): =20
</span>            num_blocks_to_allocate +=3D manager.get_num_blocks_to_al=
locate( =20
                request_id, num_encoder_tokens, [] =20
            ) =20
<span>        </span><span style=3D"color: rgb(51, 51, 51); font-weight: bo=
ld;">else</span><span>: =20
</span><span>            </span><span style=3D"color: rgb(153, 153, 136); f=
ont-style: italic;"># =E6=A0=B9=E6=8D=AE=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=
=8F=E8=B0=83=E6=95=B4 num_tokens  </span><span>
</span>            effective_tokens =3D self._apply_sparsity( =20
                num_tokens, sparsity_pattern, layer_group=3Di =20
            ) =20
            num_blocks_to_allocate +=3D manager.get_num_blocks_to_allocate(=
 =20
                request_id, effective_tokens, new_computed_blocks[i] =20
            ) =20
<span>    </span><span style=3D"color: rgb(51, 51, 51); font-weight: bold;"=
>return</span><span> num_blocks_to_allocate</span></code></pre></pre>
<h3 class=3D"group">2. =E4=BF=AE=E6=94=B9 <code class=3D"rounded-sm bg-[#e5=
e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:h=
idden after:hidden dark:bg-[#484848]/30">allocate_new_blocks()</code> - =E5=
=88=86=E9=85=8D=E7=A8=80=E7=96=8F=E5=8C=96=E7=9A=84=E5=9D=97  </h3>
<p><code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs=
 font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30=
">KVCacheCoordinator.allocate_new_blocks()</code> =E6=96=B9=E6=B3=95=E8=B4=
=9F=E8=B4=A3=E5=AE=9E=E9=99=85=E5=88=86=E9=85=8D=E5=9D=97 <span role=3D"lin=
k" tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 =
hover:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] tex=
t-xs font-normal leading-[15px] transition-colors duration-100 before:hidde=
n after:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM =
Plex Mono Fallback&quot;; font-weight: 400; font-style: normal;">kv_cache_c=
oordinator.py:101-126</span> =E3=80=82=E5=AE=83=E4=B8=BA=E6=AF=8F=E4=B8=AA =
manager =E8=B0=83=E7=94=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25r=
em] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hid=
den dark:bg-[#484848]/30">allocate_new_blocks()</code> <span role=3D"link" =
tabindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hov=
er:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-x=
s font-normal leading-[15px] transition-colors duration-100 before:hidden a=
fter:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Ple=
x Mono Fallback&quot;; font-weight: 400; font-style: normal;">kv_cache_coor=
dinator.py:118-126</span> =E3=80=82</p>
<p><strong>=E4=BF=AE=E6=94=B9=E7=AD=96=E7=95=A5:</strong></p>
<p>=E5=90=8C=E6=A0=B7=E9=9C=80=E8=A6=81=E6=A0=B9=E6=8D=AE=E7=A8=80=E7=96=8F=
=E6=A8=A1=E5=BC=8F=E8=B0=83=E6=95=B4=E4=BC=A0=E9=80=92=E7=BB=99=E6=AF=8F=E4=
=B8=AA manager =E7=9A=84 token =E6=95=B0:</p>
<pre class=3D"px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] ha=
s-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[c=
ode]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_cod=
e]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><pre style=3D"=
display: block; overflow-x: auto; padding: 6px 8px; color: rgb(51, 51, 51);=
 background: transparent; margin: 0px; width: 100%;"><code style=3D"white-s=
pace: pre; font-size: 12px;"><span class=3D"hljs-function" style=3D"color: =
rgb(51, 51, 51); font-weight: bold;">def</span><span class=3D"hljs-function=
"> </span><span class=3D"hljs-function" style=3D"color: rgb(153, 0, 0); fon=
t-weight: bold;">allocate_new_blocks</span><span class=3D"hljs-function">(<=
/span><span class=3D"hljs-function hljs-params"> =20
</span><span class=3D"hljs-function hljs-params">    self,  =20
</span><span class=3D"hljs-function hljs-params">    request_id: </span><sp=
an class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 134, 179);">s=
tr</span><span class=3D"hljs-function hljs-params">,  =20
</span><span class=3D"hljs-function hljs-params">    num_tokens: </span><sp=
an class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 134, 179);">i=
nt</span><span class=3D"hljs-function hljs-params">,  =20
</span><span class=3D"hljs-function hljs-params">    num_encoder_tokens: </=
span><span class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 134, =
179);">int</span><span class=3D"hljs-function hljs-params"> =3D </span><spa=
n class=3D"hljs-function hljs-params" style=3D"color: rgb(0, 128, 128);">0<=
/span><span class=3D"hljs-function hljs-params">, =20
</span><span class=3D"hljs-function hljs-params">    sparsity_pattern: </sp=
an><span class=3D"hljs-function hljs-params" style=3D"color: rgb(68, 85, 13=
6); font-weight: bold;">Optional</span><span class=3D"hljs-function hljs-pa=
rams">[SparsityPattern] =3D </span><span class=3D"hljs-function hljs-params=
" style=3D"color: rgb(0, 128, 128);">None</span><span class=3D"hljs-functio=
n hljs-params">,  </span><span class=3D"hljs-function hljs-params" style=3D=
"color: rgb(153, 153, 136); font-style: italic;"># =E6=96=B0=E5=A2=9E=E5=8F=
=82=E6=95=B0  </span><span class=3D"hljs-function hljs-params">
</span><span class=3D"hljs-function hljs-params"></span><span class=3D"hljs=
-function">) -&gt; </span><span class=3D"hljs-function" style=3D"color: rgb=
(0, 134, 179);">tuple</span><span class=3D"hljs-function">[</span><span cla=
ss=3D"hljs-function" style=3D"color: rgb(0, 134, 179);">list</span><span cl=
ass=3D"hljs-function">[KVCacheBlock], ...]:</span><span> =20
</span><span>    </span><span style=3D"color: rgb(51, 51, 51); font-weight:=
 bold;">return</span><span> </span><span style=3D"color: rgb(0, 134, 179);"=
>tuple</span><span>( =20
</span>        manager.allocate_new_blocks( =20
            request_id, =20
            num_encoder_tokens =20
<span>            </span><span style=3D"color: rgb(51, 51, 51); font-weight=
: bold;">if</span><span> </span><span style=3D"color: rgb(0, 134, 179);">is=
instance</span><span>(manager, CrossAttentionManager) =20
</span><span>            </span><span style=3D"color: rgb(51, 51, 51); font=
-weight: bold;">else</span><span> self._apply_sparsity(num_tokens, sparsity=
_pattern, layer_group=3Di), =20
</span>        ) =20
<span>        </span><span style=3D"color: rgb(51, 51, 51); font-weight: bo=
ld;">for</span><span> i, manager </span><span style=3D"color: rgb(51, 51, 5=
1); font-weight: bold;">in</span><span> </span><span style=3D"color: rgb(0,=
 134, 179);">enumerate</span><span>(self.single_type_managers) =20
</span>    )</code></pre></pre>
<h3 class=3D"group">3. =E4=BF=AE=E6=94=B9=E5=BA=95=E5=B1=82 Manager =E7=9A=
=84=E5=9D=97=E8=AE=A1=E7=AE=97=E9=80=BB=E8=BE=91  </h3>
<p><code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs=
 font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30=
">SingleTypeKVCacheManager.get_num_blocks_to_allocate()</code> =E4=BD=BF=E7=
=94=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] tex=
t-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848=
]/30">cdiv(num_tokens, self.block_size)</code> =E8=AE=A1=E7=AE=97=E6=89=80=
=E9=9C=80=E5=9D=97=E6=95=B0 <span role=3D"link" tabindex=3D"0" class=3D"bg-=
pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-poi=
nter rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px=
] transition-colors duration-100 before:hidden after:hidden" style=3D"font-=
family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font=
-weight: 400; font-style: normal;">single_type_kv_cache_manager.py:64-97</s=
pan> =E3=80=82=E5=AF=B9=E4=BA=8E=E7=A8=80=E7=96=8F=E5=8C=96,=E8=BF=99=E4=B8=
=AA=E8=AE=A1=E7=AE=97=E9=9C=80=E8=A6=81=E8=80=83=E8=99=91=E5=AE=9E=E9=99=85=
=E7=9A=84=E7=A8=80=E7=96=8F token =E6=95=B0=E9=87=8F <span role=3D"link" ta=
bindex=3D"0" class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover=
:bg-pacific/20 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs =
font-normal leading-[15px] transition-colors duration-100 before:hidden aft=
er:hidden" style=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex =
Mono Fallback&quot;; font-weight: 400; font-style: normal;">single_type_kv_=
cache_manager.py:84-89</span> =E3=80=82</p>
<p><code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs=
 font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30=
">SingleTypeKVCacheManager.allocate_new_blocks()</code> =E5=90=8C=E6=A0=B7=
=E4=BD=BF=E7=94=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[=
0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark=
:bg-[#484848]/30">cdiv(num_tokens, self.block_size)</code> =E8=AE=A1=E7=AE=
=97=E5=9D=97=E6=95=B0 <span role=3D"link" tabindex=3D"0" class=3D"bg-pacifi=
c/10 text-pacific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer r=
ounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] tran=
sition-colors duration-100 before:hidden after:hidden" style=3D"font-family=
: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weigh=
t: 400; font-style: normal;">single_type_kv_cache_manager.py:120-143</span>=
 =E3=80=82</p>
<p><strong>=E4=BF=AE=E6=94=B9=E7=AD=96=E7=95=A5:</strong></p>
<p>=E5=A6=82=E6=9E=9C=E4=B8=8D=E5=90=8C=E5=B1=82=E6=9C=89=E4=B8=8D=E5=90=8C=
=E7=9A=84=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F,=E6=82=A8=E5=8F=AF=E4=BB=A5=
=E5=88=9B=E5=BB=BA=E8=87=AA=E5=AE=9A=E4=B9=89=E7=9A=84 <code class=3D"round=
ed-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[1=
5px] before:hidden after:hidden dark:bg-[#484848]/30">SingleTypeKVCacheMana=
ger</code> =E5=AD=90=E7=B1=BB,=E9=87=8D=E5=86=99=E8=BF=99=E4=B8=A4=E4=B8=AA=
=E6=96=B9=E6=B3=95=E4=BB=A5=E6=94=AF=E6=8C=81=E7=A8=80=E7=96=8F=E5=8C=96=E8=
=AE=A1=E7=AE=97=E3=80=82</p>
<h2 class=3D"group">=E8=B0=83=E7=94=A8=E9=93=BE=E4=BF=AE=E6=94=B9  </h2>
<p>=E6=82=A8=E8=BF=98=E9=9C=80=E8=A6=81=E4=BF=AE=E6=94=B9=E8=B0=83=E7=94=A8=
 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs f=
ont-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">=
KVCacheCoordinator</code> =E7=9A=84=E4=B8=8A=E5=B1=82=E4=BB=A3=E7=A0=81:</p=
>
<h3 class=3D"group">=E4=BF=AE=E6=94=B9 <code class=3D"rounded-sm bg-[#e5e5e=
5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidd=
en after:hidden dark:bg-[#484848]/30">KVCacheManager.allocate_slots()</code=
>  </h3>
<p><code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs=
 font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30=
">KVCacheManager.allocate_slots()</code> =E8=B0=83=E7=94=A8 <code class=3D"=
rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leadi=
ng-[15px] before:hidden after:hidden dark:bg-[#484848]/30">coordinator.get_=
num_blocks_to_allocate()</code> =E5=92=8C <code class=3D"rounded-sm bg-[#e5=
e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:h=
idden after:hidden dark:bg-[#484848]/30">coordinator.allocate_new_blocks()<=
/code> <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pacif=
ic active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer rounded-md px-[0=
.25rem] py-[0.12rem] text-xs font-normal leading-[15px] transition-colors d=
uration-100 before:hidden after:hidden" style=3D"font-family: &quot;IBM Ple=
x Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: 400; font-st=
yle: normal;">kv_cache_manager.py:295-322</span> =E3=80=82=E6=82=A8=E9=9C=
=80=E8=A6=81:</p>
<ol>
<li>=E5=9C=A8 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20r=
em] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[=
#484848]/30">Request</code> =E5=AF=B9=E8=B1=A1=E4=B8=AD=E6=B7=BB=E5=8A=A0=
=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F=E4=BF=A1=E6=81=AF</li>
<li>=E5=B0=86=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F=E4=BC=A0=E9=80=92=E7=BB=
=99 coordinator =E7=9A=84=E6=96=B9=E6=B3=95=E8=B0=83=E7=94=A8</li>
</ol>
<pre class=3D"px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] ha=
s-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[c=
ode]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_cod=
e]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><pre style=3D"=
display: block; overflow-x: auto; padding: 6px 8px; color: rgb(51, 51, 51);=
 background: transparent; margin: 0px; width: 100%;"><code style=3D"white-s=
pace: pre; font-size: 12px;"><span>num_blocks_to_allocate =3D self.coordina=
tor.get_num_blocks_to_allocate( =20
</span>    request_id=3Drequest.request_id, =20
    num_tokens=3Dnum_tokens_need_slot, =20
    new_computed_blocks=3Dnew_computed_block_list, =20
    num_encoder_tokens=3Dnum_encoder_tokens, =20
<span>    sparsity_pattern=3Drequest.sparsity_pattern,  </span><span style=
=3D"color: rgb(153, 153, 136); font-style: italic;"># =E6=96=B0=E5=A2=9E  <=
/span><span>
</span>) =20
 =20
<span></span><span style=3D"color: rgb(153, 153, 136); font-style: italic;"=
># ...  </span><span>
</span> =20
new_blocks =3D self.coordinator.allocate_new_blocks( =20
    request.request_id,  =20
    num_tokens_need_slot,  =20
    num_encoder_tokens, =20
<span>    sparsity_pattern=3Drequest.sparsity_pattern,  </span><span style=
=3D"color: rgb(153, 153, 136); font-style: italic;"># =E6=96=B0=E5=A2=9E  <=
/span><span>
</span>)</code></pre></pre>
<h2 class=3D"group">=E5=AE=9E=E7=8E=B0=E7=A8=80=E7=96=8F=E6=A8=A1=E5=BC=8F=
=E7=9A=84=E6=95=B0=E6=8D=AE=E7=BB=93=E6=9E=84  </h2>
<p>=E6=82=A8=E9=9C=80=E8=A6=81=E5=AE=9A=E4=B9=89=E4=B8=80=E4=B8=AA <code cl=
ass=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-norma=
l leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">SparsityP=
attern</code> =E7=B1=BB=E6=9D=A5=E6=8F=8F=E8=BF=B0=E7=A8=80=E7=96=8F=E5=8C=
=96=E7=AD=96=E7=95=A5:</p>
<pre class=3D"px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] ha=
s-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[c=
ode]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_cod=
e]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><pre style=3D"=
display: block; overflow-x: auto; padding: 6px 8px; color: rgb(51, 51, 51);=
 background: transparent; margin: 0px; width: 100%;"><code style=3D"white-s=
pace: pre; font-size: 12px;"><span style=3D"color: rgb(153, 153, 153); font=
-weight: bold;">@dataclass  </span><span>
</span><span></span><span class=3D"hljs-class" style=3D"color: rgb(51, 51, =
51); font-weight: bold;">class</span><span class=3D"hljs-class"> </span><sp=
an class=3D"hljs-class" style=3D"color: rgb(153, 0, 0); font-weight: bold;"=
>SparsityPattern</span><span class=3D"hljs-class">:</span><span> =20
</span><span>    </span><span style=3D"color: rgb(153, 153, 136); font-styl=
e: italic;"># =E6=AF=8F=E5=B1=82=E7=9A=84=E7=A8=80=E7=96=8F=E7=8E=87,=E4=BE=
=8B=E5=A6=82 [0.5, 0.7, 0.5] =E8=A1=A8=E7=A4=BA=E7=AC=AC0=E5=B1=82=E4=BF=9D=
=E7=95=9950%,=E7=AC=AC1=E5=B1=82=E4=BF=9D=E7=95=9970%  </span><span>
</span><span>    layer_sparsity_ratios: </span><span style=3D"color: rgb(0,=
 134, 179);">list</span><span>[</span><span style=3D"color: rgb(0, 134, 179=
);">float</span><span>] =20
</span>     =20
<span>    </span><span style=3D"color: rgb(153, 153, 136); font-style: ital=
ic;"># =E6=88=96=E8=80=85=E6=9B=B4=E7=BB=86=E7=B2=92=E5=BA=A6=E7=9A=84=E7=
=A8=80=E7=96=8F=E6=8E=A9=E7=A0=81  </span><span>
</span><span>    sparse_token_indices: </span><span style=3D"color: rgb(68,=
 85, 136); font-weight: bold;">Optional</span><span>[</span><span style=3D"=
color: rgb(0, 134, 179);">list</span><span>[</span><span style=3D"color: rg=
b(0, 134, 179);">list</span><span>[</span><span style=3D"color: rgb(0, 134,=
 179);">int</span><span>]]] =3D </span><span style=3D"color: rgb(0, 128, 12=
8);">None</span></code></pre></pre>
<h2 class=3D"group">Notes  </h2>
<p>=E5=8A=A8=E6=80=81=E7=A8=80=E7=96=8F=E5=8C=96=E7=9A=84=E5=85=B3=E9=94=AE=
=E6=98=AF=E5=9C=A8=E5=9D=97=E5=88=86=E9=85=8D=E6=97=B6=E6=A0=B9=E6=8D=AE=E5=
=AE=9E=E9=99=85=E7=9A=84=E7=A8=80=E7=96=8F token =E6=95=B0=E9=87=8F=E8=AE=
=A1=E7=AE=97=E6=89=80=E9=9C=80=E5=9D=97=E6=95=B0,=E8=80=8C=E4=B8=8D=E6=98=
=AF=E4=BD=BF=E7=94=A8=E5=8E=9F=E5=A7=8B=E7=9A=84 <code class=3D"rounded-sm =
bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] b=
efore:hidden after:hidden dark:bg-[#484848]/30">num_tokens</code>=E3=80=82<=
/p>
<p>=E9=9C=80=E8=A6=81=E6=B3=A8=E6=84=8F=E7=9A=84=E6=98=AF,V1 =E7=9A=84 pref=
ix caching =E6=9C=BA=E5=88=B6=E4=BE=9D=E8=B5=96=E4=BA=8E=E5=9D=97=E5=93=88=
=E5=B8=8C <span role=3D"link" tabindex=3D"0" class=3D"bg-pacific/10 text-pa=
cific active:bg-pacific/20 hover:bg-pacific/20 cursor-pointer rounded-md px=
-[0.25rem] py-[0.12rem] text-xs font-normal leading-[15px] transition-color=
s duration-100 before:hidden after:hidden" style=3D"font-family: &quot;IBM =
Plex Mono&quot;, &quot;IBM Plex Mono Fallback&quot;; font-weight: 400; font=
-style: normal;">prefix_caching.md:100-134</span> =E3=80=82=E5=A6=82=E6=9E=
=9C=E7=A8=80=E7=96=8F=E5=8C=96=E6=94=B9=E5=8F=98=E4=BA=86=E5=9D=97=E7=9A=84=
=E5=86=85=E5=AE=B9,=E6=82=A8=E9=9C=80=E8=A6=81=E7=A1=AE=E4=BF=9D=E5=93=88=
=E5=B8=8C=E8=AE=A1=E7=AE=97=E8=83=BD=E6=AD=A3=E7=A1=AE=E5=8F=8D=E6=98=A0=E7=
=A8=80=E7=96=8F=E5=8C=96=E5=90=8E=E7=9A=84=E5=86=85=E5=AE=B9,=E4=BB=A5=E9=
=81=BF=E5=85=8D=E7=BC=93=E5=AD=98=E5=91=BD=E4=B8=AD=E9=94=99=E8=AF=AF=E3=80=
=82</p>
<p>=E5=8F=A6=E5=A4=96,=E4=B8=8D=E5=90=8C=E7=9A=84 attention =E7=B1=BB=E5=9E=
=8B(=E5=A6=82 <code class=3D"rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20r=
em] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[=
#484848]/30">MambaManager</code>)=E6=9C=89=E7=89=B9=E6=AE=8A=E7=9A=84=E5=9D=
=97=E5=88=86=E9=85=8D=E9=80=BB=E8=BE=91 <span role=3D"link" tabindex=3D"0" =
class=3D"bg-pacific/10 text-pacific active:bg-pacific/20 hover:bg-pacific/2=
0 cursor-pointer rounded-md px-[0.25rem] py-[0.12rem] text-xs font-normal l=
eading-[15px] transition-colors duration-100 before:hidden after:hidden" st=
yle=3D"font-family: &quot;IBM Plex Mono&quot;, &quot;IBM Plex Mono Fallback=
&quot;; font-weight: 400; font-style: normal;">single_type_kv_cache_manager=
.py:599-628</span> ,=E6=82=A8=E7=9A=84=E7=A8=80=E7=96=8F=E5=8C=96=E9=80=BB=
=E8=BE=91=E9=9C=80=E8=A6=81=E4=B8=8E=E8=BF=99=E4=BA=9B=E7=89=B9=E6=AE=8A=E6=
=83=85=E5=86=B5=E5=85=BC=E5=AE=B9=E3=80=82</p></div><div class=3D"mt-4 flex=
 justify-end gap-2"><button data-state=3D"closed" data-slot=3D"tooltip-trig=
ger"><button class=3D"border-border bg-surface hover:border-border-hover ho=
ver:bg-component flex cursor-pointer items-center gap-1.5 rounded-md border=
 px-3 py-2 text-sm transition-colors" aria-label=3D"Copy" type=3D"button" i=
d=3D"radix-=C2=ABr8=C2=BB" aria-haspopup=3D"menu" aria-expanded=3D"false" d=
ata-state=3D"closed"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"24"=
 height=3D"24" viewBox=3D"0 0 24 24" fill=3D"none" stroke=3D"currentColor" =
stroke-width=3D"2" stroke-linecap=3D"round" stroke-linejoin=3D"round" class=
=3D"lucide lucide-copy h-4 w-4" aria-hidden=3D"true"><rect width=3D"14" hei=
ght=3D"14" x=3D"8" y=3D"8" rx=3D"2" ry=3D"2"></rect><path d=3D"M4 16c-1.1 0=
-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></button=
><button class=3D"flex items-center rounded-md cursor-pointer transition-al=
l border border-border bg-surface hover:border-border-hover hover:bg-compon=
ent disabled:cursor-default disabled:opacity-50 disabled:hover:border-borde=
r disabled:hover:bg-surface gap-1.5 px-3 py-1.5 text-sm" aria-label=3D"Shar=
e" data-state=3D"closed" data-slot=3D"tooltip-trigger"><svg xmlns=3D"http:/=
/www.w3.org/2000/svg" width=3D"24" height=3D"24" viewBox=3D"0 0 24 24" fill=
=3D"none" stroke=3D"currentColor" stroke-width=3D"2" stroke-linecap=3D"roun=
d" stroke-linejoin=3D"round" class=3D"h-4 w-4"><circle cx=3D"18" cy=3D"5" r=
=3D"3"></circle><circle cx=3D"6" cy=3D"12" r=3D"3"></circle><circle cx=3D"1=
8" cy=3D"19" r=3D"3"></circle><line x1=3D"8.59" y1=3D"13.51" x2=3D"15.42" y=
2=3D"17.49"></line><line x1=3D"15.41" y1=3D"6.51" x2=3D"8.59" y2=3D"10.49">=
</line></svg></button></div></div></div></div></div><div class=3D"min-w-0 f=
lex-1 scroll-smooth xl:[flex-grow:3]" style=3D"scrollbar-width: thin; scrol=
lbar-color: rgb(90, 90, 90) transparent; min-height: calc(-205px + 100vh);"=
><div class=3D"sticky left-0 top-20 overflow-y-auto rounded-md" style=3D"ma=
x-height: calc(-225px + 100vh);"><div class=3D"flex flex-col gap-3 p-0"><di=
v id=3D"file-Repo vllm-project/vllm: vllm/v1/core/kv_cache_coordinator.py" =
class=3D"flex flex-col gap-2 scroll-smooth rounded-md" style=3D"content-vis=
ibility: auto;"><div class=3D"scrollbar-hide relative w-full p-0 ring-1 rin=
g-neutral-800 rounded-sm"><div class=3D"bg-secondary dark:bg-surface sticky=
 top-0 z-10 flex w-full items-center justify-between px-3 py-1.5 text-sm te=
xt-neutral-300 rounded-t-sm"><div class=3D"flex min-w-0 grow items-center g=
ap-2"><button><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" heigh=
t=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><=
path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90=
.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg></button><d=
iv class=3D"[&amp;_svg_path]:fill-current size-4 flex-shrink-0" style=3D"fi=
ll: rgb(81, 154, 186); height: 20px; width: 20px;"><svg viewBox=3D"0 0 32 3=
2"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8c0 .2-.1.3-.3.3h-.9c-.9=
 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-3.3.3-.9.9-1.6 1.9-1.8h=
5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.1-.4-.4V9.4c0-.7.3-1.2.=
9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 1.4.6.4.4.7.8.6 1.4v3.6=
c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3.8.8.8.4 0 .8-.4.8-.8s-=
.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.3-2.3v-1.8c0-.2.1-.3.3-=
.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.3 3.3-.3.9-.9 1.6-1.9 1=
.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.4v1.3c0 .7-.3 1.2-.9 1.=
4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-.6-.4-.4-.7-.8-.6-1.4v-=
3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4-.3-.8-.8-.8-.4 0-.8.4-=
.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div><a href=3D"https://githu=
b.com/vllm-project/vllm" target=3D"_blank" rel=3D"noreferrer" class=3D"curs=
or-pointer truncate text-neutral-500 hover:underline">vllm-project/vllm</a>=
<a href=3D"https://github.com/vllm-project/vllm/blob/352c0c8a/vllm/v1/core/=
kv_cache_coordinator.py" target=3D"_blank" rel=3D"noreferrer" class=3D"curs=
or-pointer truncate text-black dark:text-neutral-300 hover:underline">vllm/=
v1/core/kv_cache_coordinator.py</a><button><svg xmlns=3D"http://www.w3.org/=
2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0=
 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,0,=
0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,=
0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H=
96V48H208Z"></path></svg></button></div></div><div class=3D"scrollbar-hide =
grid overflow-auto scroll-smooth"><button class=3D"h-5 w-full cursor-pointe=
r bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral=
-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs=
 font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" wid=
th=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" cla=
ss=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V22=
4a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,1=
1.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></=
button><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:=
overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); fo=
nt-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier Ne=
w&quot;, Courier, monospace; direction: ltr; text-align: left; white-space:=
 pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-heig=
ht: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow:=
 auto; border: 1px solid rgb(221, 221, 221); background-color: white; width=
: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D"=
background-color: rgb(248, 248, 248); display: block; white-space: pre; pad=
ding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-nu=
mber" style=3D"display: inline-block; min-width: 2.25em; padding-right: 1em=
; text-align: right; user-select: none; font-size: 11px; font-weight: norma=
l; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-s=
tyle: italic;">48</span><span>            </span><span class=3D"token" styl=
e=3D"color: rgb(0, 0, 255);">for</span><span> i</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">,</span><span> kv_cache_group </span><sp=
an class=3D"token" style=3D"color: rgb(0, 0, 255);">in</span><span> </span>=
<span class=3D"token builtin">enumerate</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>self</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">.</span><span>kv_cache_config</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>kv_cache_=
groups</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">49</span><span>        </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">50</span></span></code></pre></=
div><div class=3D"citation-2-0 citation-2-1"><div class=3D"relative w-full =
min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 click=
able-snippet cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-fam=
ily: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot=
;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; =
word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.=
2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto;=
 border: 1px solid rgb(221, 221, 221); background-color: white; width: 100%=
;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D"backgr=
ound-color: var(--bg-secondary); display: block; white-space: pre; padding:=
 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-number"=
 style=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; tex=
t-align: right; user-select: none; font-size: 11px; font-weight: normal; fo=
nt-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style:=
 italic;">51</span><span>    </span><span class=3D"token" style=3D"color: r=
gb(0, 0, 255);">def</span><span> </span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">get_num_blocks_to_allocate</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">52</span><span>        self</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">53</span><span>        request=
_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><=
span> </span><span class=3D"token builtin">str</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">54</span><span>        num_tok=
ens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><=
span> </span><span class=3D"token builtin">int</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">55</span><span>        new_com=
puted_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
:</span><span> </span><span class=3D"token builtin">tuple</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>Sequence</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>KVCach=
eBlock</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"to=
ken" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">56</span><span>        num_enc=
oder_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:=
</span><span> </span><span class=3D"token builtin">int</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">57</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">int</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">58</span><span>        </span>=
<span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21)=
;">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">59</span>        Get the number of blocks n=
eeded to be allocated for the request.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">60</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">61</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">62</span>            request_id: The request ID.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">63</span>            num_tokens: The total number =
of tokens that need a slot (including
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">64</span>                tokens that are already a=
llocated).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">65</span>            new_computed_blocks: The new =
computed blocks just hitting the
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">66</span>                prefix caching.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">67</span>            num_encoder_tokens: The numbe=
r of encoder tokens for allocating
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">68</span>                blocks for cross-attentio=
n.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">69</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">70</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">71</span>            The number of blocks.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">72</span><span class=3D"token triple-=
quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">73</span><span>        num_blo=
cks_to_allocate </span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 1=
72, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">74</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> i</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 manager </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</=
span><span> </span><span class=3D"token builtin">enumerate</span><span clas=
s=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>self</span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>single_ty=
pe_managers</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><spa=
n>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">75</span><span>            </s=
pan><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> =
</span><span class=3D"token builtin">isinstance</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">(</span><span>manager</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> CrossAttentionM=
anager</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">76</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: i=
talic;"># For cross-attention, we issue a single static allocation</span><s=
pan>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">77</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: i=
talic;"># of blocks based on the number of encoder input tokens.</span><spa=
n>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">78</span><span>               =
 num_blocks_to_allocate </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">+=3D</span><span> manager</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">.</span><span>get_num_blocks_to_allocate</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">79</span><span>               =
     request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">,</span><span> num_encoder_tokens</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">,</span><span> </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">[</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">80</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><sp=
an>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">81</span><span>            </s=
pan><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">82</span><span>               =
 num_blocks_to_allocate </span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">+=3D</span><span> manager</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">.</span><span>get_num_blocks_to_allocate</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">83</span><span>               =
     request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">,</span><span> num_tokens</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">,</span><span> new_computed_blocks</span><span class=3D"tok=
en" style=3D"color: rgb(57, 58, 52);">[</span><span>i</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">84</span><span>               =
 </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><sp=
an>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">85</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span> =
num_blocks_to_allocate</span></span></code></pre></div></div><div class=3D"=
relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-ne=
utral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, =
&quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, mon=
ospace; direction: ltr; text-align: left; white-space: pre; word-spacing: n=
ormal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: =
4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px so=
lid rgb(221, 221, 221); background-color: white; width: 100%;"><code style=
=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: rg=
b(248, 248, 248); display: block; white-space: pre; padding: 0px 20px;"><sp=
an class=3D"linenumber react-syntax-highlighter-line-number" style=3D"displ=
ay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: right;=
 user-select: none; font-size: 11px; font-weight: normal; font-family: mono=
space; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">86</s=
pan><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">87</span><span>    </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">save_new_computed_bl=
ocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span>=
<span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">88</span><span>        self</sp=
an><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> r=
equest_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</=
span><span> </span><span class=3D"token builtin">str</span><span class=3D"t=
oken" style=3D"color: rgb(57, 58, 52);">,</span><span> new_computed_blocks<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span=
> </span><span class=3D"token builtin">tuple</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">[</span><span>Sequence</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">[</span><span>KVCacheBlock</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">]</span></span></code></pre></div><button class=3D"h-5 w-ful=
l cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:h=
over:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[=
1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.or=
g/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0=
 0 256 256" class=3D"h-3 w-3"><path d=3D"M224,128a8,8,0,0,1-8,8H40a8,8,0,0,=
1,0-16H216A8,8,0,0,1,224,128ZM101.66,53.66,120,35.31V96a8,8,0,0,0,16,0V35.3=
1l18.34,18.35a8,8,0,0,0,11.32-11.32l-32-32a8,8,0,0,0-11.32,0l-32,32a8,8,0,0=
,0,11.32,11.32Zm52.68,148.68L136,220.69V160a8,8,0,0,0-16,0v60.69l-18.34-18.=
35a8,8,0,0,0-11.32,11.32l32,32a8,8,0,0,0,11.32,0l32-32a8,8,0,0,0-11.32-11.3=
2Z"></path></svg></div></button><div class=3D"relative w-full min-w-max ove=
rflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"c=
olor: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mon=
o&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-=
align: left; white-space: pre; word-spacing: normal; word-break: normal; fo=
nt-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0p=
x; margin: 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); backg=
round-color: white; width: 100%;"><code style=3D"white-space: pre; font-siz=
e: 12px;"><span style=3D"background-color: rgb(248, 248, 248); display: blo=
ck; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-s=
yntax-highlighter-line-number" style=3D"display: inline-block; min-width: 2=
.25em; padding-right: 1em; text-align: right; user-select: none; font-size:=
 11px; font-weight: normal; font-family: monospace; padding-left: 8px; colo=
r: rgb(0, 128, 0); font-style: italic;">98</span><span>        </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span> i</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> mana=
ger </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in</span>=
<span> </span><span class=3D"token builtin">enumerate</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">(</span><span>self</span><span cla=
ss=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>single_type_ma=
nagers</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">99</span><span>            mana=
ger</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><=
span>save_new_computed_blocks</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">(</span><span>request_id</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> new_computed_blocks</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>i</span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">100</span></span></code></pre><=
/div><div class=3D"citation-2-2 citation-2-3"><div class=3D"relative w-full=
 min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clic=
kable-snippet cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-fa=
mily: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quo=
t;, Courier, monospace; direction: ltr; text-align: left; white-space: pre;=
 word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1=
.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto=
; border: 1px solid rgb(221, 221, 221); background-color: white; width: 100=
%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D"backg=
round-color: var(--bg-secondary); display: block; white-space: pre; padding=
: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-number=
" style=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; te=
xt-align: right; user-select: none; font-size: 11px; font-weight: normal; f=
ont-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style=
: italic;">101</span><span>    </span><span class=3D"token" style=3D"color:=
 rgb(0, 0, 255);">def</span><span> </span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">allocate_new_blocks</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">102</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:=
</span><span> </span><span class=3D"token builtin">str</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> num_tokens</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </spa=
n><span class=3D"token builtin">int</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span> num_encoder_tokens</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </span><span cl=
ass=3D"token builtin">int</span><span> </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">=3D</span><span> </span><span class=3D"token" =
style=3D"color: rgb(54, 172, 170);">0</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">103</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">tuple</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">[</span><span class=3D"token builtin">list</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>KVCacheBlock<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">.</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">104</span><span>        </span=
><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21=
);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">105</span>        Allocate new blocks for t=
he request to give it at least `num_tokens`
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">106</span>        token slots.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">107</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">108</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">109</span>            request_id: The request ID.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">110</span>            num_tokens: The total number=
 of tokens that need a slot (including
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">111</span>                tokens that are already =
allocated).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">112</span>            num_encoder_tokens: The numb=
er of encoder tokens for allocating
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">113</span>                blocks for cross-attenti=
on.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">114</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">115</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">116</span>            The new allocated blocks.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">117</span><span class=3D"token triple=
-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">118</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 </span><span class=3D"token builtin">tuple</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">119</span><span>            ma=
nager</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>allocate_new_blocks</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">120</span><span>              =
  request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">121</span>                num_=
encoder_tokens
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">122</span><span>                </spa=
n><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> </=
span><span class=3D"token builtin">isinstance</span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">(</span><span>manager</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> CrossAttentionMana=
ger</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><=
span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">123</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span>=
<span> num_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">124</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">125</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">for</span><span=
> manager </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">in<=
/span><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">.</span><span>single_type_managers
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">126</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></c=
ode></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">127</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">128</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">cache_blocks</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>self<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span=
> request</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</=
span><span> Request</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">,</span><span> num_computed_tokens</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">:</span><span> </span><span class=3D"token bui=
ltin">int</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</=
span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
-</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span>=
<span> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">Non=
e</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><sp=
an>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">129</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(163, 21, 21);">""</span><span>"</=
span></span></code></pre></div><button class=3D"h-5 w-full cursor-pointer b=
g-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-70=
0/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs fo=
nt-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=
=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=
=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8=
,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.=
32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></b=
utton></div></div></div><div id=3D"file-Repo vllm-project/vllm: vllm/v1/cor=
e/single_type_kv_cache_manager.py" class=3D"flex flex-col gap-2 scroll-smoo=
th rounded-md" style=3D"content-visibility: auto;"><div class=3D"scrollbar-=
hide relative w-full p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"=
bg-secondary dark:bg-surface sticky top-0 z-10 flex w-full items-center jus=
tify-between px-3 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=
=3D"flex min-w-0 grow items-center gap-2"><button><svg xmlns=3D"http://www.=
w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=
=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0=
,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11=
.32,11.32Z"></path></svg></button><div class=3D"[&amp;_svg_path]:fill-curre=
nt size-4 flex-shrink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; wi=
dth: 20px;"><svg viewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.=
9-2.3 2.3v1.8c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-=
1.1-.1-2.2.3-3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3=
.4c-.3 0-.4-.1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.=
6.1.5.1 1 .3 1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm=
-2.8-6c0 .4.3.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.=
4 0 2.3-.9 2.3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.=
1 1.1.1 2.2-.3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4=
c.3 0 .4.1.4.4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5=
-.1-1-.3-1.4-.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.=
1zm2.8 6c0-.4-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path>=
</svg></div><a href=3D"https://github.com/vllm-project/vllm" target=3D"_bla=
nk" rel=3D"noreferrer" class=3D"cursor-pointer truncate text-neutral-500 ho=
ver:underline">vllm-project/vllm</a><a href=3D"https://github.com/vllm-proj=
ect/vllm/blob/352c0c8a/vllm/v1/core/single_type_kv_cache_manager.py" target=
=3D"_blank" rel=3D"noreferrer" class=3D"cursor-pointer truncate text-black =
dark:text-neutral-300 hover:underline">vllm/v1/core/single_type_kv_cache_ma=
nager.py</a><button><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em"=
 height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-4 =
w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8=
,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,21=
6,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path></sv=
g></button></div></div><div class=3D"scrollbar-hide grid overflow-auto scro=
ll-smooth"><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg=
-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"=
flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutra=
l-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1e=
m" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=
=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,1-16,0V91.31=
L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,=
0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><div class=3D"r=
elative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-neu=
tral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, &=
quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, mono=
space; direction: ltr; text-align: left; white-space: pre; word-spacing: no=
rmal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4=
; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px sol=
id rgb(221, 221, 221); background-color: white; width: 100%;"><code style=
=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: rg=
b(248, 248, 248); display: block; white-space: pre; padding: 0px 20px;"><sp=
an class=3D"linenumber react-syntax-highlighter-line-number" style=3D"displ=
ay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: right;=
 user-select: none; font-size: 11px; font-weight: normal; font-family: mono=
space; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">61</s=
pan><span>        self</span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">.</span><span>kv_cache_group_id </span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">=3D</span><span> kv_cache_group_id
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">62</span><span>        self</sp=
an><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>_n=
ull_block </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
=3D</span><span> block_pool</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">.</span><span>null_block
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">63</span></span></code></pre></=
div><div class=3D"citation-2-4 citation-2-5"><div class=3D"relative w-full =
min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 click=
able-snippet cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-fam=
ily: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot=
;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; =
word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.=
2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto;=
 border: 1px solid rgb(221, 221, 221); background-color: white; width: 100%=
;"><code style=3D"white-space: pre; font-size: 12px;"><span style=3D"backgr=
ound-color: var(--bg-secondary); display: block; white-space: pre; padding:=
 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-line-number"=
 style=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; tex=
t-align: right; user-select: none; font-size: 11px; font-weight: normal; fo=
nt-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style:=
 italic;">64</span><span>    </span><span class=3D"token" style=3D"color: r=
gb(0, 0, 255);">def</span><span> </span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">get_num_blocks_to_allocate</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">65</span><span>        self</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">66</span><span>        request=
_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><=
span> </span><span class=3D"token builtin">str</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">67</span><span>        num_tok=
ens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><=
span> </span><span class=3D"token builtin">int</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">68</span><span>        new_com=
puted_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
:</span><span> Sequence</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">[</span><span>KVCacheBlock</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb(=
57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">69</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">int</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">70</span><span>        </span>=
<span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21)=
;">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">71</span>        Get the number of blocks n=
eeded to be allocated for the request.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">72</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">73</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">74</span>            request_id: The request ID.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">75</span>            num_tokens: The total number =
of tokens that need a slot (including
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">76</span>                tokens that are already a=
llocated).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">77</span>            new_computed_blocks: The new =
computed blocks just hitting the
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">78</span>                prefix caching.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">79</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">80</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">81</span>            The number of blocks.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">82</span><span class=3D"token triple-=
quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">83</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">84</span><span>        num_required_b=
locks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</s=
pan><span> cdiv</span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">(</span><span>num_tokens</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">,</span><span> self</span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">.</span><span>block_size</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">85</span><span>        num_new=
_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D<=
/span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">86</span>            num_requi=
red_blocks
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">87</span><span>            </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span> </span>=
<span class=3D"token builtin">len</span><span class=3D"token" style=3D"colo=
r: rgb(57, 58, 52);">(</span><span>new_computed_blocks</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">88</span><span>            </s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span> =
</span><span class=3D"token builtin">len</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>self</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">.</span><span>req_to_blocks</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span><span>request_id<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">89</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">90</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# If a computed block of a request is an eviction candidate (in the</span><=
span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">91</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# free queue and ref_cnt =3D=3D 0), it will be changed from a free block</s=
pan><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">92</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# to a computed block when the request is allocated, so we also count</span=
><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">93</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# it as needed to be allocated.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">94</span><span>        num_evi=
ctable_computed_blocks </span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">=3D</span><span> </span><span class=3D"token builtin">sum</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">95</span><span>            blk=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><spa=
n>ref_cnt </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
=3D=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 17=
2, 170);">0</span><span> </span><span class=3D"token" style=3D"color: rgb(0=
, 0, 255);">and</span><span> </span><span class=3D"token" style=3D"color: r=
gb(0, 0, 255);">not</span><span> blk</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">.</span><span>is_null </span><span class=3D"token" =
style=3D"color: rgb(0, 0, 255);">for</span><span> blk </span><span class=3D=
"token" style=3D"color: rgb(0, 0, 255);">in</span><span> new_computed_block=
s
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">96</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">97</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span> =
num_new_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52)=
;">+</span><span> num_evictable_computed_blocks</span></span></code></pre><=
/div></div><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_p=
re]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52)=
; font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courie=
r New&quot;, Courier, monospace; direction: ltr; text-align: left; white-sp=
ace: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-=
height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overf=
low: auto; border: 1px solid rgb(221, 221, 221); background-color: white; w=
idth: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=
=3D"background-color: rgb(248, 248, 248); display: block; white-space: pre;=
 padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-lin=
e-number" style=3D"display: inline-block; min-width: 2.25em; padding-right:=
 1em; text-align: right; user-select: none; font-size: 11px; font-weight: n=
ormal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); fo=
nt-style: italic;">98</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">99</span><span>    </span><span=
 class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">save_new_computed_bl=
ocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span>=
<span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">100</span><span>        self</s=
pan><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> =
request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:<=
/span><span> </span><span class=3D"token builtin">str</span><span class=3D"=
token" style=3D"color: rgb(57, 58, 52);">,</span><span> new_computed_blocks=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><spa=
n> Sequence</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[=
</span><span>KVCacheBlock</span><span class=3D"token" style=3D"color: rgb(5=
7, 58, 52);">]</span></span></code></pre></div><button class=3D"h-5 w-full =
cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hov=
er:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.=
3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/=
2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0=
 256 256" class=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L=
120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,7=
2a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path>=
</svg></div></button><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0=
] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div=
 class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light t=
ext-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" he=
ight=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3=
"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,1-1=
6,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216,3=
2H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><div c=
lass=3D"relative w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidd=
en bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Co=
nsolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Cour=
ier, monospace; direction: ltr; text-align: left; white-space: pre; word-sp=
acing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; ta=
b-size: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border=
: 1px solid rgb(221, 221, 221); background-color: white; width: 100%;"><cod=
e style=3D"white-space: pre; font-size: 12px;"><span style=3D"background-co=
lor: rgb(248, 248, 248); display: block; white-space: pre; padding: 0px 20p=
x;"><span class=3D"linenumber react-syntax-highlighter-line-number" style=
=3D"display: inline-block; min-width: 2.25em; padding-right: 1em; text-alig=
n: right; user-select: none; font-size: 11px; font-weight: normal; font-fam=
ily: monospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: itali=
c;">117</span><span>            </span><span class=3D"token" style=3D"color=
: rgb(0, 128, 0); font-style: italic;"># A running request. Should not have=
 new computed blocks.</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">118</span><span>            </s=
pan><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><sp=
an> </span><span class=3D"token builtin">len</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">(</span><span>new_computed_blocks</span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=3D</span><span>=
 </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><=
span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">119</span></span></code></pre><=
/div><div class=3D"citation-2-6"><div class=3D"relative w-full min-w-max ov=
erflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet=
 cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consola=
s, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, =
monospace; direction: ltr; text-align: left; white-space: pre; word-spacing=
: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-siz=
e: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px=
 solid rgb(221, 221, 221); background-color: white; width: 100%;"><code sty=
le=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: =
var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;">=
<span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"di=
splay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: rig=
ht; user-select: none; font-size: 11px; font-weight: normal; font-family: m=
onospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">12=
0</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, 25=
5);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">allocate_new_blocks</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">121</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:=
</span><span> </span><span class=3D"token builtin">str</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> num_tokens</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </spa=
n><span class=3D"token builtin">int</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">122</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">list</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">[</span><span>KVCacheBlock</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">123</span><span>        </span=
><span class=3D"token triple-quoted-string" style=3D"color: rgb(163, 21, 21=
);">"""
</span></span><span class=3D"token triple-quoted-string" style=3D"backgroun=
d-color: var(--bg-secondary); display: block; white-space: pre; padding: 0p=
x 20px; color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-hi=
ghlighter-line-number" style=3D"display: inline-block; min-width: 2.25em; p=
adding-right: 1em; text-align: right; user-select: none; font-size: 11px; f=
ont-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0=
, 128, 0); font-style: italic;">124</span>        Allocate new blocks for t=
he request to give it at least `num_tokens`
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">125</span>        token slots.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">126</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">127</span>        Args:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">128</span>            request_id: The request ID.
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">129</span>            num_tokens: The total number=
 of tokens that need a slot (including
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">130</span>                tokens that are already =
allocated).
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">131</span>
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">132</span>        Returns:
</span><span class=3D"token triple-quoted-string" style=3D"background-color=
: var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;=
 color: rgb(163, 21, 21);"><span class=3D"linenumber react-syntax-highlight=
er-line-number" style=3D"display: inline-block; min-width: 2.25em; padding-=
right: 1em; text-align: right; user-select: none; font-size: 11px; font-wei=
ght: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, =
0); font-style: italic;">133</span>            The new allocated blocks.
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">134</span><span class=3D"token triple=
-quoted-string" style=3D"color: rgb(163, 21, 21);">        """</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">135</span><span>        req_bl=
ocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</sp=
an><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>req_to_blocks</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">[</span><span>request_id</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">136</span><span>        num_re=
quired_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">=3D</span><span> cdiv</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">(</span><span>num_tokens</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">,</span><span> self</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">.</span><span>block_size</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">137</span><span>        num_ne=
w_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
</span><span> num_required_blocks </span><span class=3D"token" style=3D"col=
or: rgb(57, 58, 52);">-</span><span> </span><span class=3D"token builtin">l=
en</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><s=
pan>req_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">138</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> num=
_new_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
&lt;=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(54, 1=
72, 170);">0</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=
:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">139</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><s=
pan> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">[</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">]</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">140</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">141</span><span>            ne=
w_blocks </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D=
</span><span> self</span><span class=3D"token" style=3D"color: rgb(57, 58, =
52);">.</span><span>block_pool</span><span class=3D"token" style=3D"color: =
rgb(57, 58, 52);">.</span><span>get_new_blocks</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">(</span><span>num_new_blocks</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">142</span><span>            re=
q_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</s=
pan><span>extend</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">(</span><span>new_blocks</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">143</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><s=
pan> new_blocks</span></span></code></pre></div></div><div class=3D"relativ=
e w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-8=
00/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot;B=
itstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;=
 direction: ltr; text-align: left; white-space: pre; word-spacing: normal; =
word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyph=
ens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px solid rgb=
(221, 221, 221); background-color: white; width: 100%;"><code style=3D"whit=
e-space: pre; font-size: 12px;"><span style=3D"background-color: rgb(248, 2=
48, 248); display: block; white-space: pre; padding: 0px 20px;"><span class=
=3D"linenumber react-syntax-highlighter-line-number" style=3D"display: inli=
ne-block; min-width: 2.25em; padding-right: 1em; text-align: right; user-se=
lect: none; font-size: 11px; font-weight: normal; font-family: monospace; p=
adding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">144</span><sp=
an>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">145</span><span>    </span><spa=
n class=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">cache_blocks</span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>self<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span=
> request</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</=
span><span> Request</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">,</span><span> num_tokens</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">:</span><span> </span><span class=3D"token builtin">int=
</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><spa=
n> </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </=
span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">None</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">146</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(163, 21, 21);">""</span><span>"</=
span></span></code></pre></div><button class=3D"h-5 w-full cursor-pointer b=
g-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-70=
0/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs fo=
nt-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=
=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=
=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8=
,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.=
32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></b=
utton><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0=
e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex =
h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-400=
"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fi=
ll=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M2=
05.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66=
,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,=
0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button><div class=3D"relativ=
e w-full min-w-max overflow-hidden [&amp;_pre]:overflow-hidden bg-neutral-8=
00/80"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot;B=
itstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;=
 direction: ltr; text-align: left; white-space: pre; word-spacing: normal; =
word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyph=
ens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px solid rgb=
(221, 221, 221); background-color: white; width: 100%;"><code style=3D"whit=
e-space: pre; font-size: 12px;"><span style=3D"background-color: rgb(248, 2=
48, 248); display: block; white-space: pre; padding: 0px 20px;"><span class=
=3D"linenumber react-syntax-highlighter-line-number" style=3D"display: inli=
ne-block; min-width: 2.25em; padding-right: 1em; text-align: right; user-se=
lect: none; font-size: 11px; font-weight: normal; font-family: monospace; p=
adding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">596</span><sp=
an>        </span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">=
""</span><span>"
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">597</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span> =
</span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">0</span><s=
pan>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">598</span></span></code></pre><=
/div><div class=3D"citation-2-9"><div class=3D"relative w-full min-w-max ov=
erflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet=
 cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consola=
s, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, =
monospace; direction: ltr; text-align: left; white-space: pre; word-spacing=
: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-siz=
e: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px=
 solid rgb(221, 221, 221); background-color: white; width: 100%;"><code sty=
le=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: =
var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;">=
<span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"di=
splay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: rig=
ht; user-select: none; font-size: 11px; font-weight: normal; font-family: m=
onospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">59=
9</span><span>    </span><span class=3D"token" style=3D"color: rgb(0, 0, 25=
5);">def</span><span> </span><span class=3D"token" style=3D"color: rgb(57, =
58, 52);">get_num_blocks_to_allocate</span><span class=3D"token" style=3D"c=
olor: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">600</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">601</span><span>        reques=
t_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span>=
<span> </span><span class=3D"token builtin">str</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">602</span><span>        num_to=
kens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span>=
<span> </span><span class=3D"token builtin">int</span><span class=3D"token"=
 style=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">603</span><span>        new_co=
mputed_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>:</span><span> Sequence</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">[</span><span>KVCacheBlock</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color: rgb=
(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">604</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">int</span><span class=3D"token" style=3D"color: rg=
b(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">605</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"=
># Allocate extra `num_speculative_blocks` blocks for</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">606</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"=
># speculative decoding (MTP/EAGLE) with linear attention.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">607</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span>=
 </span><span class=3D"token builtin">isinstance</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">(</span><span>self</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">.</span><span>kv_cache_spec</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> Mam=
baSpec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">608</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> sel=
f</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><sp=
an>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">.</span><span>num_speculative_blocks </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span class=3D"token"=
 style=3D"color: rgb(54, 172, 170);">0</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">609</span><span>            nu=
m_tokens </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">+=
=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">610</span><span>              =
  self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</spa=
n><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">611</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">*</span><s=
pan> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</=
span><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>num_speculative_blocks
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">612</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">613</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 </span><span class=3D"token builtin">super</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>get_num_blocks_to_allocate</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">614</span><span>            re=
quest_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</s=
pan><span> num_tokens</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">,</span><span> new_computed_blocks
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">615</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">616</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">617</span><span>    </span><span clas=
s=3D"token" style=3D"color: rgb(0, 0, 255);">def</span><span> </span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">allocate_new_blocks</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">618</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span>=
 request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:=
</span><span> </span><span class=3D"token builtin">str</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> num_tokens</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span> </spa=
n><span class=3D"token builtin">int</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">619</span><span>    </span><sp=
an class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span> </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">-</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span=
 class=3D"token builtin">list</span><span class=3D"token" style=3D"color: r=
gb(57, 58, 52);">[</span><span>KVCacheBlock</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">]</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">620</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"=
># Allocate extra `num_speculative_blocks` blocks for</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">621</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"=
># speculative decoding (MTP/EAGLE) with linear attention.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">622</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><span>=
 </span><span class=3D"token builtin">isinstance</span><span class=3D"token=
" style=3D"color: rgb(57, 58, 52);">(</span><span>self</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">.</span><span>kv_cache_spec</span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> Mam=
baSpec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</spa=
n><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">623</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> sel=
f</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><sp=
an>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">.</span><span>num_speculative_blocks </span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">&gt;</span><span> </span><span class=3D"token"=
 style=3D"color: rgb(54, 172, 170);">0</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">624</span><span>            nu=
m_tokens </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">+=
=3D</span><span> </span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">625</span><span>              =
  self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</spa=
n><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>block_size
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">626</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">*</span><s=
pan> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</=
span><span>kv_cache_spec</span><span class=3D"token" style=3D"color: rgb(57=
, 58, 52);">.</span><span>num_speculative_blocks
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">627</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">628</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><span>=
 </span><span class=3D"token builtin">super</span><span class=3D"token" sty=
le=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">.</span><span>allocate_new_blocks</span><span class=3D"token" styl=
e=3D"color: rgb(57, 58, 52);">(</span><span>request_id</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">,</span><span> num_tokens</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></cod=
e></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidden=
 [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57=
, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &qu=
ot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left;=
 white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9=
em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0=
px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color:=
 white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><s=
pan style=3D"background-color: rgb(248, 248, 248); display: block; white-sp=
ace: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highli=
ghter-line-number" style=3D"display: inline-block; min-width: 2.25em; paddi=
ng-right: 1em; text-align: right; user-select: none; font-size: 11px; font-=
weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, 12=
8, 0); font-style: italic;">629</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">630</span>
</span><span style=3D"background-color: rgb(248, 248, 248); display: block;=
 white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-synt=
ax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25=
em; padding-right: 1em; text-align: right; user-select: none; font-size: 11=
px; font-weight: normal; font-family: monospace; padding-left: 8px; color: =
rgb(0, 128, 0); font-style: italic;">631</span><span></span><span class=3D"=
token" style=3D"color: rgb(0, 0, 255);">class</span><span> </span><span cla=
ss=3D"token" style=3D"color: rgb(43, 145, 175);">CrossAttentionManager</spa=
n><span class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>Sin=
gleTypeKVCacheManager</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">)</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">:<=
/span></span></code></pre></div><button class=3D"h-5 w-full cursor-pointer =
bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-7=
00/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text-xs f=
ont-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" width=
=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=
=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8=
,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.=
32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></b=
utton></div></div></div><div id=3D"file-Repo vllm-project/vllm: vllm/v1/cor=
e/kv_cache_manager.py" class=3D"flex flex-col gap-2 scroll-smooth rounded-m=
d" style=3D"content-visibility: auto;"><div class=3D"scrollbar-hide relativ=
e w-full p-0 ring-1 ring-neutral-800 rounded-sm"><div class=3D"bg-secondary=
 dark:bg-surface sticky top-0 z-10 flex w-full items-center justify-between=
 px-3 py-1.5 text-sm text-neutral-300 rounded-t-sm"><div class=3D"flex min-=
w-0 grow items-center gap-2"><button><svg xmlns=3D"http://www.w3.org/2000/s=
vg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 2=
56" class=3D"h-3 w-3"><path d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-8=
0-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"><=
/path></svg></button><div class=3D"[&amp;_svg_path]:fill-current size-4 fle=
x-shrink-0" style=3D"fill: rgb(81, 154, 186); height: 20px; width: 20px;"><=
svg viewBox=3D"0 0 32 32"><path d=3D"M15.6 15.5h-2c-1.4 0-2.3.9-2.3 2.3v1.8=
c0 .2-.1.3-.3.3h-.9c-.9 0-1.6-.4-2-1.2-.3-.6-.5-1.2-.5-1.8-.1-1.1-.1-2.2.3-=
3.3.3-.9.9-1.6 1.9-1.8h5.8c.1 0 .3 0 .3-.1v-.5s-.2-.1-.3-.1h-3.4c-.3 0-.4-.=
1-.4-.4V9.4c0-.7.3-1.2.9-1.4.5-.2 1-.4 1.5-.5 1.2-.2 2.4-.2 3.6.1.5.1 1 .3 =
1.4.6.4.4.7.8.6 1.4v3.6c0 1.4-.8 2.2-2.2 2.2-.7.1-1.4.1-2 .1zm-2.8-6c0 .4.3=
.8.8.8.4 0 .8-.4.8-.8s-.4-.7-.8-.8c-.5 0-.8.4-.8.8zm3.6 7h2c1.4 0 2.3-.9 2.=
3-2.3v-1.8c0-.2.1-.3.3-.3h.9c.9 0 1.6.4 2 1.2.3.6.5 1.2.5 1.8.1 1.1.1 2.2-.=
3 3.3-.3.9-.9 1.6-1.9 1.8h-5.8c-.1 0-.3 0-.3.1v.5s.2.1.3.1h3.4c.3 0 .4.1.4.=
4v1.3c0 .7-.3 1.2-.9 1.4-.5.2-1 .4-1.5.5-1.2.2-2.4.2-3.6-.1-.5-.1-1-.3-1.4-=
.6-.4-.4-.7-.8-.6-1.4v-3.6c0-1.4.8-2.2 2.2-2.2.7-.1 1.4-.1 2-.1zm2.8 6c0-.4=
-.3-.8-.8-.8-.4 0-.8.4-.8.8s.4.7.8.8c.5 0 .8-.4.8-.8z"></path></svg></div><=
a href=3D"https://github.com/vllm-project/vllm" target=3D"_blank" rel=3D"no=
referrer" class=3D"cursor-pointer truncate text-neutral-500 hover:underline=
">vllm-project/vllm</a><a href=3D"https://github.com/vllm-project/vllm/blob=
/352c0c8a/vllm/v1/core/kv_cache_manager.py" target=3D"_blank" rel=3D"norefe=
rrer" class=3D"cursor-pointer truncate text-black dark:text-neutral-300 hov=
er:underline">vllm/v1/core/kv_cache_manager.py</a><button><svg xmlns=3D"htt=
p://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor"=
 viewBox=3D"0 0 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216=
,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-=
8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88=
a8,8,0,0,0-8-8H96V48H208Z"></path></svg></button></div></div><div class=3D"=
scrollbar-hide grid overflow-auto scroll-smooth"><button class=3D"h-5 w-ful=
l cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:h=
over:bg-neutral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[=
1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.or=
g/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0=
 0 256 256" class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.=
32L136,91.31V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72=
-72a8,8,0,0,1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path=
></svg></div></button><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">292</span><span>            self</span><span =
class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>max_model_l=
en</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><s=
pan>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">293</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">294</span></span></code></pre><=
/div><div class=3D"citation-2-7"><div class=3D"relative w-full min-w-max ov=
erflow-hidden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet=
 cursor-pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consola=
s, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, =
monospace; direction: ltr; text-align: left; white-space: pre; word-spacing=
: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-siz=
e: 4; hyphens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px=
 solid rgb(221, 221, 221); background-color: white; width: 100%;"><code sty=
le=3D"white-space: pre; font-size: 12px;"><span style=3D"background-color: =
var(--bg-secondary); display: block; white-space: pre; padding: 0px 20px;">=
<span class=3D"linenumber react-syntax-highlighter-line-number" style=3D"di=
splay: inline-block; min-width: 2.25em; padding-right: 1em; text-align: rig=
ht; user-select: none; font-size: 11px; font-weight: normal; font-family: m=
onospace; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">29=
5</span><span>        num_blocks_to_allocate </span><span class=3D"token" s=
tyle=3D"color: rgb(57, 58, 52);">=3D</span><span> self</span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">.</span><span>coordinator</span><=
span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>get_nu=
m_blocks_to_allocate</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">296</span><span>            re=
quest_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D<=
/span><span>request</span><span class=3D"token" style=3D"color: rgb(57, 58,=
 52);">.</span><span>request_id</span><span class=3D"token" style=3D"color:=
 rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">297</span><span>            nu=
m_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D<=
/span><span>num_tokens_need_slot</span><span class=3D"token" style=3D"color=
: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">298</span><span>            ne=
w_computed_blocks</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">=3D</span><span>new_computed_block_list</span><span class=3D"token" st=
yle=3D"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">299</span><span>            nu=
m_encoder_tokens</span><span class=3D"token" style=3D"color: rgb(57, 58, 52=
);">=3D</span><span>num_encoder_tokens</span><span class=3D"token" style=3D=
"color: rgb(57, 58, 52);">,</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">300</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">301</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">302</span><span>        </span><span =
class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> num_blocks=
_to_allocate </span><span class=3D"token" style=3D"color: rgb(57, 58, 52);"=
>&gt;</span><span> self</span><span class=3D"token" style=3D"color: rgb(57,=
 58, 52);">.</span><span>block_pool</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">.</span><span>get_num_free_blocks</span><span class=
=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">)</span><span class=3D"token" style=3D"co=
lor: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">303</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: ital=
ic;"># Cannot allocate new blocks</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">304</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">return</span><s=
pan> </span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">None<=
/span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">305</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">306</span><span>        </span><span =
class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># Touc=
h the computed blocks to make sure they won't be evicted.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">307</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">if</span><span> sel=
f</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><sp=
an>enable_caching</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">308</span><span>            se=
lf</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><s=
pan>block_pool</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);=
">.</span><span>touch</span><span class=3D"token" style=3D"color: rgb(57, 5=
8, 52);">(</span><span>new_computed_block_list</span><span class=3D"token" =
style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">309</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 0, 255);">else</span><span cl=
ass=3D"token" style=3D"color: rgb(57, 58, 52);">:</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">310</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">assert</span><s=
pan> </span><span class=3D"token" style=3D"color: rgb(0, 0, 255);">not</spa=
n><span> </span><span class=3D"token builtin">any</span><span class=3D"toke=
n" style=3D"color: rgb(57, 58, 52);">(</span><span>new_computed_block_list<=
/span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span=
 class=3D"token" style=3D"color: rgb(57, 58, 52);">,</span><span> </span><s=
pan class=3D"token" style=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">311</span><span>              =
  </span><span class=3D"token" style=3D"color: rgb(163, 21, 21);">"Computed=
 blocks should be empty when prefix caching is disabled"</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">312</span><span>            </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">313</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">314</span><span>        </span><span =
class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"># Appe=
nd the new computed blocks to the request blocks until now to</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">315</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;"=
># avoid the case where the new blocks cannot be allocated.</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">316</span><span>        self</=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span><span>=
coordinator</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.=
</span><span>save_new_computed_blocks</span><span class=3D"token" style=3D"=
color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">317</span><span>            re=
quest</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">,</span><span> new_computed_block_list
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">318</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">319</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">320</span><span>        new_blocks </=
span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">=3D</span><spa=
n> self</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</sp=
an><span>coordinator</span><span class=3D"token" style=3D"color: rgb(57, 58=
, 52);">.</span><span>allocate_new_blocks</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">(</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">321</span><span>            re=
quest</span><span class=3D"token" style=3D"color: rgb(57, 58, 52);">.</span=
><span>request_id</span><span class=3D"token" style=3D"color: rgb(57, 58, 5=
2);">,</span><span> num_tokens_need_slot</span><span class=3D"token" style=
=3D"color: rgb(57, 58, 52);">,</span><span> num_encoder_tokens
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">322</span><span>        </span=
><span class=3D"token" style=3D"color: rgb(57, 58, 52);">)</span></span></c=
ode></pre></div></div><div class=3D"relative w-full min-w-max overflow-hidd=
en [&amp;_pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(=
57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &=
quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: lef=
t; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0=
.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin:=
 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-colo=
r: white; width: 100%;"><code style=3D"white-space: pre; font-size: 12px;">=
<span style=3D"background-color: rgb(248, 248, 248); display: block; white-=
space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syntax-high=
lighter-line-number" style=3D"display: inline-block; min-width: 2.25em; pad=
ding-right: 1em; text-align: right; user-select: none; font-size: 11px; fon=
t-weight: normal; font-family: monospace; padding-left: 8px; color: rgb(0, =
128, 0); font-style: italic;">323</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">324</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# P/D: delay caching blocks if we have to recv from</span><span>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">325</span><span>        </span>=
<span class=3D"token" style=3D"color: rgb(0, 128, 0); font-style: italic;">=
# remote. Update state for locally cached blocks.</span></span></code></pre=
></div><button class=3D"h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e=
0e0e0] dark:bg-neutral-800 dark:hover:bg-neutral-700/80"><div class=3D"flex=
 h-full items-center gap-1.5 pl-[1.3rem] text-xs font-light text-neutral-40=
0"><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"1em" f=
ill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M=
50.34,117.66a8,8,0,0,1,11.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.3=
4-58.35a8,8,0,0,1,11.32,11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,=
0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div></button></div></div></div><=
div id=3D"file-Repo vllm-project/vllm: docs/design/prefix_caching.md" class=
=3D"flex flex-col gap-2 scroll-smooth rounded-md" style=3D"content-visibili=
ty: auto;"><div class=3D"scrollbar-hide relative w-full p-0 ring-1 ring-neu=
tral-800 rounded-sm"><div class=3D"bg-secondary dark:bg-surface sticky top-=
0 z-10 flex w-full items-center justify-between px-3 py-1.5 text-sm text-ne=
utral-300 rounded-t-sm"><div class=3D"flex min-w-0 grow items-center gap-2"=
><button><svg xmlns=3D"http://www.w3.org/2000/svg" width=3D"1em" height=3D"=
1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" class=3D"h-3 w-3"><path =
d=3D"M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L1=
28,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg></button><div cl=
ass=3D"[&amp;_svg_path]:fill-current size-4 flex-shrink-0" style=3D"fill: r=
gb(81, 154, 186); height: 20px; width: 20px;"><svg viewBox=3D"0 0 32 32"><p=
ath d=3D"M20.7 6.7v9.9h3.8c-2.9 3-5.8 5.9-8.7 8.8-2.7-2.8-5.6-5.8-8.4-8.7h3=
.5V6.6c1.3.9 4.4 3.1 5 3.1.6 0 3.6-2.2 4.8-3z"></path></svg></div><a href=
=3D"https://github.com/vllm-project/vllm" target=3D"_blank" rel=3D"noreferr=
er" class=3D"cursor-pointer truncate text-neutral-500 hover:underline">vllm=
-project/vllm</a><a href=3D"https://github.com/vllm-project/vllm/blob/352c0=
c8a/docs/design/prefix_caching.md" target=3D"_blank" rel=3D"noreferrer" cla=
ss=3D"cursor-pointer truncate text-black dark:text-neutral-300 hover:underl=
ine">docs/design/prefix_caching.md</a><button><svg xmlns=3D"http://www.w3.o=
rg/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"=
0 0 256 256" class=3D"h-4 w-4 text-neutral-500"><path d=3D"M216,32H88a8,8,0=
,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8=
,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8=
-8H96V48H208Z"></path></svg></button></div></div><div class=3D"scrollbar-hi=
de grid overflow-auto scroll-smooth"><button class=3D"h-5 w-full cursor-poi=
nter bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-800 dark:hover:bg-neut=
ral-700/80"><div class=3D"flex h-full items-center gap-1.5 pl-[1.3rem] text=
-xs font-light text-neutral-400"><svg xmlns=3D"http://www.w3.org/2000/svg" =
width=3D"1em" height=3D"1em" fill=3D"currentColor" viewBox=3D"0 0 256 256" =
class=3D"h-3 w-3"><path d=3D"M205.66,138.34a8,8,0,0,1-11.32,11.32L136,91.31=
V224a8,8,0,0,1-16,0V91.31L61.66,149.66a8,8,0,0,1-11.32-11.32l72-72a8,8,0,0,=
1,11.32,0ZM216,32H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Z"></path></svg></div=
></button><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_pr=
e]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52);=
 font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier=
 New&quot;, Courier, monospace; direction: ltr; text-align: left; white-spa=
ce: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-h=
eight: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; overfl=
ow: auto; border: 1px solid rgb(221, 221, 221); background-color: white; wi=
dth: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span style=
=3D"background-color: rgb(248, 248, 248); display: block; white-space: pre;=
 padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-lin=
e-number" style=3D"display: inline-block; min-width: 2.25em; padding-right:=
 1em; text-align: right; user-select: none; font-size: 11px; font-weight: n=
ormal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); fo=
nt-style: italic;">97</span><span>!!! note
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">98</span>    Cache isolation is=
 not supported in engine V0.
</span><span style=3D"background-color: rgb(248, 248, 248); display: block;=
 white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-synt=
ax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25=
em; padding-right: 1em; text-align: right; user-select: none; font-size: 11=
px; font-weight: normal; font-family: monospace; padding-left: 8px; color: =
rgb(0, 128, 0); font-style: italic;">99</span></span></code></pre></div><di=
v class=3D"citation-2-8"><div class=3D"relative w-full min-w-max overflow-h=
idden [&amp;_pre]:overflow-hidden bg-[#6096FF]/10 clickable-snippet cursor-=
pointer"><pre style=3D"color: rgb(57, 58, 52); font-family: Consolas, &quot=
;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospac=
e; direction: ltr; text-align: left; white-space: pre; word-spacing: normal=
; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hy=
phens: none; padding: 0px; margin: 0px; overflow: auto; border: 1px solid r=
gb(221, 221, 221); background-color: white; width: 100%;"><code style=3D"wh=
ite-space: pre; font-size: 12px;"><span style=3D"background-color: var(--bg=
-secondary); display: block; white-space: pre; padding: 0px 20px;"><span cl=
ass=3D"linenumber react-syntax-highlighter-line-number" style=3D"display: i=
nline-block; min-width: 2.25em; padding-right: 1em; text-align: right; user=
-select: none; font-size: 11px; font-weight: normal; font-family: monospace=
; padding-left: 8px; color: rgb(0, 128, 0); font-style: italic;">100</span>=
<span class=3D"token title" style=3D"color: rgb(57, 58, 52); font-weight: b=
old;">##</span><span class=3D"token title" style=3D"color: rgb(238, 153, 0)=
; font-weight: bold;"> Data Structure</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">101</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">102</span>The prefix caching in vLLM =
v1 is implemented in the KV cache manager. The basic building block is the =
=E2=80=9CBlock=E2=80=9D data class (simplified):
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">103</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">104</span><span></span><span class=3D=
"token code" style=3D"color: rgb(57, 58, 52);">```</span><span class=3D"tok=
en code code-language">python</span><span class=3D"token code">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">105</span><span class=3D"token=
 code"></span><span class=3D"token code code-block language-python" style=
=3D"color: rgb(0, 0, 255);">class</span><span class=3D"token code code-bloc=
k language-python"> </span><span class=3D"token code code-block language-py=
thon" style=3D"color: rgb(43, 145, 175);">KVCacheBlock</span><span class=3D=
"token code code-block language-python" style=3D"color: rgb(57, 58, 52);">:=
</span><span class=3D"token code code-block language-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">106</span><span class=3D"token=
 code code-block language-python">    </span><span class=3D"token code code=
-block language-python" style=3D"color: rgb(0, 128, 0); font-style: italic;=
"># The block ID (immutable)</span><span class=3D"token code code-block lan=
guage-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">107</span><span class=3D"token=
 code code-block language-python">    block_id</span><span class=3D"token c=
ode code-block language-python" style=3D"color: rgb(57, 58, 52);">:</span><=
span class=3D"token code code-block language-python"> </span><span class=3D=
"token code code-block language-python builtin">int</span><span class=3D"to=
ken code code-block language-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">108</span><span class=3D"token=
 code code-block language-python">    </span><span class=3D"token code code=
-block language-python" style=3D"color: rgb(0, 128, 0); font-style: italic;=
"># The block hash (will be assigned when the block is full,</span><span cl=
ass=3D"token code code-block language-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">109</span><span class=3D"token=
 code code-block language-python">    </span><span class=3D"token code code=
-block language-python" style=3D"color: rgb(0, 128, 0); font-style: italic;=
"># and will be reset when the block is evicted).</span><span class=3D"toke=
n code code-block language-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">110</span><span class=3D"token=
 code code-block language-python">    block_hash</span><span class=3D"token=
 code code-block language-python" style=3D"color: rgb(57, 58, 52);">:</span=
><span class=3D"token code code-block language-python"> BlockHash
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">111</span><span class=3D"token=
 code code-block language-python">    </span><span class=3D"token code code=
-block language-python" style=3D"color: rgb(0, 128, 0); font-style: italic;=
"># The number of requests using this block now.</span><span class=3D"token=
 code code-block language-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">112</span><span class=3D"token=
 code code-block language-python">    ref_cnt</span><span class=3D"token co=
de code-block language-python" style=3D"color: rgb(57, 58, 52);">:</span><s=
pan class=3D"token code code-block language-python"> </span><span class=3D"=
token code code-block language-python builtin">int</span><span class=3D"tok=
en code code-block language-python">
</span></span><span class=3D"token code code-block language-python" style=
=3D"background-color: var(--bg-secondary); display: block; white-space: pre=
; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-li=
ne-number" style=3D"display: inline-block; min-width: 2.25em; padding-right=
: 1em; text-align: right; user-select: none; font-size: 11px; font-weight: =
normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); f=
ont-style: italic;">113</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">114</span><span class=3D"token code c=
ode-block language-python">    </span><span class=3D"token code code-block =
language-python" style=3D"color: rgb(0, 128, 0); font-style: italic;"># The=
 pointers to form a doubly linked list for the free queue.</span><span clas=
s=3D"token code code-block language-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">115</span><span class=3D"token=
 code code-block language-python">    prev_free_block</span><span class=3D"=
token code code-block language-python" style=3D"color: rgb(57, 58, 52);">:<=
/span><span class=3D"token code code-block language-python"> </span><span c=
lass=3D"token code code-block language-python" style=3D"color: rgb(163, 21,=
 21);">"KVCacheBlock | None"</span><span class=3D"token code code-block lan=
guage-python"> </span><span class=3D"token code code-block language-python"=
 style=3D"color: rgb(57, 58, 52);">=3D</span><span class=3D"token code code=
-block language-python"> </span><span class=3D"token code code-block langua=
ge-python" style=3D"color: rgb(54, 172, 170);">None</span><span class=3D"to=
ken code code-block language-python">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">116</span><span class=3D"token=
 code code-block language-python">    next_free_block</span><span class=3D"=
token code code-block language-python" style=3D"color: rgb(57, 58, 52);">:<=
/span><span class=3D"token code code-block language-python"> </span><span c=
lass=3D"token code code-block language-python" style=3D"color: rgb(163, 21,=
 21);">"KVCacheBlock | None"</span><span class=3D"token code code-block lan=
guage-python"> </span><span class=3D"token code code-block language-python"=
 style=3D"color: rgb(57, 58, 52);">=3D</span><span class=3D"token code code=
-block language-python"> </span><span class=3D"token code code-block langua=
ge-python" style=3D"color: rgb(54, 172, 170);">None</span><span class=3D"to=
ken code">
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">117</span><span class=3D"token=
 code"></span><span class=3D"token code" style=3D"color: rgb(57, 58, 52);">=
```</span><span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">118</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">119</span>There are two design points=
 to highlight:
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">120</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">121</span><span></span><span class=3D=
"token list" style=3D"color: rgb(57, 58, 52);">1.</span><span> We allocate =
all KVCacheBlock when initializing the KV cache manager to be a block pool.=
 This avoids Python object creation overheads and can easily track all bloc=
ks all the time. =20
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">122</span><span></span><span c=
lass=3D"token list" style=3D"color: rgb(57, 58, 52);">2.</span><span> We in=
troduce doubly linked list pointers directly in the KVCacheBlock, so that w=
e could construct a free queue directly. This gives us two benefits: =20
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">123</span><span>    </span><sp=
an class=3D"token list" style=3D"color: rgb(57, 58, 52);">1.</span><span> W=
e could have O(1) complexity moving elements in the middle to the tail. =20
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">124</span><span>    </span><sp=
an class=3D"token list" style=3D"color: rgb(57, 58, 52);">2.</span><span> W=
e could avoid introducing another Python queue (e.g., </span><span class=3D=
"token code-snippet code" style=3D"color: rgb(0, 0, 255);">`deque`</span><s=
pan>) which has a wrapper to the elements.
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">125</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">126</span>As a result, we will have t=
he following components when the KV cache manager is initialized:
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">127</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">128</span><span></span><span class=3D=
"token" style=3D"color: rgb(57, 58, 52);">!</span><span class=3D"token" sty=
le=3D"color: rgb(54, 172, 170);">[</span><span class=3D"token content" styl=
e=3D"color: rgb(54, 172, 170);">Component Overview</span><span class=3D"tok=
en" style=3D"color: rgb(54, 172, 170);">](</span><span class=3D"token" styl=
e=3D"color: rgb(54, 172, 170);">../assets/design/prefix_caching/overview.pn=
g</span><span class=3D"token" style=3D"color: rgb(54, 172, 170);">)</span><=
span>
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">129</span>
</span><span style=3D"background-color: var(--bg-secondary); display: block=
; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-syn=
tax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.2=
5em; padding-right: 1em; text-align: right; user-select: none; font-size: 1=
1px; font-weight: normal; font-family: monospace; padding-left: 8px; color:=
 rgb(0, 128, 0); font-style: italic;">130</span><span></span><span class=3D=
"token list" style=3D"color: rgb(57, 58, 52);">*</span><span> Block Pool: A=
 list of KVCacheBlock. =20
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">131</span><span></span><span c=
lass=3D"token list" style=3D"color: rgb(57, 58, 52);">*</span><span> Free B=
lock Queue: Only store the pointers of head and tail blocks for manipulatio=
ns. =20
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">132</span><span></span><span c=
lass=3D"token list" style=3D"color: rgb(57, 58, 52);">*</span><span> Cache =
blocks: Mapping from hash key to block IDs. =20
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">133</span><span></span><span c=
lass=3D"token list" style=3D"color: rgb(57, 58, 52);">*</span><span> Reques=
t blocks: Mapping from request ID to allocated block IDs.
</span></span><span style=3D"background-color: var(--bg-secondary); display=
: block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber re=
act-syntax-highlighter-line-number" style=3D"display: inline-block; min-wid=
th: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-=
size: 11px; font-weight: normal; font-family: monospace; padding-left: 8px;=
 color: rgb(0, 128, 0); font-style: italic;">134</span></span></code></pre>=
</div></div><div class=3D"relative w-full min-w-max overflow-hidden [&amp;_=
pre]:overflow-hidden bg-neutral-800/80"><pre style=3D"color: rgb(57, 58, 52=
); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Couri=
er New&quot;, Courier, monospace; direction: ltr; text-align: left; white-s=
pace: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line=
-height: 1.2em; tab-size: 4; hyphens: none; padding: 0px; margin: 0px; over=
flow: auto; border: 1px solid rgb(221, 221, 221); background-color: white; =
width: 100%;"><code style=3D"white-space: pre; font-size: 12px;"><span styl=
e=3D"background-color: rgb(248, 248, 248); display: block; white-space: pre=
; padding: 0px 20px;"><span class=3D"linenumber react-syntax-highlighter-li=
ne-number" style=3D"display: inline-block; min-width: 2.25em; padding-right=
: 1em; text-align: right; user-select: none; font-size: 11px; font-weight: =
normal; font-family: monospace; padding-left: 8px; color: rgb(0, 128, 0); f=
ont-style: italic;">135</span><span class=3D"token title" style=3D"color: r=
gb(57, 58, 52); font-weight: bold;">##</span><span class=3D"token title" st=
yle=3D"color: rgb(238, 153, 0); font-weight: bold;"> Operations</span><span=
>
</span></span><span style=3D"background-color: rgb(248, 248, 248); display:=
 block; white-space: pre; padding: 0px 20px;"><span class=3D"linenumber rea=
ct-syntax-highlighter-line-number" style=3D"display: inline-block; min-widt=
h: 2.25em; padding-right: 1em; text-align: right; user-select: none; font-s=
ize: 11px; font-weight: normal; font-family: monospace; padding-left: 8px; =
color: rgb(0, 128, 0); font-style: italic;">136</span>
</span><span style=3D"background-color: rgb(248, 248, 248); display: block;=
 white-space: pre; padding: 0px 20px;"><span class=3D"linenumber react-synt=
ax-highlighter-line-number" style=3D"display: inline-block; min-width: 2.25=
em; padding-right: 1em; text-align: right; user-select: none; font-size: 11=
px; font-weight: normal; font-family: monospace; padding-left: 8px; color: =
rgb(0, 128, 0); font-style: italic;">137</span><span></span><span class=3D"=
token title" style=3D"color: rgb(57, 58, 52); font-weight: bold;">###</span=
><span class=3D"token title" style=3D"color: rgb(238, 153, 0); font-weight:=
 bold;"> Block Allocation</span></span></code></pre></div><button class=3D"=
h-5 w-full cursor-pointer bg-[#f0f0f0] hover:bg-[#e0e0e0] dark:bg-neutral-8=
00 dark:hover:bg-neutral-700/80"><div class=3D"flex h-full items-center gap=
-1.5 pl-[1.3rem] text-xs font-light text-neutral-400"><svg xmlns=3D"http://=
www.w3.org/2000/svg" width=3D"1em" height=3D"1em" fill=3D"currentColor" vie=
wBox=3D"0 0 256 256" class=3D"h-3 w-3"><path d=3D"M50.34,117.66a8,8,0,0,1,1=
1.32-11.32L120,164.69V32a8,8,0,0,1,16,0V164.69l58.34-58.35a8,8,0,0,1,11.32,=
11.32l-72,72a8,8,0,0,1-11.32,0ZM216,208H40a8,8,0,0,0,0,16H216a8,8,0,0,0,0-1=
6Z"></path></svg></div></button></div></div></div></div></div></div></div><=
/div></div></div></div><!--$--><!--/$--><!--$--><!--/$--><next-route-announ=
cer style=3D"position: absolute;"><template shadowmode=3D"open"><div aria-l=
ive=3D"assertive" id=3D"__next-route-announcer__" role=3D"alert" style=3D"p=
osition: absolute; border: 0px; height: 1px; margin: -1px; padding: 0px; wi=
dth: 1px; clip: rect(0px, 0px, 0px, 0px); overflow: hidden; white-space: no=
wrap; overflow-wrap: normal;"></div></template></next-route-announcer><ifra=
me id=3D"_hjSafeContext_25897277" title=3D"_hjSafeContext" tabindex=3D"-1" =
aria-hidden=3D"true" src=3D"cid:frame-620E8B284DE4836F2F88CED27D770CE7@mhtm=
l.blink" style=3D"display: none !important; width: 1px !important; height: =
1px !important; opacity: 0 !important; pointer-events: none !important;"></=
iframe></body></html>
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: https://deepwiki.com/_next/static/css/87600ca0112f3c8f.css?dpl=dpl_FtMvNrLWw316N3P8owbGd4HX4iEE

@charset "utf-8";

@font-face { font-family: "IBM Plex Mono"; font-style: normal; font-weight:=
 400; font-display: swap; src: url("/_next/static/media/58f386aa6b1a2a92-s.=
woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C8A, U+20B4, U+2=
DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "IBM Plex Mono"; font-style: normal; font-weight:=
 400; font-display: swap; src: url("/_next/static/media/011e180705008d6f-s.=
woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-=
4B1, U+2116; }

@font-face { font-family: "IBM Plex Mono"; font-style: normal; font-weight:=
 400; font-display: swap; src: url("/_next/static/media/7ba5fb2a8c88521c-s.=
woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+=
168-169, U+1A0-1A1, U+1AF-1B0, U+300-301, U+303-304, U+308-309, U+323, U+32=
9, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "IBM Plex Mono"; font-style: normal; font-weight:=
 400; font-display: swap; src: url("/_next/static/media/92eeb95d069020cc-s.=
woff2") format("woff2"); unicode-range: U+100-2BA, U+2BD-2C5, U+2C7-2CC, U+=
2CE-2D7, U+2DD-2FF, U+304, U+308, U+329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1=
EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "IBM Plex Mono"; font-style: normal; font-weight:=
 400; font-display: swap; src: url("/_next/static/media/d3ebbfd689654d3a-s.=
p.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2=
BC, U+2C6, U+2DA, U+2DC, U+304, U+308, U+329, U+2000-206F, U+20AC, U+2122, =
U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "IBM Plex Mono Fallback"; src: local("Arial"); as=
cent-override: 76.16%; descent-override: 20.43%; line-gap-override: 0%; siz=
e-adjust: 134.59%; }

.__className_21eb4d { font-family: "IBM Plex Mono", "IBM Plex Mono Fallback=
"; font-weight: 400; font-style: normal; }
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: https://deepwiki.com/_next/static/css/2e0edb6b57d4c702.css?dpl=dpl_FtMvNrLWw316N3P8owbGd4HX4iEE

@charset "utf-8";

@layer properties {
  @supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((=
-moz-orient:inline) and (not (color:rgb(from red r g b)))) {
  *, ::backdrop, ::after, ::before { --tw-translate-x: 0; --tw-translate-y:=
 0; --tw-translate-z: 0; --tw-rotate-x: initial; --tw-rotate-y: initial; --=
tw-rotate-z: initial; --tw-skew-x: initial; --tw-skew-y: initial; --tw-spac=
e-y-reverse: 0; --tw-border-style: solid; --tw-gradient-position: initial; =
--tw-gradient-from: #0000; --tw-gradient-via: #0000; --tw-gradient-to: #000=
0; --tw-gradient-stops: initial; --tw-gradient-via-stops: initial; --tw-gra=
dient-from-position: 0%; --tw-gradient-via-position: 50%; --tw-gradient-to-=
position: 100%; --tw-leading: initial; --tw-font-weight: initial; --tw-trac=
king: initial; --tw-ordinal: initial; --tw-slashed-zero: initial; --tw-nume=
ric-figure: initial; --tw-numeric-spacing: initial; --tw-numeric-fraction: =
initial; --tw-shadow: 0 0 #0000; --tw-shadow-color: initial; --tw-shadow-al=
pha: 100%; --tw-inset-shadow: 0 0 #0000; --tw-inset-shadow-color: initial; =
--tw-inset-shadow-alpha: 100%; --tw-ring-color: initial; --tw-ring-shadow: =
0 0 #0000; --tw-inset-ring-color: initial; --tw-inset-ring-shadow: 0 0 #000=
0; --tw-ring-inset: initial; --tw-ring-offset-width: 0px; --tw-ring-offset-=
color: #fff; --tw-ring-offset-shadow: 0 0 #0000; --tw-outline-style: solid;=
 --tw-blur: initial; --tw-brightness: initial; --tw-contrast: initial; --tw=
-grayscale: initial; --tw-hue-rotate: initial; --tw-invert: initial; --tw-o=
pacity: initial; --tw-saturate: initial; --tw-sepia: initial; --tw-drop-sha=
dow: initial; --tw-drop-shadow-color: initial; --tw-drop-shadow-alpha: 100%=
; --tw-drop-shadow-size: initial; --tw-backdrop-blur: initial; --tw-backdro=
p-brightness: initial; --tw-backdrop-contrast: initial; --tw-backdrop-grays=
cale: initial; --tw-backdrop-hue-rotate: initial; --tw-backdrop-invert: ini=
tial; --tw-backdrop-opacity: initial; --tw-backdrop-saturate: initial; --tw=
-backdrop-sepia: initial; --tw-duration: initial; --tw-ease: initial; --tw-=
content: ""; --tw-animation-delay: 0s; --tw-animation-direction: normal; --=
tw-animation-duration: initial; --tw-animation-fill-mode: none; --tw-animat=
ion-iteration-count: 1; --tw-enter-blur: 0; --tw-enter-opacity: 1; --tw-ent=
er-rotate: 0; --tw-enter-scale: 1; --tw-enter-translate-x: 0; --tw-enter-tr=
anslate-y: 0; --tw-exit-blur: 0; --tw-exit-opacity: 1; --tw-exit-rotate: 0;=
 --tw-exit-scale: 1; --tw-exit-translate-x: 0; --tw-exit-translate-y: 0; }
}
}

@layer theme {
  :host, :root { --font-sans: ui-sans-serif,system-ui,sans-serif,"Apple Col=
or Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"; --font-mon=
o: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Cou=
rier New",monospace; --color-red-100: oklch(93.6% .032 17.717); --color-red=
-300: oklch(80.8% .114 19.571); --color-red-400: oklch(70.4% .191 22.216); =
--color-red-500: oklch(63.7% .237 25.331); --color-red-600: oklch(57.7% .24=
5 27.325); --color-red-900: oklch(39.6% .141 25.723); --color-orange-600: o=
klch(64.6% .222 41.116); --color-yellow-400: oklch(85.2% .199 91.936); --co=
lor-yellow-600: oklch(68.1% .162 75.834); --color-green-300: oklch(87.1% .1=
5 154.449); --color-green-400: oklch(79.2% .209 151.711); --color-green-600=
: oklch(62.7% .194 149.214); --color-green-900: oklch(39.3% .095 152.535); =
--color-cyan-300: oklch(86.5% .127 207.078); --color-cyan-400: oklch(78.9% =
.154 211.53); --color-cyan-600: oklch(60.9% .126 221.723); --color-blue-100=
: oklch(93.2% .032 255.585); --color-blue-200: oklch(88.2% .059 254.128); -=
-color-blue-300: oklch(80.9% .105 251.813); --color-blue-400: oklch(70.7% .=
165 254.624); --color-blue-500: oklch(62.3% .214 259.815); --color-blue-600=
: oklch(54.6% .245 262.881); --color-blue-800: oklch(42.4% .199 265.638); -=
-color-blue-900: oklch(37.9% .146 265.522); --color-blue-950: oklch(28.2% .=
091 267.935); --color-indigo-300: oklch(78.5% .115 274.713); --color-indigo=
-500: oklch(58.5% .233 277.117); --color-purple-400: oklch(71.4% .203 305.5=
04); --color-purple-500: oklch(62.7% .265 303.9); --color-purple-600: oklch=
(55.8% .288 302.321); --color-gray-100: oklch(96.7% .003 264.542); --color-=
gray-200: oklch(92.8% .006 264.531); --color-gray-300: oklch(87.2% .01 258.=
338); --color-gray-400: oklch(70.7% .022 261.325); --color-gray-600: oklch(=
44.6% .03 256.802); --color-gray-700: oklch(37.3% .034 259.733); --color-gr=
ay-800: oklch(27.8% .033 256.848); --color-gray-900: oklch(21% .034 264.665=
); --color-zinc-100: oklch(96.7% .001 286.375); --color-zinc-400: oklch(70.=
5% .015 286.067); --color-zinc-500: oklch(55.2% .016 285.938); --color-zinc=
-600: oklch(44.2% .017 285.786); --color-zinc-900: oklch(21% .006 285.885);=
 --color-neutral-100: oklch(97% 0 0); --color-neutral-200: oklch(92.2% 0 0)=
; --color-neutral-300: oklch(87% 0 0); --color-neutral-400: oklch(70.8% 0 0=
); --color-neutral-500: oklch(55.6% 0 0); --color-neutral-600: oklch(43.9% =
0 0); --color-neutral-700: oklch(37.1% 0 0); --color-neutral-800: oklch(26.=
9% 0 0); --color-neutral-900: oklch(20.5% 0 0); --color-stone-900: oklch(21=
.6% .006 56.043); --color-black: #000; --color-white: #fff; --spacing: .25r=
em; --container-xs: 20rem; --container-md: 28rem; --container-lg: 32rem; --=
container-xl: 36rem; --container-2xl: 42rem; --container-3xl: 48rem; --cont=
ainer-5xl: 64rem; --container-6xl: 72rem; --text-xs: .75rem; --text-xs--lin=
e-height: calc(1/.75); --text-sm: .875rem; --text-sm--line-height: calc(1.2=
5/.875); --text-base: 1rem; --text-base--line-height: calc(1.5/1); --text-l=
g: 1.125rem; --text-lg--line-height: calc(1.75/1.125); --text-xl: 1.25rem; =
--text-xl--line-height: calc(1.75/1.25); --text-2xl: 1.5rem; --text-2xl--li=
ne-height: calc(2/1.5); --text-3xl: 1.875rem; --text-3xl--line-height: calc=
(2.25/1.875); --font-weight-light: 300; --font-weight-normal: 400; --font-w=
eight-medium: 500; --font-weight-semibold: 600; --font-weight-bold: 700; --=
font-weight-extrabold: 800; --tracking-tight: -.025em; --tracking-widest: .=
1em; --leading-normal: 1.5; --radius-xs: .125rem; --ease-out: cubic-bezier(=
0,0,.2,1); --ease-in-out: cubic-bezier(.4,0,.2,1); --animate-spin: spin 1s =
linear infinite; --animate-ping: ping 1s cubic-bezier(0,0,.2,1)infinite; --=
animate-pulse: pulse 2s cubic-bezier(.4,0,.6,1)infinite; --animate-bounce: =
bounce 1s infinite; --blur-xs: 4px; --blur-md: 12px; --default-transition-d=
uration: .15s; --default-transition-timing-function: cubic-bezier(.4,0,.2,1=
); --default-font-family: var(--font-sans); --default-mono-font-family: var=
(--font-mono); --color-text-light: #cbcbcb; --color-pacific: #6096ff; --col=
or-ray: #ffaa47; --color-night: #242424; --color-border: var(--border); --c=
olor-border-hover: #454545; --color-text-primary: var(--color-text-light); =
--color-text-secondary: #8f8f8f; --color-hover: #1f1f1f; --color-codemaps-g=
lyph: #a855f7; --color-codemap-bg: #151515; --bg-surface: #181818; --bg-sur=
face-hover: #202020; --bg-secondary: #202020; --bg-component: #252525; --bg=
-placeholder: #333; --font-geist-sans: "Geist","Geist Fallback"; --font-gei=
st-mono: "Geist Mono","Geist Mono Fallback"; --animate-shine: shine 5s line=
ar infinite; }
}

@layer base {
  *, ::backdrop, ::after, ::before { box-sizing: border-box; border: 0px so=
lid; margin: 0px; padding: 0px; }
  ::file-selector-button { box-sizing: border-box; border: 0px solid; margi=
n: 0px; padding: 0px; }
  :host, html { text-size-adjust: 100%; tab-size: 4; line-height: 1.5; font=
-family: var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Appl=
e Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"); font=
-feature-settings: var(--default-font-feature-settings,normal); font-variat=
ion-settings: var(--default-font-variation-settings,normal); -webkit-tap-hi=
ghlight-color: transparent; }
  hr { height: 0px; color: inherit; border-top-width: 1px; }
  abbr:where([title]) { text-decoration: underline dotted; }
  h1, h2, h3, h4, h5, h6 { font-size: inherit; font-weight: inherit; }
  a { color: inherit; text-decoration: inherit; }
  b, strong { font-weight: bolder; }
  code, kbd, pre, samp { font-family: var(--default-mono-font-family,ui-mon=
ospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New"=
,monospace); font-feature-settings: var(--default-mono-font-feature-setting=
s,normal); font-variation-settings: var(--default-mono-font-variation-setti=
ngs,normal); font-size: 1em; }
  small { font-size: 80%; }
  sub, sup { vertical-align: baseline; font-size: 75%; line-height: 0; posi=
tion: relative; }
  sub { bottom: -0.25em; }
  sup { top: -0.5em; }
  table { text-indent: 0px; border-color: inherit; border-collapse: collaps=
e; }
  progress { vertical-align: baseline; }
  summary { display: list-item; }
  menu, ol, ul { list-style: none; }
  audio, canvas, embed, iframe, img, object, svg, video { vertical-align: m=
iddle; display: block; }
  img, video { max-width: 100%; height: auto; }
  button, input, optgroup, select, textarea { font: inherit; letter-spacing=
: inherit; color: inherit; opacity: 1; background-color: rgba(0, 0, 0, 0); =
border-radius: 0px; }
  ::file-selector-button { font: inherit; letter-spacing: inherit; color: i=
nherit; opacity: 1; background-color: rgba(0, 0, 0, 0); border-radius: 0px;=
 }
  :where(select:is([multiple], [size])) optgroup { font-weight: bolder; }
  :where(select:is([multiple], [size])) optgroup option { padding-inline-st=
art: 20px; }
  ::file-selector-button { margin-inline-end: 4px; }
  ::placeholder { opacity: 1; }
  @supports (not ((-webkit-appearance:-apple-pay-button))) or (contain-intr=
insic-size:1px) {
  ::placeholder { color: currentcolor; }
  @supports (color:color-mix(in lab,red,red)) {
  ::placeholder { color: color-mix(in oklab, currentcolor, transparent); }
}
}
  textarea { resize: vertical; }
  ::-webkit-search-decoration { appearance: none; }
  ::-webkit-date-and-time-value { min-height: 1lh; text-align: inherit; }
  ::-webkit-datetime-edit { display: inline-flex; }
  ::-webkit-datetime-edit-fields-wrapper { padding: 0px; }
  ::-webkit-datetime-edit, ::-webkit-datetime-edit-year-field { padding-blo=
ck: 0px; }
  ::-webkit-datetime-edit-day-field, ::-webkit-datetime-edit-month-field { =
padding-block: 0px; }
  ::-webkit-datetime-edit-hour-field, ::-webkit-datetime-edit-minute-field =
{ padding-block: 0px; }
  ::-webkit-datetime-edit-millisecond-field, ::-webkit-datetime-edit-second=
-field { padding-block: 0px; }
  ::-webkit-datetime-edit-meridiem-field { padding-block: 0px; }
  button, input:where([type=3D"button"], [type=3D"reset"], [type=3D"submit"=
]) { appearance: button; }
  ::file-selector-button { appearance: button; }
  ::-webkit-inner-spin-button, ::-webkit-outer-spin-button { height: auto; =
}
  [hidden]:where(:not([hidden=3D"until-found"])) { display: none !important=
; }
  * { border-color: var(--border); outline-color: var(--ring); }
  @supports (color:color-mix(in lab,red,red)) {
  * { outline-color: color-mix(in oklab,var(--ring)50%,transparent); }
}
  body { background-color: var(--background); color: var(--foreground); }
}

@layer components;

@layer utilities {
  .\[pointer-events\:all\] { pointer-events: all; }
  .pointer-events-auto { pointer-events: auto; }
  .pointer-events-none { pointer-events: none; }
  .invisible { visibility: hidden; }
  .visible { visibility: visible; }
  .sr-only { clip: rect(0px, 0px, 0px, 0px); white-space: nowrap; border-wi=
dth: 0px; width: 1px; height: 1px; margin: -1px; padding: 0px; position: ab=
solute; overflow: hidden; }
  .\!sticky { position: sticky !important; }
  .absolute { position: absolute; }
  .fixed { position: fixed; }
  .relative { position: relative; }
  .sticky { position: sticky; }
  .inset-0 { inset: calc(var(--spacing)*0); }
  .inset-y-0 { inset-block: calc(var(--spacing)*0); }
  .-top-1 { top: calc(var(--spacing)*-1); }
  .top-0 { top: calc(var(--spacing)*0); }
  .top-1 { top: calc(var(--spacing)*1); }
  .top-1\/2 { top: 50%; }
  .top-2 { top: calc(var(--spacing)*2); }
  .top-3 { top: calc(var(--spacing)*3); }
  .top-20 { top: calc(var(--spacing)*20); }
  .top-\[50\%\] { top: 50%; }
  .top-full { top: 100%; }
  .-right-1 { right: calc(var(--spacing)*-1); }
  .right-0 { right: calc(var(--spacing)*0); }
  .right-1 { right: calc(var(--spacing)*1); }
  .right-2 { right: calc(var(--spacing)*2); }
  .right-3 { right: calc(var(--spacing)*3); }
  .bottom-0 { bottom: calc(var(--spacing)*0); }
  .bottom-2 { bottom: calc(var(--spacing)*2); }
  .left-0 { left: calc(var(--spacing)*0); }
  .left-2 { left: calc(var(--spacing)*2); }
  .left-3 { left: calc(var(--spacing)*3); }
  .left-\[7px\] { left: 7px; }
  .left-\[50\%\] { left: 50%; }
  .z-10 { z-index: 10; }
  .z-20 { z-index: 20; }
  .z-30 { z-index: 30; }
  .z-40 { z-index: 40; }
  .z-50 { z-index: 50; }
  .z-\[-1\] { z-index: -1; }
  .col-span-full { grid-column: 1 / -1; }
  .container { width: 100%; }
  @media (min-width: 40rem) {
  .container { max-width: 40rem; }
}
  @media (min-width: 48rem) {
  .container { max-width: 48rem; }
}
  @media (min-width: 64rem) {
  .container { max-width: 64rem; }
}
  @media (min-width: 80rem) {
  .container { max-width: 80rem; }
}
  @media (min-width: 96rem) {
  .container { max-width: 96rem; }
}
  .-mx-1 { margin-inline: calc(var(--spacing)*-1); }
  .mx-1 { margin-inline: calc(var(--spacing)*1); }
  .mx-4 { margin-inline: calc(var(--spacing)*4); }
  .mx-auto { margin-inline: auto; }
  .my-1 { margin-block: calc(var(--spacing)*1); }
  .my-4 { margin-block: calc(var(--spacing)*4); }
  .my-6 { margin-block: calc(var(--spacing)*6); }
  .my-auto { margin-block: auto; }
  .prose { color: var(--color-text-primary); --tw-prose-body: oklch(37.3% .=
034 259.733); --tw-prose-headings: oklch(21% .034 264.665); --tw-prose-lead=
: oklch(44.6% .03 256.802); --tw-prose-links: oklch(21% .034 264.665); --tw=
-prose-bold: oklch(21% .034 264.665); --tw-prose-counters: oklch(55.1% .027=
 264.364); --tw-prose-bullets: oklch(87.2% .01 258.338); --tw-prose-hr: okl=
ch(92.8% .006 264.531); --tw-prose-quotes: oklch(21% .034 264.665); --tw-pr=
ose-quote-borders: oklch(92.8% .006 264.531); --tw-prose-captions: oklch(55=
.1% .027 264.364); --tw-prose-kbd: oklch(21% .034 264.665); --tw-prose-kbd-=
shadows: NaN NaN NaN; --tw-prose-code: oklch(21% .034 264.665); --tw-prose-=
pre-code: oklch(92.8% .006 264.531); --tw-prose-pre-bg: oklch(27.8% .033 25=
6.848); --tw-prose-th-borders: oklch(87.2% .01 258.338); --tw-prose-td-bord=
ers: oklch(92.8% .006 264.531); --tw-prose-invert-body: oklch(87.2% .01 258=
.338); --tw-prose-invert-headings: #fff; --tw-prose-invert-lead: oklch(70.7=
% .022 261.325); --tw-prose-invert-links: #fff; --tw-prose-invert-bold: #ff=
f; --tw-prose-invert-counters: oklch(70.7% .022 261.325); --tw-prose-invert=
-bullets: oklch(44.6% .03 256.802); --tw-prose-invert-hr: oklch(37.3% .034 =
259.733); --tw-prose-invert-quotes: oklch(96.7% .003 264.542); --tw-prose-i=
nvert-quote-borders: oklch(37.3% .034 259.733); --tw-prose-invert-captions:=
 oklch(70.7% .022 261.325); --tw-prose-invert-kbd: #fff; --tw-prose-invert-=
kbd-shadows: 255 255 255; --tw-prose-invert-code: #fff; --tw-prose-invert-p=
re-code: oklch(87.2% .01 258.338); --tw-prose-invert-pre-bg: #00000080; --t=
w-prose-invert-th-borders: oklch(44.6% .03 256.802); --tw-prose-invert-td-b=
orders: oklch(37.3% .034 259.733); max-width: 65ch; font-size: 1rem; line-h=
eight: 1.75; }
  .prose :where(p):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"=
] *)) { margin-top: 1.25em; margin-bottom: 1.25em; }
  .prose :where([class~=3D"lead"]):not(:where([class~=3D"not-prose"], [clas=
s~=3D"not-prose"] *)) { color: var(--tw-prose-lead); margin-top: 1.2em; mar=
gin-bottom: 1.2em; font-size: 1.25em; line-height: 1.6; }
  .prose :where(a):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"=
] *)) { color: var(--color-pacific); font-weight: 500; text-decoration: und=
erline; }
  .prose :where(a):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"=
] *)):hover { color: var(--color-ray); }
  .prose :where(strong):not(:where([class~=3D"not-prose"], [class~=3D"not-p=
rose"] *)) { color: var(--color-text-primary); font-weight: 600; }
  .prose :where(a strong):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)), .prose :where(blockquote strong):not(:where([class~=3D"not-pr=
ose"], [class~=3D"not-prose"] *)), .prose :where(thead th strong):not(:wher=
e([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { color: inherit; }
  .prose :where(ol):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; padding-inline-start: 1=
.625em; list-style-type: decimal; }
  .prose :where(ol[type=3D"A"]):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { list-style-type: upper-alpha; }
  .prose :where(ol[type=3D"a"]):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { list-style-type: lower-alpha; }
  .prose :where():not(:where([class~=3D"not-prose"], [class~=3D"not-prose"]=
 *)) { list-style-type: upper-alpha; }
  .prose :where():not(:where([class~=3D"not-prose"], [class~=3D"not-prose"]=
 *)) { list-style-type: lower-alpha; }
  .prose :where(ol[type=3D"I"]):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { list-style-type: upper-roman; }
  .prose :where(ol[type=3D"i"]):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { list-style-type: lower-roman; }
  .prose :where():not(:where([class~=3D"not-prose"], [class~=3D"not-prose"]=
 *)) { list-style-type: upper-roman; }
  .prose :where():not(:where([class~=3D"not-prose"], [class~=3D"not-prose"]=
 *)) { list-style-type: lower-roman; }
  .prose :where(ol[type=3D"1"]):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { list-style-type: decimal; }
  .prose :where(ul):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; padding-inline-start: 1=
.625em; list-style-type: disc; }
  .prose :where(ol > li):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *))::marker { color: var(--tw-prose-counters); font-weight: 400; }
  .prose :where(ul > li):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *))::marker { color: var(--tw-prose-bullets); }
  .prose :where(dt):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { color: var(--tw-prose-headings); margin-top: 1.25em; font-weight: =
600; }
  .prose :where(hr):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { border-color: var(--tw-prose-hr); border-top-width: 1px; margin-to=
p: 3em; margin-bottom: 3em; }
  .prose :where(blockquote):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { color: var(--color-text-secondary); border-inline-start-wi=
dth: 0.25rem; border-inline-start-color: var(--tw-prose-quote-borders); quo=
tes: "=E2=80=9C" "=E2=80=9D" "=E2=80=98" "=E2=80=99"; border-left-color: va=
r(--color-border); margin-top: 1.6em; margin-bottom: 1.6em; padding-inline-=
start: 1em; font-style: italic; font-weight: 500; }
  .prose :where(blockquote p:first-of-type):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *))::before { content: open-quote; }
  .prose :where(blockquote p:last-of-type):not(:where([class~=3D"not-prose"=
], [class~=3D"not-prose"] *))::after { content: close-quote; }
  .prose :where(h1):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { color: var(--color-text-primary); margin-top: 0px; margin-bottom: =
0.888889em; font-size: 2.25em; font-weight: 800; line-height: 1.11111; }
  .prose :where(h1 strong):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *)) { color: inherit; font-weight: 900; }
  .prose :where(h2):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { color: var(--color-text-primary); margin-top: 2em; margin-bottom: =
1em; font-size: 1.5em; font-weight: 700; line-height: 1.33333; }
  .prose :where(h2 strong):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *)) { color: inherit; font-weight: 800; }
  .prose :where(h3):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { color: var(--color-text-primary); margin-top: 1.6em; margin-bottom=
: 0.6em; font-size: 1.25em; font-weight: 600; line-height: 1.6; }
  .prose :where(h3 strong):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *)) { color: inherit; font-weight: 700; }
  .prose :where(h4):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { color: var(--color-text-primary); margin-top: 1.5em; margin-bottom=
: 0.5em; font-weight: 600; line-height: 1.5; }
  .prose :where(h4 strong):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *)) { color: inherit; font-weight: 700; }
  .prose :where(img):not(:where([class~=3D"not-prose"], [class~=3D"not-pros=
e"] *)) { margin-top: 2em; margin-bottom: 2em; }
  .prose :where(picture):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { margin-top: 2em; margin-bottom: 2em; display: block; }
  .prose :where(video):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { margin-top: 2em; margin-bottom: 2em; }
  .prose :where(kbd):not(:where([class~=3D"not-prose"], [class~=3D"not-pros=
e"] *)) { color: var(--tw-prose-kbd); box-shadow: 0 0 0 1px rgb(var(--tw-pr=
ose-kbd-shadows)/10%),0 3px 0 rgb(var(--tw-prose-kbd-shadows)/10%); padding=
-top: 0.1875em; padding-inline: 0.375em; padding-bottom: 0.1875em; border-r=
adius: 0.3125rem; font-family: inherit; font-size: 0.875em; font-weight: 50=
0; }
  .prose :where(code):not(:where([class~=3D"not-prose"], [class~=3D"not-pro=
se"] *)) { color: var(--color-text-primary); font-size: 0.875em; font-weigh=
t: 600; }
  .prose :where(code):not(:where([class~=3D"not-prose"], [class~=3D"not-pro=
se"] *))::after, .prose :where(code):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *))::before { content: "`"; }
  .prose :where(a code):not(:where([class~=3D"not-prose"], [class~=3D"not-p=
rose"] *)), .prose :where(h1 code):not(:where([class~=3D"not-prose"], [clas=
s~=3D"not-prose"] *)) { color: inherit; }
  .prose :where(h2 code):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { color: inherit; font-size: 0.875em; }
  .prose :where(h3 code):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { color: inherit; font-size: 0.9em; }
  .prose :where(blockquote code):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)), .prose :where(h4 code):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *)), .prose :where(thead th code):not(:where([cl=
ass~=3D"not-prose"], [class~=3D"not-prose"] *)) { color: inherit; }
  .prose :where(pre):not(:where([class~=3D"not-prose"], [class~=3D"not-pros=
e"] *)) { color: var(--tw-prose-pre-code); background-color: var(--color-ni=
ght); padding-top: 0.857143em; padding-inline: 1.14286em; padding-bottom: 0=
.857143em; border-radius: 0.375rem; margin-top: 1.71429em; margin-bottom: 1=
.71429em; font-size: 0.875em; font-weight: 400; line-height: 1.71429; overf=
low-x: auto; }
  .prose :where(pre code):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { font-weight: inherit; color: inherit; font-size: inherit; fo=
nt-family: inherit; line-height: inherit; background-color: rgba(0, 0, 0, 0=
); border-width: 0px; border-radius: 0px; padding: 0px; }
  .prose :where(pre code):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *))::after, .prose :where(pre code):not(:where([class~=3D"not-pros=
e"], [class~=3D"not-prose"] *))::before { content: none; }
  .prose :where(table):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { table-layout: auto; width: 100%; margin-top: 2em; margin-bottom=
: 2em; font-size: 0.875em; line-height: 1.71429; }
  .prose :where(thead):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { border-bottom-width: 1px; border-bottom-color: var(--tw-prose-t=
h-borders); }
  .prose :where(thead th):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { color: var(--tw-prose-headings); vertical-align: bottom; pad=
ding-inline: 0.571429em; padding-bottom: 0.571429em; font-weight: 600; }
  .prose :where(tbody tr):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { border-bottom-width: 1px; border-bottom-color: var(--tw-pros=
e-td-borders); }
  .prose :where(tbody tr:last-child):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *)) { border-bottom-width: 0px; }
  .prose :where(tbody td):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { vertical-align: baseline; }
  .prose :where(tfoot):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { border-top-width: 1px; border-top-color: var(--tw-prose-th-bord=
ers); }
  .prose :where(tfoot td):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { vertical-align: top; }
  .prose :where(th, td):not(:where([class~=3D"not-prose"], [class~=3D"not-p=
rose"] *)) { text-align: start; }
  .prose :where(figure > *):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }
  .prose :where(figcaption):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { color: var(--tw-prose-captions); margin-top: 0.857143em; f=
ont-size: 0.875em; line-height: 1.42857; }
  .prose :where(picture > img):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }
  .prose :where(li):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { margin-top: 0.5em; margin-bottom: 0.5em; }
  .prose :where(ol > li):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)), .prose :where(ul > li):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { padding-inline-start: 0.375em; }
  .prose :where(.prose > ul > li p):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 0.75em; margin-bottom: 0.75em; }
  .prose :where(.prose > ul > li > p:first-child):not(:where([class~=3D"not=
-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.25em; }
  .prose :where(.prose > ul > li > p:last-child):not(:where([class~=3D"not-=
prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.25em; }
  .prose :where(.prose > ol > li > p:first-child):not(:where([class~=3D"not=
-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.25em; }
  .prose :where(.prose > ol > li > p:last-child):not(:where([class~=3D"not-=
prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.25em; }
  .prose :where(ul ul, ul ol, ol ul, ol ol):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *)) { margin-top: 0.75em; margin-bottom: 0.75em;=
 }
  .prose :where(dl):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; }
  .prose :where(dd):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { margin-top: 0.5em; padding-inline-start: 1.625em; }
  .prose :where(h2 + *):not(:where([class~=3D"not-prose"], [class~=3D"not-p=
rose"] *)), .prose :where(h3 + *):not(:where([class~=3D"not-prose"], [class=
~=3D"not-prose"] *)), .prose :where(h4 + *):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *)), .prose :where(hr + *):not(:where([class~=3D=
"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 0px; }
  .prose :where(thead th:first-child):not(:where([class~=3D"not-prose"], [c=
lass~=3D"not-prose"] *)) { padding-inline-start: 0px; }
  .prose :where(thead th:last-child):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *)) { padding-inline-end: 0px; }
  .prose :where(tbody td, tfoot td):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { padding-top: 0.571429em; padding-inline: 0.571429e=
m; padding-bottom: 0.571429em; }
  .prose :where(tbody td:first-child, tfoot td:first-child):not(:where([cla=
ss~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-start: 0px;=
 }
  .prose :where(tbody td:last-child, tfoot td:last-child):not(:where([class=
~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-end: 0px; }
  .prose :where(figure):not(:where([class~=3D"not-prose"], [class~=3D"not-p=
rose"] *)) { margin-top: 2em; margin-bottom: 2em; }
  .prose :where(.prose > :first-child):not(:where([class~=3D"not-prose"], [=
class~=3D"not-prose"] *)) { margin-top: 0px; }
  .prose :where(.prose > :last-child):not(:where([class~=3D"not-prose"], [c=
lass~=3D"not-prose"] *)) { margin-bottom: 0px; }
  .prose :where(th):not(:where([class~=3D"not-prose"], [class~=3D"not-prose=
"] *)) { color: var(--color-text-primary); }
  .prose-xs { font-size: 0.8125rem; line-height: 1.1rem; }
  .prose-xs :where(p):not(:where([class~=3D"not-prose"], [class~=3D"not-pro=
se"] *)) { margin-top: 0px; margin-bottom: 0.25rem; }
  .prose-xs :where(ul):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { margin-top: 0px; margin-bottom: 0.5em; }
  .prose-xs :where(li):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *))::marker { color: var(--color-neutral-300); }
  .prose-xs :where(h1):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { margin-top: 0.5em; margin-bottom: 0.25em; font-size: 1.2em; }
  .prose-xs :where(h2):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { margin-top: 0.4em; margin-bottom: 0.2em; font-size: 1.1em; }
  .prose-xs :where(h3):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { margin-top: 0.3em; margin-bottom: 0.15em; font-size: 1em; }
  .prose-xs :where(h4):not(:where([class~=3D"not-prose"], [class~=3D"not-pr=
ose"] *)) { margin-top: 0.25em; margin-bottom: 0.1em; font-size: 0.9em; }
  .mt-0\.5 { margin-top: calc(var(--spacing)*.5); }
  .mt-1 { margin-top: calc(var(--spacing)*1); }
  .mt-2 { margin-top: calc(var(--spacing)*2); }
  .mt-3 { margin-top: calc(var(--spacing)*3); }
  .mt-4 { margin-top: calc(var(--spacing)*4); }
  .mt-6 { margin-top: calc(var(--spacing)*6); }
  .mt-8 { margin-top: calc(var(--spacing)*8); }
  .mt-16 { margin-top: calc(var(--spacing)*16); }
  .mt-auto { margin-top: auto; }
  .mr-1 { margin-right: calc(var(--spacing)*1); }
  .mr-1\.5 { margin-right: calc(var(--spacing)*1.5); }
  .mr-2 { margin-right: calc(var(--spacing)*2); }
  .mr-3 { margin-right: calc(var(--spacing)*3); }
  .mr-\[0\.5px\] { margin-right: 0.5px; }
  .mb-1 { margin-bottom: calc(var(--spacing)*1); }
  .mb-2 { margin-bottom: calc(var(--spacing)*2); }
  .mb-3 { margin-bottom: calc(var(--spacing)*3); }
  .mb-4 { margin-bottom: calc(var(--spacing)*4); }
  .mb-5 { margin-bottom: calc(var(--spacing)*5); }
  .mb-6 { margin-bottom: calc(var(--spacing)*6); }
  .mb-8 { margin-bottom: calc(var(--spacing)*8); }
  .mb-10 { margin-bottom: calc(var(--spacing)*10); }
  .ml-1 { margin-left: calc(var(--spacing)*1); }
  .ml-1\.5 { margin-left: calc(var(--spacing)*1.5); }
  .ml-2 { margin-left: calc(var(--spacing)*2); }
  .ml-3 { margin-left: calc(var(--spacing)*3); }
  .ml-6 { margin-left: calc(var(--spacing)*6); }
  .ml-\[5px\] { margin-left: 5px; }
  .ml-auto { margin-left: auto; }
  .ml-px { margin-left: 1px; }
  .line-clamp-1 { -webkit-line-clamp: 1; }
  .line-clamp-1, .line-clamp-2 { -webkit-box-orient: vertical; display: -we=
bkit-box; overflow: hidden; }
  .line-clamp-2 { -webkit-line-clamp: 2; }
  .block { display: block; }
  .contents { display: contents; }
  .flex { display: flex; }
  .grid { display: grid; }
  .hidden { display: none; }
  .inline { display: inline; }
  .inline-block { display: inline-block; }
  .inline-flex { display: inline-flex; }
  .aspect-square { aspect-ratio: 1 / 1; }
  .size-2 { width: calc(var(--spacing)*2); height: calc(var(--spacing)*2); =
}
  .size-2\.5 { width: calc(var(--spacing)*2.5); height: calc(var(--spacing)=
*2.5); }
  .size-3 { width: calc(var(--spacing)*3); height: calc(var(--spacing)*3); =
}
  .size-3\.5 { width: calc(var(--spacing)*3.5); height: calc(var(--spacing)=
*3.5); }
  .size-4 { width: calc(var(--spacing)*4); height: calc(var(--spacing)*4); =
}
  .size-5 { width: calc(var(--spacing)*5); height: calc(var(--spacing)*5); =
}
  .size-9 { width: calc(var(--spacing)*9); height: calc(var(--spacing)*9); =
}
  .h-0\.5 { height: calc(var(--spacing)*.5); }
  .h-1\.5 { height: calc(var(--spacing)*1.5); }
  .h-2 { height: calc(var(--spacing)*2); }
  .h-2\.5 { height: calc(var(--spacing)*2.5); }
  .h-3 { height: calc(var(--spacing)*3); }
  .h-3\.5 { height: calc(var(--spacing)*3.5); }
  .h-4 { height: calc(var(--spacing)*4); }
  .h-5 { height: calc(var(--spacing)*5); }
  .h-6 { height: calc(var(--spacing)*6); }
  .h-7 { height: calc(var(--spacing)*7); }
  .h-8 { height: calc(var(--spacing)*8); }
  .h-9 { height: calc(var(--spacing)*9); }
  .h-10 { height: calc(var(--spacing)*10); }
  .h-12 { height: calc(var(--spacing)*12); }
  .h-14 { height: calc(var(--spacing)*14); }
  .h-16 { height: calc(var(--spacing)*16); }
  .h-32 { height: calc(var(--spacing)*32); }
  .h-\[1px\] { height: 1px; }
  .h-\[2px\] { height: 2px; }
  .h-auto { height: auto; }
  .h-fit { height: fit-content; }
  .h-full { height: 100%; }
  .h-px { height: 1px; }
  .h-screen { height: 100vh; }
  .max-h-80 { max-height: calc(var(--spacing)*80); }
  .max-h-fit { max-height: fit-content; }
  .max-h-full { max-height: 100%; }
  .max-h-screen { max-height: 100vh; }
  .min-h-0 { min-height: calc(var(--spacing)*0); }
  .min-h-32 { min-height: calc(var(--spacing)*32); }
  .min-h-\[240px\] { min-height: 240px; }
  .min-h-full { min-height: 100%; }
  .min-h-screen { min-height: 100vh; }
  .w-0 { width: calc(var(--spacing)*0); }
  .w-1\.5 { width: calc(var(--spacing)*1.5); }
  .w-1\/4 { width: 25%; }
  .w-2 { width: calc(var(--spacing)*2); }
  .w-2\.5 { width: calc(var(--spacing)*2.5); }
  .w-3 { width: calc(var(--spacing)*3); }
  .w-3\.5 { width: calc(var(--spacing)*3.5); }
  .w-3\/4 { width: 75%; }
  .w-4 { width: calc(var(--spacing)*4); }
  .w-5 { width: calc(var(--spacing)*5); }
  .w-6 { width: calc(var(--spacing)*6); }
  .w-8 { width: calc(var(--spacing)*8); }
  .w-10 { width: calc(var(--spacing)*10); }
  .w-11 { width: calc(var(--spacing)*11); }
  .w-12 { width: calc(var(--spacing)*12); }
  .w-16 { width: calc(var(--spacing)*16); }
  .w-20 { width: calc(var(--spacing)*20); }
  .w-24 { width: calc(var(--spacing)*24); }
  .w-32 { width: calc(var(--spacing)*32); }
  .w-40 { width: calc(var(--spacing)*40); }
  .w-48 { width: calc(var(--spacing)*48); }
  .w-64 { width: calc(var(--spacing)*64); }
  .w-72 { width: calc(var(--spacing)*72); }
  .w-\[2px\] { width: 2px; }
  .w-fit { width: fit-content; }
  .w-full { width: 100%; }
  .\!max-w-none { max-width: none !important; }
  .max-w-2xl { max-width: var(--container-2xl); }
  .max-w-3xl { max-width: var(--container-3xl); }
  .max-w-5xl { max-width: var(--container-5xl); }
  .max-w-6xl { max-width: var(--container-6xl); }
  .max-w-\[90vw\] { max-width: 90vw; }
  .max-w-\[250px\] { max-width: 250px; }
  .max-w-\[calc\(100\%-2rem\)\] { max-width: calc(100% - 2rem); }
  .max-w-full { max-width: 100%; }
  .max-w-md { max-width: var(--container-md); }
  .max-w-none { max-width: none; }
  .max-w-xl { max-width: var(--container-xl); }
  .min-w-0 { min-width: calc(var(--spacing)*0); }
  .min-w-5 { min-width: calc(var(--spacing)*5); }
  .min-w-\[8rem\] { min-width: 8rem; }
  .min-w-\[20px\] { min-width: 20px; }
  .min-w-\[200px\] { min-width: 200px; }
  .min-w-max { min-width: max-content; }
  .min-w-xs { min-width: var(--container-xs); }
  .flex-1 { flex: 1 1 0%; }
  .flex-none { flex: 0 0 auto; }
  .flex-shrink { flex-shrink: 1; }
  .flex-shrink-0, .shrink-0 { flex-shrink: 0; }
  .flex-grow, .flex-grow-1, .grow { flex-grow: 1; }
  .origin-\(--radix-popover-content-transform-origin\) { transform-origin: =
var(--radix-popover-content-transform-origin); }
  .origin-\(--radix-tooltip-content-transform-origin\) { transform-origin: =
var(--radix-tooltip-content-transform-origin); }
  .-translate-x-\[2px\] { --tw-translate-x: calc(2px*-1); }
  .-translate-x-\[2px\], .translate-x-\[-50\%\] { translate: var(--tw-trans=
late-x)var(--tw-translate-y); }
  .translate-x-\[-50\%\] { --tw-translate-x: -50%; }
  .-translate-y-1\/2 { --tw-translate-y: calc(calc(1/2*100%)*-1); }
  .-translate-y-1\/2, .translate-y-\[-50\%\] { translate: var(--tw-translat=
e-x)var(--tw-translate-y); }
  .translate-y-\[-50\%\] { --tw-translate-y: -50%; }
  .translate-y-\[calc\(-50\%_-_2px\)\] { --tw-translate-y: calc(-50% - 2px)=
; translate: var(--tw-translate-x)var(--tw-translate-y); }
  .-rotate-90 { rotate: -90deg; }
  .rotate-45 { rotate: 45deg; }
  .rotate-90 { rotate: 90deg; }
  .transform { transform: var(--tw-rotate-x,)var(--tw-rotate-y,)var(--tw-ro=
tate-z,)var(--tw-skew-x,)var(--tw-skew-y,); }
  .animate-bounce { animation: var(--animate-bounce); }
  .animate-in { animation: enter var(--tw-animation-duration,var(--tw-durat=
ion,.15s))var(--tw-ease,ease)var(--tw-animation-delay,0s)var(--tw-animation=
-iteration-count,1)var(--tw-animation-direction,normal)var(--tw-animation-f=
ill-mode,none); }
  .animate-ping { animation: var(--animate-ping); }
  .animate-pulse { animation: var(--animate-pulse); }
  .animate-shine { animation: var(--animate-shine); }
  .animate-spin { animation: var(--animate-spin); }
  .cursor-default { cursor: default; }
  .cursor-help { cursor: help; }
  .cursor-not-allowed { cursor: not-allowed; }
  .cursor-pointer { cursor: pointer; }
  .resize { resize: both; }
  .resize-none { resize: none; }
  .list-disc { list-style-type: disc; }
  .grid-cols-1 { grid-template-columns: repeat(1, minmax(0px, 1fr)); }
  .grid-rows-\[0fr\] { grid-template-rows: 0fr; }
  .grid-rows-\[1fr\] { grid-template-rows: 1fr; }
  .flex-col { flex-direction: column; }
  .flex-row { flex-direction: row; }
  .flex-wrap { flex-wrap: wrap; }
  .items-center { align-items: center; }
  .items-start { align-items: flex-start; }
  .items-stretch { align-items: stretch; }
  .justify-between { justify-content: space-between; }
  .justify-center { justify-content: center; }
  .justify-end { justify-content: flex-end; }
  .gap-0 { gap: calc(var(--spacing)*0); }
  .gap-0\.5 { gap: calc(var(--spacing)*.5); }
  .gap-1 { gap: calc(var(--spacing)*1); }
  .gap-1\.5 { gap: calc(var(--spacing)*1.5); }
  .gap-2 { gap: calc(var(--spacing)*2); }
  .gap-3 { gap: calc(var(--spacing)*3); }
  .gap-4 { gap: calc(var(--spacing)*4); }
  .gap-6 { gap: calc(var(--spacing)*6); }
  .gap-8 { gap: calc(var(--spacing)*8); }
  .gap-\[1px\], .gap-px { gap: 1px; }
  :where(.space-y-1 > :not(:last-child)) { --tw-space-y-reverse: 0; margin-=
block-start: calc(calc(var(--spacing)*1)*var(--tw-space-y-reverse)); margin=
-block-end: calc(calc(var(--spacing)*1)*calc(1 - var(--tw-space-y-reverse))=
); }
  :where(.space-y-2 > :not(:last-child)) { --tw-space-y-reverse: 0; margin-=
block-start: calc(calc(var(--spacing)*2)*var(--tw-space-y-reverse)); margin=
-block-end: calc(calc(var(--spacing)*2)*calc(1 - var(--tw-space-y-reverse))=
); }
  :where(.space-y-3 > :not(:last-child)) { --tw-space-y-reverse: 0; margin-=
block-start: calc(calc(var(--spacing)*3)*var(--tw-space-y-reverse)); margin=
-block-end: calc(calc(var(--spacing)*3)*calc(1 - var(--tw-space-y-reverse))=
); }
  .truncate { text-overflow: ellipsis; white-space: nowrap; overflow: hidde=
n; }
  .overflow-auto { overflow: auto; }
  .overflow-hidden { overflow: hidden; }
  .overflow-x-auto { overflow-x: auto; }
  .overflow-x-hidden { overflow-x: hidden; }
  .overflow-y-auto { overflow-y: auto; }
  .overflow-y-hidden { overflow-y: hidden; }
  .scroll-smooth { scroll-behavior: smooth; }
  .rounded { border-radius: 0.25rem; }
  .rounded-\[2px\] { border-radius: 2px; }
  .rounded-\[4px\] { border-radius: 4px; }
  .rounded-full { border-radius: 3.40282e+38px; }
  .rounded-lg { border-radius: var(--radius); }
  .rounded-md { border-radius: calc(var(--radius) - 2px); }
  .rounded-none { border-radius: 0px; }
  .rounded-sm { border-radius: calc(var(--radius) - 4px); }
  .rounded-xl { border-radius: calc(var(--radius) + 4px); }
  .rounded-xs { border-radius: var(--radius-xs); }
  .rounded-t-\[6px\] { border-top-left-radius: 6px; border-top-right-radius=
: 6px; }
  .rounded-t-sm { border-top-left-radius: calc(var(--radius) - 4px); border=
-top-right-radius: calc(var(--radius) - 4px); }
  .rounded-l { border-top-left-radius: 0.25rem; border-bottom-left-radius: =
0.25rem; }
  .rounded-r { border-top-right-radius: 0.25rem; border-bottom-right-radius=
: 0.25rem; }
  .rounded-b-md { border-bottom-right-radius: calc(var(--radius) - 2px); bo=
rder-bottom-left-radius: calc(var(--radius) - 2px); }
  .border { border-style: var(--tw-border-style); border-width: 1px; }
  .border-2 { border-style: var(--tw-border-style); border-width: 2px; }
  .border-4 { border-style: var(--tw-border-style); border-width: 4px; }
  .border-\[0\.5px\] { border-style: var(--tw-border-style); border-width: =
0.5px; }
  .border-t { border-top-style: var(--tw-border-style); border-top-width: 1=
px; }
  .border-t-\[0\.5px\] { border-top-style: var(--tw-border-style); border-t=
op-width: 0.5px; }
  .border-r { border-right-style: var(--tw-border-style); border-right-widt=
h: 1px; }
  .border-b { border-bottom-style: var(--tw-border-style); border-bottom-wi=
dth: 1px; }
  .border-l { border-left-style: var(--tw-border-style); border-left-width:=
 1px; }
  .border-l-2 { border-left-style: var(--tw-border-style); border-left-widt=
h: 2px; }
  .border-dashed { --tw-border-style: dashed; border-style: dashed; }
  .border-none { --tw-border-style: none; border-style: none; }
  .\!border-\[color-mix\(in_srgb\,_var\(--border\)_90\%\,\#000\)\] { border=
-color: var(--border) !important; }
  @supports (color:color-mix(in lab,red,red)) {
  .\!border-\[color-mix\(in_srgb\,_var\(--border\)_90\%\,\#000\)\] { border=
-color: color-mix(in srgb,var(--border)90%,#000) !important; }
}
  .border-\[\#2a2a2a\] { border-color: rgb(42, 42, 42); }
  .border-\[\#3a3a3a\] { border-color: rgb(58, 58, 58); }
  .border-\[\#8F8F8F\]\/30 { border-color: oklab(0.650041 2.98023e-8 0 / 0.=
3); }
  .border-\[\#333333\] { border-color: rgb(51, 51, 51); }
  .border-\[\#353535\] { border-color: rgb(53, 53, 53); }
  .border-\[\#bb6dff90\] { border-color: rgba(187, 109, 255, 0.565); }
  .border-\[\#c0c0c0\] { border-color: silver; }
  .border-\[\#d0d0d0\] { border-color: rgb(208, 208, 208); }
  .border-\[\#d1d1d1\] { border-color: rgb(209, 209, 209); }
  .border-\[\#dddddd\] { border-color: rgb(221, 221, 221); }
  .border-\[\#e0e0e0\] { border-color: rgb(224, 224, 224); }
  .border-\[var\(--color-border\)\] { border-color: var(--color-border); }
  .border-blue-300 { border-color: var(--color-blue-300); }
  .border-blue-500 { border-color: var(--color-blue-500); }
  .border-blue-800 { border-color: var(--color-blue-800); }
  .border-border { border-color: var(--border); }
  .border-cyan-300\/30 { border-color: rgba(83, 234, 253, 0.3); }
  @supports (color:color-mix(in lab,red,red)) {
  .border-cyan-300\/30 { border-color: color-mix(in oklab,var(--color-cyan-=
300)30%,transparent); }
}
  .border-gray-300 { border-color: var(--color-gray-300); }
  .border-green-600 { border-color: var(--color-green-600); }
  .border-indigo-300\/20 { border-color: rgba(164, 179, 255, 0.2); }
  @supports (color:color-mix(in lab,red,red)) {
  .border-indigo-300\/20 { border-color: color-mix(in oklab,var(--color-ind=
igo-300)20%,transparent); }
}
  .border-input { border-color: var(--input); }
  .border-neutral-200 { border-color: var(--color-neutral-200); }
  .border-neutral-700 { border-color: var(--color-neutral-700); }
  .border-red-300 { border-color: var(--color-red-300); }
  .border-red-500 { border-color: var(--color-red-500); }
  .border-transparent { border-color: rgba(0, 0, 0, 0); }
  .border-t-blue-500 { border-top-color: var(--color-blue-500); }
  .border-t-white\/90 { border-top-color: rgba(255, 255, 255, 0.9); }
  @supports (color:color-mix(in lab,red,red)) {
  .border-t-white\/90 { border-top-color: color-mix(in oklab,var(--color-wh=
ite)90%,transparent); }
}
  .border-r-border { border-right-color: var(--border); }
  .border-b-border, .border-b-border\/50 { border-bottom-color: var(--borde=
r); }
  @supports (color:color-mix(in lab,red,red)) {
  .border-b-border\/50 { border-bottom-color: color-mix(in oklab,var(--bord=
er)50%,transparent); }
}
  .border-l-border { border-left-color: var(--border); }
  .\!bg-\[color-mix\(in_srgb\,_var\(--border\)_95\%\,\#000\)\] { background=
-color: var(--border) !important; }
  @supports (color:color-mix(in lab,red,red)) {
  .\!bg-\[color-mix\(in_srgb\,_var\(--border\)_95\%\,\#000\)\] { background=
-color: color-mix(in srgb,var(--border)95%,#000) !important; }
}
  .bg-\[\#6096FF\]\/10 { background-color: oklab(0.685011 -0.0219935 -0.164=
058 / 0.1); }
  .bg-\[\#252525\] { background-color: rgb(37, 37, 37); }
  .bg-\[\#cccccc\] { background-color: rgb(204, 204, 204); }
  .bg-\[\#d0d0d0\] { background-color: rgb(208, 208, 208); }
  .bg-\[\#d5d5d5\] { background-color: rgb(213, 213, 213); }
  .bg-\[\#d8d8d8\] { background-color: rgb(216, 216, 216); }
  .bg-\[\#e0e0e0\] { background-color: rgb(224, 224, 224); }
  .bg-\[\#e5e5e5\] { background-color: rgb(229, 229, 229); }
  .bg-\[\#ef9541\] { background-color: rgb(239, 149, 65); }
  .bg-\[\#ef9541\]\/20 { background-color: oklab(0.74824 0.0720983 0.125982=
 / 0.2); }
  .bg-\[\#ef9541\]\/80 { background-color: oklab(0.74824 0.0720983 0.125982=
 / 0.8); }
  .bg-\[\#f0f0f0\] { background-color: rgb(240, 240, 240); }
  .bg-\[\#f2f1f0\] { background-color: rgb(242, 241, 240); }
  .bg-\[\#f7f7f7\] { background-color: rgb(247, 247, 247); }
  .bg-\[\#f8f8f8\] { background-color: rgb(248, 248, 248); }
  .bg-\[\#fee2e2\] { background-color: rgb(254, 226, 226); }
  .bg-\[\#fffffe\] { background-color: rgb(255, 255, 254); }
  .bg-\[rgb\(26_26_26\)\] { background-color: rgb(26, 26, 26); }
  .bg-accent { background-color: var(--accent); }
  .bg-background { background-color: var(--background); }
  .bg-black { background-color: var(--color-black); }
  .bg-black\/50 { background-color: rgba(0, 0, 0, 0.5); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-black\/50 { background-color: color-mix(in oklab,var(--color-black)50=
%,transparent); }
}
  .bg-black\/70 { background-color: rgba(0, 0, 0, 0.7); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-black\/70 { background-color: color-mix(in oklab,var(--color-black)70=
%,transparent); }
}
  .bg-blue-100 { background-color: var(--color-blue-100); }
  .bg-blue-200 { background-color: var(--color-blue-200); }
  .bg-blue-300 { background-color: var(--color-blue-300); }
  .bg-blue-400 { background-color: var(--color-blue-400); }
  .bg-blue-500 { background-color: var(--color-blue-500); }
  .bg-blue-600 { background-color: var(--color-blue-600); }
  .bg-border, .bg-border\/50 { background-color: var(--border); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-border\/50 { background-color: color-mix(in oklab,var(--border)50%,tr=
ansparent); }
}
  .bg-border\/60 { background-color: var(--border); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-border\/60 { background-color: color-mix(in oklab,var(--border)60%,tr=
ansparent); }
}
  .bg-border\/90 { background-color: var(--border); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-border\/90 { background-color: color-mix(in oklab,var(--border)90%,tr=
ansparent); }
}
  .bg-card { background-color: var(--card); }
  .bg-clay-500 { background-color: var(--clay-500); }
  .bg-codemap-bg { background-color: var(--color-codemap-bg); }
  .bg-component { background-color: var(--bg-component); }
  .bg-component\/70 { background-color: rgba(37, 37, 37, 0.7); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-component\/70 { background-color: color-mix(in oklab,var(--bg-compone=
nt)70%,transparent); }
}
  .bg-current { background-color: currentcolor; }
  .bg-cyan-600 { background-color: var(--color-cyan-600); }
  .bg-destructive { background-color: var(--destructive); }
  .bg-foreground, .bg-foreground\/30 { background-color: var(--foreground);=
 }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-foreground\/30 { background-color: color-mix(in oklab,var(--foregroun=
d)30%,transparent); }
}
  .bg-gray-100 { background-color: var(--color-gray-100); }
  .bg-gray-200 { background-color: var(--color-gray-200); }
  .bg-gray-300 { background-color: var(--color-gray-300); }
  .bg-gray-700 { background-color: var(--color-gray-700); }
  .bg-green-600 { background-color: var(--color-green-600); }
  .bg-green-900\/30 { background-color: rgba(13, 84, 43, 0.3); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-green-900\/30 { background-color: color-mix(in oklab,var(--color-gree=
n-900)30%,transparent); }
}
  .bg-muted { background-color: var(--muted); }
  .bg-neutral-100 { background-color: var(--color-neutral-100); }
  .bg-neutral-200 { background-color: var(--color-neutral-200); }
  .bg-neutral-300 { background-color: var(--color-neutral-300); }
  .bg-neutral-400 { background-color: var(--color-neutral-400); }
  .bg-neutral-400\/10 { background-color: rgba(161, 161, 161, 0.1); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-neutral-400\/10 { background-color: color-mix(in oklab,var(--color-ne=
utral-400)10%,transparent); }
}
  .bg-neutral-600 { background-color: var(--color-neutral-600); }
  .bg-neutral-700 { background-color: var(--color-neutral-700); }
  .bg-neutral-800 { background-color: var(--color-neutral-800); }
  .bg-neutral-800\/80 { background-color: rgba(38, 38, 38, 0.8); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-neutral-800\/80 { background-color: color-mix(in oklab,var(--color-ne=
utral-800)80%,transparent); }
}
  .bg-night { background-color: var(--color-night); }
  .bg-orange-600 { background-color: var(--color-orange-600); }
  .bg-pacific\/10 { background-color: rgba(96, 150, 255, 0.1); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-pacific\/10 { background-color: color-mix(in oklab,var(--color-pacifi=
c)10%,transparent); }
}
  .bg-pacific\/30 { background-color: rgba(96, 150, 255, 0.3); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-pacific\/30 { background-color: color-mix(in oklab,var(--color-pacifi=
c)30%,transparent); }
}
  .bg-popover { background-color: var(--popover); }
  .bg-primary, .bg-primary\/5 { background-color: var(--primary); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-primary\/5 { background-color: color-mix(in oklab,var(--primary)5%,tr=
ansparent); }
}
  .bg-purple-500\/20 { background-color: rgba(172, 75, 255, 0.2); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-purple-500\/20 { background-color: color-mix(in oklab,var(--color-pur=
ple-500)20%,transparent); }
}
  .bg-red-100 { background-color: var(--color-red-100); }
  .bg-red-500\/10 { background-color: rgba(251, 44, 54, 0.1); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-red-500\/10 { background-color: color-mix(in oklab,var(--color-red-50=
0)10%,transparent); }
}
  .bg-red-900\/30 { background-color: rgba(130, 24, 26, 0.3); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-red-900\/30 { background-color: color-mix(in oklab,var(--color-red-90=
0)30%,transparent); }
}
  .bg-secondary { background-color: var(--bg-secondary); }
  .bg-surface { background-color: var(--bg-surface); }
  .bg-transparent { background-color: rgba(0, 0, 0, 0); }
  .bg-white { background-color: var(--color-white); }
  .bg-white\/70 { background-color: rgba(255, 255, 255, 0.7); }
  @supports (color:color-mix(in lab,red,red)) {
  .bg-white\/70 { background-color: color-mix(in oklab,var(--color-white)70=
%,transparent); }
}
  .bg-yellow-600 { background-color: var(--color-yellow-600); }
  .bg-gradient-to-r { --tw-gradient-position: to right in oklab; background=
-image: linear-gradient(var(--tw-gradient-stops)); }
  .from-\[\#3969CB\] { --tw-gradient-from: #3969cb; --tw-gradient-stops: va=
r(--tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-fro=
m)var(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-t=
o-position)); }
  .via-\[\#0295DF\] { --tw-gradient-via: #0295df; --tw-gradient-via-stops: =
var(--tw-gradient-position),var(--tw-gradient-from)var(--tw-gradient-from-p=
osition),var(--tw-gradient-via)var(--tw-gradient-via-position),var(--tw-gra=
dient-to)var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-grad=
ient-via-stops); }
  .to-\[\#21C29B\] { --tw-gradient-to: #21c29b; --tw-gradient-stops: var(--=
tw-gradient-via-stops,var(--tw-gradient-position),var(--tw-gradient-from)va=
r(--tw-gradient-from-position),var(--tw-gradient-to)var(--tw-gradient-to-po=
sition)); }
  .bg-clip-text { background-clip: text; }
  .fill-current { fill: currentcolor; }
  .fill-foreground { fill: var(--foreground); }
  .fill-white { fill: var(--color-white); }
  .object-contain { object-fit: contain; }
  .p-0 { padding: calc(var(--spacing)*0); }
  .p-0\.5 { padding: calc(var(--spacing)*.5); }
  .p-1 { padding: calc(var(--spacing)*1); }
  .p-1\.5 { padding: calc(var(--spacing)*1.5); }
  .p-2 { padding: calc(var(--spacing)*2); }
  .p-3 { padding: calc(var(--spacing)*3); }
  .p-4 { padding: calc(var(--spacing)*4); }
  .p-5 { padding: calc(var(--spacing)*5); }
  .p-6 { padding: calc(var(--spacing)*6); }
  .p-8 { padding: calc(var(--spacing)*8); }
  .px-0 { padding-inline: calc(var(--spacing)*0); }
  .px-0\.5 { padding-inline: calc(var(--spacing)*.5); }
  .px-1 { padding-inline: calc(var(--spacing)*1); }
  .px-1\.5 { padding-inline: calc(var(--spacing)*1.5); }
  .px-2 { padding-inline: calc(var(--spacing)*2); }
  .px-2\.5 { padding-inline: calc(var(--spacing)*2.5); }
  .px-3 { padding-inline: calc(var(--spacing)*3); }
  .px-4 { padding-inline: calc(var(--spacing)*4); }
  .px-5 { padding-inline: calc(var(--spacing)*5); }
  .px-6 { padding-inline: calc(var(--spacing)*6); }
  .px-\[0\.25rem\] { padding-inline: 0.25rem; }
  .px-\[5px\] { padding-inline: 5px; }
  .py-0\.5 { padding-block: calc(var(--spacing)*.5); }
  .py-1 { padding-block: calc(var(--spacing)*1); }
  .py-1\.5 { padding-block: calc(var(--spacing)*1.5); }
  .py-2 { padding-block: calc(var(--spacing)*2); }
  .py-2\.5 { padding-block: calc(var(--spacing)*2.5); }
  .py-3 { padding-block: calc(var(--spacing)*3); }
  .py-4 { padding-block: calc(var(--spacing)*4); }
  .py-6 { padding-block: calc(var(--spacing)*6); }
  .py-8 { padding-block: calc(var(--spacing)*8); }
  .py-12 { padding-block: calc(var(--spacing)*12); }
  .py-16 { padding-block: calc(var(--spacing)*16); }
  .py-\[0\.12rem\] { padding-block: 0.12rem; }
  .py-\[0\.20rem\] { padding-block: 0.2rem; }
  .py-\[3px\] { padding-block: 3px; }
  .py-px { padding-block: 1px; }
  .pt-0 { padding-top: calc(var(--spacing)*0); }
  .pt-1 { padding-top: calc(var(--spacing)*1); }
  .pt-1\.5 { padding-top: calc(var(--spacing)*1.5); }
  .pt-2 { padding-top: calc(var(--spacing)*2); }
  .pt-3 { padding-top: calc(var(--spacing)*3); }
  .pt-4 { padding-top: calc(var(--spacing)*4); }
  .pt-6 { padding-top: calc(var(--spacing)*6); }
  .pt-12 { padding-top: calc(var(--spacing)*12); }
  .pr-1 { padding-right: calc(var(--spacing)*1); }
  .pr-2 { padding-right: calc(var(--spacing)*2); }
  .pr-4 { padding-right: calc(var(--spacing)*4); }
  .pr-8 { padding-right: calc(var(--spacing)*8); }
  .pb-1 { padding-bottom: calc(var(--spacing)*1); }
  .pb-2 { padding-bottom: calc(var(--spacing)*2); }
  .pb-2\.5 { padding-bottom: calc(var(--spacing)*2.5); }
  .pb-4 { padding-bottom: calc(var(--spacing)*4); }
  .pb-5 { padding-bottom: calc(var(--spacing)*5); }
  .pb-8 { padding-bottom: calc(var(--spacing)*8); }
  .pb-12 { padding-bottom: calc(var(--spacing)*12); }
  .pb-24 { padding-bottom: calc(var(--spacing)*24); }
  .pb-30 { padding-bottom: calc(var(--spacing)*30); }
  .pb-36 { padding-bottom: calc(var(--spacing)*36); }
  .pb-\[90px\] { padding-bottom: 90px; }
  .pl-1 { padding-left: calc(var(--spacing)*1); }
  .pl-1\.5 { padding-left: calc(var(--spacing)*1.5); }
  .pl-4 { padding-left: calc(var(--spacing)*4); }
  .pl-5 { padding-left: calc(var(--spacing)*5); }
  .pl-6 { padding-left: calc(var(--spacing)*6); }
  .pl-8 { padding-left: calc(var(--spacing)*8); }
  .pl-9 { padding-left: calc(var(--spacing)*9); }
  .pl-\[1\.3rem\] { padding-left: 1.3rem; }
  .pl-\[var\(--indent-width\)\] { padding-left: var(--indent-width); }
  .text-center { text-align: center; }
  .text-left { text-align: left; }
  .text-right { text-align: right; }
  .align-baseline { vertical-align: baseline; }
  .font-geist-mono { font-family: var(--font-geist-mono); }
  .font-geist-sans { font-family: var(--font-geist-sans); }
  .font-mono { font-family: var(--font-mono); }
  .font-sans { font-family: var(--font-sans); }
  .text-2xl { font-size: var(--text-2xl); line-height: var(--tw-leading,var=
(--text-2xl--line-height)); }
  .text-3xl { font-size: var(--text-3xl); line-height: var(--tw-leading,var=
(--text-3xl--line-height)); }
  .text-base { font-size: var(--text-base); line-height: var(--tw-leading,v=
ar(--text-base--line-height)); }
  .text-lg { font-size: var(--text-lg); line-height: var(--tw-leading,var(-=
-text-lg--line-height)); }
  .text-sm { font-size: var(--text-sm); line-height: var(--tw-leading,var(-=
-text-sm--line-height)); }
  .text-xl { font-size: var(--text-xl); line-height: var(--tw-leading,var(-=
-text-xl--line-height)); }
  .text-xs { font-size: var(--text-xs); line-height: var(--tw-leading,var(-=
-text-xs--line-height)); }
  .text-\[10px\] { font-size: 10px; }
  .leading-\[15px\] { --tw-leading: 15px; line-height: 15px; }
  .leading-none { --tw-leading: 1; line-height: 1; }
  .leading-normal { --tw-leading: var(--leading-normal); line-height: var(-=
-leading-normal); }
  .font-bold { --tw-font-weight: var(--font-weight-bold); font-weight: var(=
--font-weight-bold); }
  .font-extrabold { --tw-font-weight: var(--font-weight-extrabold); font-we=
ight: var(--font-weight-extrabold); }
  .font-light { --tw-font-weight: var(--font-weight-light); font-weight: va=
r(--font-weight-light); }
  .font-medium { --tw-font-weight: var(--font-weight-medium); font-weight: =
var(--font-weight-medium); }
  .font-normal { --tw-font-weight: var(--font-weight-normal); font-weight: =
var(--font-weight-normal); }
  .font-semibold { --tw-font-weight: var(--font-weight-semibold); font-weig=
ht: var(--font-weight-semibold); }
  .tracking-tight { --tw-tracking: var(--tracking-tight); letter-spacing: v=
ar(--tracking-tight); }
  .tracking-widest { --tw-tracking: var(--tracking-widest); letter-spacing:=
 var(--tracking-widest); }
  .text-balance { text-wrap: balance; }
  .text-nowrap { text-wrap: nowrap; }
  .text-wrap { text-wrap: wrap; }
  .\[overflow-wrap\:anywhere\] { overflow-wrap: anywhere; }
  .\[overflow-wrap\:break-word\] { overflow-wrap: break-word; }
  .break-all { word-break: break-all; }
  .whitespace-nowrap { white-space: nowrap; }
  .\!text-blue-800 { color: var(--color-blue-800) !important; }
  .\!text-neutral-800 { color: var(--color-neutral-800) !important; }
  .\!text-white { color: var(--color-white) !important; }
  .text-\[\#6096FF\] { color: rgb(96, 150, 255); }
  .text-\[\#333333\] { color: rgb(51, 51, 51); }
  .text-\[\#666666\] { color: rgb(102, 102, 102); }
  .text-\[\#b5b5b5a4\] { color: rgba(181, 181, 181, 0.643); }
  .text-\[\#ef9541\] { color: rgb(239, 149, 65); }
  .text-accent-foreground { color: var(--accent-foreground); }
  .text-background { color: var(--background); }
  .text-black { color: var(--color-black); }
  .text-blue-400 { color: var(--color-blue-400); }
  .text-blue-500 { color: var(--color-blue-500); }
  .text-blue-800 { color: var(--color-blue-800); }
  .text-card-foreground { color: var(--card-foreground); }
  .text-clay-800 { color: var(--clay-800); }
  .text-codemaps-glyph { color: var(--color-codemaps-glyph); }
  .text-current { color: currentcolor; }
  .text-destructive { color: var(--destructive); }
  .text-foreground, .text-foreground\/70 { color: var(--foreground); }
  @supports (color:color-mix(in lab,red,red)) {
  .text-foreground\/70 { color: color-mix(in oklab,var(--foreground)70%,tra=
nsparent); }
}
  .text-foreground\/80 { color: var(--foreground); }
  @supports (color:color-mix(in lab,red,red)) {
  .text-foreground\/80 { color: color-mix(in oklab,var(--foreground)80%,tra=
nsparent); }
}
  .text-gray-300 { color: var(--color-gray-300); }
  .text-gray-400 { color: var(--color-gray-400); }
  .text-gray-600 { color: var(--color-gray-600); }
  .text-gray-700 { color: var(--color-gray-700); }
  .text-gray-800 { color: var(--color-gray-800); }
  .text-gray-900 { color: var(--color-gray-900); }
  .text-green-300 { color: var(--color-green-300); }
  .text-green-600 { color: var(--color-green-600); }
  .text-muted-foreground { color: var(--muted-foreground); }
  .text-neutral-200 { color: var(--color-neutral-200); }
  .text-neutral-300 { color: var(--color-neutral-300); }
  .text-neutral-400 { color: var(--color-neutral-400); }
  .text-neutral-500 { color: var(--color-neutral-500); }
  .text-neutral-600 { color: var(--color-neutral-600); }
  .text-neutral-700 { color: var(--color-neutral-700); }
  .text-neutral-800 { color: var(--color-neutral-800); }
  .text-pacific { color: var(--color-pacific); }
  .text-popover-foreground { color: var(--popover-foreground); }
  .text-primary { color: var(--color-text-primary); }
  .text-primary-foreground { color: var(--primary-foreground); }
  .text-primary\/70 { color: rgba(203, 203, 203, 0.7); }
  @supports (color:color-mix(in lab,red,red)) {
  .text-primary\/70 { color: color-mix(in oklab,var(--color-text-primary)70=
%,transparent); }
}
  .text-purple-600 { color: var(--color-purple-600); }
  .text-red-300 { color: var(--color-red-300); }
  .text-red-400 { color: var(--color-red-400); }
  .text-red-500 { color: var(--color-red-500); }
  .text-red-600 { color: var(--color-red-600); }
  .text-secondary { color: var(--color-text-secondary); }
  .text-secondary-foreground { color: var(--secondary-foreground); }
  .text-text-light { color: var(--color-text-light); }
  .text-white { color: var(--color-white); }
  .text-yellow-400 { color: var(--color-yellow-400); }
  .text-zinc-400 { color: var(--color-zinc-400); }
  .text-zinc-600 { color: var(--color-zinc-600); }
  .text-zinc-900 { color: var(--color-zinc-900); }
  .uppercase { text-transform: uppercase; }
  .italic { font-style: italic; }
  .tabular-nums { --tw-numeric-spacing: tabular-nums; font-variant-numeric:=
 var(--tw-ordinal,)var(--tw-slashed-zero,)var(--tw-numeric-figure,)var(--tw=
-numeric-spacing,)var(--tw-numeric-fraction,); }
  .\!no-underline { text-decoration-line: none !important; }
  .underline { text-decoration-line: underline; }
  .\[text-decoration-color\:color-mix\(in_srgb\,var\(--foreground\)_50\%\,\=
#0000\)\] { text-decoration-color: var(--foreground); }
  @supports (color:color-mix(in lab,red,red)) {
  .\[text-decoration-color\:color-mix\(in_srgb\,var\(--foreground\)_50\%\,\=
#0000\)\] { text-decoration-color: color-mix(in srgb,var(--foreground)50%,#=
0000); }
}
  .decoration-dotted { text-decoration-style: dotted; }
  .underline-offset-2 { text-underline-offset: 2px; }
  .underline-offset-4 { text-underline-offset: 4px; }
  .antialiased { -webkit-font-smoothing: antialiased; }
  .opacity-0 { opacity: 0; }
  .opacity-25 { opacity: 0.25; }
  .opacity-30 { opacity: 0.3; }
  .opacity-40 { opacity: 0.4; }
  .opacity-50 { opacity: 0.5; }
  .opacity-60 { opacity: 0.6; }
  .opacity-70 { opacity: 0.7; }
  .opacity-75 { opacity: 0.75; }
  .opacity-90 { opacity: 0.9; }
  .opacity-100 { opacity: 1; }
  .shadow-lg { --tw-shadow: 0 10px 15px -3px var(--tw-shadow-color,#0000001=
a),0 4px 6px -4px var(--tw-shadow-color,#0000001a); }
  .shadow-lg, .shadow-md { box-shadow: var(--tw-inset-shadow),var(--tw-inse=
t-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-=
shadow); }
  .shadow-md { --tw-shadow: 0 4px 6px -1px var(--tw-shadow-color,#0000001a)=
,0 2px 4px -2px var(--tw-shadow-color,#0000001a); }
  .shadow-none { --tw-shadow: 0 0 #0000; }
  .shadow-none, .shadow-sm { box-shadow: var(--tw-inset-shadow),var(--tw-in=
set-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--t=
w-shadow); }
  .shadow-sm { --tw-shadow: 0 1px 3px 0 var(--tw-shadow-color,#0000001a),0 =
1px 2px -1px var(--tw-shadow-color,#0000001a); }
  .shadow-xl { --tw-shadow: 0 20px 25px -5px var(--tw-shadow-color,#0000001=
a),0 8px 10px -6px var(--tw-shadow-color,#0000001a); }
  .shadow-xl, .shadow-xs { box-shadow: var(--tw-inset-shadow),var(--tw-inse=
t-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-=
shadow); }
  .shadow-xs { --tw-shadow: 0 1px 2px 0 var(--tw-shadow-color,#0000000d); }
  .ring-1, .ring-\[1px\] { --tw-ring-shadow: var(--tw-ring-inset,)0 0 0 cal=
c(1px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor); box-=
shadow: var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-of=
fset-shadow),var(--tw-ring-shadow),var(--tw-shadow); }
  .shadow-indigo-500\/20 { --tw-shadow-color: #625fff33; }
  @supports (color:color-mix(in lab,red,red)) {
  .shadow-indigo-500\/20 { --tw-shadow-color: color-mix(in oklab,color-mix(=
in oklab,var(--color-indigo-500)20%,transparent)var(--tw-shadow-alpha),tran=
sparent); }
}
  .shadow-neutral-400\/70 { --tw-shadow-color: #a1a1a1b3; }
  @supports (color:color-mix(in lab,red,red)) {
  .shadow-neutral-400\/70 { --tw-shadow-color: color-mix(in oklab,color-mix=
(in oklab,var(--color-neutral-400)70%,transparent)var(--tw-shadow-alpha),tr=
ansparent); }
}
  .shadow-neutral-900 { --tw-shadow-color: oklch(20.5% 0 0); }
  @supports (color:color-mix(in lab,red,red)) {
  .shadow-neutral-900 { --tw-shadow-color: color-mix(in oklab,var(--color-n=
eutral-900)var(--tw-shadow-alpha),transparent); }
}
  .shadow-white\/70 { --tw-shadow-color: #ffffffb3; }
  @supports (color:color-mix(in lab,red,red)) {
  .shadow-white\/70 { --tw-shadow-color: color-mix(in oklab,color-mix(in ok=
lab,var(--color-white)70%,transparent)var(--tw-shadow-alpha),transparent); =
}
}
  .ring-cyan-400\/50 { --tw-ring-color: #00d2ef80; }
  @supports (color:color-mix(in lab,red,red)) {
  .ring-cyan-400\/50 { --tw-ring-color: color-mix(in oklab,var(--color-cyan=
-400)50%,transparent); }
}
  .ring-neutral-700 { --tw-ring-color: var(--color-neutral-700); }
  .ring-neutral-800 { --tw-ring-color: var(--color-neutral-800); }
  .ring-offset-background { --tw-ring-offset-color: var(--background); }
  .outline-hidden { --tw-outline-style: none; outline-style: none; }
  @media (forced-colors: active) {
  .outline-hidden { outline-offset: 2px; outline: rgba(0, 0, 0, 0) solid 2p=
x; }
}
  .outline { outline-style: var(--tw-outline-style); outline-width: 1px; }
  .blur { --tw-blur: blur(8px); }
  .blur, .invert { filter: var(--tw-blur,)var(--tw-brightness,)var(--tw-con=
trast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-s=
aturate,)var(--tw-sepia,)var(--tw-drop-shadow,); }
  .invert { --tw-invert: invert(100%); }
  .backdrop-blur-md { --tw-backdrop-blur: blur(var(--blur-md)); }
  .backdrop-blur-md, .backdrop-blur-xs { backdrop-filter: var(--tw-backdrop=
-blur,)var(--tw-backdrop-brightness,)var(--tw-backdrop-contrast,)var(--tw-b=
ackdrop-grayscale,)var(--tw-backdrop-hue-rotate,)var(--tw-backdrop-invert,)=
var(--tw-backdrop-opacity,)var(--tw-backdrop-saturate,)var(--tw-backdrop-se=
pia,); }
  .backdrop-blur-xs { --tw-backdrop-blur: blur(var(--blur-xs)); }
  .\[backdrop-filter\:blur\(8px\)\] { backdrop-filter: blur(8px); }
  .transition { transition-property: color, background-color, border-color,=
 outline-color, text-decoration-color, fill, stroke, --tw-gradient-from, --=
tw-gradient-via, --tw-gradient-to, opacity, box-shadow, transform, translat=
e, scale, rotate, filter, -webkit-backdrop-filter, backdrop-filter; transit=
ion-timing-function: var(--tw-ease,var(--default-transition-timing-function=
)); transition-duration: var(--tw-duration,var(--default-transition-duratio=
n)); }
  .transition-\[border-radius\] { transition-property: border-radius; trans=
ition-timing-function: var(--tw-ease,var(--default-transition-timing-functi=
on)); transition-duration: var(--tw-duration,var(--default-transition-durat=
ion)); }
  .transition-\[color\,box-shadow\] { transition-property: color, box-shado=
w; transition-timing-function: var(--tw-ease,var(--default-transition-timin=
g-function)); transition-duration: var(--tw-duration,var(--default-transiti=
on-duration)); }
  .transition-\[grid-template-rows\] { transition-property: grid-template-r=
ows; transition-timing-function: var(--tw-ease,var(--default-transition-tim=
ing-function)); transition-duration: var(--tw-duration,var(--default-transi=
tion-duration)); }
  .transition-all { transition-property: all; transition-timing-function: v=
ar(--tw-ease,var(--default-transition-timing-function)); transition-duratio=
n: var(--tw-duration,var(--default-transition-duration)); }
  .transition-colors { transition-property: color, background-color, border=
-color, outline-color, text-decoration-color, fill, stroke, --tw-gradient-f=
rom, --tw-gradient-via, --tw-gradient-to; transition-timing-function: var(-=
-tw-ease,var(--default-transition-timing-function)); transition-duration: v=
ar(--tw-duration,var(--default-transition-duration)); }
  .transition-opacity { transition-property: opacity; transition-timing-fun=
ction: var(--tw-ease,var(--default-transition-timing-function)); transition=
-duration: var(--tw-duration,var(--default-transition-duration)); }
  .transition-shadow { transition-property: box-shadow; transition-timing-f=
unction: var(--tw-ease,var(--default-transition-timing-function)); transiti=
on-duration: var(--tw-duration,var(--default-transition-duration)); }
  .transition-transform { transition-property: transform, translate, scale,=
 rotate; transition-timing-function: var(--tw-ease,var(--default-transition=
-timing-function)); transition-duration: var(--tw-duration,var(--default-tr=
ansition-duration)); }
  .transition-none { transition-property: none; }
  .duration-100 { --tw-duration: .1s; transition-duration: 0.1s; }
  .duration-150 { --tw-duration: .15s; transition-duration: 0.15s; }
  .duration-200 { --tw-duration: .2s; transition-duration: 0.2s; }
  .duration-300 { --tw-duration: .3s; transition-duration: 0.3s; }
  .duration-500 { --tw-duration: .5s; transition-duration: 0.5s; }
  .duration-700 { --tw-duration: .7s; transition-duration: 0.7s; }
  .ease-in-out { --tw-ease: var(--ease-in-out); transition-timing-function:=
 var(--ease-in-out); }
  .ease-out { --tw-ease: var(--ease-out); transition-timing-function: var(-=
-ease-out); }
  .prose-invert { --tw-prose-body: var(--color-text-primary); --tw-prose-he=
adings: var(--color-text-primary); --tw-prose-lead: var(--color-text-second=
ary); --tw-prose-links: var(--color-pacific); --tw-prose-bold: var(--color-=
text-primary); --tw-prose-counters: var(--color-text-secondary); --tw-prose=
-bullets: var(--color-text-secondary); --tw-prose-hr: var(--tw-prose-invert=
-hr); --tw-prose-quotes: var(--color-text-secondary); --tw-prose-quote-bord=
ers: var(--color-border); --tw-prose-captions: var(--color-text-secondary);=
 --tw-prose-kbd: var(--tw-prose-invert-kbd); --tw-prose-kbd-shadows: var(--=
tw-prose-invert-kbd-shadows); --tw-prose-code: var(--color-text-primary); -=
-tw-prose-pre-code: var(--color-text-primary); --tw-prose-pre-bg: var(--col=
or-night); --tw-prose-th-borders: var(--color-border); --tw-prose-td-border=
s: var(--color-border); }
  .animate-in { --tw-enter-opacity: initial; --tw-enter-scale: initial; --t=
w-enter-rotate: initial; --tw-enter-translate-x: initial; --tw-enter-transl=
ate-y: initial; animation-name: enter; animation-duration: 0.15s; }
  .outline-none { --tw-outline-style: none; outline-style: none; }
  .select-none { user-select: none; }
  .\[--c-1\:\#f1f1f1\] { --c-1: #f1f1f1; }
  .\[--c-1\:\#f5f5f5\] { --c-1: #f5f5f5; }
  .\[--c-2\:\#eeeeee\] { --c-2: #eee; }
  .\[--c-2\:var\(--bg-secondary\)\] { --c-2: var(--bg-secondary); }
  .\[--delay\:0\.6s\] { --delay: .6s; }
  .\[--delay\:1\.2s\] { --delay: 1.2s; }
  .\[animation-delay\:-0\.2s\] { animation-delay: -0.2s; }
  .\[animation-delay\:0\.2s\] { animation-delay: 0.2s; }
  .\[animation-duration\:calc\(var\(--node-depth\)\*100ms\)\] { animation-d=
uration: calc(var(--node-depth)*.1s); }
  .\[background\:var\(--gradient-light\)\] { background: var(--gradient-lig=
ht); }
  .\[overflow-anchor\:none\] { overflow-anchor: none; }
  .duration-100 { animation-duration: 0.1s; }
  .duration-150 { animation-duration: 0.15s; }
  .duration-200 { animation-duration: 0.2s; }
  .duration-300 { animation-duration: 0.3s; }
  .duration-500 { animation-duration: 0.5s; }
  .duration-700 { animation-duration: 0.7s; }
  .ease-in-out { animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }
  .ease-out { animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
  .fade-in-0 { --tw-enter-opacity: 0; }
  .fade-in-50 { --tw-enter-opacity: .5; }
  .running { animation-play-state: running; }
  .slide-in-from-bottom-1 { --tw-enter-translate-y: calc(var(--spacing)*1);=
 }
  .slide-in-from-bottom-2 { --tw-enter-translate-y: calc(var(--spacing)*2);=
 }
  .slide-in-from-top-10 { --tw-enter-translate-y: -2.5rem; }
  .zoom-in-95 { --tw-enter-scale: .95; }
  @media (hover: hover) {
  .group-hover\:w-full:is(:where(.group):hover *) { width: 100%; }
  .group-hover\:translate-x-0\.5:is(:where(.group):hover *) { --tw-translat=
e-x: calc(var(--spacing)*.5); translate: var(--tw-translate-x)var(--tw-tran=
slate-y); }
  .group-hover\:rotate-180:is(:where(.group):hover *) { rotate: 180deg; }
  .group-hover\:text-foreground:is(:where(.group):hover *) { color: var(--f=
oreground); }
  .group-hover\:opacity-100:is(:where(.group):hover *) { opacity: 1; }
}
  .group-data-\[disabled\=3Dtrue\]\:pointer-events-none:is(:where(.group)[d=
ata-disabled=3D"true"] *) { pointer-events: none; }
  .group-data-\[disabled\=3Dtrue\]\:opacity-50:is(:where(.group)[data-disab=
led=3D"true"] *) { opacity: 0.5; }
  .peer-disabled\:cursor-not-allowed:is(:where(.peer):disabled ~ *) { curso=
r: not-allowed; }
  .peer-disabled\:opacity-50:is(:where(.peer):disabled ~ *) { opacity: 0.5;=
 }
  .selection\:bg-primary ::selection { background-color: var(--primary); }
  .selection\:bg-primary::selection { background-color: var(--primary); }
  .selection\:text-primary-foreground ::selection { color: var(--primary-fo=
reground); }
  .selection\:text-primary-foreground::selection { color: var(--primary-for=
eground); }
  .file\:inline-flex::file-selector-button { display: inline-flex; }
  .file\:h-7::file-selector-button { height: calc(var(--spacing)*7); }
  .file\:border-0::file-selector-button { border-style: var(--tw-border-sty=
le); border-width: 0px; }
  .file\:bg-transparent::file-selector-button { background-color: rgba(0, 0=
, 0, 0); }
  .file\:text-sm::file-selector-button { font-size: var(--text-sm); line-he=
ight: var(--tw-leading,var(--text-sm--line-height)); }
  .file\:font-medium::file-selector-button { --tw-font-weight: var(--font-w=
eight-medium); font-weight: var(--font-weight-medium); }
  .file\:text-foreground::file-selector-button { color: var(--foreground); =
}
  .placeholder\:text-muted-foreground::placeholder { color: var(--muted-for=
eground); }
  .before\:absolute::before { content: var(--tw-content); position: absolut=
e; }
  .before\:inset-y-0::before { content: var(--tw-content); inset-block: cal=
c(var(--spacing)*0); }
  .before\:top-\[10px\]::before { content: var(--tw-content); top: 10px; }
  .before\:bottom-0::before { content: var(--tw-content); bottom: calc(var(=
--spacing)*0); }
  .before\:left-0::before { content: var(--tw-content); left: calc(var(--sp=
acing)*0); }
  .before\:left-\[var\(--indent-width\)\]::before { content: var(--tw-conte=
nt); left: var(--indent-width); }
  .before\:hidden::before { content: var(--tw-content); display: none; }
  .before\:h-auto::before { content: var(--tw-content); height: auto; }
  .before\:w-\[2px\]::before { content: var(--tw-content); width: 2px; }
  .before\:w-\[calc\(var\(--indent-width\)-2px\)\]::before { content: var(-=
-tw-content); width: calc(var(--indent-width) - 2px); }
  .before\:-translate-x-full::before { content: var(--tw-content); --tw-tra=
nslate-x: -100%; translate: var(--tw-translate-x)var(--tw-translate-y); }
  .before\:border-t-\[2px\]::before { content: var(--tw-content); border-to=
p-style: var(--tw-border-style); border-top-width: 2px; }
  .before\:border-\[\#ddd\]::before { content: var(--tw-content); border-co=
lor: rgb(221, 221, 221); }
  .before\:bg-\[\#ddd\]::before { content: var(--tw-content); background-co=
lor: rgb(221, 221, 221); }
  .after\:hidden::after { content: var(--tw-content); display: none; }
  .last\:border-0:last-child { border-style: var(--tw-border-style); border=
-width: 0px; }
  .last\:before\:bg-codemap-bg:last-child::before { content: var(--tw-conte=
nt); background-color: var(--color-codemap-bg); }
  .focus-within\:ring-\[\.5px\]:focus-within { --tw-ring-shadow: var(--tw-r=
ing-inset,)0 0 0 calc(.5px + var(--tw-ring-offset-width))var(--tw-ring-colo=
r,currentcolor); box-shadow: var(--tw-inset-shadow),var(--tw-inset-ring-sha=
dow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow); }
  .focus-within\:ring-indigo-300\/40:focus-within { --tw-ring-color: #a4b3f=
f66; }
  @supports (color:color-mix(in lab,red,red)) {
  .focus-within\:ring-indigo-300\/40:focus-within { --tw-ring-color: color-=
mix(in oklab,var(--color-indigo-300)40%,transparent); }
}
  @media (hover: hover) {
  .hover\:-translate-y-1:hover { --tw-translate-y: calc(var(--spacing)*-1);=
 translate: var(--tw-translate-x)var(--tw-translate-y); }
  .hover\:border-\[\#a1a1a1\]:hover { border-color: rgb(161, 161, 161); }
  .hover\:border-blue-600:hover { border-color: var(--color-blue-600); }
  .hover\:border-border-hover:hover { border-color: var(--color-border-hove=
r); }
  .hover\:bg-\[\#111111\]:hover { background-color: rgb(17, 17, 17); }
  .hover\:bg-\[\#353535\]:hover { background-color: rgb(53, 53, 53); }
  .hover\:bg-\[\#e0e0e0\]:hover { background-color: rgb(224, 224, 224); }
  .hover\:bg-\[\#ededed\]:hover { background-color: rgb(237, 237, 237); }
  .hover\:bg-accent:hover { background-color: var(--accent); }
  .hover\:bg-blue-300:hover { background-color: var(--color-blue-300); }
  .hover\:bg-blue-600:hover { background-color: var(--color-blue-600); }
  .hover\:bg-border:hover, .hover\:bg-border\/80:hover { background-color: =
var(--border); }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-border\/80:hover { background-color: color-mix(in oklab,var(--=
border)80%,transparent); }
}
  .hover\:bg-codemap-bg\/50:hover { background-color: rgba(21, 21, 21, 0.5)=
; }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-codemap-bg\/50:hover { background-color: color-mix(in oklab,va=
r(--color-codemap-bg)50%,transparent); }
}
  .hover\:bg-component:hover { background-color: var(--bg-component); }
  .hover\:bg-destructive\/90:hover { background-color: var(--destructive); =
}
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-destructive\/90:hover { background-color: color-mix(in oklab,v=
ar(--destructive)90%,transparent); }
}
  .hover\:bg-gray-100:hover { background-color: var(--color-gray-100); }
  .hover\:bg-gray-400:hover { background-color: var(--color-gray-400); }
  .hover\:bg-hover:hover { background-color: var(--color-hover); }
  .hover\:bg-neutral-300:hover { background-color: var(--color-neutral-300)=
; }
  .hover\:bg-neutral-600:hover { background-color: var(--color-neutral-600)=
; }
  .hover\:bg-neutral-700\/50:hover { background-color: rgba(64, 64, 64, 0.5=
); }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-neutral-700\/50:hover { background-color: color-mix(in oklab,v=
ar(--color-neutral-700)50%,transparent); }
}
  .hover\:bg-pacific\/20:hover { background-color: rgba(96, 150, 255, 0.2);=
 }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-pacific\/20:hover { background-color: color-mix(in oklab,var(-=
-color-pacific)20%,transparent); }
}
  .hover\:bg-primary:hover, .hover\:bg-primary\/90:hover { background-color=
: var(--primary); }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-primary\/90:hover { background-color: color-mix(in oklab,var(-=
-primary)90%,transparent); }
}
  .hover\:bg-purple-500\/20:hover { background-color: rgba(172, 75, 255, 0.=
2); }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-purple-500\/20:hover { background-color: color-mix(in oklab,va=
r(--color-purple-500)20%,transparent); }
}
  .hover\:bg-secondary\/80:hover { background-color: rgba(32, 32, 32, 0.8);=
 }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-secondary\/80:hover { background-color: color-mix(in oklab,var=
(--bg-secondary)80%,transparent); }
}
  .hover\:bg-surface-hover:hover { background-color: var(--bg-surface-hover=
); }
  .hover\:bg-white\/40:hover { background-color: rgba(255, 255, 255, 0.4); =
}
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:bg-white\/40:hover { background-color: color-mix(in oklab,var(--c=
olor-white)40%,transparent); }
}
  .hover\:text-accent-foreground:hover { color: var(--accent-foreground); }
  .hover\:text-black:hover { color: var(--color-black); }
  .hover\:text-blue-400:hover { color: var(--color-blue-400); }
  .hover\:text-blue-600:hover { color: var(--color-blue-600); }
  .hover\:text-muted-foreground\/80:hover { color: var(--muted-foreground);=
 }
  @supports (color:color-mix(in lab,red,red)) {
  .hover\:text-muted-foreground\/80:hover { color: color-mix(in oklab,var(-=
-muted-foreground)80%,transparent); }
}
  .hover\:text-neutral-200:hover { color: var(--color-neutral-200); }
  .hover\:text-neutral-600:hover { color: var(--color-neutral-600); }
  .hover\:text-pacific:hover { color: var(--color-pacific); }
  .hover\:text-primary:hover { color: var(--color-text-primary); }
  .hover\:text-red-500:hover { color: var(--color-red-500); }
  .hover\:text-white:hover { color: var(--color-white); }
  .hover\:underline:hover { text-decoration-line: underline; }
  .hover\:opacity-75:hover { opacity: 0.75; }
  .hover\:opacity-80:hover { opacity: 0.8; }
  .hover\:opacity-100:hover { opacity: 1; }
  .hover\:shadow-md:hover { --tw-shadow: 0 4px 6px -1px var(--tw-shadow-col=
or,#0000001a),0 2px 4px -2px var(--tw-shadow-color,#0000001a); }
  .hover\:shadow-md:hover, .hover\:shadow-xl:hover { box-shadow: var(--tw-i=
nset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(-=
-tw-ring-shadow),var(--tw-shadow); }
  .hover\:shadow-xl:hover { --tw-shadow: 0 20px 25px -5px var(--tw-shadow-c=
olor,#0000001a),0 8px 10px -6px var(--tw-shadow-color,#0000001a); }
}
  .focus\:border-\[\#353535\]:focus { border-color: rgb(53, 53, 53); }
  .focus\:bg-accent:focus { background-color: var(--accent); }
  .focus\:text-accent-foreground:focus { color: var(--accent-foreground); }
  .focus\:opacity-100:focus { opacity: 1; }
  .focus\:ring:focus { --tw-ring-shadow: var(--tw-ring-inset,)0 0 0 calc(1p=
x + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor); }
  .focus\:ring-2:focus, .focus\:ring:focus { box-shadow: var(--tw-inset-sha=
dow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring=
-shadow),var(--tw-shadow); }
  .focus\:ring-2:focus { --tw-ring-shadow: var(--tw-ring-inset,)0 0 0 calc(=
2px + var(--tw-ring-offset-width))var(--tw-ring-color,currentcolor); }
  .focus\:ring-\[\#353535\]:focus { --tw-ring-color: #353535; }
  .focus\:ring-\[\#d1d1d1\]:focus { --tw-ring-color: #d1d1d1; }
  .focus\:ring-neutral-400:focus { --tw-ring-color: var(--color-neutral-400=
); }
  .focus\:ring-ring:focus { --tw-ring-color: var(--ring); }
  .focus\:ring-offset-2:focus { --tw-ring-offset-width: 2px; --tw-ring-offs=
et-shadow: var(--tw-ring-inset,)0 0 0 var(--tw-ring-offset-width)var(--tw-r=
ing-offset-color); }
  .focus\:outline-hidden:focus { --tw-outline-style: none; outline-style: n=
one; }
  @media (forced-colors: active) {
  .focus\:outline-hidden:focus { outline-offset: 2px; outline: rgba(0, 0, 0=
, 0) solid 2px; }
}
  .focus\:outline-none:focus { --tw-outline-style: none; outline-style: non=
e; }
  .focus-visible\:border-ring:focus-visible { border-color: var(--ring); }
  .focus-visible\:ring-2:focus-visible { --tw-ring-shadow: var(--tw-ring-in=
set,)0 0 0 calc(2px + var(--tw-ring-offset-width))var(--tw-ring-color,curre=
ntcolor); box-shadow: var(--tw-inset-shadow),var(--tw-inset-ring-shadow),va=
r(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow); }
  .focus-visible\:ring-\[3px\]:focus-visible { --tw-ring-shadow: var(--tw-r=
ing-inset,)0 0 0 calc(3px + var(--tw-ring-offset-width))var(--tw-ring-color=
,currentcolor); box-shadow: var(--tw-inset-shadow),var(--tw-inset-ring-shad=
ow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow); }
  .focus-visible\:ring-\[\#353535\]:focus-visible { --tw-ring-color: #35353=
5; }
  .focus-visible\:ring-destructive\/20:focus-visible { --tw-ring-color: var=
(--destructive); }
  @supports (color:color-mix(in lab,red,red)) {
  .focus-visible\:ring-destructive\/20:focus-visible { --tw-ring-color: col=
or-mix(in oklab,var(--destructive)20%,transparent); }
}
  .focus-visible\:ring-ring:focus-visible, .focus-visible\:ring-ring\/50:fo=
cus-visible { --tw-ring-color: var(--ring); }
  @supports (color:color-mix(in lab,red,red)) {
  .focus-visible\:ring-ring\/50:focus-visible { --tw-ring-color: color-mix(=
in oklab,var(--ring)50%,transparent); }
}
  .focus-visible\:outline-none:focus-visible { --tw-outline-style: none; ou=
tline-style: none; }
  .active\:bg-pacific\/20:active { background-color: rgba(96, 150, 255, 0.2=
); }
  @supports (color:color-mix(in lab,red,red)) {
  .active\:bg-pacific\/20:active { background-color: color-mix(in oklab,var=
(--color-pacific)20%,transparent); }
}
  .disabled\:pointer-events-auto:disabled { pointer-events: auto; }
  .disabled\:pointer-events-none:disabled { pointer-events: none; }
  .disabled\:cursor-default:disabled { cursor: default; }
  .disabled\:cursor-not-allowed:disabled { cursor: not-allowed; }
  .disabled\:bg-blue-400\/40:disabled { background-color: rgba(84, 162, 255=
, 0.4); }
  @supports (color:color-mix(in lab,red,red)) {
  .disabled\:bg-blue-400\/40:disabled { background-color: color-mix(in okla=
b,var(--color-blue-400)40%,transparent); }
}
  .disabled\:text-blue-400\/40:disabled { color: rgba(84, 162, 255, 0.4); }
  @supports (color:color-mix(in lab,red,red)) {
  .disabled\:text-blue-400\/40:disabled { color: color-mix(in oklab,var(--c=
olor-blue-400)40%,transparent); }
}
  .disabled\:opacity-50:disabled { opacity: 0.5; }
  @media (hover: hover) {
  .disabled\:hover\:border-blue-500:disabled:hover { border-color: var(--co=
lor-blue-500); }
  .disabled\:hover\:border-border:disabled:hover { border-color: var(--bord=
er); }
  .disabled\:hover\:bg-blue-500:disabled:hover { background-color: var(--co=
lor-blue-500); }
  .disabled\:hover\:bg-surface:disabled:hover { background-color: var(--bg-=
surface); }
}
  .has-\[code\]\:rounded-md:has(:is(code)) { border-radius: calc(var(--radi=
us) - 2px); }
  .has-\[code\]\:\!bg-\[\#e5e5e5\]:has(:is(code)) { background-color: rgb(2=
29, 229, 229) !important; }
  .has-\[code\]\:text-stone-900:has(:is(code)) { color: var(--color-stone-9=
00); }
  .has-\[div\]\:bg-transparent:has(:is(div)) { background-color: rgba(0, 0,=
 0, 0); }
  .has-\[div\]\:\!p-0:has(:is(div)) { padding: calc(var(--spacing)*0) !impo=
rtant; }
  .has-\[\>svg\]\:px-2:has(> svg) { padding-inline: calc(var(--spacing)*2);=
 }
  .has-\[\>svg\]\:px-2\.5:has(> svg) { padding-inline: calc(var(--spacing)*=
2.5); }
  .has-\[\>svg\]\:px-3:has(> svg) { padding-inline: calc(var(--spacing)*3);=
 }
  .has-\[\>svg\]\:px-4:has(> svg) { padding-inline: calc(var(--spacing)*4);=
 }
  .aria-invalid\:border-destructive[aria-invalid=3D"true"] { border-color: =
var(--destructive); }
  .aria-invalid\:ring-destructive\/20[aria-invalid=3D"true"] { --tw-ring-co=
lor: var(--destructive); }
  @supports (color:color-mix(in lab,red,red)) {
  .aria-invalid\:ring-destructive\/20[aria-invalid=3D"true"] { --tw-ring-co=
lor: color-mix(in oklab,var(--destructive)20%,transparent); }
}
  .data-\[disabled\]\:pointer-events-none[data-disabled] { pointer-events: =
none; }
  .data-\[disabled\]\:opacity-50[data-disabled] { opacity: 0.5; }
  .data-\[placeholder\]\:text-muted-foreground[data-placeholder] { color: v=
ar(--muted-foreground); }
  .data-\[selected\=3Dtrue\]\:bg-\[\#ef9541\]\/20[data-selected=3D"true"] {=
 background-color: oklab(0.74824 0.0720983 0.125982 / 0.2); }
  .data-\[selected\=3Dtrue\]\:bg-hover[data-selected=3D"true"] { background=
-color: var(--color-hover); }
  .data-\[selected\=3Dtrue\]\:bg-purple-500\/20[data-selected=3D"true"] { b=
ackground-color: rgba(172, 75, 255, 0.2); }
  @supports (color:color-mix(in lab,red,red)) {
  .data-\[selected\=3Dtrue\]\:bg-purple-500\/20[data-selected=3D"true"] { b=
ackground-color: color-mix(in oklab,var(--color-purple-500)20%,transparent)=
; }
}
  .data-\[selected\=3Dtrue\]\:font-normal[data-selected=3D"true"] { --tw-fo=
nt-weight: var(--font-weight-normal); font-weight: var(--font-weight-normal=
); }
  .data-\[selected\=3Dtrue\]\:text-\[\#ef9541\][data-selected=3D"true"] { c=
olor: rgb(239, 149, 65); }
  .data-\[selected\=3Dtrue\]\:text-primary[data-selected=3D"true"] { color:=
 var(--color-text-primary); }
  .data-\[selected\=3Dtrue\]\:text-purple-600[data-selected=3D"true"] { col=
or: var(--color-purple-600); }
  @media (hover: hover) {
  .data-\[selected\=3Dtrue\]\:hover\:bg-\[\#ef9541\]\/30[data-selected=3D"t=
rue"]:hover { background-color: oklab(0.74824 0.0720983 0.125982 / 0.3); }
  .data-\[selected\=3Dtrue\]\:hover\:bg-purple-500\/20[data-selected=3D"tru=
e"]:hover { background-color: rgba(172, 75, 255, 0.2); }
  @supports (color:color-mix(in lab,red,red)) {
  .data-\[selected\=3Dtrue\]\:hover\:bg-purple-500\/20[data-selected=3D"tru=
e"]:hover { background-color: color-mix(in oklab,var(--color-purple-500)20%=
,transparent); }
}
}
  .data-\[side\=3Dbottom\]\:slide-in-from-top-2[data-side=3D"bottom"] { --t=
w-enter-translate-y: calc(var(--spacing)*2*-1); }
  .data-\[side\=3Dleft\]\:slide-in-from-right-2[data-side=3D"left"] { --tw-=
enter-translate-x: calc(var(--spacing)*2); }
  .data-\[side\=3Dright\]\:slide-in-from-left-2[data-side=3D"right"] { --tw=
-enter-translate-x: calc(var(--spacing)*2*-1); }
  .data-\[side\=3Dtop\]\:slide-in-from-bottom-2[data-side=3D"top"] { --tw-e=
nter-translate-y: calc(var(--spacing)*2); }
  .data-\[state\=3Dchecked\]\:border-primary[data-state=3D"checked"] { bord=
er-color: var(--primary); }
  .data-\[state\=3Dchecked\]\:bg-primary[data-state=3D"checked"] { backgrou=
nd-color: var(--primary); }
  .data-\[state\=3Dchecked\]\:text-primary-foreground[data-state=3D"checked=
"] { color: var(--primary-foreground); }
  .data-\[state\=3Dclosed\]\:animate-out[data-state=3D"closed"] { animation=
-timing-function: ; animation-delay: ; animation-iteration-count: ; animati=
on-direction: ; animation-fill-mode: ; animation-play-state: ; animation-ti=
meline: ; animation-range-start: ; animation-range-end: ; --tw-exit-opacity=
: initial; --tw-exit-scale: initial; --tw-exit-rotate: initial; --tw-exit-t=
ranslate-x: initial; --tw-exit-translate-y: initial; animation-name: exit; =
animation-duration: 0.15s; }
  .data-\[state\=3Dclosed\]\:fade-out-0[data-state=3D"closed"] { --tw-exit-=
opacity: 0; }
  .data-\[state\=3Dclosed\]\:zoom-out-95[data-state=3D"closed"] { --tw-exit=
-scale: .95; }
  .data-\[state\=3Dopen\]\:animate-in[data-state=3D"open"] { animation: ent=
er var(--tw-animation-duration,var(--tw-duration,.15s))var(--tw-ease,ease)v=
ar(--tw-animation-delay,0s)var(--tw-animation-iteration-count,1)var(--tw-an=
imation-direction,normal)var(--tw-animation-fill-mode,none); }
  .data-\[state\=3Dopen\]\:bg-accent[data-state=3D"open"] { background-colo=
r: var(--accent); }
  .data-\[state\=3Dopen\]\:text-accent-foreground[data-state=3D"open"] { co=
lor: var(--accent-foreground); }
  .data-\[state\=3Dopen\]\:text-muted-foreground[data-state=3D"open"] { col=
or: var(--muted-foreground); }
  .data-\[state\=3Dopen\]\:animate-in[data-state=3D"open"] { --tw-enter-opa=
city: initial; --tw-enter-scale: initial; --tw-enter-rotate: initial; --tw-=
enter-translate-x: initial; --tw-enter-translate-y: initial; animation-name=
: enter; animation-duration: 0.15s; }
  .data-\[state\=3Dopen\]\:fade-in-0[data-state=3D"open"] { --tw-enter-opac=
ity: 0; }
  .data-\[state\=3Dopen\]\:zoom-in-95[data-state=3D"open"] { --tw-enter-sca=
le: .95; }
  .data-\[selected\=3Dtrue\]\:data-\[state\=3Dopen\]\:bg-\[\#ef9541\]\/30[d=
ata-selected=3D"true"][data-state=3D"open"] { background-color: oklab(0.748=
24 0.0720983 0.125982 / 0.3); }
  .data-\[selected\=3Dtrue\]\:data-\[state\=3Dopen\]\:bg-purple-500\/20[dat=
a-selected=3D"true"][data-state=3D"open"] { background-color: rgba(172, 75,=
 255, 0.2); }
  @supports (color:color-mix(in lab,red,red)) {
  .data-\[selected\=3Dtrue\]\:data-\[state\=3Dopen\]\:bg-purple-500\/20[dat=
a-selected=3D"true"][data-state=3D"open"] { background-color: color-mix(in =
oklab,var(--color-purple-500)20%,transparent); }
}
  .data-\[selected\=3Dtrue\]\:data-\[state\=3Dopen\]\:text-\[\#ef9541\][dat=
a-selected=3D"true"][data-state=3D"open"] { color: rgb(239, 149, 65); }
  .data-\[selected\=3Dtrue\]\:data-\[state\=3Dopen\]\:text-purple-600[data-=
selected=3D"true"][data-state=3D"open"] { color: var(--color-purple-600); }
  @media not all and (min-width: 48rem) {
  .max-md\:\!px-0 { padding-inline: calc(var(--spacing)*0) !important; }
}
  @media (min-width: 40rem) {
  .sm\:mt-0 { margin-top: calc(var(--spacing)*0); }
  .sm\:mb-6 { margin-bottom: calc(var(--spacing)*6); }
  .sm\:block { display: block; }
  .sm\:hidden { display: none; }
  .sm\:h-6 { height: calc(var(--spacing)*6); }
  .sm\:h-8 { height: calc(var(--spacing)*8); }
  .sm\:w-\[400px\] { width: 400px; }
  .sm\:w-fit { width: fit-content; }
  .sm\:max-w-\[90vw\] { max-width: 90vw; }
  .sm\:max-w-lg { max-width: var(--container-lg); }
  .sm\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0px, 1fr)); }
  .sm\:flex-row { flex-direction: row; }
  .sm\:items-center { align-items: center; }
  .sm\:items-start { align-items: flex-start; }
  .sm\:justify-between { justify-content: space-between; }
  .sm\:justify-center { justify-content: center; }
  .sm\:justify-end { justify-content: flex-end; }
  .sm\:gap-4 { gap: calc(var(--spacing)*4); }
  .sm\:p-3 { padding: calc(var(--spacing)*3); }
  .sm\:p-5 { padding: calc(var(--spacing)*5); }
  .sm\:p-6 { padding: calc(var(--spacing)*6); }
  .sm\:py-3 { padding-block: calc(var(--spacing)*3); }
  .sm\:py-8 { padding-block: calc(var(--spacing)*8); }
  .sm\:text-left { text-align: left; }
  .sm\:text-2xl { font-size: var(--text-2xl); line-height: var(--tw-leading=
,var(--text-2xl--line-height)); }
  .sm\:text-3xl { font-size: var(--text-3xl); line-height: var(--tw-leading=
,var(--text-3xl--line-height)); }
  .sm\:text-base { font-size: var(--text-base); line-height: var(--tw-leadi=
ng,var(--text-base--line-height)); }
  .sm\:text-lg { font-size: var(--text-lg); line-height: var(--tw-leading,v=
ar(--text-lg--line-height)); }
  .sm\:text-sm { font-size: var(--text-sm); line-height: var(--tw-leading,v=
ar(--text-sm--line-height)); }
  .sm\:text-xl { font-size: var(--text-xl); line-height: var(--tw-leading,v=
ar(--text-xl--line-height)); }
}
  @media (min-width: 48rem) {
  .md\:sticky { position: sticky; }
  .md\:top-20 { top: calc(var(--spacing)*20); }
  .md\:top-28 { top: calc(var(--spacing)*28); }
  .md\:right-0 { right: calc(var(--spacing)*0); }
  .md\:bottom-4 { bottom: calc(var(--spacing)*4); }
  .md\:left-0 { left: calc(var(--spacing)*0); }
  .md\:block { display: block; }
  .md\:flex { display: flex; }
  .md\:hidden { display: none; }
  .md\:h-\[calc\(100vh-82px\)\] { height: calc(-82px + 100vh); }
  .md\:w-64 { width: calc(var(--spacing)*64); }
  .md\:flex-shrink-0 { flex-shrink: 0; }
  .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0px, 1fr)); }
  .md\:flex-row { flex-direction: row; }
  .md\:gap-6 { gap: calc(var(--spacing)*6); }
  .md\:overflow-y-auto { overflow-y: auto; }
  .md\:rounded-md { border-radius: calc(var(--radius) - 2px); }
  .md\:p-8 { padding: calc(var(--spacing)*8); }
  .md\:px-0 { padding-inline: calc(var(--spacing)*0); }
  .md\:py-6 { padding-block: calc(var(--spacing)*6); }
  .md\:pt-0 { padding-top: calc(var(--spacing)*0); }
  .md\:pt-6 { padding-top: calc(var(--spacing)*6); }
  .md\:pb-40 { padding-bottom: calc(var(--spacing)*40); }
  .md\:text-lg { font-size: var(--text-lg); line-height: var(--tw-leading,v=
ar(--text-lg--line-height)); }
  .md\:text-sm { font-size: var(--text-sm); line-height: var(--tw-leading,v=
ar(--text-sm--line-height)); }
}
  @media (min-width: 64rem) {
  .lg\:static { position: static; }
  .lg\:block { display: block; }
  .lg\:w-auto { width: auto; }
  .lg\:flex-1 { flex: 1 1 0%; }
  .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0px, 1fr)); }
  .lg\:flex-row { flex-direction: row; }
  .lg\:gap-10 { gap: calc(var(--spacing)*10); }
  .lg\:py-9 { padding-block: calc(var(--spacing)*9); }
  .lg\:pt-8 { padding-top: calc(var(--spacing)*8); }
  .lg\:pb-4 { padding-bottom: calc(var(--spacing)*4); }
}
  @media (min-width: 80rem) {
  .xl\:sticky { position: sticky; }
  .xl\:top-20 { top: calc(var(--spacing)*20); }
  .xl\:top-28 { top: calc(var(--spacing)*28); }
  .xl\:right-0 { right: calc(var(--spacing)*0); }
  .xl\:right-8 { right: calc(var(--spacing)*8); }
  .xl\:block { display: block; }
  .xl\:h-\[calc\(100vh-82px\)\] { height: calc(-82px + 100vh); }
  .xl\:w-64 { width: calc(var(--spacing)*64); }
  .xl\:w-72 { width: calc(var(--spacing)*72); }
  .xl\:flex-shrink-0 { flex-shrink: 0; }
  .xl\:\[flex-grow\:2\] { flex-grow: 2; }
  .xl\:\[flex-grow\:3\] { flex-grow: 3; }
  .xl\:text-2xl { font-size: var(--text-2xl); line-height: var(--tw-leading=
,var(--text-2xl--line-height)); }
  .xl\:text-lg { font-size: var(--text-lg); line-height: var(--tw-leading,v=
ar(--text-lg--line-height)); }
  .xl\:text-xl { font-size: var(--text-xl); line-height: var(--tw-leading,v=
ar(--text-xl--line-height)); }
}
  @media (min-width: 96rem) {
  .\32 xl\:right-12 { right: calc(var(--spacing)*12); }
  .\32 xl\:w-72 { width: calc(var(--spacing)*72); }
}
  .dark\:border-\[\#2F2F2F\]:where(.dark, .dark *), .dark\:border-\[\#2f2f2=
f\]:where(.dark, .dark *) { border-color: rgb(47, 47, 47); }
  .dark\:border-\[\#3a3a3a\]:where(.dark, .dark *) { border-color: rgb(58, =
58, 58); }
  .dark\:border-\[\#252525\]:where(.dark, .dark *) { border-color: rgb(37, =
37, 37); }
  .dark\:border-\[\#333333\]:where(.dark, .dark *) { border-color: rgb(51, =
51, 51); }
  .dark\:border-\[\#353535\]:where(.dark, .dark *) { border-color: rgb(53, =
53, 53); }
  .dark\:border-blue-200:where(.dark, .dark *) { border-color: var(--color-=
blue-200); }
  .dark\:border-blue-800\/30:where(.dark, .dark *) { border-color: rgba(25,=
 60, 184, 0.3); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:border-blue-800\/30:where(.dark, .dark *) { border-color: color-mi=
x(in oklab,var(--color-blue-800)30%,transparent); }
}
  .dark\:border-blue-900:where(.dark, .dark *) { border-color: var(--color-=
blue-900); }
  .dark\:border-border:where(.dark, .dark *), .dark\:border-border\/60:wher=
e(.dark, .dark *) { border-color: var(--border); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:border-border\/60:where(.dark, .dark *) { border-color: color-mix(=
in oklab,var(--border)60%,transparent); }
}
  .dark\:border-input:where(.dark, .dark *) { border-color: var(--input); }
  .dark\:border-neutral-600:where(.dark, .dark *) { border-color: var(--col=
or-neutral-600); }
  .dark\:border-neutral-700:where(.dark, .dark *) { border-color: var(--col=
or-neutral-700); }
  .dark\:border-neutral-800:where(.dark, .dark *) { border-color: var(--col=
or-neutral-800); }
  .dark\:bg-\[\#1e1e1e\]:where(.dark, .dark *) { background-color: rgb(30, =
30, 30); }
  .dark\:bg-\[\#1f1f1f\]:where(.dark, .dark *) { background-color: rgb(31, =
31, 31); }
  .dark\:bg-\[\#2a2a2a\]:where(.dark, .dark *) { background-color: rgb(42, =
42, 42); }
  .dark\:bg-\[\#3a3a45\]:where(.dark, .dark *) { background-color: rgb(58, =
58, 69); }
  .dark\:bg-\[\#331a1a\]:where(.dark, .dark *) { background-color: rgb(51, =
26, 26); }
  .dark\:bg-\[\#333\]:where(.dark, .dark *) { background-color: rgb(51, 51,=
 51); }
  .dark\:bg-\[\#121212\]:where(.dark, .dark *) { background-color: rgb(18, =
18, 18); }
  .dark\:bg-\[\#141414\]:where(.dark, .dark *) { background-color: rgb(20, =
20, 20); }
  .dark\:bg-\[\#181818\]:where(.dark, .dark *) { background-color: rgb(24, =
24, 24); }
  .dark\:bg-\[\#242424\]:where(.dark, .dark *) { background-color: rgb(36, =
36, 36); }
  .dark\:bg-\[\#252525\]:where(.dark, .dark *) { background-color: rgb(37, =
37, 37); }
  .dark\:bg-\[\#333333\]:where(.dark, .dark *) { background-color: rgb(51, =
51, 51); }
  .dark\:bg-\[\#353535\]:where(.dark, .dark *) { background-color: rgb(53, =
53, 53); }
  .dark\:bg-\[\#484848\]\/30:where(.dark, .dark *) { background-color: okla=
b(0.401667 -1.49012e-8 2.98023e-8 / 0.3); }
  .dark\:bg-\[\#535353\]:where(.dark, .dark *) { background-color: rgb(83, =
83, 83); }
  .dark\:bg-\[\#ef9541\]\/80:where(.dark, .dark *) { background-color: okla=
b(0.74824 0.0720983 0.125982 / 0.8); }
  .dark\:bg-black:where(.dark, .dark *) { background-color: var(--color-bla=
ck); }
  .dark\:bg-blue-900:where(.dark, .dark *) { background-color: var(--color-=
blue-900); }
  .dark\:bg-blue-900\/20:where(.dark, .dark *) { background-color: rgba(28,=
 57, 142, 0.2); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:bg-blue-900\/20:where(.dark, .dark *) { background-color: color-mi=
x(in oklab,var(--color-blue-900)20%,transparent); }
}
  .dark\:bg-blue-950:where(.dark, .dark *) { background-color: var(--color-=
blue-950); }
  .dark\:bg-border\/40:where(.dark, .dark *) { background-color: var(--bord=
er); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:bg-border\/40:where(.dark, .dark *) { background-color: color-mix(=
in oklab,var(--border)40%,transparent); }
}
  .dark\:bg-border\/70:where(.dark, .dark *) { background-color: var(--bord=
er); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:bg-border\/70:where(.dark, .dark *) { background-color: color-mix(=
in oklab,var(--border)70%,transparent); }
}
  .dark\:bg-border\/80:where(.dark, .dark *) { background-color: var(--bord=
er); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:bg-border\/80:where(.dark, .dark *) { background-color: color-mix(=
in oklab,var(--border)80%,transparent); }
}
  .dark\:bg-destructive\/60:where(.dark, .dark *) { background-color: var(-=
-destructive); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:bg-destructive\/60:where(.dark, .dark *) { background-color: color=
-mix(in oklab,var(--destructive)60%,transparent); }
}
  .dark\:bg-gray-800:where(.dark, .dark *) { background-color: var(--color-=
gray-800); }
  .dark\:bg-input\/30:where(.dark, .dark *) { background-color: var(--input=
); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:bg-input\/30:where(.dark, .dark *) { background-color: color-mix(i=
n oklab,var(--input)30%,transparent); }
}
  .dark\:bg-neutral-600:where(.dark, .dark *) { background-color: var(--col=
or-neutral-600); }
  .dark\:bg-neutral-600\/10:where(.dark, .dark *) { background-color: rgba(=
82, 82, 82, 0.1); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:bg-neutral-600\/10:where(.dark, .dark *) { background-color: color=
-mix(in oklab,var(--color-neutral-600)10%,transparent); }
}
  .dark\:bg-neutral-700:where(.dark, .dark *) { background-color: var(--col=
or-neutral-700); }
  .dark\:bg-neutral-800:where(.dark, .dark *) { background-color: var(--col=
or-neutral-800); }
  .dark\:bg-neutral-900:where(.dark, .dark *) { background-color: var(--col=
or-neutral-900); }
  .dark\:bg-surface:where(.dark, .dark *) { background-color: var(--bg-surf=
ace); }
  .dark\:bg-white:where(.dark, .dark *) { background-color: var(--color-whi=
te); }
  .dark\:fill-neutral-900:where(.dark, .dark *) { fill: var(--color-neutral=
-900); }
  .dark\:\!text-black:where(.dark, .dark *) { color: var(--color-black) !im=
portant; }
  .dark\:\!text-blue-200:where(.dark, .dark *) { color: var(--color-blue-20=
0) !important; }
  .dark\:\!text-neutral-300:where(.dark, .dark *) { color: var(--color-neut=
ral-300) !important; }
  .dark\:\!text-white:where(.dark, .dark *) { color: var(--color-white) !im=
portant; }
  .dark\:text-\[\#888888\]:where(.dark, .dark *) { color: rgb(136, 136, 136=
); }
  .dark\:text-\[\#e4e4e4\]:where(.dark, .dark *) { color: rgb(228, 228, 228=
); }
  .dark\:text-blue-300:where(.dark, .dark *) { color: var(--color-blue-300)=
; }
  .dark\:text-gray-300:where(.dark, .dark *) { color: var(--color-gray-300)=
; }
  .dark\:text-gray-400:where(.dark, .dark *) { color: var(--color-gray-400)=
; }
  .dark\:text-green-400:where(.dark, .dark *) { color: var(--color-green-40=
0); }
  .dark\:text-neutral-300:where(.dark, .dark *) { color: var(--color-neutra=
l-300); }
  .dark\:text-neutral-400:where(.dark, .dark *) { color: var(--color-neutra=
l-400); }
  .dark\:text-neutral-500:where(.dark, .dark *) { color: var(--color-neutra=
l-500); }
  .dark\:text-purple-400:where(.dark, .dark *) { color: var(--color-purple-=
400); }
  .dark\:text-red-400:where(.dark, .dark *) { color: var(--color-red-400); =
}
  .dark\:text-white:where(.dark, .dark *) { color: var(--color-white); }
  .dark\:text-zinc-100:where(.dark, .dark *) { color: var(--color-zinc-100)=
; }
  .dark\:text-zinc-400:where(.dark, .dark *) { color: var(--color-zinc-400)=
; }
  .dark\:text-zinc-500:where(.dark, .dark *) { color: var(--color-zinc-500)=
; }
  .dark\:\[backdrop-filter\:blur\(8px\)_contrast\(90\%\)_brightness\(60\%\)=
\]:where(.dark, .dark *) { backdrop-filter: blur(8px) contrast(90%) brightn=
ess(60%); }
  .dark\:prose-invert:where(.dark, .dark *) { --tw-prose-body: var(--color-=
text-primary); --tw-prose-headings: var(--color-text-primary); --tw-prose-l=
ead: var(--color-text-secondary); --tw-prose-links: var(--color-pacific); -=
-tw-prose-bold: var(--color-text-primary); --tw-prose-counters: var(--color=
-text-secondary); --tw-prose-bullets: var(--color-text-secondary); --tw-pro=
se-hr: var(--tw-prose-invert-hr); --tw-prose-quotes: var(--color-text-secon=
dary); --tw-prose-quote-borders: var(--color-border); --tw-prose-captions: =
var(--color-text-secondary); --tw-prose-kbd: var(--tw-prose-invert-kbd); --=
tw-prose-kbd-shadows: var(--tw-prose-invert-kbd-shadows); --tw-prose-code: =
var(--color-text-primary); --tw-prose-pre-code: var(--color-text-primary); =
--tw-prose-pre-bg: var(--color-night); --tw-prose-th-borders: var(--color-b=
order); --tw-prose-td-borders: var(--color-border); }
  .dark\:\[--c-1\:\#131313\]:where(.dark, .dark *) { --c-1: #131313; }
  .dark\:\[--c-1\:\#141414\]:where(.dark, .dark *) { --c-1: #141414; }
  .dark\:\[--c-2\:\#141414\]:where(.dark, .dark *) { --c-2: #141414; }
  .dark\:\[--c-2\:\#161616\]:where(.dark, .dark *) { --c-2: #161616; }
  .dark\:\[background\:var\(--gradient-dark\)\]:where(.dark, .dark *) { bac=
kground: var(--gradient-dark); }
  .dark\:before\:border-\[\#333\]:where(.dark, .dark *)::before { content: =
var(--tw-content); border-color: rgb(51, 51, 51); }
  .dark\:before\:bg-\[\#333\]:where(.dark, .dark *)::before { content: var(=
--tw-content); background-color: rgb(51, 51, 51); }
  @media (hover: hover) {
  .dark\:hover\:border-\[\#6a6a6a\]:where(.dark, .dark *):hover { border-co=
lor: rgb(106, 106, 106); }
  .dark\:hover\:border-blue-800:where(.dark, .dark *):hover { border-color:=
 var(--color-blue-800); }
  .dark\:hover\:bg-\[\#444\]:where(.dark, .dark *):hover { background-color=
: rgb(68, 68, 68); }
  .dark\:hover\:bg-\[\#242424\]:where(.dark, .dark *):hover { background-co=
lor: rgb(36, 36, 36); }
  .dark\:hover\:bg-\[\#252525\]:where(.dark, .dark *):hover { background-co=
lor: rgb(37, 37, 37); }
  .dark\:hover\:bg-accent\/50:where(.dark, .dark *):hover { background-colo=
r: var(--accent); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:hover\:bg-accent\/50:where(.dark, .dark *):hover { background-colo=
r: color-mix(in oklab,var(--accent)50%,transparent); }
}
  .dark\:hover\:bg-blue-800:where(.dark, .dark *):hover { background-color:=
 var(--color-blue-800); }
  .dark\:hover\:bg-blue-900:where(.dark, .dark *):hover { background-color:=
 var(--color-blue-900); }
  .dark\:hover\:bg-border\/60:where(.dark, .dark *):hover { background-colo=
r: var(--border); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:hover\:bg-border\/60:where(.dark, .dark *):hover { background-colo=
r: color-mix(in oklab,var(--border)60%,transparent); }
}
  .dark\:hover\:bg-input\/50:where(.dark, .dark *):hover { background-color=
: var(--input); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:hover\:bg-input\/50:where(.dark, .dark *):hover { background-color=
: color-mix(in oklab,var(--input)50%,transparent); }
}
  .dark\:hover\:bg-neutral-700:where(.dark, .dark *):hover { background-col=
or: var(--color-neutral-700); }
  .dark\:hover\:bg-neutral-700\/80:where(.dark, .dark *):hover { background=
-color: rgba(64, 64, 64, 0.8); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:hover\:bg-neutral-700\/80:where(.dark, .dark *):hover { background=
-color: color-mix(in oklab,var(--color-neutral-700)80%,transparent); }
}
  .dark\:hover\:bg-purple-500\/20:where(.dark, .dark *):hover { background-=
color: rgba(172, 75, 255, 0.2); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:hover\:bg-purple-500\/20:where(.dark, .dark *):hover { background-=
color: color-mix(in oklab,var(--color-purple-500)20%,transparent); }
}
  .dark\:hover\:text-neutral-400:where(.dark, .dark *):hover { color: var(-=
-color-neutral-400); }
  .dark\:hover\:text-white:where(.dark, .dark *):hover { color: var(--color=
-white); }
}
  .dark\:focus\:ring-\[\#353535\]:where(.dark, .dark *):focus { --tw-ring-c=
olor: #353535; }
  .dark\:focus-visible\:ring-destructive\/40:where(.dark, .dark *):focus-vi=
sible { --tw-ring-color: var(--destructive); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:focus-visible\:ring-destructive\/40:where(.dark, .dark *):focus-vi=
sible { --tw-ring-color: color-mix(in oklab,var(--destructive)40%,transpare=
nt); }
}
  @media (hover: hover) {
  .dark\:disabled\:hover\:border-blue-900:where(.dark, .dark *):disabled:ho=
ver { border-color: var(--color-blue-900); }
  .dark\:disabled\:hover\:bg-blue-900:where(.dark, .dark *):disabled:hover =
{ background-color: var(--color-blue-900); }
}
  .dark\:has-\[code\]\:\!bg-\[\#242424\]:where(.dark, .dark *):has(:is(code=
)) { background-color: rgb(36, 36, 36) !important; }
  .has-\[code\]\:dark\:text-white:has(:is(code)):where(.dark, .dark *) { co=
lor: var(--color-white); }
  .dark\:aria-invalid\:ring-destructive\/40:where(.dark, .dark *)[aria-inva=
lid=3D"true"] { --tw-ring-color: var(--destructive); }
  @supports (color:color-mix(in lab,red,red)) {
  .dark\:aria-invalid\:ring-destructive\/40:where(.dark, .dark *)[aria-inva=
lid=3D"true"] { --tw-ring-color: color-mix(in oklab,var(--destructive)40%,t=
ransparent); }
}
  .dark\:data-\[selected\=3Dtrue\]\:text-purple-400:where(.dark, .dark *)[d=
ata-selected=3D"true"] { color: var(--color-purple-400); }
  .dark\:data-\[state\=3Dchecked\]\:bg-primary:where(.dark, .dark *)[data-s=
tate=3D"checked"] { background-color: var(--primary); }
  .dark\:data-\[selected\=3Dtrue\]\:data-\[state\=3Dopen\]\:text-purple-400=
:where(.dark, .dark *)[data-selected=3D"true"][data-state=3D"open"] { color=
: var(--color-purple-400); }
  .prose-headings\:text-inherit :where(h1, h2, h3, h4, h5, h6, th):not(:whe=
re([class~=3D"not-prose"], [class~=3D"not-prose"] *)), .prose-p\:text-inher=
it :where(p):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"] *)) =
{ color: inherit; }
  .\[\&_\:\:selection\]\:bg-purple-500\/40 ::selection { background-color: =
rgba(172, 75, 255, 0.4); }
  @supports (color:color-mix(in lab,red,red)) {
  .\[\&_\:\:selection\]\:bg-purple-500\/40 ::selection { background-color: =
color-mix(in oklab,var(--color-purple-500)40%,transparent); }
}
  .\[\&_code\]\:block code { display: block; }
  .\[\&_code\]\:border-none code { --tw-border-style: none; border-style: n=
one; }
  .\[\&_code\]\:bg-transparent code { background-color: rgba(0, 0, 0, 0); }
  .\[\&_code\]\:p-0 code { padding: calc(var(--spacing)*0); }
  .\[\&_path\]\:animate-\[custom-pulse_1\.8s_infinite_var\(--delay\,0s\)\] =
path { animation: custom-pulse 1.8s infinite var(--delay,0s); }
  .\[\&_path\]\:stroke-0 path { stroke-width: 0; }
  .\[\&_pre\]\:my-3 pre { margin-block: calc(var(--spacing)*3); }
  .\[\&_pre\]\:overflow-hidden pre { overflow: hidden; }
  .\[\&_svg\]\:pointer-events-none svg { pointer-events: none; }
  .\[\&_svg\]\:shrink-0 svg { flex-shrink: 0; }
  .\[\&_svg_path\]\:fill-current svg path { fill: currentcolor; }
  .\[\&_svg\:not\(\[class\*\=3D\'size-\'\]\)\]\:size-4 svg:not([class*=3D"s=
ize-"]) { width: calc(var(--spacing)*4); height: calc(var(--spacing)*4); }
  .\[\&_svg\:not\(\[class\*\=3D\'text-\'\]\)\]\:text-muted-foreground svg:n=
ot([class*=3D"text-"]) { color: var(--muted-foreground); }
}

.light .prose-light { color: var(--color-text-primary); }

.light .prose-light a { color: rgb(75, 116, 217); font-weight: 500; text-de=
coration: underline; }

.light .prose-light a:hover { color: rgb(45, 72, 160); }

.light .prose-light strong { color: var(--color-text-primary); font-weight:=
 600; }

.light .prose-light ol > li::marker { color: var(--color-text-secondary); }

.light .prose-light ul > li::marker { color: var(--color-text-secondary); }

.light .prose-light hr { border-color: var(--color-border); }

.light .prose-light blockquote { color: var(--color-text-secondary); border=
-left-color: var(--color-border); }

.light .prose-light h1, .light .prose-light h2, .light .prose-light h3, .li=
ght .prose-light h4 { color: var(--color-text-primary); font-weight: 600; }

.light .prose-light code { color: var(--color-text-primary); background-col=
or: var(--bg-secondary); border-radius: 0.25em; padding: 0.2em 0.4em; }

.light .prose-light pre { border: 1px solid var(--color-border); background=
-color: rgb(241, 241, 241); }

.light .prose-light pre code { color: rgb(51, 51, 51); background-color: rg=
ba(0, 0, 0, 0); }

.light .prose-light img { border: 1px solid var(--color-border); }

.light .prose-light figure figcaption { color: var(--color-text-secondary);=
 }

.light .prose-light table { border-color: var(--color-border); }

.light .prose-light thead { color: var(--color-text-primary); }

.light .prose-light tbody tr, .light .prose-light thead { border-bottom-col=
or: var(--color-border); }

body .prose-custom p:empty { font-size: 0px; display: none; }

body .prose-custom :where(li > p):not(:where([class~=3D"not-prose"], [class=
~=3D"not-prose"] *)) { margin-top: 0.5em; margin-bottom: 0.5em; }

body .prose-custom :where(h1):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)) { letter-spacing: -0.025em; font-size: 1.5rem; font-weight=
: 700; line-height: 2rem; }

body .prose-custom :where(blockquote p:first-of-type):not(:where([class~=3D=
"not-prose"], [class~=3D"not-prose"] *))::before, body .prose-custom :where=
(blockquote p:last-of-type):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *))::after { --tw-content: none; content: var(--tw-content); }

body .prose-custom :where(blockquote):not(:where([class~=3D"not-prose"], [c=
lass~=3D"not-prose"] *)) { font-weight: inherit; }

body .prose-custom :where(blockquote:first-child p:first-child):not(:where(=
[class~=3D"not-prose"], [class~=3D"not-prose"] *)), body .prose-custom :whe=
re(p:empty + p) { margin-top: 0px; }

body .prose-custom :where(ul):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)) { padding-inline-start: 1.45em; }

body .prose-custom .cite-definition { display: none; }

body .prose-custom .cite-definition > p:first-of-type { margin-top: 0px; }

body .prose-custom .cite-definition > p:last-of-type { margin-bottom: 0px; =
}

@media (max-width: 640px) {
  body .prose-custom :where(h1):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 1.25rem; line-height: 1.75rem; }
  body .prose-custom :where(h2):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 1.125rem; line-height: 1.75rem; }
  body .prose-custom :where(h3):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 1rem; line-height: 1.5rem; }
}

::backdrop { --tw-border-spacing-x: 0; --tw-border-spacing-y: 0; --tw-trans=
late-x: 0; --tw-translate-y: 0; --tw-rotate: 0; --tw-skew-x: 0; --tw-skew-y=
: 0; --tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pin=
ch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-posit=
ion: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordi=
nal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; =
--tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --=
tw-ring-offset-color: #fff; --tw-ring-color: #3b82f680; --tw-ring-offset-sh=
adow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-=
shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ;=
 --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-=
sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness=
: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-=
rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-sa=
turate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: =
; --tw-contain-paint: ; --tw-contain-style: ; }

.\!container { width: 100% !important; margin-left: auto !important; margin=
-right: auto !important; }

.container { width: 100%; }

@media (min-width: 1400px) {
  .\!container { max-width: 1400px !important; }
  .container { max-width: 1400px; }
}

.prose-custom { color: var(--tw-prose-body); max-width: 65ch; }

.prose-custom :where(p):not(:where([class~=3D"not-prose"], [class~=3D"not-p=
rose"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; }

.prose-custom :where([class~=3D"lead"]):not(:where([class~=3D"not-prose"], =
[class~=3D"not-prose"] *)) { color: var(--tw-prose-lead); margin-top: 1.2em=
; margin-bottom: 1.2em; font-size: 1.25em; line-height: 1.6; }

.prose-custom :where(a):not(:where([class~=3D"not-prose"], [class~=3D"not-p=
rose"] *)) { color: var(--tw-prose-links); font-weight: 500; text-decoratio=
n: underline; }

.prose-custom :where(strong):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)) { color: var(--tw-prose-bold); font-weight: 600; }

.prose-custom :where(a strong):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)), .prose-custom :where(blockquote strong):not(:where([cl=
ass~=3D"not-prose"], [class~=3D"not-prose"] *)), .prose-custom :where(thead=
 th strong):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"] *)) {=
 color: inherit; }

.prose-custom :where(ol):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; padding-inline-sta=
rt: 1.625em; list-style-type: decimal; }

.prose-custom :where(ol[type=3D"A"]):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *)) { list-style-type: upper-alpha; }

.prose-custom :where(ol[type=3D"a"]):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *)) { list-style-type: lower-alpha; }

.prose-custom :where(ol[type=3D"A s"]):not(:where([class~=3D"not-prose"], [=
class~=3D"not-prose"] *)) { list-style-type: upper-alpha; }

.prose-custom :where(ol[type=3D"a s"]):not(:where([class~=3D"not-prose"], [=
class~=3D"not-prose"] *)) { list-style-type: lower-alpha; }

.prose-custom :where(ol[type=3D"I"]):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *)) { list-style-type: upper-roman; }

.prose-custom :where(ol[type=3D"i"]):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *)) { list-style-type: lower-roman; }

.prose-custom :where(ol[type=3D"I s"]):not(:where([class~=3D"not-prose"], [=
class~=3D"not-prose"] *)) { list-style-type: upper-roman; }

.prose-custom :where(ol[type=3D"i s"]):not(:where([class~=3D"not-prose"], [=
class~=3D"not-prose"] *)) { list-style-type: lower-roman; }

.prose-custom :where(ol[type=3D"1"]):not(:where([class~=3D"not-prose"], [cl=
ass~=3D"not-prose"] *)) { list-style-type: decimal; }

.prose-custom :where(ul):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; padding-inline-sta=
rt: 1.625em; list-style-type: disc; }

.prose-custom :where(ol > li):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *))::marker { color: var(--tw-prose-counters); font-weight: 40=
0; }

.prose-custom :where(ul > li):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *))::marker { color: var(--tw-prose-bullets); }

.prose-custom :where(dt):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { color: var(--tw-prose-headings); margin-top: 1.25em; font-wei=
ght: 600; }

.prose-custom :where(hr):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { border-color: var(--tw-prose-hr); border-top-width: 1px; marg=
in-top: 3em; margin-bottom: 3em; }

.prose-custom :where(blockquote):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { color: var(--tw-prose-quotes); border-inline-start-wi=
dth: 0.25rem; border-inline-start-color: var(--tw-prose-quote-borders); quo=
tes: "=E2=80=9C" "=E2=80=9D" "=E2=80=98" "=E2=80=99"; margin-top: 1.6em; ma=
rgin-bottom: 1.6em; padding-inline-start: 1em; font-style: italic; font-wei=
ght: 500; }

.prose-custom :where(blockquote p:first-of-type):not(:where([class~=3D"not-=
prose"], [class~=3D"not-prose"] *))::before { content: open-quote; }

.prose-custom :where(blockquote p:last-of-type):not(:where([class~=3D"not-p=
rose"], [class~=3D"not-prose"] *))::after { content: close-quote; }

.prose-custom :where(h1):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { color: var(--tw-prose-headings); margin-top: 0px; margin-bott=
om: 0.888889em; font-size: 2.25em; font-weight: 800; line-height: 1.11111; =
}

.prose-custom :where(h1 strong):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { color: inherit; font-weight: 900; }

.prose-custom :where(h2):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { color: var(--tw-prose-headings); margin-top: 2em; margin-bott=
om: 1em; font-size: 1.5em; font-weight: 700; line-height: 1.33333; }

.prose-custom :where(h2 strong):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { color: inherit; font-weight: 800; }

.prose-custom :where(h3):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { color: var(--tw-prose-headings); margin-top: 1.6em; margin-bo=
ttom: 0.6em; font-size: 1.25em; font-weight: 600; line-height: 1.6; }

.prose-custom :where(h3 strong):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { color: inherit; font-weight: 700; }

.prose-custom :where(h4):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { color: var(--tw-prose-headings); margin-top: 1.5em; margin-bo=
ttom: 0.5em; font-weight: 600; line-height: 1.5; }

.prose-custom :where(h4 strong):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { color: inherit; font-weight: 700; }

.prose-custom :where(img):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { margin-top: 2em; margin-bottom: 2em; }

.prose-custom :where(picture):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)) { margin-top: 2em; margin-bottom: 2em; display: block; }

.prose-custom :where(video):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 2em; margin-bottom: 2em; }

.prose-custom :where(kbd):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { color: var(--tw-prose-kbd); box-shadow: 0 0 0 1px rgb(var(--=
tw-prose-kbd-shadows)/10%),0 3px 0 rgb(var(--tw-prose-kbd-shadows)/10%); pa=
dding-top: 0.1875em; padding-inline: 0.375em; padding-bottom: 0.1875em; bor=
der-radius: 0.3125rem; font-family: inherit; font-size: 0.875em; font-weigh=
t: 500; }

.prose-custom :where(code):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *)) { color: var(--tw-prose-code); font-size: 0.875em; font-weigh=
t: 600; }

.prose-custom :where(code):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *))::after, .prose-custom :where(code):not(:where([class~=3D"not-=
prose"], [class~=3D"not-prose"] *))::before { content: "`"; }

.prose-custom :where(a code):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)), .prose-custom :where(h1 code):not(:where([class~=3D"not-pr=
ose"], [class~=3D"not-prose"] *)) { color: inherit; }

.prose-custom :where(h2 code):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)) { color: inherit; font-size: 0.875em; }

.prose-custom :where(h3 code):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)) { color: inherit; font-size: 0.9em; }

.prose-custom :where(blockquote code):not(:where([class~=3D"not-prose"], [c=
lass~=3D"not-prose"] *)), .prose-custom :where(h4 code):not(:where([class~=
=3D"not-prose"], [class~=3D"not-prose"] *)), .prose-custom :where(thead th =
code):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { color=
: inherit; }

.prose-custom :where(pre):not(:where([class~=3D"not-prose"], [class~=3D"not=
-prose"] *)) { color: var(--tw-prose-pre-code); background-color: var(--tw-=
prose-pre-bg); padding-top: 0.857143em; padding-inline: 1.14286em; padding-=
bottom: 0.857143em; border-radius: 0.375rem; margin-top: 1.71429em; margin-=
bottom: 1.71429em; font-size: 0.875em; font-weight: 400; line-height: 1.714=
29; overflow-x: auto; }

.prose-custom :where(pre code):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-weight: inherit; color: inherit; font-size: inhe=
rit; font-family: inherit; line-height: inherit; background-color: rgba(0, =
0, 0, 0); border-width: 0px; border-radius: 0px; padding: 0px; }

.prose-custom :where(pre code):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *))::after, .prose-custom :where(pre code):not(:where([clas=
s~=3D"not-prose"], [class~=3D"not-prose"] *))::before { content: none; }

.prose-custom :where(table):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { table-layout: auto; text-align: start; width: 100%; margin=
-top: 2em; margin-bottom: 2em; font-size: 0.875em; line-height: 1.71429; }

.prose-custom :where(thead):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { border-bottom-width: 1px; border-bottom-color: var(--tw-pr=
ose-th-borders); }

.prose-custom :where(thead th):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { color: var(--tw-prose-headings); vertical-align: bott=
om; padding-inline: 0.571429em; padding-bottom: 0.571429em; font-weight: 60=
0; }

.prose-custom :where(tbody tr):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { border-bottom-width: 1px; border-bottom-color: var(--=
tw-prose-td-borders); }

.prose-custom :where(tbody tr:last-child):not(:where([class~=3D"not-prose"]=
, [class~=3D"not-prose"] *)) { border-bottom-width: 0px; }

.prose-custom :where(tbody td):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { vertical-align: baseline; }

.prose-custom :where(tfoot):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { border-top-width: 1px; border-top-color: var(--tw-prose-th=
-borders); }

.prose-custom :where(tfoot td):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { vertical-align: top; }

.prose-custom :where(figure > *):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }

.prose-custom :where(figcaption):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { color: var(--tw-prose-captions); margin-top: 0.857143=
em; font-size: 0.875em; line-height: 1.42857; }

.prose-custom { --tw-prose-body: #374151; --tw-prose-headings: #111827; --t=
w-prose-lead: #4b5563; --tw-prose-links: #111827; --tw-prose-bold: #111827;=
 --tw-prose-counters: #6b7280; --tw-prose-bullets: #d1d5db; --tw-prose-hr: =
#e5e7eb; --tw-prose-quotes: #111827; --tw-prose-quote-borders: #e5e7eb; --t=
w-prose-captions: #6b7280; --tw-prose-kbd: #111827; --tw-prose-kbd-shadows:=
 17 24 39; --tw-prose-code: #111827; --tw-prose-pre-code: #e5e7eb; --tw-pro=
se-pre-bg: #1f2937; --tw-prose-th-borders: #d1d5db; --tw-prose-td-borders: =
#e5e7eb; --tw-prose-invert-body: #d1d5db; --tw-prose-invert-headings: #fff;=
 --tw-prose-invert-lead: #9ca3af; --tw-prose-invert-links: #fff; --tw-prose=
-invert-bold: #fff; --tw-prose-invert-counters: #9ca3af; --tw-prose-invert-=
bullets: #4b5563; --tw-prose-invert-hr: #374151; --tw-prose-invert-quotes: =
#f3f4f6; --tw-prose-invert-quote-borders: #374151; --tw-prose-invert-captio=
ns: #9ca3af; --tw-prose-invert-kbd: #fff; --tw-prose-invert-kbd-shadows: 25=
5 255 255; --tw-prose-invert-code: #fff; --tw-prose-invert-pre-code: #d1d5d=
b; --tw-prose-invert-pre-bg: #00000080; --tw-prose-invert-th-borders: #4b55=
63; --tw-prose-invert-td-borders: #374151; font-size: 1rem; line-height: 1.=
75; }

.prose-custom :where(picture > img):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }

.prose-custom :where(li):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { margin-top: 0.5em; margin-bottom: 0.5em; }

.prose-custom :where(ol > li):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)), .prose-custom :where(ul > li):not(:where([class~=3D"not-p=
rose"], [class~=3D"not-prose"] *)) { padding-inline-start: 0.375em; }

.prose-custom :where(.prose-custom > ul > li p):not(:where([class~=3D"not-p=
rose"], [class~=3D"not-prose"] *)) { margin-top: 0.75em; margin-bottom: 0.7=
5em; }

.prose-custom :where(.prose-custom > ul > li > p:first-child):not(:where([c=
lass~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.25em; }

.prose-custom :where(.prose-custom > ul > li > p:last-child):not(:where([cl=
ass~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.25em; }

.prose-custom :where(.prose-custom > ol > li > p:first-child):not(:where([c=
lass~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.25em; }

.prose-custom :where(.prose-custom > ol > li > p:last-child):not(:where([cl=
ass~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.25em; }

.prose-custom :where(ul ul, ul ol, ol ul, ol ol):not(:where([class~=3D"not-=
prose"], [class~=3D"not-prose"] *)) { margin-top: 0.75em; margin-bottom: 0.=
75em; }

.prose-custom :where(dl):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; }

.prose-custom :where(dd):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { margin-top: 0.5em; padding-inline-start: 1.625em; }

.prose-custom :where(h2 + *):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)), .prose-custom :where(h3 + *):not(:where([class~=3D"not-pro=
se"], [class~=3D"not-prose"] *)), .prose-custom :where(h4 + *):not(:where([=
class~=3D"not-prose"], [class~=3D"not-prose"] *)), .prose-custom :where(hr =
+ *):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin=
-top: 0px; }

.prose-custom :where(thead th:first-child):not(:where([class~=3D"not-prose"=
], [class~=3D"not-prose"] *)) { padding-inline-start: 0px; }

.prose-custom :where(thead th:last-child):not(:where([class~=3D"not-prose"]=
, [class~=3D"not-prose"] *)) { padding-inline-end: 0px; }

.prose-custom :where(tbody td, tfoot td):not(:where([class~=3D"not-prose"],=
 [class~=3D"not-prose"] *)) { padding-top: 0.571429em; padding-inline: 0.57=
1429em; padding-bottom: 0.571429em; }

.prose-custom :where(tbody td:first-child, tfoot td:first-child):not(:where=
([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-start:=
 0px; }

.prose-custom :where(tbody td:last-child, tfoot td:last-child):not(:where([=
class~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-end: 0px=
; }

.prose-custom :where(figure):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)) { margin-top: 2em; margin-bottom: 2em; }

.prose-custom :where(.prose-custom > :first-child):not(:where([class~=3D"no=
t-prose"], [class~=3D"not-prose"] *)) { margin-top: 0px; }

.prose-custom :where(.prose-custom > :last-child):not(:where([class~=3D"not=
-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 0px; }

.prose-custom :where(em):not(:where([class~=3D"not-prose"], [class~=3D"not-=
prose"] *)) { font-style: normal; font-weight: 700; display: inline-block; =
}

.prose-custom-sm { font-size: 0.825rem; line-height: 1.8; }

.prose-custom-sm :where(p):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *)) { margin-top: 1.1em; margin-bottom: 1.1em; }

.prose-custom-sm :where([class~=3D"lead"]):not(:where([class~=3D"not-prose"=
], [class~=3D"not-prose"] *)) { margin-top: 0.8em; margin-bottom: 0.8em; fo=
nt-size: 1.15em; line-height: 1.7; }

.prose-custom-sm :where(blockquote):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 1.25em; margin-bottom: 1.25em; padding=
-inline-start: 1.05em; }

.prose-custom-sm :where(h1):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { letter-spacing: -0.015em; margin-top: 0px; margin-bottom: =
0.75em; font-size: 1.5em; font-weight: 700; line-height: 1.35; }

body .prose-custom-sm :where(h1):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 1.25rem; font-weight: 700; line-height: 1.=
75rem; }

.prose-custom-sm :where(h2):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { letter-spacing: -0.01em; margin-top: 1.45em; margin-bottom=
: 0.75em; font-size: 1.25em; font-weight: 700; line-height: 1.5; }

body .prose-custom-sm :where(h2):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 1.125rem; font-weight: 700; line-height: 1=
.65rem; }

.prose-custom-sm :where(h3):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.45em; margin-bottom: 0.45em; font-size: 1.15=
em; line-height: 1.6; }

.prose-custom-sm :where(h4):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.2em; margin-bottom: 0.5em; line-height: 1.3;=
 }

.prose-custom-sm :where(img):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)), .prose-custom-sm :where(picture):not(:where([class~=3D"not=
-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.5em; margin-bottom: 1.=
5em; }

.prose-custom-sm :where(picture > img):not(:where([class~=3D"not-prose"], [=
class~=3D"not-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }

.prose-custom-sm :where(video):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { margin-top: 1.5em; margin-bottom: 1.5em; }

.prose-custom-sm :where(kbd):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)) { padding-top: 0.15em; padding-inline: 0.35em; padding-bott=
om: 0.15em; border-radius: 0.25rem; font-size: 0.8em; }

.prose-custom-sm :where(code):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)) { font-size: 0.8em; }

.prose-custom-sm :where(h2 code):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 0.85em; }

.prose-custom-sm :where(h3 code):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 0.8em; }

.prose-custom-sm :where(pre):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)) { margin-top: 1.6em; margin-bottom: 1.6em; font-size: 0.8em=
; line-height: 1.8; }

.prose-custom-sm :where(ol):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)), .prose-custom-sm :where(ul):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *)) { margin-top: 1em; margin-bottom: 1em; paddi=
ng-inline-start: 1.4em; }

.prose-custom-sm :where(li):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 0.25em; margin-bottom: 0.25em; }

.prose-custom-sm :where(ol > li):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)), .prose-custom-sm :where(ul > li):not(:where([class~=3D=
"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-start: 0.4em; }

.prose-custom-sm :where(.prose-custom-sm > ul > li p):not(:where([class~=3D=
"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 0.571429em; margin-b=
ottom: 0.571429em; }

.prose-custom-sm :where(.prose-custom-sm > ul > li > p:first-child):not(:wh=
ere([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.1428=
6em; }

.prose-custom-sm :where(.prose-custom-sm > ul > li > p:last-child):not(:whe=
re([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.14=
286em; }

.prose-custom-sm :where(.prose-custom-sm > ol > li > p:first-child):not(:wh=
ere([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.1428=
6em; }

.prose-custom-sm :where(.prose-custom-sm > ol > li > p:last-child):not(:whe=
re([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.14=
286em; }

.prose-custom-sm :where(ul ul, ul ol, ol ul, ol ol):not(:where([class~=3D"n=
ot-prose"], [class~=3D"not-prose"] *)) { margin-top: 0.571429em; margin-bot=
tom: 0.571429em; }

.prose-custom-sm :where(dl):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.14286em; margin-bottom: 1.14286em; }

.prose-custom-sm :where(dt):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.14286em; }

.prose-custom-sm :where(dd):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 0.285714em; padding-inline-start: 1.57143em; }

.prose-custom-sm :where(hr):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 2.85714em; margin-bottom: 2.85714em; }

.prose-custom-sm :where(h2 + *):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)), .prose-custom-sm :where(h3 + *):not(:where([class~=3D"=
not-prose"], [class~=3D"not-prose"] *)), .prose-custom-sm :where(h4 + *):no=
t(:where([class~=3D"not-prose"], [class~=3D"not-prose"] *)), .prose-custom-=
sm :where(hr + *):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"]=
 *)) { margin-top: 0px; }

.prose-custom-sm :where(table):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 0.75em; line-height: 1.4; }

.prose-custom-sm :where(thead th):not(:where([class~=3D"not-prose"], [class=
~=3D"not-prose"] *)) { padding-inline: 0.9em; padding-bottom: 0.6em; }

.prose-custom-sm :where(thead th:first-child):not(:where([class~=3D"not-pro=
se"], [class~=3D"not-prose"] *)) { padding-inline-start: 0px; }

.prose-custom-sm :where(thead th:last-child):not(:where([class~=3D"not-pros=
e"], [class~=3D"not-prose"] *)) { padding-inline-end: 0px; }

.prose-custom-sm :where(tbody td, tfoot td):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *)) { padding-top: 0.6em; padding-inline: 0.9em;=
 padding-bottom: 0.6em; }

.prose-custom-sm :where(tbody td:first-child, tfoot td:first-child):not(:wh=
ere([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-sta=
rt: 0px; }

.prose-custom-sm :where(tbody td:last-child, tfoot td:last-child):not(:wher=
e([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-end: =
0px; }

.prose-custom-sm :where(figure):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { margin-top: 1.5em; margin-bottom: 1.5em; }

.prose-custom-sm :where(figure > *):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }

.prose-custom-sm :where(figcaption):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 0.6em; font-size: 0.75em; line-height:=
 1.3; }

.prose-custom-sm :where(.prose-custom-sm > :first-child):not(:where([class~=
=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 0px; }

.prose-custom-sm :where(.prose-custom-sm > :last-child):not(:where([class~=
=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 0px; }

.prose-custom-gray { --tw-prose-body: hsl(var(--gray-900)); --tw-prose-head=
ings: hsl(var(--gray-900)); --tw-prose-lead: hsl(var(--gray-600)); --tw-pro=
se-links: hsl(var(--gray-900)); --tw-prose-bold: hsl(var(--gray-900)); --tw=
-prose-counters: hsl(var(--gray-500)); --tw-prose-bullets: hsl(var(--gray-3=
00)); --tw-prose-hr: hsl(var(--gray-200)); --tw-prose-quotes: hsl(var(--gra=
y-900)); --tw-prose-quote-borders: hsl(var(--gray-200)); --tw-prose-caption=
s: hsl(var(--gray-500)); --tw-prose-kbd: hsl(var(--gray-900)); --tw-prose-k=
bd-shadows: hsl(var(--gray-900)); --tw-prose-code: hsl(var(--gray-900)); --=
tw-prose-pre-code: hsl(var(--gray-200)); --tw-prose-pre-bg: hsl(var(--gray-=
800)); --tw-prose-th-borders: hsl(var(--gray-300)); --tw-prose-td-borders: =
hsl(var(--gray-200)); --tw-prose-invert-body: #d1d5db; --tw-prose-invert-he=
adings: #fff; --tw-prose-invert-lead: #9ca3af; --tw-prose-invert-links: #ff=
f; --tw-prose-invert-bold: #fff; --tw-prose-invert-counters: #9ca3af; --tw-=
prose-invert-bullets: #4b5563; --tw-prose-invert-hr: #374151; --tw-prose-in=
vert-quotes: #f3f4f6; --tw-prose-invert-quote-borders: #374151; --tw-prose-=
invert-captions: #9ca3af; --tw-prose-invert-kbd: #fff; --tw-prose-invert-kb=
d-shadows: 255 255 255; --tw-prose-invert-code: #fff; --tw-prose-invert-pre=
-code: #d1d5db; --tw-prose-invert-pre-bg: #00000080; --tw-prose-invert-th-b=
orders: #4b5563; --tw-prose-invert-td-borders: #374151; }

.prose-custom-stone { --tw-prose-body: #44403c; --tw-prose-headings: #1c191=
7; --tw-prose-lead: #57534e; --tw-prose-links: #1c1917; --tw-prose-bold: #1=
c1917; --tw-prose-counters: #78716c; --tw-prose-bullets: #d6d3d1; --tw-pros=
e-hr: #e7e5e4; --tw-prose-quotes: #1c1917; --tw-prose-quote-borders: #e7e5e=
4; --tw-prose-captions: #78716c; --tw-prose-kbd: #1c1917; --tw-prose-kbd-sh=
adows: 28 25 23; --tw-prose-code: #1c1917; --tw-prose-pre-code: #e7e5e4; --=
tw-prose-pre-bg: #292524; --tw-prose-th-borders: #d6d3d1; --tw-prose-td-bor=
ders: #e7e5e4; --tw-prose-invert-body: #d6d3d1; --tw-prose-invert-headings:=
 #fff; --tw-prose-invert-lead: #a8a29e; --tw-prose-invert-links: #fff; --tw=
-prose-invert-bold: #fff; --tw-prose-invert-counters: #a8a29e; --tw-prose-i=
nvert-bullets: #57534e; --tw-prose-invert-hr: #44403c; --tw-prose-invert-qu=
otes: #f5f5f4; --tw-prose-invert-quote-borders: #44403c; --tw-prose-invert-=
captions: #a8a29e; --tw-prose-invert-kbd: #fff; --tw-prose-invert-kbd-shado=
ws: 255 255 255; --tw-prose-invert-code: #fff; --tw-prose-invert-pre-code: =
#d6d3d1; --tw-prose-invert-pre-bg: #00000080; --tw-prose-invert-th-borders:=
 #57534e; --tw-prose-invert-td-borders: #44403c; }

.prose-custom-md { font-size: 0.925rem; line-height: 1.75; }

.prose-custom-md :where(p):not(:where([class~=3D"not-prose"], [class~=3D"no=
t-prose"] *)) { margin-top: 1.15em; margin-bottom: 1.15em; }

.prose-custom-md :where([class~=3D"lead"]):not(:where([class~=3D"not-prose"=
], [class~=3D"not-prose"] *)) { margin-top: 1em; margin-bottom: 1em; font-s=
ize: 1.2em; line-height: 1.65; }

.prose-custom-md :where(blockquote):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 1.35em; margin-bottom: 1.35em; padding=
-inline-start: 1.1em; }

.prose-custom-md :where(h1):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { letter-spacing: -0.02em; margin-top: 0px; margin-bottom: 0=
.8em; font-size: 1.75em; font-weight: 700; line-height: 1.4; }

body .prose-custom-md :where(h1):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 1.375rem; font-weight: 700; line-height: 1=
.875rem; }

.prose-custom-md :where(h2):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { letter-spacing: -0.015em; margin-top: 1.5em; margin-bottom=
: 0.8em; font-size: 1.35em; font-weight: 700; line-height: 1.55; }

body .prose-custom-md :where(h2):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 1.25rem; font-weight: 700; line-height: 1.=
75rem; }

.prose-custom-md :where(h3):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.5em; margin-bottom: 0.5em; font-size: 1.2em;=
 line-height: 1.65; }

.prose-custom-md :where(h4):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.3em; margin-bottom: 0.55em; line-height: 1.4=
; }

.prose-custom-md :where(img):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)), .prose-custom-md :where(picture):not(:where([class~=3D"not=
-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.75em; margin-bottom: 1=
.75em; }

.prose-custom-md :where(picture > img):not(:where([class~=3D"not-prose"], [=
class~=3D"not-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }

.prose-custom-md :where(video):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { margin-top: 1.75em; margin-bottom: 1.75em; }

.prose-custom-md :where(kbd):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)) { padding-top: 0.175em; padding-inline: 0.375em; padding-bo=
ttom: 0.175em; border-radius: 0.3rem; font-size: 0.85em; }

.prose-custom-md :where(code):not(:where([class~=3D"not-prose"], [class~=3D=
"not-prose"] *)) { font-size: 0.85em; }

.prose-custom-md :where(h2 code):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 0.875em; }

.prose-custom-md :where(h3 code):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 0.85em; }

.prose-custom-md :where(pre):not(:where([class~=3D"not-prose"], [class~=3D"=
not-prose"] *)) { margin-top: 1.75em; margin-bottom: 1.75em; font-size: 0.8=
5em; line-height: 1.75; }

.prose-custom-md :where(ol):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)), .prose-custom-md :where(ul):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *)) { margin-top: 1.15em; margin-bottom: 1.15em;=
 padding-inline-start: 1.5em; }

.prose-custom-md :where(li):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 0.35em; margin-bottom: 0.35em; }

.prose-custom-md :where(ol > li):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)), .prose-custom-md :where(ul > li):not(:where([class~=3D=
"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-start: 0.45em; }

.prose-custom-md :where(.prose-custom-md > ul > li p):not(:where([class~=3D=
"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 0.65em; margin-botto=
m: 0.65em; }

.prose-custom-md :where(.prose-custom-md > ul > li > p:first-child):not(:wh=
ere([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.2em;=
 }

.prose-custom-md :where(.prose-custom-md > ul > li > p:last-child):not(:whe=
re([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.2e=
m; }

.prose-custom-md :where(.prose-custom-md > ol > li > p:first-child):not(:wh=
ere([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 1.2em;=
 }

.prose-custom-md :where(.prose-custom-md > ol > li > p:last-child):not(:whe=
re([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 1.2e=
m; }

.prose-custom-md :where(ul ul, ul ol, ol ul, ol ol):not(:where([class~=3D"n=
ot-prose"], [class~=3D"not-prose"] *)) { margin-top: 0.65em; margin-bottom:=
 0.65em; }

.prose-custom-md :where(dl):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.2em; margin-bottom: 1.2em; }

.prose-custom-md :where(dt):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 1.2em; }

.prose-custom-md :where(dd):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 0.325em; padding-inline-start: 1.6em; }

.prose-custom-md :where(hr):not(:where([class~=3D"not-prose"], [class~=3D"n=
ot-prose"] *)) { margin-top: 2.9em; margin-bottom: 2.9em; }

.prose-custom-md :where(h2 + *):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)), .prose-custom-md :where(h3 + *):not(:where([class~=3D"=
not-prose"], [class~=3D"not-prose"] *)), .prose-custom-md :where(h4 + *):no=
t(:where([class~=3D"not-prose"], [class~=3D"not-prose"] *)), .prose-custom-=
md :where(hr + *):not(:where([class~=3D"not-prose"], [class~=3D"not-prose"]=
 *)) { margin-top: 0px; }

.prose-custom-md :where(table):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { font-size: 0.875em; line-height: 1.5; }

.prose-custom-md :where(thead th):not(:where([class~=3D"not-prose"], [class=
~=3D"not-prose"] *)) { padding-inline: 0.95em; padding-bottom: 0.65em; }

.prose-custom-md :where(thead th:first-child):not(:where([class~=3D"not-pro=
se"], [class~=3D"not-prose"] *)) { padding-inline-start: 0px; }

.prose-custom-md :where(thead th:last-child):not(:where([class~=3D"not-pros=
e"], [class~=3D"not-prose"] *)) { padding-inline-end: 0px; }

.prose-custom-md :where(tbody td, tfoot td):not(:where([class~=3D"not-prose=
"], [class~=3D"not-prose"] *)) { padding-top: 0.65em; padding-inline: 0.95e=
m; padding-bottom: 0.65em; }

.prose-custom-md :where(tbody td:first-child, tfoot td:first-child):not(:wh=
ere([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-sta=
rt: 0px; }

.prose-custom-md :where(tbody td:last-child, tfoot td:last-child):not(:wher=
e([class~=3D"not-prose"], [class~=3D"not-prose"] *)) { padding-inline-end: =
0px; }

.prose-custom-md :where(figure):not(:where([class~=3D"not-prose"], [class~=
=3D"not-prose"] *)) { margin-top: 1.75em; margin-bottom: 1.75em; }

.prose-custom-md :where(figure > *):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 0px; margin-bottom: 0px; }

.prose-custom-md :where(figcaption):not(:where([class~=3D"not-prose"], [cla=
ss~=3D"not-prose"] *)) { margin-top: 0.7em; font-size: 0.875em; line-height=
: 1.4; }

.prose-custom-md :where(.prose-custom-md > :first-child):not(:where([class~=
=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-top: 0px; }

.prose-custom-md :where(.prose-custom-md > :last-child):not(:where([class~=
=3D"not-prose"], [class~=3D"not-prose"] *)) { margin-bottom: 0px; }

@property --tw-animation-delay { syntax: "*"; inherits: false; initial-valu=
e: 0s; }

@property --tw-animation-direction { syntax: "*"; inherits: false; initial-=
value: normal; }

@property --tw-animation-duration { syntax: "*"; inherits: false; }

@property --tw-animation-fill-mode { syntax: "*"; inherits: false; initial-=
value: none; }

@property --tw-animation-iteration-count { syntax: "*"; inherits: false; in=
itial-value: 1; }

@property --tw-enter-blur { syntax: "*"; inherits: false; initial-value: 0;=
 }

@property --tw-enter-opacity { syntax: "*"; inherits: false; initial-value:=
 1; }

@property --tw-enter-rotate { syntax: "*"; inherits: false; initial-value: =
0; }

@property --tw-enter-scale { syntax: "*"; inherits: false; initial-value: 1=
; }

@property --tw-enter-translate-x { syntax: "*"; inherits: false; initial-va=
lue: 0; }

@property --tw-enter-translate-y { syntax: "*"; inherits: false; initial-va=
lue: 0; }

@property --tw-exit-blur { syntax: "*"; inherits: false; initial-value: 0; =
}

@property --tw-exit-opacity { syntax: "*"; inherits: false; initial-value: =
1; }

@property --tw-exit-rotate { syntax: "*"; inherits: false; initial-value: 0=
; }

@property --tw-exit-scale { syntax: "*"; inherits: false; initial-value: 1;=
 }

@property --tw-exit-translate-x { syntax: "*"; inherits: false; initial-val=
ue: 0; }

@property --tw-exit-translate-y { syntax: "*"; inherits: false; initial-val=
ue: 0; }

.light { --color-text-primary: #333; --color-text-secondary: #666; --color-=
border: #e0e0e0; --color-border-hover: #d0d0d0; --color-hover: #e8e8e8; --c=
olor-night: #f1f1f1; --color-codemaps-glyph: #7c1bd6; --color-codemap-bg: #=
f6f6f6; --bg-surface: #f2f1f0; --bg-surface-hover: #e8e8e8; --bg-secondary:=
 #e8e8e8; --bg-component: #e0e0e0; --bg-placeholder: #ccc; }

.prose { color: var(--color-text-primary); }

.light .text-white { color: inherit; }

.container-wrapper { border-color: var(--color-border); border-style: dashe=
d; width: 100%; max-width: 1400px; margin-left: auto; margin-right: auto; }

@media (min-width: 1400px) {
  .container-wrapper { border-left-width: 1px; border-right-width: 1px; }
}

@media (min-width: 1800px) {
  .container-wrapper { max-width: 1536px; }
}

.container { max-width: 1536px; margin-left: auto; margin-right: auto; padd=
ing-left: 1rem; padding-right: 1rem; }

@media (min-width: 1280px) {
  .container { padding-left: 1.5rem; padding-right: 1.5rem; }
}

details { border: 1px solid var(--color-border); border-radius: 0.5rem; mar=
gin-bottom: 0.5rem; padding: 0.5rem 0.75rem; }

details[open] { padding-bottom: 0.5rem; }

details > summary { cursor: pointer; align-items: center; gap: 0.5rem; marg=
in: -0.5rem; padding: 0.5rem; list-style: none; display: flex; }

details > summary::before { content: ""; background-image: url("data:image/=
svg+xml,%3Csvg xmlns=3D'http://www.w3.org/2000/svg' viewBox=3D'0 0 16 16'%3=
E%3Cpath fill=3D'%23cbcbcb' d=3D'M6.22 3.22a.75.75 0 011.06 0l4.25 4.25a.75=
.75 0 010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06L9.94 8 6.22 4.28a.75.75 0 0=
10-1.06z'%3E%3C/path%3E%3C/svg%3E"); width: 1rem; height: 1rem; transition:=
 transform 0.2s; }

.light details > summary::before { background-image: url("data:image/svg+xm=
l,%3Csvg xmlns=3D'http://www.w3.org/2000/svg' viewBox=3D'0 0 16 16'%3E%3Cpa=
th fill=3D'%23666666' d=3D'M6.22 3.22a.75.75 0 011.06 0l4.25 4.25a.75.75 0 =
010 1.06l-4.25 4.25a.75.75 0 01-1.06-1.06L9.94 8 6.22 4.28a.75.75 0 010-1.0=
6z'%3E%3C/path%3E%3C/svg%3E"); }

details[open] > summary::before { transform: rotate(90deg); }

details > summary::-webkit-details-marker { display: none; }

details > p { margin-top: 0.5rem; margin-bottom: 0px; padding-left: 1.5rem;=
 font-size: 0.875rem; }

details li { margin: 0.25rem 0px; padding-left: 1.5rem; list-style: none; }

details ul { margin: 0px; padding-left: 0px; }

.scrollbar-hide { scrollbar-width: none; }

@keyframes shimmer {=20
  0% { background-position: -1000px 0px; }
  100% { background-position: 1000px 0px; }
}

.animate-shimmer { background-image: ; background-position-x: ; background-=
position-y: ; background-repeat: ; background-attachment: ; background-orig=
in: ; background-clip: ; background-color: ; background-size: 1000px 100%; =
animation: 2.5s linear 0s infinite normal none running shimmer; }

.powered-by-devin-gradient { background-color: rgba(0, 0, 0, 0); background=
-size: 200% 100%; }

:root { --radius: .65rem; --background: #f8f7f6; --foreground: #333; --colo=
r-codemaps-glyph: #7c1bd6; --color-codemap-bg: #f6f6f6; --card: oklch(1 0 0=
); --card-foreground: oklch(.141 .005 285.823); --popover: oklch(1 0 0); --=
popover-foreground: oklch(.141 .005 285.823); --primary: oklch(.623 .214 25=
9.815); --primary-foreground: oklch(.97 .014 254.604); --secondary: oklch(.=
967 .001 286.375); --secondary-foreground: oklch(.21 .006 285.885); --muted=
: oklch(.967 .001 286.375); --muted-foreground: oklch(.552 .016 285.938); -=
-accent: oklch(.967 .001 286.375); --accent-foreground: oklch(.21 .006 285.=
885); --destructive: oklch(.577 .245 27.325); --border: oklch(.922 0 0); --=
input: oklch(.622 0 0); --ring: oklch(.708 0 0); --chart-1: oklch(.646 .222=
 41.116); --chart-2: oklch(.6 .118 184.704); --chart-3: oklch(.398 .07 227.=
392); --chart-4: oklch(.828 .189 84.429); --chart-5: oklch(.769 .188 70.08)=
; --sidebar: oklch(.985 0 0); --sidebar-foreground: oklch(.141 .005 285.823=
); --sidebar-primary: oklch(.623 .214 259.815); --sidebar-primary-foregroun=
d: oklch(.97 .014 254.604); --sidebar-accent: oklch(.967 .001 286.375); --s=
idebar-accent-foreground: oklch(.21 .006 285.885); --sidebar-border: oklch(=
.92 .004 286.32); --sidebar-ring: oklch(.623 .214 259.815); --clay: oklch(7=
2.06% .1066 51.426); --clay-50: oklch(98.982% .00417 56.376); --clay-100: o=
klch(95.91% .01439 50.804); --clay-200: oklch(89.748% .03637 50.975); --cla=
y-300: oklch(83.818% .05907 52.409); --clay-400: oklch(77.777% .08285 51.50=
5); --clay-500: oklch(72.06% .1066 51.426); --clay-600: oklch(64.515% .1377=
6 49.406); --clay-700: oklch(54.614% .12025 49.119); --clay-800: oklch(43.7=
25% .09357 49.287); --clay-900: oklch(31.953% .06351 50.207); --clay-950: o=
klch(25.842% .04804 49.421); }

.dark { --background: #101010; --foreground: #cbcbcb; --color-codemaps-glyp=
h: #a855f7; --color-codemap-bg: #151515; --card: oklch(.21 .006 285.885); -=
-card-foreground: oklch(.985 0 0); --popover: oklch(.21 .006 285.885); --po=
pover-foreground: oklch(.985 0 0); --primary: oklch(.546 .245 262.881); --p=
rimary-foreground: oklch(1 .0197 265.522); --secondary: oklch(.274 .006 286=
.033); --secondary-foreground: oklch(.985 0 0); --muted: oklch(.274 .006 28=
6.033); --muted-foreground: oklch(.705 .015 286.067); --accent: oklch(.274 =
.006 286.033); --accent-foreground: oklch(.985 0 0); --destructive: oklch(.=
704 .191 22.216); --border: oklch(1 0 0/10%); --input: oklch(1 0 0/15%); --=
ring: oklch(.556 0 0); --chart-1: oklch(.488 .243 264.376); --chart-2: oklc=
h(.696 .17 162.48); --chart-3: oklch(.769 .188 70.08); --chart-4: oklch(.62=
7 .265 303.9); --chart-5: oklch(.645 .246 16.439); --sidebar: oklch(.21 .00=
6 285.885); --sidebar-foreground: oklch(.985 0 0); --sidebar-primary: oklch=
(.546 .245 262.881); --sidebar-primary-foreground: oklch(1 .0197 265.522); =
--sidebar-accent: oklch(.274 .006 286.033); --sidebar-accent-foreground: ok=
lch(.985 0 0); --sidebar-border: oklch(1 0 0/10%); --sidebar-ring: oklch(.4=
88 .243 264.376); }

::view-transition-group(root) { animation-duration: 0.7s; animation-timing-=
function: var(--expo-out); }

::view-transition-new(root) { animation-name: reveal-light; }

::view-transition-old(root) { z-index: -1; animation: auto ease 0s 1 normal=
 none running none; }

.dark::view-transition-old(root) { z-index: -1; animation: auto ease 0s 1 n=
ormal none running none; }

.dark::view-transition-new(root) { animation-name: reveal-dark; }

@keyframes reveal-dark {=20
  0% { clip-path: polygon(50% -71%, -50% 71%, -50% 71%, 50% -71%); opacity:=
 0.5; }
  100% { clip-path: polygon(50% -71%, -50% 71%, 50% 171%, 171% 50%); opacit=
y: 1; }
}

@keyframes reveal-light {=20
  0% { clip-path: polygon(171% 50%, 50% 171%, 50% 171%, 171% 50%); opacity:=
 0.5; }
  100% { clip-path: polygon(171% 50%, 50% 171%, -50% 71%, 50% -71%); opacit=
y: 1; }
}

.code-map-last-clicked-decoration { background-color: rgba(187, 109, 255, 0=
.086); }

.codemap-temporary-line-highlight { background-color: rgba(187, 109, 255, 0=
.086); animation: 3s ease-out 0s 1 normal forwards running fadeOut; }

@keyframes fadeOut {=20
  0% { opacity: 1; }
  100% { opacity: 0; }
}

@keyframes enter {=20
  0% { opacity: var(--tw-enter-opacity,1); transform: translate3d(var(--tw-=
enter-translate-x,0),var(--tw-enter-translate-y,0),0)scale3d(var(--tw-enter=
-scale,1),var(--tw-enter-scale,1),var(--tw-enter-scale,1))rotate(var(--tw-e=
nter-rotate,0)); }
}

@keyframes exit {=20
  100% { opacity: var(--tw-exit-opacity,1); transform: translate3d(var(--tw=
-exit-translate-x,0),var(--tw-exit-translate-y,0),0)scale3d(var(--tw-exit-s=
cale,1),var(--tw-exit-scale,1),var(--tw-exit-scale,1))rotate(var(--tw-exit-=
rotate,0)); }
}

@property --tw-translate-x { syntax: "*"; inherits: false; initial-value: 0=
; }

@property --tw-translate-y { syntax: "*"; inherits: false; initial-value: 0=
; }

@property --tw-translate-z { syntax: "*"; inherits: false; initial-value: 0=
; }

@property --tw-rotate-x { syntax: "*"; inherits: false; }

@property --tw-rotate-y { syntax: "*"; inherits: false; }

@property --tw-rotate-z { syntax: "*"; inherits: false; }

@property --tw-skew-x { syntax: "*"; inherits: false; }

@property --tw-skew-y { syntax: "*"; inherits: false; }

@property --tw-space-y-reverse { syntax: "*"; inherits: false; initial-valu=
e: 0; }

@property --tw-border-style { syntax: "*"; inherits: false; initial-value: =
solid; }

@property --tw-gradient-position { syntax: "*"; inherits: false; }

@property --tw-gradient-from { syntax: "<color>"; inherits: false; initial-=
value: #0000; }

@property --tw-gradient-via { syntax: "<color>"; inherits: false; initial-v=
alue: #0000; }

@property --tw-gradient-to { syntax: "<color>"; inherits: false; initial-va=
lue: #0000; }

@property --tw-gradient-stops { syntax: "*"; inherits: false; }

@property --tw-gradient-via-stops { syntax: "*"; inherits: false; }

@property --tw-gradient-from-position { syntax: "<length-percentage>"; inhe=
rits: false; initial-value: 0; }

@property --tw-gradient-via-position { syntax: "<length-percentage>"; inher=
its: false; initial-value: 50%; }

@property --tw-gradient-to-position { syntax: "<length-percentage>"; inheri=
ts: false; initial-value: 100%; }

@property --tw-leading { syntax: "*"; inherits: false; }

@property --tw-font-weight { syntax: "*"; inherits: false; }

@property --tw-tracking { syntax: "*"; inherits: false; }

@property --tw-ordinal { syntax: "*"; inherits: false; }

@property --tw-slashed-zero { syntax: "*"; inherits: false; }

@property --tw-numeric-figure { syntax: "*"; inherits: false; }

@property --tw-numeric-spacing { syntax: "*"; inherits: false; }

@property --tw-numeric-fraction { syntax: "*"; inherits: false; }

@property --tw-shadow { syntax: "*"; inherits: false; initial-value: 0 0 #0=
000; }

@property --tw-shadow-color { syntax: "*"; inherits: false; }

@property --tw-shadow-alpha { syntax: "<percentage>"; inherits: false; init=
ial-value: 100%; }

@property --tw-inset-shadow { syntax: "*"; inherits: false; initial-value: =
0 0 #0000; }

@property --tw-inset-shadow-color { syntax: "*"; inherits: false; }

@property --tw-inset-shadow-alpha { syntax: "<percentage>"; inherits: false=
; initial-value: 100%; }

@property --tw-ring-color { syntax: "*"; inherits: false; }

@property --tw-ring-shadow { syntax: "*"; inherits: false; initial-value: 0=
 0 #0000; }

@property --tw-inset-ring-color { syntax: "*"; inherits: false; }

@property --tw-inset-ring-shadow { syntax: "*"; inherits: false; initial-va=
lue: 0 0 #0000; }

@property --tw-ring-inset { syntax: "*"; inherits: false; }

@property --tw-ring-offset-width { syntax: "<length>"; inherits: false; ini=
tial-value: 0; }

@property --tw-ring-offset-color { syntax: "*"; inherits: false; initial-va=
lue: #fff; }

@property --tw-ring-offset-shadow { syntax: "*"; inherits: false; initial-v=
alue: 0 0 #0000; }

@property --tw-outline-style { syntax: "*"; inherits: false; initial-value:=
 solid; }

@property --tw-blur { syntax: "*"; inherits: false; }

@property --tw-brightness { syntax: "*"; inherits: false; }

@property --tw-contrast { syntax: "*"; inherits: false; }

@property --tw-grayscale { syntax: "*"; inherits: false; }

@property --tw-hue-rotate { syntax: "*"; inherits: false; }

@property --tw-invert { syntax: "*"; inherits: false; }

@property --tw-opacity { syntax: "*"; inherits: false; }

@property --tw-saturate { syntax: "*"; inherits: false; }

@property --tw-sepia { syntax: "*"; inherits: false; }

@property --tw-drop-shadow { syntax: "*"; inherits: false; }

@property --tw-drop-shadow-color { syntax: "*"; inherits: false; }

@property --tw-drop-shadow-alpha { syntax: "<percentage>"; inherits: false;=
 initial-value: 100%; }

@property --tw-drop-shadow-size { syntax: "*"; inherits: false; }

@property --tw-backdrop-blur { syntax: "*"; inherits: false; }

@property --tw-backdrop-brightness { syntax: "*"; inherits: false; }

@property --tw-backdrop-contrast { syntax: "*"; inherits: false; }

@property --tw-backdrop-grayscale { syntax: "*"; inherits: false; }

@property --tw-backdrop-hue-rotate { syntax: "*"; inherits: false; }

@property --tw-backdrop-invert { syntax: "*"; inherits: false; }

@property --tw-backdrop-opacity { syntax: "*"; inherits: false; }

@property --tw-backdrop-saturate { syntax: "*"; inherits: false; }

@property --tw-backdrop-sepia { syntax: "*"; inherits: false; }

@property --tw-duration { syntax: "*"; inherits: false; }

@property --tw-ease { syntax: "*"; inherits: false; }

@property --tw-content { syntax: "*"; inherits: false; initial-value: ""; }

@keyframes spin {=20
  100% { transform: rotate(1turn); }
}

@keyframes ping {=20
  75%, 100% { opacity: 0; transform: scale(2); }
}

@keyframes pulse {=20
  50% { opacity: 0.5; }
}

@keyframes bounce {=20
  0%, 100% { animation-timing-function: cubic-bezier(0.8, 0, 1, 1); transfo=
rm: translateY(-25%); }
  50% { animation-timing-function: cubic-bezier(0, 0, 0.2, 1); transform: n=
one; }
}

@keyframes shine {=20
  0% { background-position: 100% center; }
}
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: https://deepwiki.com/_next/static/css/de70bee13400563f.css?dpl=dpl_FtMvNrLWw316N3P8owbGd4HX4iEE

@charset "utf-8";

@font-face { font-family: Geist; font-style: normal; font-weight: 100 900; =
font-display: swap; src: url("/_next/static/media/8d697b304b401681-s.woff2"=
) format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U=
+2116; }

@font-face { font-family: Geist; font-style: normal; font-weight: 100 900; =
font-display: swap; src: url("/_next/static/media/ba015fad6dcf6784-s.woff2"=
) format("woff2"); unicode-range: U+100-2BA, U+2BD-2C5, U+2C7-2CC, U+2CE-2D=
7, U+2DD-2FF, U+304, U+308, U+329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U=
+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: Geist; font-style: normal; font-weight: 100 900; =
font-display: swap; src: url("/_next/static/media/4cf2300e9c8272f7-s.p.woff=
2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+=
2C6, U+2DA, U+2DC, U+304, U+308, U+329, U+2000-206F, U+20AC, U+2122, U+2191=
, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Geist Fallback"; src: local("Arial"); ascent-ove=
rride: 95.94%; descent-override: 28.16%; line-gap-override: 0%; size-adjust=
: 104.76%; }

.__className_188709 { font-family: Geist, "Geist Fallback"; font-style: nor=
mal; }

.__variable_188709 { --font-geist-sans: "Geist","Geist Fallback"; }

@font-face { font-family: "Geist Mono"; font-style: normal; font-weight: 10=
0 900; font-display: swap; src: url("/_next/static/media/9610d9e46709d722-s=
.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0=
-4B1, U+2116; }

@font-face { font-family: "Geist Mono"; font-style: normal; font-weight: 10=
0 900; font-display: swap; src: url("/_next/static/media/747892c23ea88013-s=
.woff2") format("woff2"); unicode-range: U+100-2BA, U+2BD-2C5, U+2C7-2CC, U=
+2CE-2D7, U+2DD-2FF, U+304, U+308, U+329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-=
1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Geist Mono"; font-style: normal; font-weight: 10=
0 900; font-display: swap; src: url("/_next/static/media/93f479601ee12b01-s=
.p.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-=
2BC, U+2C6, U+2DA, U+2DC, U+304, U+308, U+329, U+2000-206F, U+20AC, U+2122,=
 U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Geist Mono Fallback"; src: local("Arial"); ascen=
t-override: 74.67%; descent-override: 21.92%; line-gap-override: 0%; size-a=
djust: 134.59%; }

.__className_9a8899 { font-family: "Geist Mono", "Geist Mono Fallback"; fon=
t-style: normal; }

.__variable_9a8899 { --font-geist-mono: "Geist Mono","Geist Mono Fallback";=
 }
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: cid:css-c34f4ee3-a26c-4e7d-b017-59ca33898d51@mhtml.blink

@charset "utf-8";

[data-sonner-toaster][dir=3D"ltr"], html[dir=3D"ltr"] { --toast-icon-margin=
-start: -3px; --toast-icon-margin-end: 4px; --toast-svg-margin-start: -1px;=
 --toast-svg-margin-end: 0px; --toast-button-margin-start: auto; --toast-bu=
tton-margin-end: 0; --toast-close-button-start: 0; --toast-close-button-end=
: unset; --toast-close-button-transform: translate(-35%, -35%); }

[data-sonner-toaster][dir=3D"rtl"], html[dir=3D"rtl"] { --toast-icon-margin=
-start: 4px; --toast-icon-margin-end: -3px; --toast-svg-margin-start: 0px; =
--toast-svg-margin-end: -1px; --toast-button-margin-start: 0; --toast-butto=
n-margin-end: auto; --toast-close-button-start: unset; --toast-close-button=
-end: 0; --toast-close-button-transform: translate(35%, -35%); }

[data-sonner-toaster] { position: fixed; width: var(--width); font-family: =
ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Ro=
boto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji"=
, "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; --gray1: hsl(0, =
0%, 99%); --gray2: hsl(0, 0%, 97.3%); --gray3: hsl(0, 0%, 95.1%); --gray4: =
hsl(0, 0%, 93%); --gray5: hsl(0, 0%, 90.9%); --gray6: hsl(0, 0%, 88.7%); --=
gray7: hsl(0, 0%, 85.8%); --gray8: hsl(0, 0%, 78%); --gray9: hsl(0, 0%, 56.=
1%); --gray10: hsl(0, 0%, 52.3%); --gray11: hsl(0, 0%, 43.5%); --gray12: hs=
l(0, 0%, 9%); --border-radius: 8px; box-sizing: border-box; padding: 0px; m=
argin: 0px; list-style: none; outline: 0px; z-index: 999999999; transition:=
 transform 0.4s; }

@media (hover: none) and (pointer: coarse) {
  [data-sonner-toaster][data-lifted=3D"true"] { transform: none; }
}

[data-sonner-toaster][data-x-position=3D"right"] { right: var(--offset-righ=
t); }

[data-sonner-toaster][data-x-position=3D"left"] { left: var(--offset-left);=
 }

[data-sonner-toaster][data-x-position=3D"center"] { left: 50%; transform: t=
ranslateX(-50%); }

[data-sonner-toaster][data-y-position=3D"top"] { top: var(--offset-top); }

[data-sonner-toaster][data-y-position=3D"bottom"] { bottom: var(--offset-bo=
ttom); }

[data-sonner-toast] { --y: translateY(100%); --lift-amount: calc(var(--lift=
) * var(--gap)); z-index: var(--z-index); position: absolute; opacity: 0; t=
ransform: var(--y); touch-action: none; transition: transform 0.4s, opacity=
 0.4s, height 0.4s, box-shadow 0.2s; box-sizing: border-box; outline: 0px; =
overflow-wrap: anywhere; }

[data-sonner-toast][data-styled=3D"true"] { padding: 16px; background: var(=
--normal-bg); border: 1px solid var(--normal-border); color: var(--normal-t=
ext); border-radius: var(--border-radius); box-shadow: rgba(0, 0, 0, 0.1) 0=
px 4px 12px; width: var(--width); font-size: 13px; display: flex; align-ite=
ms: center; gap: 6px; }

[data-sonner-toast]:focus-visible { box-shadow: rgba(0, 0, 0, 0.1) 0px 4px =
12px, rgba(0, 0, 0, 0.2) 0px 0px 0px 2px; }

[data-sonner-toast][data-y-position=3D"top"] { top: 0px; --y: translateY(-1=
00%); --lift: 1; --lift-amount: calc(1 * var(--gap)); }

[data-sonner-toast][data-y-position=3D"bottom"] { bottom: 0px; --y: transla=
teY(100%); --lift: -1; --lift-amount: calc(var(--lift) * var(--gap)); }

[data-sonner-toast][data-styled=3D"true"] [data-description] { font-weight:=
 400; line-height: 1.4; color: rgb(63, 63, 63); }

[data-rich-colors=3D"true"][data-sonner-toast][data-styled=3D"true"] [data-=
description] { color: inherit; }

[data-sonner-toaster][data-sonner-theme=3D"dark"] [data-description] { colo=
r: rgb(232, 232, 232); }

[data-sonner-toast][data-styled=3D"true"] [data-title] { font-weight: 500; =
line-height: 1.5; color: inherit; }

[data-sonner-toast][data-styled=3D"true"] [data-icon] { display: flex; heig=
ht: 16px; width: 16px; position: relative; justify-content: flex-start; ali=
gn-items: center; flex-shrink: 0; margin-left: var(--toast-icon-margin-star=
t); margin-right: var(--toast-icon-margin-end); }

[data-sonner-toast][data-promise=3D"true"] [data-icon] > svg { opacity: 0; =
transform: scale(0.8); transform-origin: center center; animation: 0.3s eas=
e 0s 1 normal forwards running sonner-fade-in; }

[data-sonner-toast][data-styled=3D"true"] [data-icon] > * { flex-shrink: 0;=
 }

[data-sonner-toast][data-styled=3D"true"] [data-icon] svg { margin-left: va=
r(--toast-svg-margin-start); margin-right: var(--toast-svg-margin-end); }

[data-sonner-toast][data-styled=3D"true"] [data-content] { display: flex; f=
lex-direction: column; gap: 2px; }

[data-sonner-toast][data-styled=3D"true"] [data-button] { border-radius: 4p=
x; padding-left: 8px; padding-right: 8px; height: 24px; font-size: 12px; co=
lor: var(--normal-bg); background: var(--normal-text); margin-left: var(--t=
oast-button-margin-start); margin-right: var(--toast-button-margin-end); bo=
rder: none; font-weight: 500; cursor: pointer; outline: 0px; display: flex;=
 align-items: center; flex-shrink: 0; transition: opacity 0.4s, box-shadow =
0.2s; }

[data-sonner-toast][data-styled=3D"true"] [data-button]:focus-visible { box=
-shadow: rgba(0, 0, 0, 0.4) 0px 0px 0px 2px; }

[data-sonner-toast][data-styled=3D"true"] [data-button]:first-of-type { mar=
gin-left: var(--toast-button-margin-start); margin-right: var(--toast-butto=
n-margin-end); }

[data-sonner-toast][data-styled=3D"true"] [data-cancel] { color: var(--norm=
al-text); background: rgba(0, 0, 0, 0.08); }

[data-sonner-toaster][data-sonner-theme=3D"dark"] [data-sonner-toast][data-=
styled=3D"true"] [data-cancel] { background: rgba(255, 255, 255, 0.3); }

[data-sonner-toast][data-styled=3D"true"] [data-close-button] { position: a=
bsolute; left: var(--toast-close-button-start); right: var(--toast-close-bu=
tton-end); top: 0px; height: 20px; width: 20px; display: flex; justify-cont=
ent: center; align-items: center; padding: 0px; color: var(--gray12); backg=
round: var(--normal-bg); border: 1px solid var(--gray4); transform: var(--t=
oast-close-button-transform); border-radius: 50%; cursor: pointer; z-index:=
 1; transition: opacity 0.1s, background 0.2s, border-color 0.2s; }

[data-sonner-toast][data-styled=3D"true"] [data-close-button]:focus-visible=
 { box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px, rgba(0, 0, 0, 0.2) 0px 0px =
0px 2px; }

[data-sonner-toast][data-styled=3D"true"] [data-disabled=3D"true"] { cursor=
: not-allowed; }

[data-sonner-toast][data-styled=3D"true"]:hover [data-close-button]:hover {=
 background: var(--gray2); border-color: var(--gray5); }

[data-sonner-toast][data-swiping=3D"true"]::before { content: ""; position:=
 absolute; left: -100%; right: -100%; height: 100%; z-index: -1; }

[data-sonner-toast][data-y-position=3D"top"][data-swiping=3D"true"]::before=
 { bottom: 50%; transform: scaleY(3) translateY(50%); }

[data-sonner-toast][data-y-position=3D"bottom"][data-swiping=3D"true"]::bef=
ore { top: 50%; transform: scaleY(3) translateY(-50%); }

[data-sonner-toast][data-swiping=3D"false"][data-removed=3D"true"]::before =
{ content: ""; position: absolute; inset: 0px; transform: scaleY(2); }

[data-sonner-toast][data-expanded=3D"true"]::after { content: ""; position:=
 absolute; left: 0px; height: calc(var(--gap) + 1px); bottom: 100%; width: =
100%; }

[data-sonner-toast][data-mounted=3D"true"] { --y: translateY(0); opacity: 1=
; }

[data-sonner-toast][data-expanded=3D"false"][data-front=3D"false"] { --scal=
e: var(--toasts-before) * 0.05 + 1; --y: translateY(calc(var(--lift-amount)=
 * var(--toasts-before))) scale(calc(-1 * var(--scale))); height: var(--fro=
nt-toast-height); }

[data-sonner-toast] > * { transition: opacity 0.4s; }

[data-sonner-toast][data-x-position=3D"right"] { right: 0px; }

[data-sonner-toast][data-x-position=3D"left"] { left: 0px; }

[data-sonner-toast][data-expanded=3D"false"][data-front=3D"false"][data-sty=
led=3D"true"] > * { opacity: 0; }

[data-sonner-toast][data-visible=3D"false"] { opacity: 0; pointer-events: n=
one; }

[data-sonner-toast][data-mounted=3D"true"][data-expanded=3D"true"] { --y: t=
ranslateY(calc(var(--lift) * var(--offset))); height: var(--initial-height)=
; }

[data-sonner-toast][data-removed=3D"true"][data-front=3D"true"][data-swipe-=
out=3D"false"] { --y: translateY(calc(var(--lift) * -100%)); opacity: 0; }

[data-sonner-toast][data-removed=3D"true"][data-front=3D"false"][data-swipe=
-out=3D"false"][data-expanded=3D"true"] { --y: translateY(calc(var(--lift) =
* var(--offset) + var(--lift) * -100%)); opacity: 0; }

[data-sonner-toast][data-removed=3D"true"][data-front=3D"false"][data-swipe=
-out=3D"false"][data-expanded=3D"false"] { --y: translateY(40%); opacity: 0=
; transition: transform 0.5s, opacity 0.2s; }

[data-sonner-toast][data-removed=3D"true"][data-front=3D"false"]::before { =
height: calc(var(--initial-height) + 20%); }

[data-sonner-toast][data-swiping=3D"true"] { transform: var(--y) translateY=
(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0)); transition: =
none; }

[data-sonner-toast][data-swiped=3D"true"] { user-select: none; }

[data-sonner-toast][data-swipe-out=3D"true"][data-y-position=3D"bottom"], [=
data-sonner-toast][data-swipe-out=3D"true"][data-y-position=3D"top"] { anim=
ation-duration: 0.2s; animation-timing-function: ease-out; animation-fill-m=
ode: forwards; }

[data-sonner-toast][data-swipe-out=3D"true"][data-swipe-direction=3D"left"]=
 { animation-name: swipe-out-left; }

[data-sonner-toast][data-swipe-out=3D"true"][data-swipe-direction=3D"right"=
] { animation-name: swipe-out-right; }

[data-sonner-toast][data-swipe-out=3D"true"][data-swipe-direction=3D"up"] {=
 animation-name: swipe-out-up; }

[data-sonner-toast][data-swipe-out=3D"true"][data-swipe-direction=3D"down"]=
 { animation-name: swipe-out-down; }

@keyframes swipe-out-left {=20
  0% { transform: var(--y) translateX(var(--swipe-amount-x)); opacity: 1; }
  100% { transform: var(--y) translateX(calc(var(--swipe-amount-x) - 100%))=
; opacity: 0; }
}

@keyframes swipe-out-right {=20
  0% { transform: var(--y) translateX(var(--swipe-amount-x)); opacity: 1; }
  100% { transform: var(--y) translateX(calc(var(--swipe-amount-x) + 100%))=
; opacity: 0; }
}

@keyframes swipe-out-up {=20
  0% { transform: var(--y) translateY(var(--swipe-amount-y)); opacity: 1; }
  100% { transform: var(--y) translateY(calc(var(--swipe-amount-y) - 100%))=
; opacity: 0; }
}

@keyframes swipe-out-down {=20
  0% { transform: var(--y) translateY(var(--swipe-amount-y)); opacity: 1; }
  100% { transform: var(--y) translateY(calc(var(--swipe-amount-y) + 100%))=
; opacity: 0; }
}

@media (max-width: 600px) {
  [data-sonner-toaster] { position: fixed; right: var(--mobile-offset-right=
); left: var(--mobile-offset-left); width: 100%; }
  [data-sonner-toaster][dir=3D"rtl"] { left: calc(var(--mobile-offset-left)=
 * -1); }
  [data-sonner-toaster] [data-sonner-toast] { left: 0px; right: 0px; width:=
 calc(100% - var(--mobile-offset-left) * 2); }
  [data-sonner-toaster][data-x-position=3D"left"] { left: var(--mobile-offs=
et-left); }
  [data-sonner-toaster][data-y-position=3D"bottom"] { bottom: var(--mobile-=
offset-bottom); }
  [data-sonner-toaster][data-y-position=3D"top"] { top: var(--mobile-offset=
-top); }
  [data-sonner-toaster][data-x-position=3D"center"] { left: var(--mobile-of=
fset-left); right: var(--mobile-offset-right); transform: none; }
}

[data-sonner-toaster][data-sonner-theme=3D"light"] { --normal-bg: #fff; --n=
ormal-border: var(--gray4); --normal-text: var(--gray12); --success-bg: hsl=
(143, 85%, 96%); --success-border: hsl(145, 92%, 87%); --success-text: hsl(=
140, 100%, 27%); --info-bg: hsl(208, 100%, 97%); --info-border: hsl(221, 91=
%, 93%); --info-text: hsl(210, 92%, 45%); --warning-bg: hsl(49, 100%, 97%);=
 --warning-border: hsl(49, 91%, 84%); --warning-text: hsl(31, 92%, 45%); --=
error-bg: hsl(359, 100%, 97%); --error-border: hsl(359, 100%, 94%); --error=
-text: hsl(360, 100%, 45%); }

[data-sonner-toaster][data-sonner-theme=3D"light"] [data-sonner-toast][data=
-invert=3D"true"] { --normal-bg: #000; --normal-border: hsl(0, 0%, 20%); --=
normal-text: var(--gray1); }

[data-sonner-toaster][data-sonner-theme=3D"dark"] [data-sonner-toast][data-=
invert=3D"true"] { --normal-bg: #fff; --normal-border: var(--gray3); --norm=
al-text: var(--gray12); }

[data-sonner-toaster][data-sonner-theme=3D"dark"] { --normal-bg: #000; --no=
rmal-bg-hover: hsl(0, 0%, 12%); --normal-border: hsl(0, 0%, 20%); --normal-=
border-hover: hsl(0, 0%, 25%); --normal-text: var(--gray1); --success-bg: h=
sl(150, 100%, 6%); --success-border: hsl(147, 100%, 12%); --success-text: h=
sl(150, 86%, 65%); --info-bg: hsl(215, 100%, 6%); --info-border: hsl(223, 4=
3%, 17%); --info-text: hsl(216, 87%, 65%); --warning-bg: hsl(64, 100%, 6%);=
 --warning-border: hsl(60, 100%, 9%); --warning-text: hsl(46, 87%, 65%); --=
error-bg: hsl(358, 76%, 10%); --error-border: hsl(357, 89%, 16%); --error-t=
ext: hsl(358, 100%, 81%); }

[data-sonner-toaster][data-sonner-theme=3D"dark"] [data-sonner-toast] [data=
-close-button] { background: var(--normal-bg); border-color: var(--normal-b=
order); color: var(--normal-text); }

[data-sonner-toaster][data-sonner-theme=3D"dark"] [data-sonner-toast] [data=
-close-button]:hover { background: var(--normal-bg-hover); border-color: va=
r(--normal-border-hover); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"success"] { bac=
kground: var(--success-bg); border-color: var(--success-border); color: var=
(--success-text); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"success"] [data=
-close-button] { background: var(--success-bg); border-color: var(--success=
-border); color: var(--success-text); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"info"] { backgr=
ound: var(--info-bg); border-color: var(--info-border); color: var(--info-t=
ext); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"info"] [data-cl=
ose-button] { background: var(--info-bg); border-color: var(--info-border);=
 color: var(--info-text); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"warning"] { bac=
kground: var(--warning-bg); border-color: var(--warning-border); color: var=
(--warning-text); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"warning"] [data=
-close-button] { background: var(--warning-bg); border-color: var(--warning=
-border); color: var(--warning-text); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"error"] { backg=
round: var(--error-bg); border-color: var(--error-border); color: var(--err=
or-text); }

[data-rich-colors=3D"true"][data-sonner-toast][data-type=3D"error"] [data-c=
lose-button] { background: var(--error-bg); border-color: var(--error-borde=
r); color: var(--error-text); }

.sonner-loading-wrapper { --size: 16px; height: var(--size); width: var(--s=
ize); position: absolute; inset: 0px; z-index: 10; }

.sonner-loading-wrapper[data-visible=3D"false"] { transform-origin: center =
center; animation: 0.2s ease 0s 1 normal forwards running sonner-fade-out; =
}

.sonner-spinner { position: relative; top: 50%; left: 50%; height: var(--si=
ze); width: var(--size); }

.sonner-loading-bar { animation: 1.2s linear 0s infinite normal none runnin=
g sonner-spin; background: var(--gray11); border-radius: 6px; height: 8%; l=
eft: -10%; position: absolute; top: -3.9%; width: 24%; }

.sonner-loading-bar:first-child { animation-delay: -1.2s; transform: rotate=
(0.0001deg) translate(146%); }

.sonner-loading-bar:nth-child(2) { animation-delay: -1.1s; transform: rotat=
e(30deg) translate(146%); }

.sonner-loading-bar:nth-child(3) { animation-delay: -1s; transform: rotate(=
60deg) translate(146%); }

.sonner-loading-bar:nth-child(4) { animation-delay: -0.9s; transform: rotat=
e(90deg) translate(146%); }

.sonner-loading-bar:nth-child(5) { animation-delay: -0.8s; transform: rotat=
e(120deg) translate(146%); }

.sonner-loading-bar:nth-child(6) { animation-delay: -0.7s; transform: rotat=
e(150deg) translate(146%); }

.sonner-loading-bar:nth-child(7) { animation-delay: -0.6s; transform: rotat=
e(180deg) translate(146%); }

.sonner-loading-bar:nth-child(8) { animation-delay: -0.5s; transform: rotat=
e(210deg) translate(146%); }

.sonner-loading-bar:nth-child(9) { animation-delay: -0.4s; transform: rotat=
e(240deg) translate(146%); }

.sonner-loading-bar:nth-child(10) { animation-delay: -0.3s; transform: rota=
te(270deg) translate(146%); }

.sonner-loading-bar:nth-child(11) { animation-delay: -0.2s; transform: rota=
te(300deg) translate(146%); }

.sonner-loading-bar:nth-child(12) { animation-delay: -0.1s; transform: rota=
te(330deg) translate(146%); }

@keyframes sonner-fade-in {=20
  0% { opacity: 0; transform: scale(0.8); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes sonner-fade-out {=20
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.8); }
}

@keyframes sonner-spin {=20
  0% { opacity: 1; }
  100% { opacity: 0.15; }
}

@media (prefers-reduced-motion) {
  .sonner-loading-bar, [data-sonner-toast], [data-sonner-toast] > * { trans=
ition: none !important; animation: auto ease 0s 1 normal none running none =
!important; }
}

.sonner-loader { position: absolute; top: 50%; left: 50%; transform: transl=
ate(-50%, -50%); transform-origin: center center; transition: opacity 0.2s,=
 transform 0.2s; }

.sonner-loader[data-visible=3D"false"] { opacity: 0; transform: scale(0.8) =
translate(-50%, -50%); }
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: cid:css-fc5d1e29-5ad3-423d-96b7-7036dc7852eb@mhtml.blink

@charset "utf-8";

.index_highlightSelector__-qiHd { background-color: rgb(250, 250, 250) !imp=
ortant; outline: rgb(25, 118, 210) dashed 3px !important; opacity: 0.8 !imp=
ortant; cursor: pointer !important; transition: opacity 0.5s !important; }
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: cid:css-8f13f30f-e936-48e8-9f7d-c91f6ef3a077@mhtml.blink

@charset "utf-8";

#index_crossLine__2WHMH { position: fixed; height: 100%; width: 100%; z-ind=
ex: 2147483645; }

#index_crossLine__2WHMH::before { border-top: none; border-left: none; bord=
er-image: initial; content: ""; height: 100%; position: absolute; width: 10=
0%; z-index: 2147483645; border-right: 1px solid red; border-bottom: 1px so=
lid red; left: -100%; top: -100%; }

#index_crossLine__2WHMH::after { border-right: none; border-bottom: none; b=
order-image: initial; content: ""; height: 100%; position: absolute; width:=
 100%; z-index: 2147483645; border-top: 1px solid red; border-left: 1px sol=
id red; left: 0px; top: 0px; }

#index_selectArea__2G3Z3 { border: 1px solid red; position: fixed; z-index:=
 2147483645; }
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/css
Content-Transfer-Encoding: quoted-printable
Content-Location: cid:css-63b151db-15ef-4a4f-a85c-f690b81c1375@mhtml.blink

@charset "utf-8";

.src-service-contentScript-browser-contentScript-contentScript__toolFrame--=
2uksu { position: fixed !important; right: 0px !important; top: 0px !import=
ant; width: 100% !important; height: 100% !important; z-index: 2147483646 !=
important; border: none !important; }

.src-service-contentScript-browser-contentScript-contentScript__web-clipper=
-loading-box--fHTwh { position: fixed; right: 0px; top: 0px; width: 100%; h=
eight: 100%; z-index: 2147483646; border: none; }

.src-service-contentScript-browser-contentScript-contentScript__web-clipper=
-loading-box--fHTwh .web-clipper-loading { position: fixed; right: 10px; to=
p: 10px; box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 12px 0px; background: white=
; width: 324px; height: 150px; display: flex; align-items: center; justify-=
content: center; }

.src-service-contentScript-browser-contentScript-contentScript__web-clipper=
-loading-box--fHTwh .web-clipper-loading .line { animation: 1s ease-in-out =
0s infinite normal none running src-service-contentScript-browser-contentSc=
ript-contentScript__expand--31ZFO; border-radius: 10px; display: inline-blo=
ck; transform-origin: center center; margin: 0px 3px; width: 1px; height: 2=
5px; }

.src-service-contentScript-browser-contentScript-contentScript__web-clipper=
-loading-box--fHTwh .web-clipper-loading .line:nth-child(1) { background: r=
gb(39, 174, 96); }

.src-service-contentScript-browser-contentScript-contentScript__web-clipper=
-loading-box--fHTwh .web-clipper-loading .line:nth-child(2) { animation-del=
ay: 180ms; background: rgb(241, 196, 15); }

.src-service-contentScript-browser-contentScript-contentScript__web-clipper=
-loading-box--fHTwh .web-clipper-loading .line:nth-child(3) { animation-del=
ay: 360ms; background: rgb(230, 126, 34); }

.src-service-contentScript-browser-contentScript-contentScript__web-clipper=
-loading-box--fHTwh .web-clipper-loading .line:nth-child(4) { animation-del=
ay: 540ms; background: rgb(41, 128, 185); }

@keyframes src-service-contentScript-browser-contentScript-contentScript__e=
xpand--31ZFO {=20
  0% { transform: scale(1); }
  25% { transform: scale(2); }
}
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8----
Content-Type: text/html
Content-ID: <frame-620E8B284DE4836F2F88CED27D770CE7@mhtml.blink>
Content-Transfer-Encoding: quoted-printable

<html><head><meta http-equiv=3D"Content-Type" content=3D"text/html; charset=
=3DUTF-8"></head><body></body></html>
------MultipartBoundary--OjhcIXtRHXlfEO0CCusFg7SBewkwi63ZHG6tRikWg8------
